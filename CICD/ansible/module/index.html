<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>常用模块 | 代码推演录</title><meta name="author" content="Aquarius"><meta name="copyright" content="Aquarius"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="1 命令执行相关1.1 Command 模块功能：在远程主机执行命令，此为默认模块，可忽略 -m 选项，但有些操作不支持，比如管道，重定向，通配符等，如果要实现这些功能，可以用 shell 模块实现 注意：此命令不支持 $VARNAME &lt; &gt; | ; &amp; 等，可能用shell模块实现 注意：此模块不具有幂等性 常见选项 123chdir&#x3D;dir    #执行命令前,先切换至目">
<meta property="og:type" content="article">
<meta property="og:title" content="常用模块">
<meta property="og:url" content="https://aquapluto.github.io/CICD/ansible/module/">
<meta property="og:site_name" content="代码推演录">
<meta property="og:description" content="1 命令执行相关1.1 Command 模块功能：在远程主机执行命令，此为默认模块，可忽略 -m 选项，但有些操作不支持，比如管道，重定向，通配符等，如果要实现这些功能，可以用 shell 模块实现 注意：此命令不支持 $VARNAME &lt; &gt; | ; &amp; 等，可能用shell模块实现 注意：此模块不具有幂等性 常见选项 123chdir&#x3D;dir    #执行命令前,先切换至目">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://aquapluto.github.io/img/paper4.png">
<meta property="article:published_time" content="2025-09-13T10:07:42.000Z">
<meta property="article:modified_time" content="2025-09-13T13:22:38.575Z">
<meta property="article:author" content="Aquarius">
<meta property="article:tag" content="Ansible">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://aquapluto.github.io/img/paper4.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "常用模块",
  "url": "https://aquapluto.github.io/CICD/ansible/module/",
  "image": "https://aquapluto.github.io/img/paper4.png",
  "datePublished": "2025-09-13T10:07:42.000Z",
  "dateModified": "2025-09-13T13:22:38.575Z",
  "author": [
    {
      "@type": "Person",
      "name": "Aquarius",
      "url": "https://AquaPluto.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://aquapluto.github.io/CICD/ansible/module/"><link rel="preconnect" href="//unpkg.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://unpkg.com/@fancyapps/ui/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":true,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://unpkg.com/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '常用模块',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/wave.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(/img/background.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avator.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">138</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="menus_items"><!-- 一级菜单项（非目录）--><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>计算机基础</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>计算机组成原理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/hardware-composition/"><span>计算机硬件组成</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/CPU/"><span>CPU</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/memory/"><span>内存</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/hard-disk/"><span>硬盘</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>操作系统</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/concept/"><span>操作系统的概念</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/processes-threads/"><span>进程与线程</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/IO-model/"><span>IO模型</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Linux</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>linux基础</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/introduce/"><span>linux介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/file-structure-and-IO-redirects/"><span>文件结构与IO重定向</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/file-command/"><span>文件管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/text-command/"><span>文本管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/GSA/"><span>文本处理三剑客</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/user-permission/"><span>用户和权限管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/regular-expression/"><span>正则表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/software-manage/"><span>软件包管理</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>进程管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/command/"><span>进程相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/signal/"><span>信号发送</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/job-parallel/"><span>作业管理与并行运行</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/OOM/"><span>OOM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>磁盘管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/disk-partition/"><span>磁盘分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/file-system/"><span>文件系统</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/swap/"><span>Swap分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/LVM/"><span>逻辑卷管理器LVM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>网络管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/configuration/"><span>网络配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/test-diagnostic/"><span>网络测试诊断工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/bridge/"><span>网桥配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/troubleshoot/"><span>网络问题排查</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/DNS/"><span>域名DNS解析服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/time-synchronization/"><span>时间同步服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/plan-tasks/"><span>计划任务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/log/"><span>日志服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/data-synchronization/"><span>数据的实时同步</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/ssh/"><span>ssh远程连接服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/mail/"><span>邮件服务</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/kernel-manage/"><span>内核和启动管理</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>防火墙</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/introduce/"><span>安全技术和防火墙</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/iptables/"><span>iptables</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/firewalld/"><span>firewalld</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/nft/"><span>nft</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>加密和安全</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/security-mechanisms/"><span>安全机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/OpenSSL/"><span>OpenSSL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/sudo/"><span>sudo实现授权</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/PAM/"><span>PAM认证机制</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>shell编程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/introduce/"><span>shell脚本介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/variable/"><span>变量</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/operations-conditional/"><span>运算和条件测试</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-control/"><span>流程控制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/function/"><span>函数</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/array/"><span>数组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/string/"><span>字符串</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/script-tools/"><span>脚本相关工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-lock/"><span>进程锁</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/queue/"><span>队列实现线程并发控制</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/system-optimization/"><span>系统优化</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>数据库</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>MySQL</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/DataBase/MySQL/SQL/"><span>SQL语句</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Redis</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/DataBase/Redis/deploy/"><span>部署安装</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>中间件</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Nginx</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Nginx/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>HAProxy</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/HAProxy/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Keepalived</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Keepalived/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kafka</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Kafka/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Tomcat</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Tomcat/111/"><span>111</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>日志</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>存储</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Storage/conspect/"><span>存储概论</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Storage/nfs/"><span>NFS</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>容器</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/basics/"><span>容器基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Docker</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/conspect/"><span>Docker概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/image/"><span>镜像管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/container/"><span>容器管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/volume/"><span>数据卷</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/network/"><span>网络管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/compose/"><span>Docker-Compose</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>镜像</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/conspect/"><span>镜像概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/dockerfile/"><span>dockerfile</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/build/"><span>构建镜像</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/harbor/"><span>镜像仓库</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>容器进程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/management/"><span>容器里的进程管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/cpu-cgroup/"><span>cpu cgroup使用</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/cpu-usage/"><span>监控容器真实的cpu使用率</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/memory/"><span>容器内存</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/storage/"><span>容器存储</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/network/"><span>容器网络</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/safe/"><span>容器安全</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/containerd/"><span>Containerd</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>K8s</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kubernetes概论</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/architecture/"><span>Kubernetes架构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/cri/"><span>容器运行时接口CRI</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/list-watch/"><span>List-Watch机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/object/"><span>Kubernetes对象</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/namespace/"><span>Namespace</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/kubectl/"><span>kubectl命令</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>部署安装</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/explanation/"><span>部署说明</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/docker/"><span>基于docker部署k8s-v1.30</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/containerd/"><span>基于containerd部署k8s-v1.30</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/cluster/"><span>集群管理指南</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Pod</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/conspect/"><span>Pod概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/configuration/"><span>Pod的配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/schedule/"><span>Pod的调度</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/eviction/"><span>Pod的驱逐</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>控制器</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/introduce/"><span>控制器介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/deployment/"><span>Deployment</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/statefulset/"><span>StatefulSet</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/daemonset/"><span>DaemonSet</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/job-cronjob/"><span>Job和CronJob</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/HPA/"><span>HPA</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/operator/"><span>Operator</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务发现与负载均衡</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/service/"><span>Service</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/ingress/"><span>Ingress</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/coredns/"><span>CoreDNS</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/localdns/"><span>LocalDNS</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>数据存储持久化</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/csi/"><span>存储接口CSI</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/pv-pvc/"><span>PV和PVC</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/storageclass/"><span>StorageClass</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/configmap-secret/"><span>ConfigMap和Secret</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>认证与鉴权体系</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/conspect/"><span>体系概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/kubeconfig/"><span>kubeconfig</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/user-account/"><span>User Account</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/service-account/"><span>Service Account</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>监控</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/conspect/"><span>监控概论</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Prometheus</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/introduce/"><span>prometheus概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/exporter/"><span>Exporter</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/promql/"><span>PromQL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/query-persist/"><span>查询结果持久化</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/service-discovery/"><span>服务发现</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/indicators-remarked/"><span>指标重新打标</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/pushmanager/"><span>Pushmanager</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/cluster-ha/"><span>集群与高可用</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Alertmanager</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/introduce/"><span>告警功能概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/alarm/"><span>实现告警功能</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/ha/"><span>高可用架构</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/grafana/"><span>Grafana</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/streaming/"><span>基于流处理的可观测性架构</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>CICD</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Ansible</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/introduce/"><span>架构概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/command/"><span>相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/module/"><span>常用模块</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/playbook/"><span>PlayBook</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>SRE</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/SRE/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Python</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>python基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>线性表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>列表</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>元组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字符串</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>哈希表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>封装与解构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>集合</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字典</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>解析式与生成器表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>函数</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>IO操作</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>面向对象编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>并发编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>网络编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>数据库编程</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Django</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/paper4.png);"><nav id="nav"><!-- 左侧博客信息区域--><span id="blog-info"><a class="nav-site-title" href="/"></a><a class="nav-page-title" href="/"><span class="site-name">常用模块</span></a></span><!-- 新增的导航菜单容器（居中布局关键）--><div id="nav-menus-container"><!-- 菜单主体部分--><div id="menus"><!-- 菜单项--><div class="menus_items"><!-- 一级菜单项（非目录）--><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>计算机基础</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>计算机组成原理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/hardware-composition/"><span>计算机硬件组成</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/CPU/"><span>CPU</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/memory/"><span>内存</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/hard-disk/"><span>硬盘</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>操作系统</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/concept/"><span>操作系统的概念</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/processes-threads/"><span>进程与线程</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/IO-model/"><span>IO模型</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Linux</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>linux基础</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/introduce/"><span>linux介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/file-structure-and-IO-redirects/"><span>文件结构与IO重定向</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/file-command/"><span>文件管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/text-command/"><span>文本管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/GSA/"><span>文本处理三剑客</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/user-permission/"><span>用户和权限管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/regular-expression/"><span>正则表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/software-manage/"><span>软件包管理</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>进程管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/command/"><span>进程相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/signal/"><span>信号发送</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/job-parallel/"><span>作业管理与并行运行</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/OOM/"><span>OOM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>磁盘管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/disk-partition/"><span>磁盘分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/file-system/"><span>文件系统</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/swap/"><span>Swap分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/LVM/"><span>逻辑卷管理器LVM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>网络管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/configuration/"><span>网络配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/test-diagnostic/"><span>网络测试诊断工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/bridge/"><span>网桥配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/troubleshoot/"><span>网络问题排查</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/DNS/"><span>域名DNS解析服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/time-synchronization/"><span>时间同步服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/plan-tasks/"><span>计划任务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/log/"><span>日志服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/data-synchronization/"><span>数据的实时同步</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/ssh/"><span>ssh远程连接服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/mail/"><span>邮件服务</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/kernel-manage/"><span>内核和启动管理</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>防火墙</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/introduce/"><span>安全技术和防火墙</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/iptables/"><span>iptables</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/firewalld/"><span>firewalld</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/nft/"><span>nft</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>加密和安全</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/security-mechanisms/"><span>安全机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/OpenSSL/"><span>OpenSSL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/sudo/"><span>sudo实现授权</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/PAM/"><span>PAM认证机制</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>shell编程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/introduce/"><span>shell脚本介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/variable/"><span>变量</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/operations-conditional/"><span>运算和条件测试</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-control/"><span>流程控制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/function/"><span>函数</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/array/"><span>数组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/string/"><span>字符串</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/script-tools/"><span>脚本相关工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-lock/"><span>进程锁</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/queue/"><span>队列实现线程并发控制</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/system-optimization/"><span>系统优化</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>数据库</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>MySQL</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/DataBase/MySQL/SQL/"><span>SQL语句</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Redis</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/DataBase/Redis/deploy/"><span>部署安装</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>中间件</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Nginx</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Nginx/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>HAProxy</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/HAProxy/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Keepalived</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Keepalived/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kafka</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Kafka/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Tomcat</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Tomcat/111/"><span>111</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>日志</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>存储</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Storage/conspect/"><span>存储概论</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Storage/nfs/"><span>NFS</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>容器</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/basics/"><span>容器基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Docker</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/conspect/"><span>Docker概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/image/"><span>镜像管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/container/"><span>容器管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/volume/"><span>数据卷</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/network/"><span>网络管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/compose/"><span>Docker-Compose</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>镜像</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/conspect/"><span>镜像概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/dockerfile/"><span>dockerfile</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/build/"><span>构建镜像</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/harbor/"><span>镜像仓库</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>容器进程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/management/"><span>容器里的进程管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/cpu-cgroup/"><span>cpu cgroup使用</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/cpu-usage/"><span>监控容器真实的cpu使用率</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/memory/"><span>容器内存</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/storage/"><span>容器存储</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/network/"><span>容器网络</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/safe/"><span>容器安全</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/containerd/"><span>Containerd</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>K8s</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kubernetes概论</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/architecture/"><span>Kubernetes架构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/cri/"><span>容器运行时接口CRI</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/list-watch/"><span>List-Watch机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/object/"><span>Kubernetes对象</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/namespace/"><span>Namespace</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/kubectl/"><span>kubectl命令</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>部署安装</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/explanation/"><span>部署说明</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/docker/"><span>基于docker部署k8s-v1.30</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/containerd/"><span>基于containerd部署k8s-v1.30</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/cluster/"><span>集群管理指南</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Pod</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/conspect/"><span>Pod概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/configuration/"><span>Pod的配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/schedule/"><span>Pod的调度</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/eviction/"><span>Pod的驱逐</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>控制器</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/introduce/"><span>控制器介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/deployment/"><span>Deployment</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/statefulset/"><span>StatefulSet</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/daemonset/"><span>DaemonSet</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/job-cronjob/"><span>Job和CronJob</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/HPA/"><span>HPA</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/operator/"><span>Operator</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务发现与负载均衡</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/service/"><span>Service</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/ingress/"><span>Ingress</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/coredns/"><span>CoreDNS</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/localdns/"><span>LocalDNS</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>数据存储持久化</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/csi/"><span>存储接口CSI</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/pv-pvc/"><span>PV和PVC</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/storageclass/"><span>StorageClass</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/configmap-secret/"><span>ConfigMap和Secret</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>认证与鉴权体系</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/conspect/"><span>体系概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/kubeconfig/"><span>kubeconfig</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/user-account/"><span>User Account</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/service-account/"><span>Service Account</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>监控</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/conspect/"><span>监控概论</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Prometheus</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/introduce/"><span>prometheus概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/exporter/"><span>Exporter</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/promql/"><span>PromQL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/query-persist/"><span>查询结果持久化</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/service-discovery/"><span>服务发现</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/indicators-remarked/"><span>指标重新打标</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/pushmanager/"><span>Pushmanager</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/cluster-ha/"><span>集群与高可用</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Alertmanager</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/introduce/"><span>告警功能概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/alarm/"><span>实现告警功能</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/ha/"><span>高可用架构</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/grafana/"><span>Grafana</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/streaming/"><span>基于流处理的可观测性架构</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>CICD</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Ansible</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/introduce/"><span>架构概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/command/"><span>相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/module/"><span>常用模块</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/playbook/"><span>PlayBook</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>SRE</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/SRE/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Python</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>python基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>线性表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>列表</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>元组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字符串</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>哈希表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>封装与解构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>集合</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字典</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>解析式与生成器表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>函数</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>IO操作</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>面向对象编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>并发编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>网络编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>数据库编程</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Django</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div></div></div></div><!-- 右侧功能区域（新增容器）--><div id="nav-right-container"><!-- 搜索按钮（移动到右侧）--><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i></span></div><!-- 移动端汉堡菜单按钮--><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">常用模块</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-09-13T10:07:42.000Z" title="发表于 2025-09-13 18:07">2025-09-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-13T13:22:38.575Z" title="更新于 2025-09-13 21:22">2025-09-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CICD/">CICD</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">13.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>63分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="1-命令执行相关"><a href="#1-命令执行相关" class="headerlink" title="1 命令执行相关"></a>1 命令执行相关</h1><h2 id="1-1-Command-模块"><a href="#1-1-Command-模块" class="headerlink" title="1.1 Command 模块"></a>1.1 Command 模块</h2><p>功能：在远程主机执行命令，此为默认模块，可忽略 -m 选项，但有些操作不支持，比如管道，重定向，通配符等，如果要实现这些功能，可以用 shell 模块实现</p>
<p>注意：此命令不支持 $VARNAME &lt; &gt; | ; &amp; 等，可能用shell模块实现</p>
<p>注意：此模块不具有幂等性</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chdir</span>=<span class="built_in">dir</span>    <span class="comment">#执行命令前,先切换至目录dir</span></span><br><span class="line">creates=file <span class="comment">#当file不存在时才会执行</span></span><br><span class="line">removes=file <span class="comment">#当file存在时才会执行</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#远程主机</span></span><br><span class="line">[root@ubuntu ~]# ll /root/test</span><br><span class="line">total 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#当/root/test/abc不存在时执行</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m <span class="built_in">command</span> -a <span class="string">&quot;chdir=/root/test creates=/root/test/abc touch abc&quot;</span> -k</span><br><span class="line">SSH password:</span><br><span class="line">10.0.0.206 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看远程主机</span></span><br><span class="line">[root@ubuntu ~]# ll /root/test/</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Jun 17 12:12 abc</span><br><span class="line"></span><br><span class="line"><span class="comment">#当/root/test/abc存在时不执行，提示skipped</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m <span class="built_in">command</span> -a <span class="string">&quot;chdir=/root/test creates=/root/test/abc touch bcd&quot;</span> -k</span><br><span class="line">SSH password:</span><br><span class="line">10.0.0.206 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">skipped, since /root/test/abc existsDid not run <span class="built_in">command</span> since <span class="string">&#x27;/root/test/abc&#x27;</span> exists</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看远程主机</span></span><br><span class="line">[root@ubuntu ~]# ll /root/test/</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Jun 17 12:12 abc</span><br><span class="line"></span><br><span class="line"><span class="comment">#不支持多条命令</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -a <span class="string">&quot;id;id&quot;</span> -k</span><br><span class="line">SSH password:</span><br><span class="line">10.0.0.206 | FAILED | rc=2 &gt;&gt;</span><br><span class="line">[Errno 2] No such file or directory: b<span class="string">&#x27;id;id&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建文件最好使用file模块，因为command模块不具有幂等性</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible ~]#ansible webservers -m <span class="built_in">command</span> -a <span class="string">&#x27;chdir=/etc cat centos-release&#x27;</span></span><br><span class="line">[root@ansible ~]#ansible webservers -m <span class="built_in">command</span> -a <span class="string">&#x27;chdir=/etc creates=/data/f1.txt cat centos-release&#x27;</span></span><br><span class="line">[root@ansible ~]#ansible webservers -m <span class="built_in">command</span> -a <span class="string">&#x27;chdir=/etc removes=/data/f1.txt cat centos-release&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="1-2-Shell-模块"><a href="#1-2-Shell-模块" class="headerlink" title="1.2 Shell 模块"></a>1.2 Shell 模块</h2><p>功能：和command相似，用shell执行命令,支持各种符号,比如:*,$, &gt; , 相当于增强版的command模块</p>
<p>注意：此模块不具有幂等性,建议能不能就用此模块,最好使用专用模块</p>
<p>在调用shell模块执行命令时，复杂的命令也有可能会执行失败，类似于包含多重管道，正则表达式这些，这种情况下，我们需要写成 shell 脚本，用 copy 模块直接推送到远程执行。</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chdir</span>=<span class="built_in">dir</span>    <span class="comment">#执行命令前,先切换至目录dir</span></span><br><span class="line">creates=file <span class="comment">#当file不存在时才会执行</span></span><br><span class="line">removes=file <span class="comment">#当file存在时才会执行</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#支持管道</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m shell -a <span class="string">&quot;echo 1+2|bc&quot;</span></span><br><span class="line">10.0.0.206 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">3</span><br><span class="line"></span><br><span class="line"><span class="comment">#支持重定向</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m shell -a <span class="string">&quot;echo 1+2|bc &gt; /root/test/abc&quot;</span></span><br><span class="line">10.0.0.206 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> /root/test/abc</span><br><span class="line">3</span><br><span class="line"></span><br><span class="line"><span class="comment">#支持多条命令</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m shell -a <span class="string">&quot;id;id&quot;</span> -k</span><br><span class="line">SSH password:</span><br><span class="line">10.0.0.206 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line"></span><br><span class="line"><span class="comment">#不具有幂等性</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m shell -a <span class="string">&quot;mkdir dira&quot;</span></span><br><span class="line">10.0.0.206 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m shell -a <span class="string">&quot;mkdir dira&quot;</span></span><br><span class="line">10.0.0.206 | FAILED | rc=1 &gt;&gt;</span><br><span class="line"><span class="built_in">mkdir</span>: cannot create directory ‘dira’: File existsnon-zero <span class="built_in">return</span> code</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改配置文件</span></span><br><span class="line">[root@ubuntu ~]#ansible all -m shell -a <span class="string">&quot;sed -i &#x27;s/^Listen 80/Listen 8080/&#x27; /etc/httpd/conf/httpd.conf&quot;</span></span><br></pre></td></tr></table></figure>

<p>注意：调用bash执行命令 类似 cat &#x2F;tmp&#x2F;test.md | awk -F’|’ ‘{print <img src="/CICD/ansible/module/65a5d44c6c51a9d4355d1056d2ee04cb.svg" alt="img">2}’ &amp;&gt; &#x2F;tmp&#x2F;example.txt 这些复杂命令，即使使用shell也可能会失败，解决办法：写到脚本时，copy到远程，执行，再把需要的结果拉回执行命令的机器</p>
<p>范例：将shell模块代替command，设为模块</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible ~]#vim /etc/ansible/ansible.cfg</span><br><span class="line"><span class="comment">#修改下面一行</span></span><br><span class="line">module_name = shell</span><br></pre></td></tr></table></figure>

<h2 id="1-3-Script-模块"><a href="#1-3-Script-模块" class="headerlink" title="1.3 Script 模块"></a>1.3 Script 模块</h2><p>功能：在远程主机上运行ansible服务器上的脚本(无需执行权限)</p>
<p>注意：此模块不具有幂等性</p>
<p>这里的脚本并不仅仅只是 shell脚本，只要远程主机上能执行的，都可以，包括但不限于 php, sh, py 等</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chdir</span>=<span class="built_in">dir</span>    	<span class="comment">#执行命令前,先切换至目录dir</span></span><br><span class="line">cmd      	 		<span class="comment">#指定ansible主机的命令</span></span><br><span class="line">creates=file 	<span class="comment">#当file不存在时才会执行</span></span><br><span class="line">removes=file 	<span class="comment">#当file存在时才会执行</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看脚本</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> test.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">hostname -I &gt;/tmp/ansible-script.log</span><br><span class="line">hostname -I</span><br><span class="line"></span><br><span class="line"><span class="comment">#可以不需要x权限</span></span><br><span class="line">[root@ubuntu ~]# ll test.sh</span><br><span class="line">-rw-r--r-- 1 root root 61 Jun 17 12:41 test.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@ubuntu ~]# ansible <span class="string">&quot;10.0.0.150 10.0.0.206&quot;</span> -m script -a <span class="string">&quot;./test.sh&quot;</span> -k</span><br><span class="line"></span><br><span class="line"><span class="comment">#在远程主机上查看log</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> /tmp/ansible-script.log</span><br><span class="line">10.0.0.206</span><br><span class="line">[root@rocky ~]# <span class="built_in">cat</span> /tmp/ansible-script.log</span><br><span class="line">10.0.0.150 192.168.10.150</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行python脚本</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> test.py</span><br><span class="line"><span class="comment">#!/bin/python3</span></span><br><span class="line">import <span class="keyword">time</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;this is python script&quot;</span>);</span><br><span class="line">time.sleep(15);</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# ansible <span class="string">&quot;10.0.0.150&quot;</span> -m script -a <span class="string">&quot;./test.py&quot;</span> -k</span><br><span class="line"></span><br><span class="line"><span class="comment">#在远程主机上查看脚本</span></span><br><span class="line">[root@rocky ~]# tree .ansible</span><br><span class="line">.ansible</span><br><span class="line">└── tmp</span><br><span class="line"> └── ansible-tmp-1686979905.168881-3117-38009294106067</span><br><span class="line">   └── test.py</span><br><span class="line">2 directories, 1 file</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看脚本文件内容</span></span><br><span class="line">[root@rocky ~]# <span class="built_in">cat</span> .ansible/tmp/ansible-tmp-1686979905.168881-3117-38009294106067/test.py</span><br><span class="line"><span class="comment">#!/bin/python3</span></span><br><span class="line">import <span class="keyword">time</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;this is python script&quot;</span>);</span><br><span class="line">time.sleep(15);</span><br></pre></td></tr></table></figure>

<h1 id="2-文件管理相关"><a href="#2-文件管理相关" class="headerlink" title="2 文件管理相关"></a>2 文件管理相关</h1><h2 id="2-1-Copy-模块"><a href="#2-1-Copy-模块" class="headerlink" title="2.1 Copy 模块"></a>2.1 Copy 模块</h2><p>功能：复制ansible服务器主控端或远程的本机的文件到远程主机，具有幂等性</p>
<p>注意: src&#x3D;file 如果是没指明路径,则为当前目录或当前目录下的files目录下的file文件</p>
<p>可以是控制端的文件传到被控制端，也可以是被控制端传到被控制端（要加remote_src选项）</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">src    			<span class="comment">#控制端的源文件路径</span></span><br><span class="line">dest   			<span class="comment">#被控端的文件路径</span></span><br><span class="line">owner   		<span class="comment">#属主</span></span><br><span class="line">group   		<span class="comment">#属组</span></span><br><span class="line">mode   			<span class="comment">#权限</span></span><br><span class="line">backup  		<span class="comment">#是否备份</span></span><br><span class="line">validate 		<span class="comment">#验证成功才会执行copy</span></span><br><span class="line">remote_src  		<span class="comment">#no是默认值,表示src文件在ansible主机,yes表示src文件在远程主机</span></span><br><span class="line">backup=<span class="built_in">yes</span>|no 	<span class="comment">#是否备份，默认no</span></span><br><span class="line">content=str   	<span class="comment">#使用str生成新文件</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#如目标存在，默认覆盖，此处指定先备份</span></span><br><span class="line">ansible webservers -m copy -a <span class="string">&quot;src=/root/test1.sh dest=/tmp/test2.sh owner=wang mode=600 backup=yes&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#指定内容，直接生成目标文件  </span></span><br><span class="line">ansible webservers -m copy -a <span class="string">&quot;content=&#x27;wang 123456\nxiao 654321\n&#x27; dest=/etc/rsync.pas owner=root group=root mode=0600&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#复制/etc目录自身,注意/etc/后面没有/</span></span><br><span class="line">ansible webservers -m copy -a <span class="string">&quot;src=/etc dest=/backup&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#复制/etc/下的文件，不包括/etc/目录自身,注意/etc/后面有/</span></span><br><span class="line">ansible webservers -m copy -a <span class="string">&quot;src=/etc/ dest=/backup&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#复制/etc/suders,并校验语法</span></span><br><span class="line">ansible webservers -m copy -a <span class="string">&quot;src=/etc/suders dest=/etc/sudoers.edit remote_src=yes validate=/usr/sbin/visudo -csf %s&quot;</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# <span class="built_in">echo</span> <span class="string">&quot;this is test file&quot;</span> &gt; test.txt</span><br><span class="line">[root@ubuntu ~]# ll test.txt</span><br><span class="line">-rw-r--r-- 1 root root 18 Jun 17 13:32 test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#将 ansible 主机上的文件 copy 到远程主机</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m copy -a <span class="string">&quot;src=/root/test.txt dest=/tmp/test.txt.bak&quot;</span></span><br><span class="line">10.0.0.206 | CHANGED =&gt; &#123;</span><br><span class="line">  <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python3&quot;</span></span><br><span class="line"> &#125;,</span><br><span class="line">  <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;checksum&quot;</span>: <span class="string">&quot;4a3adea6a7ca4a8ac6ccb8605317572c319786dc&quot;</span>,</span><br><span class="line">  <span class="string">&quot;dest&quot;</span>: <span class="string">&quot;/tmp/test.txt.bak&quot;</span>,</span><br><span class="line">  <span class="string">&quot;gid&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;group&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">  <span class="string">&quot;md5sum&quot;</span>: <span class="string">&quot;a7b2aeb79ab928a4598fe9f80241e5f7&quot;</span>,</span><br><span class="line">  <span class="string">&quot;mode&quot;</span>: <span class="string">&quot;0644&quot;</span>,</span><br><span class="line">  <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 18,</span><br><span class="line">  <span class="string">&quot;src&quot;</span>: <span class="string">&quot;/root/.ansible/tmp/ansible-tmp-1686980235.2434347-3212-180319983005615/source&quot;</span>,</span><br><span class="line">  <span class="string">&quot;state&quot;</span>: <span class="string">&quot;file&quot;</span>,</span><br><span class="line">  <span class="string">&quot;uid&quot;</span>: 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#远程主机上查看</span></span><br><span class="line">[root@ubuntu ~]# ll /tmp/test.txt.bak</span><br><span class="line">-rw-r--r-- 1 root root 18 Jun 17 13:37 /tmp/test.txt.bak</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> /tmp/test.txt.bak</span><br><span class="line">this is <span class="built_in">test</span> file</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改文件</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">echo</span> <span class="string">&quot;12345678&quot;</span> &gt;&gt; test.txt</span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> test.txt</span><br><span class="line">this is <span class="built_in">test</span> file</span><br><span class="line">12345678</span><br><span class="line"></span><br><span class="line"><span class="comment">#备份，指定属主属组，指定权限</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m copy -a <span class="string">&quot;src=/root/test.txt dest=/tmp/test.txt.bak backup=yes owner=tom group=mage mode=000&quot;</span></span><br><span class="line">10.0.0.206 | CHANGED =&gt; &#123;</span><br><span class="line">  <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python3&quot;</span></span><br><span class="line"> &#125;,</span><br><span class="line">  <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;checksum&quot;</span>: <span class="string">&quot;1e853908f0f72eefe7cd0d82332967ecb7f447f9&quot;</span>,</span><br><span class="line">  <span class="string">&quot;dest&quot;</span>: <span class="string">&quot;/tmp/test.txt.bak&quot;</span>,</span><br><span class="line">  <span class="string">&quot;gid&quot;</span>: 1000,</span><br><span class="line">  <span class="string">&quot;group&quot;</span>: <span class="string">&quot;mage&quot;</span>,</span><br><span class="line">  <span class="string">&quot;mode&quot;</span>: <span class="string">&quot;0000&quot;</span>,</span><br><span class="line">  <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;tom&quot;</span>,</span><br><span class="line">  <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/tmp/test.txt.bak&quot;</span>,</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 27,</span><br><span class="line">  <span class="string">&quot;state&quot;</span>: <span class="string">&quot;file&quot;</span>,</span><br><span class="line">  <span class="string">&quot;uid&quot;</span>: 1001</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#在远程主机上查看</span></span><br><span class="line">[root@ubuntu ~]# ll /tmp/test.txt.bak*</span><br><span class="line">---------- 1 tom mage 27 Jun 17 13:39 /tmp/test.txt.bak</span><br><span class="line">-rw-r--r-- 1 root root 18 Jun 17 13:37 <span class="string">&#x27;/tmp/test.txt.bak.3957.2023-06-17@13:39:40~&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#源和目标都在远程主机上</span></span><br><span class="line"><span class="comment">#将远程主机的 abc.txt 再复制一份到 from-ansible.txt</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m copy -a <span class="string">&quot;src=/root/abc.txt dest=/root/from-ansible.txt remote_src=yes&quot;</span></span><br><span class="line">10.0.0.206 | CHANGED =&gt; &#123;</span><br><span class="line">  <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python3&quot;</span></span><br><span class="line"> &#125;,</span><br><span class="line">  <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;checksum&quot;</span>: <span class="string">&quot;03cfd743661f07975fa2f1220c5194cbaff48451&quot;</span>,</span><br><span class="line">  <span class="string">&quot;dest&quot;</span>: <span class="string">&quot;/root/from-ansible.txt&quot;</span>,</span><br><span class="line">  <span class="string">&quot;gid&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;group&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">  <span class="string">&quot;md5sum&quot;</span>: <span class="string">&quot;0bee89b07a248e27c83fc3d5951213c1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;mode&quot;</span>: <span class="string">&quot;0644&quot;</span>,</span><br><span class="line">  <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 4,</span><br><span class="line">  <span class="string">&quot;src&quot;</span>: <span class="string">&quot;/root/abc.txt&quot;</span>,</span><br><span class="line">  <span class="string">&quot;state&quot;</span>: <span class="string">&quot;file&quot;</span>,</span><br><span class="line">  <span class="string">&quot;uid&quot;</span>: 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#在远程主机上查看</span></span><br><span class="line">[root@ubuntu ~]# diff abc.txt from-ansible.txt</span><br><span class="line">[root@ubuntu ~]# <span class="built_in">echo</span> $?</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<p>范例：拷贝目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将 ansible 主机的 /etc/ansible 目复制到远程主机，保存到 /tmp/ 下</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m copy -a <span class="string">&#x27;src=/etc/ansible dest=/tmp/&#x27;</span></span><br><span class="line">10.0.0.206 | CHANGED =&gt; &#123;</span><br><span class="line">  <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;dest&quot;</span>: <span class="string">&quot;/tmp/&quot;</span>,</span><br><span class="line">  <span class="string">&quot;src&quot;</span>: <span class="string">&quot;/etc/ansible&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#在远程主机上查看</span></span><br><span class="line">[root@ubuntu ~]# ll /tmp/ansible/ -d</span><br><span class="line">drwxr-xr-x 3 root root 4096 Jun 17 13:46 /tmp/ansible//</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# tree /tmp/ansible</span><br><span class="line">/tmp/ansible</span><br><span class="line">├── ansible.cfg</span><br><span class="line">├── hosts</span><br><span class="line">└── roles</span><br><span class="line">1 directory, 2 files</span><br><span class="line"></span><br><span class="line"><span class="comment">#复制目录下所有文件，将 ansible 主机的 /etc/ansible/ 目录下所有文件复制到远程主机，保存到/tmp/ansible-2/中</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m copy -a <span class="string">&#x27;src=/etc/ansible/ dest=/tmp/ansible-2&#x27;</span></span><br><span class="line">10.0.0.206 | CHANGED =&gt; &#123;</span><br><span class="line">  <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;dest&quot;</span>: <span class="string">&quot;/tmp/ansible-2/&quot;</span>,</span><br><span class="line">  <span class="string">&quot;src&quot;</span>: <span class="string">&quot;/etc/ansible/&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# ll -d /tmp/ansible-2/</span><br><span class="line">drwxr-xr-x 3 root root 4096 Jun 17 13:53 /tmp/ansible-2/</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# tree /tmp/ansible-2/</span><br><span class="line">/tmp/ansible-2/</span><br><span class="line">├── ansible.cfg</span><br><span class="line">├── hosts</span><br><span class="line">└── roles</span><br><span class="line">1 directory, 2 files</span><br></pre></td></tr></table></figure>

<p>范例：幂等性验证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#从指定内容中生成文件</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m copy -a <span class="string">&#x27;content=#!/usr/bin/python3\nprint(&quot;123&quot;) dest=/tmp/test.py&#x27;</span></span><br><span class="line">10.0.0.206 | CHANGED =&gt; &#123;</span><br><span class="line">  <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python3&quot;</span></span><br><span class="line"> &#125;,</span><br><span class="line">  <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;checksum&quot;</span>: <span class="string">&quot;94998339860e5d0c935236649e6b2f75bfa6fab6&quot;</span>,</span><br><span class="line">  <span class="string">&quot;dest&quot;</span>: <span class="string">&quot;/tmp/test.py&quot;</span>,</span><br><span class="line">  <span class="string">&quot;gid&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;group&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">  <span class="string">&quot;md5sum&quot;</span>: <span class="string">&quot;4351397767a6c8c2af9a27e564147557&quot;</span>,</span><br><span class="line">  <span class="string">&quot;mode&quot;</span>: <span class="string">&quot;0644&quot;</span>,</span><br><span class="line">  <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 31,</span><br><span class="line">  <span class="string">&quot;src&quot;</span>: <span class="string">&quot;/root/.ansible/tmp/ansible-tmp-1686981543.715741-3495-158242536378013/source&quot;</span>,</span><br><span class="line">  <span class="string">&quot;state&quot;</span>: <span class="string">&quot;file&quot;</span>,</span><br><span class="line">  <span class="string">&quot;uid&quot;</span>: 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# ll /tmp/test.py</span><br><span class="line">-rw-r--r-- 1 root root 31 Jun 17 13:59 /tmp/test.py</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> /tmp/test.py</span><br><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;123&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#再次执行，绿色，提示成功</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m copy -a <span class="string">&#x27;content=#!/usr/bin/python3\nprint(&quot;123&quot;) dest=/tmp/test.py&#x27;</span></span><br><span class="line">10.0.0.206 | SUCCESS =&gt; &#123;</span><br><span class="line">  <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python3&quot;</span></span><br><span class="line"> &#125;,</span><br><span class="line">  <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;checksum&quot;</span>: <span class="string">&quot;94998339860e5d0c935236649e6b2f75bfa6fab6&quot;</span>,</span><br><span class="line">  <span class="string">&quot;dest&quot;</span>: <span class="string">&quot;/tmp/test.py&quot;</span>,</span><br><span class="line">  <span class="string">&quot;gid&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;group&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">  <span class="string">&quot;mode&quot;</span>: <span class="string">&quot;0644&quot;</span>,</span><br><span class="line">  <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">  <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/tmp/test.py&quot;</span>,</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 31,</span><br><span class="line">  <span class="string">&quot;state&quot;</span>: <span class="string">&quot;file&quot;</span>,</span><br><span class="line">  <span class="string">&quot;uid&quot;</span>: 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#远程主机上的文件时间戳没有发生变化</span></span><br><span class="line">[root@ubuntu ~]# ll /tmp/test.py</span><br><span class="line">-rw-r--r-- 1 root root 31 Jun 17 13:59 /tmp/test.py</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果内容不一样，就会覆盖，因为幂等性是只有内容一样时才会有</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m copy -a <span class="string">&#x27;content=#!/usr/bin/python3\nprint(&quot;456&quot;) dest=/tmp/test.py&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#远程主机</span></span><br><span class="line">[root@ubuntu ~]# ll /tmp/test.py</span><br><span class="line">-rw-r--r-- 1 root root 31 Jun 17 14:02 /tmp/test.py</span><br></pre></td></tr></table></figure>

<h2 id="2-2-Get-url-模块"><a href="#2-2-Get-url-模块" class="headerlink" title="2.2 Get_url 模块"></a>2.2 Get_url 模块</h2><p>功能: 用于将文件从http、https或ftp下载到被管理机节点上</p>
<p>常用参数如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">url  				<span class="comment">#下载文件的URL,支持HTTP，HTTPS或FTP协议</span></span><br><span class="line">dest  			<span class="comment">#下载到目标路径（绝对路径），如果目标是一个目录，就用原文件名，如果目标设置了名称就用目标设置的名称</span></span><br><span class="line">owner 			<span class="comment">#指定属主</span></span><br><span class="line">group 			<span class="comment">#指定属组</span></span><br><span class="line">mode  			<span class="comment">#指定权限</span></span><br><span class="line">force 			<span class="comment">#如果yes，dest不是目录，将每次下载文件，如果内容改变替换文件。如果no，则只有在目标不存在时才会下载</span></span><br><span class="line">checksum  	<span class="comment">#对目标文件在下载后计算摘要，以确保其完整性</span></span><br><span class="line">     				示例: checksum=<span class="string">&quot;sha256:D98291AC[...]B6DC7B97&quot;</span></span><br><span class="line">        		  	 checksum=<span class="string">&quot;sha256:http://example.com/path/sha256sum.txt&quot;</span></span><br><span class="line">        		  </span><br><span class="line">url_username 		<span class="comment">#用于HTTP基本认证的用户名。 对于允许空密码的站点，此参数可以不使用`url_password&#x27;</span></span><br><span class="line">url_password 		<span class="comment">#用于HTTP基本认证的密码。 如果未指定`url_username&#x27;参数，则不会使用`url_password&#x27;参数</span></span><br><span class="line">validate_certs 	<span class="comment">#如果“no”，SSL证书将不会被验证。 适用于自签名证书在私有网站上使用</span></span><br><span class="line"><span class="built_in">timeout</span>  				<span class="comment">#URL请求的超时时间,秒为单位</span></span><br></pre></td></tr></table></figure>

<p>范例: 下载并MD5验证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible ~]#ansible webservers -m get_url -a <span class="string">&#x27;url=http://nginx.org/download/nginx-1.18.0.tar.gz dest=/usr/local/src/nginx.tar.gz checksum=&quot;md5:b2d33d24d89b8b1f87ff5d251aa27eb8&quot;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# wget http://www.jose-404.com/aini.jpg</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">md5sum</span> aini.jpg</span><br><span class="line">e8fee721ce6e1556e1bf93ae39c7324e aini.jpg</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m get_url -a <span class="string">&#x27;url=http://www.jose-404.com/aini.jpg dest=/tmp/a.jpg checksum=&quot;md5:e8fee721ce6e1556e1bf93ae39c7324e&quot;&#x27;</span></span><br><span class="line">10.0.0.206 | CHANGED =&gt; &#123;</span><br><span class="line">  <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python3&quot;</span></span><br><span class="line"> &#125;,</span><br><span class="line">  <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;checksum_dest&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;checksum_src&quot;</span>: <span class="string">&quot;a025296e5a5d173e519cec5511c8f590f9e4fa33&quot;</span>,</span><br><span class="line">  <span class="string">&quot;dest&quot;</span>: <span class="string">&quot;/tmp/a.jpg&quot;</span>,</span><br><span class="line">  <span class="string">&quot;elapsed&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;gid&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;group&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">  <span class="string">&quot;md5sum&quot;</span>: <span class="string">&quot;e8fee721ce6e1556e1bf93ae39c7324e&quot;</span>,</span><br><span class="line">  <span class="string">&quot;mode&quot;</span>: <span class="string">&quot;0644&quot;</span>,</span><br><span class="line">  <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;OK (689635 bytes)&quot;</span>,</span><br><span class="line">  <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 689635,</span><br><span class="line">  <span class="string">&quot;src&quot;</span>: <span class="string">&quot;/root/.ansible/tmp/ansible-tmp-1686981788.8991709-3571-176490408299261/tmpy7aqnoid&quot;</span>,</span><br><span class="line">  <span class="string">&quot;state&quot;</span>: <span class="string">&quot;file&quot;</span>,</span><br><span class="line">  <span class="string">&quot;status_code&quot;</span>: 200,</span><br><span class="line">  <span class="string">&quot;uid&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://www.jose-404.com/aini.jpg&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#在目标主机上查看</span></span><br><span class="line">[root@ubuntu ~]# ll /tmp/a.jpg</span><br><span class="line">-rw-r--r-- 1 root root 689635 Jun 17 14:03 /tmp/a.jpg</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定错误的摘要，下载失败</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m get_url -a <span class="string">&#x27;url=http://www.jose-404.com/aini.jpg dest=/tmp/a.jpg checksum=&quot;md5:e8fee721ce6e1556e1bf93ae39c7324e123&quot;&#x27;</span></span><br><span class="line">10.0.0.206 | FAILED! =&gt; &#123;</span><br><span class="line">  <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python3&quot;</span></span><br><span class="line"> &#125;,</span><br><span class="line">  <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;checksum_dest&quot;</span>: <span class="string">&quot;a025296e5a5d173e519cec5511c8f590f9e4fa33&quot;</span>,</span><br><span class="line">  <span class="string">&quot;checksum_src&quot;</span>: <span class="string">&quot;a025296e5a5d173e519cec5511c8f590f9e4fa33&quot;</span>,</span><br><span class="line">  <span class="string">&quot;dest&quot;</span>: <span class="string">&quot;/tmp/a.jpg&quot;</span>,</span><br><span class="line">  <span class="string">&quot;elapsed&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;The checksum for /tmp/a.jpg did not match e8fee721ce6e1556e1bf93ae39c7324e123; it was e8fee721ce6e1556e1bf93ae39c7324e.&quot;</span>,</span><br><span class="line">  <span class="string">&quot;src&quot;</span>: <span class="string">&quot;/root/.ansible/tmp/ansible-tmp-1686981839.314159-3599-190398208112020/tmpqjyn1frk&quot;</span>,</span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://www.jose-404.com/aini.jpg&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-Fetch-模块"><a href="#2-3-Fetch-模块" class="headerlink" title="2.3 Fetch 模块"></a>2.3 Fetch 模块</h2><p>功能：从远程主机提取文件至ansible的主控端，copy相反，目前不支持目录</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">src    <span class="comment">#被控制端的源文件路径,只支持文件</span></span><br><span class="line">dest   <span class="comment">#ansible控制端的目录路径</span></span><br><span class="line">fail_on_missing=<span class="built_in">yes</span>|no 	<span class="comment">#默认yes,无法获取远程主机文件时，显示失败</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# ansible <span class="string">&quot;10.0.0.206 10.0.0.150&quot;</span> -m fetch -a <span class="string">&quot;src=/etc/issue dest=./ansible-fetch&quot;</span></span><br><span class="line">10.0.0.150 | CHANGED =&gt; &#123;</span><br><span class="line">  <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;checksum&quot;</span>: <span class="string">&quot;2cf4509acb4ba67280d4dff829ef4c550a45bb4b&quot;</span>,</span><br><span class="line">  <span class="string">&quot;dest&quot;</span>: <span class="string">&quot;/root/ansible-fetch/10.0.0.150/etc/issue&quot;</span>,</span><br><span class="line">  <span class="string">&quot;md5sum&quot;</span>: <span class="string">&quot;7886cd1627ee2af067882f3ba048cb17&quot;</span>,</span><br><span class="line">  <span class="string">&quot;remote_checksum&quot;</span>: <span class="string">&quot;2cf4509acb4ba67280d4dff829ef4c550a45bb4b&quot;</span>,</span><br><span class="line">  <span class="string">&quot;remote_md5sum&quot;</span>: null</span><br><span class="line">&#125;</span><br><span class="line">10.0.0.206 | CHANGED =&gt; &#123;</span><br><span class="line">  <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;checksum&quot;</span>: <span class="string">&quot;133e53602931fc3b50bc07e2d8fd5af745a4d531&quot;</span>,</span><br><span class="line">  <span class="string">&quot;dest&quot;</span>: <span class="string">&quot;/root/ansible-fetch/10.0.0.206/etc/issue&quot;</span>,</span><br><span class="line">  <span class="string">&quot;md5sum&quot;</span>: <span class="string">&quot;d5faf84af6529c6e6a364f164e953ff6&quot;</span>,</span><br><span class="line">  <span class="string">&quot;remote_checksum&quot;</span>: <span class="string">&quot;133e53602931fc3b50bc07e2d8fd5af745a4d531&quot;</span>,</span><br><span class="line">  <span class="string">&quot;remote_md5sum&quot;</span>: null</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#分开存放</span></span><br><span class="line">[root@ubuntu ~]# tree ansible-fetch/</span><br><span class="line">ansible-fetch/</span><br><span class="line">├── 10.0.0.150</span><br><span class="line">│  └── etc</span><br><span class="line">│    └── issue</span><br><span class="line">└── 10.0.0.206</span><br><span class="line"> └── etc</span><br><span class="line">   └── issue</span><br><span class="line">4 directories, 2 files</span><br></pre></td></tr></table></figure>

<h2 id="2-4-File-模块"><a href="#2-4-File-模块" class="headerlink" title="2.4 File 模块"></a>2.4 File 模块</h2><p>功能：设置文件属性,创建文件,目录和软链接等</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">path 				<span class="comment">#在被控端创建的路径</span></span><br><span class="line">owner 			<span class="comment">#属主</span></span><br><span class="line">group 			<span class="comment">#属组</span></span><br><span class="line">mode 				<span class="comment">#权限</span></span><br><span class="line">state 			<span class="comment">#状态</span></span><br><span class="line"> 	=<span class="built_in">touch</span>   		<span class="comment">#创建文件</span></span><br><span class="line"> 	=directory 	<span class="comment">#创建目录</span></span><br><span class="line"> 	=<span class="built_in">link</span> 			<span class="comment">#软链接</span></span><br><span class="line"> 	=hard   		<span class="comment">#硬链接</span></span><br><span class="line"> 	=absent			<span class="comment">#删除</span></span><br><span class="line">recurse   			<span class="comment">#yes表示递归授权</span></span><br><span class="line">recurse=<span class="built_in">yes</span>|no 	<span class="comment">#仅在state=directory时生效</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建空文件</span></span><br><span class="line">ansible all -m file  -a <span class="string">&#x27;path=/data/test.txt state=touch&#x27;</span></span><br><span class="line">ansible all -m file  -a <span class="string">&#x27;path=/data/test.txt state=absent&#x27;</span></span><br><span class="line">ansible all -m file -a <span class="string">&quot;path=/root/test.sh owner=wang mode=755&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建目录</span></span><br><span class="line">ansible all -m file -a <span class="string">&quot;path=/data/mysql state=directory owner=mysql group=mysql&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建软链接</span></span><br><span class="line">ansible all -m file -a <span class="string">&#x27;src=/data/testfile path|dest|name=/data/testfile-link state=link&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#递归修改目录属性,但不递归至子目录</span></span><br><span class="line">ansible all -m file -a <span class="string">&quot;path=/data/mysql state=directory owner=mysql group=mysql&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#递归修改目录及子目录的属性</span></span><br><span class="line">ansible all -m file -a <span class="string">&quot;path=/data/mysql state=directory owner=mysql group=mysql recurse=yes&quot;</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建文件或目录</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m file -a <span class="string">&quot;path=/ansible/test state=directory&quot;</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m file -a <span class="string">&quot;path=/ansible/test/test.txt state=touch owner=tom group=root mode=777&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#递归设置属性</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m file -a <span class="string">&quot;path=/ansible/dir2/dir3 state=directory owner=tom group=mage recurse=yes&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#获取文件信息</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m file -a <span class="string">&quot;path=/ansible/test/test.txt state=file&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建链接</span></span><br><span class="line"><span class="comment">#链接文件可以用dest|name 来指定</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m file -a <span class="string">&quot;src=/ansible/test/test.txt dest=/ansible/test/test.link state=link owner=tom group=tom&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除文件</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m file -a <span class="string">&quot;path=/ansible/test/test.link state=absent&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#递归删除目录</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m file -a <span class="string">&quot;path=/ansible/dir2 state=absent&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-5-Stat-模块"><a href="#2-5-Stat-模块" class="headerlink" title="2.5 Stat 模块"></a>2.5 Stat 模块</h2><p>功能：检查文件或文件系统的状态</p>
<p>注意：对于Windows目标，请改用win_stat模块</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">path 								<span class="comment">#文件/对象的完整路径（必须）</span></span><br><span class="line">follow=<span class="literal">true</span>|<span class="literal">false</span> 	<span class="comment">#是否跟随链接，默认 false，不跟随</span></span><br></pre></td></tr></table></figure>

<p>常用的返回值判断：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exists	<span class="comment">#判断是否存在</span></span><br><span class="line">isuid		<span class="comment">#调用用户的ID与所有者ID是否匹配，即是否设置了用户ID位（SUID）</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#文件存在</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m <span class="built_in">stat</span> -a <span class="string">&quot;path=/etc/issue&quot;</span></span><br><span class="line">10.0.0.206 | SUCCESS =&gt; &#123;</span><br><span class="line">  <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python3&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">  <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;stat&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;atime&quot;</span>: 1686968092.6200006,</span><br><span class="line">    <span class="string">&quot;attr_flags&quot;</span>: <span class="string">&quot;e&quot;</span>,</span><br><span class="line">    <span class="string">&quot;attributes&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;extents&quot;</span></span><br><span class="line">   ],</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="comment">#文件不存在</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m <span class="built_in">stat</span> -a <span class="string">&quot;path=/etc/abcd&quot;</span></span><br><span class="line">10.0.0.206 | SUCCESS =&gt; &#123;</span><br><span class="line">  <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python3&quot;</span></span><br><span class="line"> &#125;,</span><br><span class="line">  <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;stat&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;exists&quot;</span>: <span class="literal">false</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#目录</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m <span class="built_in">stat</span> -a <span class="string">&quot;path=/etc&quot;</span></span><br><span class="line">10.0.0.206 | SUCCESS =&gt; &#123;</span><br><span class="line">  <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python3&quot;</span></span><br><span class="line"> &#125;,</span><br><span class="line">  <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;stat&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;atime&quot;</span>: 1686971594.3314898,</span><br><span class="line">    <span class="string">&quot;attr_flags&quot;</span>: <span class="string">&quot;e&quot;</span>,</span><br><span class="line">    <span class="string">&quot;attributes&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;extents&quot;</span></span><br><span class="line">   ],</span><br><span class="line">   ......</span><br></pre></td></tr></table></figure>

<p>案例：Playbook</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- name: install | Check <span class="keyword">if</span> file is already configured.</span><br><span class="line">  <span class="built_in">stat</span>: path=&#123;&#123; nginx_file_path &#125;&#125;</span><br><span class="line">  connection: <span class="built_in">local</span></span><br><span class="line">  register: nginx_file_result</span><br><span class="line">- name: install | Download nginx file</span><br><span class="line">  get_url: url=&#123;&#123; nginx_file_url &#125;&#125; dest=&#123;&#123; software_files_path &#125;&#125; validate_certs=no</span><br><span class="line">  connection: <span class="built_in">local</span></span><br><span class="line">  when:，not. nginx_file_result.stat.exists</span><br></pre></td></tr></table></figure>

<h2 id="2-6-Unarchive-模块"><a href="#2-6-Unarchive-模块" class="headerlink" title="2.6 Unarchive 模块"></a>2.6 Unarchive 模块</h2><p>功能：解包解压缩</p>
<p>实现有两种用法：</p>
<ul>
<li>将ansible主机上的压缩包传到远程主机后解压缩至特定目录，设置remote_src&#x3D;no,此为默认值,可省略</li>
<li>将远程本主机上或非ansible的其它主机的某个压缩包解压缩到远程主机本机的指定路径下，需要设置remote_src&#x3D;yes</li>
</ul>
<p>在使用此模块时，要保证远程主机能解压对应的压缩包</p>
<p>常见参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">remote_src 		<span class="comment">#和copy功能一样且选项互斥，yes表示源文件在远程被控主机或其它非ansible的其它主机上，no表示文件在ansible主机上,默认值为no, 此选项代替copy选项</span></span><br><span class="line">copy 					<span class="comment">#默认为yes，当copy=yes，拷贝的文件是从ansible主机复制到远程主机上，如果设置为copy=no，会在远程主机上寻找src源文件,此选项已废弃</span></span><br><span class="line">src 					<span class="comment">#源路径，可以是ansible主机上的路径，也可以是远程主机(被管理端或者第三方主机)上的路径，如果是远程主机上的路径，则需要设置remote_src=yes</span></span><br><span class="line">dest 					<span class="comment">#远程主机上的目标路径</span></span><br><span class="line">owner 				<span class="comment">#默认递归</span></span><br><span class="line">group 				<span class="comment">#默认递归</span></span><br><span class="line">mode  				<span class="comment">#设置解压缩后的文件权限,默认递归</span></span><br><span class="line">creates=/path/file 	<span class="comment">#当绝对路径/path/file不存在时才会执行</span></span><br><span class="line">owner=USER  	<span class="comment">#设置目标属主</span></span><br><span class="line">group=GROUP 	<span class="comment">#设置目标属组</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将ansible主机上的压缩包解压至远程主机,远程目录必须存在</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m unarchive -a <span class="string">&quot;src=/root/dira.tar.gz dest=/tmp/test-dir owner=tom&quot;</span></span><br><span class="line"><span class="comment">#若不存在，出现以下错误</span></span><br><span class="line">An exception occurred during task execution. To see the full traceback, use -vvv. The error was: NoneType: None</span><br><span class="line"></span><br><span class="line"><span class="comment">#将第三方包解压缩到指定主机</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m unarchive -a <span class="string">&quot;src=http://www.jose-404.com/web-dir.tar dest=/tmp remote_src=yes mode=777&quot;</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ansible all -m unarchive -a <span class="string">&#x27;src=/data/foo.tgz dest=/var/lib/foo owner=wang group=bin&#x27;</span></span><br><span class="line"></span><br><span class="line">ansible all -m unarchive -a <span class="string">&#x27;src=/tmp/foo.zip dest=/data copy=no mode=0777&#x27;</span></span><br><span class="line"></span><br><span class="line">ansible all -m unarchive -a <span class="string">&#x27;src=https://example.com/example.zip dest=/data remote_src=yes&#x27;</span></span><br><span class="line"></span><br><span class="line">ansible all -m unarchive -a <span class="string">&#x27;src=https://nginx.org/download/nginx-1.20.2.tar.gz dest=/data remote_src=yes owner=wang group=wang&#x27;</span></span><br><span class="line"></span><br><span class="line">ansible webservers -m unarchive -a <span class="string">&#x27;src=https://releases.ansible.com/ansible/ansible-2.1.6.0-0.1.rc1.tar.gz dest=/data/  owner=root remote_src=yes&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-7-Archive-模块"><a href="#2-7-Archive-模块" class="headerlink" title="2.7 Archive 模块"></a>2.7 Archive 模块</h2><p>功能：打包压缩保存在被管理节点</p>
<p>此模块的源和目标都在远程主机上</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">path  				<span class="comment">#压缩的文件或目录</span></span><br><span class="line">dest  				<span class="comment">#压缩后的文件</span></span><br><span class="line">format 				<span class="comment">#压缩格式,支持gz,bz2,xz,tar,zip</span></span><br><span class="line">remove=<span class="literal">false</span>|<span class="literal">true</span> 	<span class="comment">#是否删除源文件,默认 false</span></span><br><span class="line">mode=777 		  			<span class="comment">#设置目标权限</span></span><br><span class="line">owner=USER 		  		<span class="comment">#设置目标属主</span></span><br><span class="line">group=GROUP 	  		<span class="comment">#设置目标属组</span></span><br></pre></td></tr></table></figure>

<p>安裝</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装模块</span></span><br><span class="line">[root@ubuntu ~]# ansible-galaxy collection install community.general</span><br><span class="line">Starting galaxy collection install process</span><br><span class="line">Process install dependency map</span><br><span class="line">ERROR! Unexpected Exception, this is probably a bug:</span><br><span class="line">CollectionDependencyProvider.find_matches() got an unexpected keyword argument <span class="string">&#x27;identifier&#x27;</span> to see the full traceback, use -vvv</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# pip install -Ivvv <span class="string">&quot;resolvelib &gt;= 0.5.3, &lt; 0.6.0&quot;</span></span><br><span class="line">[root@ubuntu ~]# ansible-galaxy collection install community.general</span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#有一台主机上没有要打包的目录</span></span><br><span class="line">[root@ubuntu ~]# ansible <span class="string">&quot;10.0.0.150 10.0.0.206&quot;</span> -m archive -a <span class="string">&quot;path=/root/dira/ dest=/tmp/dira.bz2 format=bz2 mode=600&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#不保留源目录</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m archive -a <span class="string">&quot;path=/root/dira/ dest=/tmp/dira.zip format=zip remove=true&quot;</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible webservers -m archive  -a <span class="string">&#x27;path=/var/log/ dest=/data/log.tar.bz2 format=bz2 owner=wang mode=0600&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-8-Lineinfile-模块"><a href="#2-8-Lineinfile-模块" class="headerlink" title="2.8 Lineinfile 模块"></a>2.8 Lineinfile 模块</h2><p>ansible在使用sed进行替换时，经常会遇到需要转义的问题，而且ansible在遇到特殊符号进行替换时，会存在问题，无法正常进行替换 </p>
<p>ansible自身提供了两个模块：lineinfile模块和replace模块，可以方便的进行替换一般在ansible当中去修改某个文件的单行进行替换的时候需要使用lineinfile模块</p>
<p>功能：相当于sed，主要用于修改一行的文件内容</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">path 			    <span class="comment">#被控端文件的路径</span></span><br><span class="line">regexp 			  <span class="comment">#正则匹配语法格式,表示被替换的内容</span></span><br><span class="line">line 			    <span class="comment">#替换为的内容</span></span><br><span class="line">state 			  <span class="comment">#absent表示删除</span></span><br><span class="line">insertafter   <span class="comment">#插入到替换内容后面,如和regexp同时存在,只在没找到与regexp匹配时才使用insertafter</span></span><br><span class="line">insertbefore  <span class="comment">#插入到替换内容前面,如和regexp同时存在,只在没找到与regexp匹配时才使用insertafter</span></span><br><span class="line">backrefs     	<span class="comment">#支持后面引用,yes和no</span></span><br><span class="line">backup      	<span class="comment">#修改前先备份</span></span><br><span class="line">create      	<span class="comment">#如果文件不存在,则创建,默认不存在会出错</span></span><br><span class="line">mode       		<span class="comment">#指定权限</span></span><br><span class="line">owner      		<span class="comment">#指定用户</span></span><br><span class="line">group      		<span class="comment">#指定组</span></span><br></pre></td></tr></table></figure>

<p>注意: </p>
<ul>
<li>regexp参数 ：使用正则表达式匹配对应的行，当替换文本时，如果有多行文本都能被匹配，则只有最后面被匹配到的那行文本才会被替换，当删除文本时，如果有多行文本都能被匹配，这么这些行都会被删除。</li>
<li>如果想进行多行匹配进行替换需要使用replace模块</li>
</ul>
<p>范例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改监听端口</span></span><br><span class="line">ansible webservers -m lineinfile -a <span class="string">&quot;path=/etc/httpd/conf/httpd.conf regexp=&#x27;^Listen&#x27; line=&#x27;Listen 8080&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改SELinux</span></span><br><span class="line">ansible all -m  lineinfile -a <span class="string">&quot;path=/etc/selinux/config regexp=&#x27;^SELINUX=&#x27; line=&#x27;SELINUX=disabled&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#添加网关</span></span><br><span class="line">ansible webservers -m lineinfile -a <span class="string">&#x27;path=/etc/sysconfig/network-scripts/ifcfg-eth0 line=&quot;GATEWAY=10.0.0.254&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#给主机增加一个网关，但需要增加到NAME=下面</span></span><br><span class="line">ansible webservers  -m lineinfile -a <span class="string">&#x27;path=/etc/sysconfig/network-scripts/ifcfg-eth0 insertafter=&quot;^NAME=&quot; line=&quot;GATEWAY=10.0.0.254&quot;&#x27;</span></span><br><span class="line"><span class="comment">#效果如下</span></span><br><span class="line"><span class="built_in">cat</span> /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">DEVICE=eth0</span><br><span class="line">NAME=eth0</span><br><span class="line">GATEWAY=10.0.0.254</span><br><span class="line"></span><br><span class="line"><span class="comment">#给主机增加一个网关，但需要增加到NAME=上面</span></span><br><span class="line">ansible webservers  -m lineinfile -a <span class="string">&#x27;path=/etc/sysconfig/network-scripts/ifcfg-eth0 insertbefore=&quot;^NAME=&quot; line=&quot;GATEWAY=10.0.0.254&quot;&#x27;</span></span><br><span class="line"><span class="comment">#效果如下</span></span><br><span class="line"><span class="built_in">cat</span> /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">DEVICE=eth0</span><br><span class="line">GATEWAY=10.0.0.254</span><br><span class="line">NAME=eth0</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除网关</span></span><br><span class="line">ansible webservers -m lineinfile -a <span class="string">&#x27;path=/etc/sysconfig/network-scripts/ifcfg-eth0 regexp=&quot;^GATEWAY&quot; state=absent&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除#开头的行</span></span><br><span class="line">ansible all -m lineinfile  -a <span class="string">&#x27;dest=/etc/fstab state=absent regexp=&quot;^#&quot;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>范例：替换</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在远程主机上查看</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> -n test.txt</span><br><span class="line">  1 aaaa</span><br><span class="line">  2 bbbb</span><br><span class="line">  3 tom-123</span><br><span class="line">  4 tom-456</span><br><span class="line">  5 tom-789</span><br><span class="line">  6 jerry-123</span><br><span class="line">  7 jerry-456</span><br><span class="line">  </span><br><span class="line"><span class="comment">#替换</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m lineinfile -a <span class="string">&#x27;path=/root/test.txt regexp=&quot;^tom&quot; line=&quot;TOM&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#再次查看</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> -n test.txt</span><br><span class="line">  1 aaaa</span><br><span class="line">  2 bbbb</span><br><span class="line">  3 tom-123</span><br><span class="line">  4 tom-456</span><br><span class="line">  5 TOM</span><br><span class="line">  6 jerry-123</span><br><span class="line">  7 jerry-456</span><br></pre></td></tr></table></figure>

<p>范例：新增内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#追加一行</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m lineinfile -a <span class="string">&#x27;path=/root/test.txt line=&quot;abcdefg&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#再次查看</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> -n test.txt</span><br><span class="line">  1 aaaa</span><br><span class="line">  2 bbbb</span><br><span class="line">  3 tom-123</span><br><span class="line">  4 tom-456</span><br><span class="line">  5 TOM</span><br><span class="line">  6 jerry-123</span><br><span class="line">  7 jerry-456</span><br><span class="line">  8 abcdefg</span><br><span class="line">  </span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> -n test2.txt</span><br><span class="line">  1 123</span><br><span class="line">  2 123</span><br><span class="line">  3 abc</span><br><span class="line">  4 ABCDEFG</span><br><span class="line">  5 123456</span><br><span class="line">  </span><br><span class="line"><span class="comment">#在最后一行123后面插入新行，锚定整行</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m lineinfile -a <span class="string">&#x27;path=/root/test2.txt insertafter=&quot;^123$&quot; line=&quot;AAAAAA&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#再次查看</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> -n test2.txt</span><br><span class="line">  1 123</span><br><span class="line">  2 123</span><br><span class="line">  3 AAAAAA</span><br><span class="line">  4 abc</span><br><span class="line">  5 ABCDEFG</span><br><span class="line">  6 123456</span><br><span class="line">  </span><br><span class="line"><span class="comment">#描定开头，在以123 开头的行的上面插入新行</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m lineinfile -a <span class="string">&#x27;path=/root/test2.txt insertbefore=&quot;^123&quot; line=&quot;BBBBBB&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> -n test2.txt</span><br><span class="line">  1 123</span><br><span class="line">  2 123</span><br><span class="line">  3 AAAAAA</span><br><span class="line">  4 abc</span><br><span class="line">  5 ABCDEFG</span><br><span class="line">  6 BBBBBB</span><br><span class="line">  7 123456</span><br><span class="line">  </span><br><span class="line"><span class="comment">#删除文件中所有以 123 开头的行，修改前先备份</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m lineinfile -a <span class="string">&#x27;path=/root/test2.txt regexp=&quot;^123&quot; backup=yes state=absent&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在远程主机上查看</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> test2.txt*</span><br><span class="line">test2.txt test2.txt.5588.2023-06-19@10:02:14~</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> test2.txt</span><br><span class="line">AAAAAA</span><br><span class="line">abc</span><br><span class="line">ABCDEFG</span><br><span class="line">BBBBBB</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> test2.txt.5588.2023-06-19@10\:02\:14~</span><br><span class="line">123</span><br><span class="line">123</span><br><span class="line">AAAAAA</span><br><span class="line">abc</span><br><span class="line">ABCDEFG</span><br><span class="line">BBBBBB</span><br><span class="line">123456</span><br></pre></td></tr></table></figure>

<p>范例：文件不存在，创建新文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m lineinfile -a <span class="string">&#x27;path=/root/test3.txt line=&quot;ABCD&quot; create=yes owner=tom mode=777&#x27;</span></span><br></pre></td></tr></table></figure>

<p>范例：匹配引用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> -n test4.txt</span><br><span class="line">  1 AAAAAA</span><br><span class="line">  2 abc</span><br><span class="line">  3 ABCDEFG</span><br><span class="line">  4 BBBBBB</span><br><span class="line">  5 abcdefg</span><br><span class="line">  6 ABC123</span><br><span class="line">  </span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m lineinfile -a <span class="string">&quot;path=/root/test4.txt regexp=&#x27;^ABC(.*)$&#x27; backrefs=yes line=&#x27;XYZ\1&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#再次查看</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> -n test4.txt</span><br><span class="line">  1 AAAAAA</span><br><span class="line">  2 abc</span><br><span class="line">  3 ABCDEFG</span><br><span class="line">  4 BBBBBB</span><br><span class="line">  5 abcdefg</span><br><span class="line">  6 XYZ123</span><br></pre></td></tr></table></figure>

<h2 id="2-9-Replace-模块"><a href="#2-9-Replace-模块" class="headerlink" title="2.9 Replace 模块"></a>2.9 Replace 模块</h2><p>该模块有点类似于sed命令，主要也是基于正则进行匹配和替换，建议使用</p>
<p>功能: 多行修改替换</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">path 				<span class="comment">#被控端文件的路径</span></span><br><span class="line">regexp 			<span class="comment">#正则匹配语法格式,表示被替换的内容</span></span><br><span class="line">replace 		<span class="comment">#替换为的内容</span></span><br><span class="line">after      	<span class="comment">#插入到替换内容前面</span></span><br><span class="line">before      <span class="comment">#插入到替换内容后面</span></span><br><span class="line">backup      <span class="comment">#修改前先备份</span></span><br><span class="line">mode       	<span class="comment">#指定权限</span></span><br><span class="line">owner      	<span class="comment">#指定用户</span></span><br><span class="line">group      	<span class="comment">#指定组</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> -n test5.txt</span><br><span class="line">  1 123</span><br><span class="line">  2 123</span><br><span class="line">  3 456</span><br><span class="line">  4 abcdefg</span><br><span class="line">  5 ABCDEFG</span><br><span class="line">  6 123root</span><br><span class="line">  </span><br><span class="line"><span class="comment">#替换所有3个数字的行</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m replace -a <span class="string">&quot;path=/root/test5.txt regexp=&#x27;^([0-9]&#123;3&#125;)$&#x27; replace=&#x27;\1---\1&#x27; backup=yes&quot;</span></span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> -n test5.txt</span><br><span class="line">  1 123---123</span><br><span class="line">  2 123---123</span><br><span class="line">  3 456---456</span><br><span class="line">  4 abcdefg</span><br><span class="line">  5 ABCDEFG</span><br><span class="line">  6 123root</span><br><span class="line">  </span><br><span class="line"><span class="comment">#备份文件</span></span><br><span class="line">[root@ubuntu ~]# ll test5.txt*</span><br><span class="line">-rw-r--r-- 1 root root 54 Jun 19 10:22 test5.txt</span><br><span class="line">-rw-r--r-- 1 root root 36 Jun 19 10:21 <span class="string">&#x27;test5.txt.5936.2023-06-19@10:22:08~&#x27;</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> -n test6.txt</span><br><span class="line">  1 aaa</span><br><span class="line">  2 123</span><br><span class="line">  3 456</span><br><span class="line">  4 bbb</span><br><span class="line">  5 ccc</span><br><span class="line">  </span><br><span class="line"><span class="comment">#只处理 aaa行到bbb行中间的内容</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m replace -a <span class="string">&quot;path=/root/test6.txt after=&#x27;aaa&#x27; before=&#x27;bbb&#x27; regexp=&#x27;^(.+)$&#x27; replace=&#x27;# \1&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> -n test6.txt</span><br><span class="line">  1 aaa</span><br><span class="line">  2 <span class="comment"># 123</span></span><br><span class="line">  3 <span class="comment"># 456</span></span><br><span class="line">  4 bbb</span><br><span class="line">  5 ccc</span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ansible all -m replace -a <span class="string">&quot;path=/etc/fstab regexp=&#x27;^(UUID.*)&#x27; replace=&#x27;#\1&#x27;&quot;</span> </span><br><span class="line">ansible all -m replace -a <span class="string">&quot;path=/etc/fstab regexp=&#x27;^#(UUID.*)&#x27; replace=&#x27;\1&#x27;&quot;</span></span><br></pre></td></tr></table></figure>

<p>范例：有一个 Nginx 配置文件，你想在 <code>server_name</code> 设置之后，但在 <code>listen</code> 指令之前添加一个新的服务器块</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Add</span> <span class="string">new</span> <span class="string">server</span> <span class="string">block</span> <span class="string">after</span> <span class="string">server_name</span> <span class="string">and</span> <span class="string">before</span> <span class="string">listen</span></span><br><span class="line">  <span class="attr">ansible.builtin.replace:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/nginx/sites-available/default</span></span><br><span class="line">    <span class="attr">after:</span> <span class="string">&#x27;^server_name&#x27;</span></span><br><span class="line">    <span class="attr">before:</span> <span class="string">&#x27;^listen&#x27;</span></span><br><span class="line">    <span class="attr">regexp:</span> <span class="string">&#x27;(?m)^#?\\s*$&#x27;</span></span><br><span class="line">    <span class="attr">replace:</span> <span class="string">&#x27;    location /new_path &#123;\n        root /var/www/html;\n        index index.html index.htm;\n    &#125;\n&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>after: &#39;^server_name&#39;</code> 确保替换发生在 <code>server_name</code> 指令之后。</li>
<li><code>before: &#39;^listen&#39;</code> 确保替换发生在 <code>listen</code> 指令之前。</li>
<li><code>regexp: &#39;(?m)^#?\\s*$&#39;</code> 是一个正则表达式，用于匹配行首的零个或多个空白字符或注释符 <code>#</code>，这通常是空行或注释行。</li>
<li><code>replace</code> 参数指定了要插入的新文本。</li>
</ul>
<h1 id="3-用户和组相关"><a href="#3-用户和组相关" class="headerlink" title="3 用户和组相关"></a>3 用户和组相关</h1><h2 id="3-1-User-模块"><a href="#3-1-User-模块" class="headerlink" title="3.1 User 模块"></a>3.1 User 模块</h2><p>功能：管理用户</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">name=USERNAME 						<span class="comment">#指定用户名</span></span><br><span class="line">comment=str 							<span class="comment">#用户描述信息</span></span><br><span class="line">create_home=<span class="built_in">yes</span>|no 				<span class="comment">#是否创建家目录,默认yes</span></span><br><span class="line">group=GROUPNAME 					<span class="comment">#指定私有组</span></span><br><span class="line"><span class="built_in">groups</span>=group1,group2... 	<span class="comment">#指定附加组</span></span><br><span class="line">append 										<span class="comment">#追加附加组使用,yes表示增加新的附加组</span></span><br><span class="line">home=/path 								<span class="comment">#指定家目录路径</span></span><br><span class="line">shell=SHELL 							<span class="comment">#指定shell，默认/bin/bash</span></span><br><span class="line">password=str 							<span class="comment">#设置密码，必须是加密后的字符串，否则不生效</span></span><br><span class="line">state=absent|present 			<span class="comment">#absent 删除用户,present 创建用户，默认 present</span></span><br><span class="line">system=<span class="built_in">yes</span>|no 						<span class="comment">#是否创建系统账号，默认 no</span></span><br><span class="line">uid=UID 									<span class="comment">#手动指定uid</span></span><br><span class="line"><span class="built_in">umask</span>=UMASK 							<span class="comment">#指定umask</span></span><br><span class="line">remove=<span class="built_in">yes</span>|no 						<span class="comment">#删除用户时将家目录一起删除,默认 no</span></span><br><span class="line">generate_ssh_key=<span class="built_in">yes</span>|no 	<span class="comment">#是否创建私钥，默认 no</span></span><br><span class="line">ssh_key_bits=2048 				<span class="comment">#指定私钥位数</span></span><br><span class="line">ssh_key_file=/path/file 	<span class="comment">#指定私钥文件位置,默认 .ssh/id_rsa</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建用户</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m user -a <span class="string">&#x27;name=user1 comment=&quot;ansible user&quot; uid=2048 home=/user1/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在远程主机上查看</span></span><br><span class="line">[root@ubuntu ~]# getent passwd user1</span><br><span class="line">user1:x:2048:2048:ansible user:/user1/:/bin/sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#生成密码</span></span><br><span class="line">[root@ubuntu ~]# openssl passwd -6 123456</span><br><span class="line">$6$yaZYTO7B1gnMCfoK<span class="variable">$MmKbbYKOX2c7Cx8mXBLSp1JGYbr6ZNTq0qAymnbU4dbTvLcuRmyOL5GPKSLpuYxDl2Ir7rkNr4gnuSlC0KSi10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建系统用户，不创建家目录，指定shell，指定组，指定密码,组要先存在</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m user -a <span class="string">&#x27;name=user2 comment=&quot;ansible user&quot; system=yes create_home=no shell=/sbin/nologin group=gb password=&quot;$6$yaZYTO7B1gnMCfoK$MmKbbYKOX2c7Cx8mXBLSp1JGYbr6ZNTq0qAymnbU4dbTvLcuRmyOL5GPKSLpuYxDl2Ir7rkNr4gnuSlC0KSi10&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在远程主机上查看</span></span><br><span class="line">[root@ubuntu ~]# getent passwd user2</span><br><span class="line">user2:x:998:123:ansible user:/home/user2:/sbin/nologin/</span><br><span class="line">[root@ubuntu ~]# getent shadow user2</span><br><span class="line">user2:$6$yaZYTO7B1gnMCfoK<span class="variable">$MmKbbYKOX2c7Cx8mXBLSp1JGYbr6ZNTq0qAymnbU4dbTvLcuRmyOL5GPKSLpuYxDl2Ir7rkNr4gnuSlC0KSi10</span>:19527::::::</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建用户并生成密钥</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m user -a <span class="string">&#x27;name=user3 generate_ssh_key=yes ssh_key_bits=2048&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在远程主机上查看</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> /home/user3/.ssh/</span><br><span class="line">id_rsa id_rsa.pub</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除用户</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m user -a <span class="string">&#x27;name=user3 remove=yes state=absent&#x27;</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m user -a <span class="string">&#x27;name=user2 remove=yes state=absent&#x27;</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m user -a <span class="string">&#x27;name=user1 remove=yes state=absent&#x27;</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建用户</span></span><br><span class="line">ansible all -m user -a <span class="string">&#x27;name=user1 comment=&quot;test user&quot; uid=2048 home=/app/user1 group=root&#x27;</span></span><br><span class="line"></span><br><span class="line">ansible all -m user -a <span class="string">&#x27;name=nginx comment=nginx uid=88 group=nginx groups=&quot;root,daemon&quot; shell=/sbin/nologin system=yes create_home=no home=/data/nginx non_unique=yes&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#remove=yes表示删除用户及家目录等数据,默认remove=no</span></span><br><span class="line">ansible all -m user -a <span class="string">&#x27;name=nginx state=absent remove=yes&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#生成123456加密的密码</span></span><br><span class="line">ansible localhost -m debug -a <span class="string">&quot;msg=&#123;&#123; &#x27;123456&#x27;| password_hash(&#x27;sha512&#x27;,&#x27;salt&#x27;)&#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#用上面创建的密码创建用户</span></span><br><span class="line">ansible webservers -m user -a <span class="string">&#x27;name=www group=www system=yes shell=/sbin/nlogin password=&quot;$6$salt$MktMKPZJ6t59GfxcJU20DwcwQzfMvOlHFVZiOVD71w.&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建用户test,并生成4096bit的私钥</span></span><br><span class="line">ansible webservers -m user -a <span class="string">&#x27;name=test generate_ssh_key=yes ssh_key_bits=4096 ssh_key_file=.ssh/id_rsa&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-2-Group-模块"><a href="#3-2-Group-模块" class="headerlink" title="3.2 Group 模块"></a>3.2 Group 模块</h2><p>功能：管理组</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">name     				<span class="comment">#指定组名称</span></span><br><span class="line">gid     				<span class="comment">#指定gid</span></span><br><span class="line">state</span><br><span class="line"> =present  			<span class="comment">#创建,默认</span></span><br><span class="line"> =absent  			<span class="comment">#删除</span></span><br><span class="line">system=<span class="built_in">yes</span>|no 	<span class="comment">#是否是系统组，默认no</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建普通组</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m group -a <span class="string">&#x27;name=ga gid=1024&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建系统组</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m group -a <span class="string">&#x27;name=gb gid=888 system=yes&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除组</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m group -a <span class="string">&#x27;name=ga state=absent&#x27;</span></span><br></pre></td></tr></table></figure>

<h1 id="4-仓库管理相关"><a href="#4-仓库管理相关" class="headerlink" title="4 仓库管理相关"></a>4 仓库管理相关</h1><h2 id="4-1-yum-模块"><a href="#4-1-yum-模块" class="headerlink" title="4.1 yum 模块"></a>4.1 yum 模块</h2><p>功能：管理软件包</p>
<p>yum 管理软件包，只支持RHEL，CentOS，fedora，不支持Ubuntu其它版本</p>
<p>yum常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">state 				<span class="comment">#状态</span></span><br><span class="line"> 	=present 		<span class="comment">#安装,此为默认值</span></span><br><span class="line"> 	=absent 		<span class="comment">#删除</span></span><br><span class="line"> 	=latest 		<span class="comment">#最新版</span></span><br><span class="line">list					<span class="comment">#列出指定包，此选项与name选项互斥，写具体包名是相当于执行yum list --showduplicates packagename</span></span><br><span class="line">    =packagename</span><br><span class="line">    =installed</span><br><span class="line">    =updates</span><br><span class="line">    =available</span><br><span class="line">    =repos </span><br><span class="line">name 									<span class="comment">#软件包名称</span></span><br><span class="line">enablerepo 						<span class="comment">#启用哪个仓库安装</span></span><br><span class="line">disablerepo 					<span class="comment">#不使用哪些仓库的包</span></span><br><span class="line">exclude 							<span class="comment">#排除指定的包</span></span><br><span class="line">validate     					<span class="comment">#是否检验,默认为yes</span></span><br><span class="line">download_dir=/path 				<span class="comment">#指定下载目录</span></span><br><span class="line">download_only=<span class="built_in">yes</span>|no 			<span class="comment">#只下载不安装，默认 no</span></span><br><span class="line">update_only=<span class="built_in">yes</span>|no 				<span class="comment">#yes 仅更新,默认no</span></span><br><span class="line">use_backend=auto|yum|yum4|dnf 	<span class="comment">#指定真实执行的命令,默认 auto</span></span><br><span class="line">autoremove=<span class="built_in">yes</span>|no 							<span class="comment">#卸载依赖，仅在卸载时生效，默认no</span></span><br><span class="line">validate_certs=<span class="built_in">yes</span>|no 					<span class="comment">#是否对包进行校验，默认yes</span></span><br><span class="line">disable_gpg_check=<span class="built_in">yes</span>|no 				<span class="comment">#是否不对包进行校验，默认no</span></span><br><span class="line">update_only=<span class="built_in">yes</span>|no 							<span class="comment">#只更新不安装,默认no</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#列出指定软件包，相当于 yum list --showduplicates nginx</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.150 -m yum -a <span class="string">&#x27;list=nginx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#列出所有 repo包</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.150 -m yum -a <span class="string">&#x27;list=repos&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#卸载</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.150 -m yum -a <span class="string">&#x27;name=sos state=removed&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#从指定源安装</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.150 -m yum -a <span class="string">&#x27;name=sos enablerepo=baseos&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#从 rpm 包中安装，不校验 ssl 证书，不校验包</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.150 -m yum -a</span><br><span class="line"><span class="string">&#x27;name=https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/6.0/rhel/8/x86_64/zabbix-agent-6.0.0-1.el8.x86_64.rpm state=present validate_certs=no disable_gpg_check=yes&#x27;</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装</span></span><br><span class="line">[root@ansible ~]#ansible webservers -m yum -a <span class="string">&#x27;name=httpd state=present&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#安装zabbix agent rpm包</span></span><br><span class="line">[root@ansible ~]#ansible webservers -m yum -a <span class="string">&#x27;name=https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/5.0/rhel/8/x86_64/zabbix-agent2-5.0.24-1.el8.x86_64.rpm state=present validate_certs=no&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#启用epel源进行安装</span></span><br><span class="line">[root@ansible ~]#ansible webservers -m yum -a <span class="string">&#x27;name=nginx state=present enablerepo=epel&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#升级除kernel和foo开头以外的所有包</span></span><br><span class="line">[root@ansible ~]#ansible webservers -m yum -a <span class="string">&#x27;name=* state=lastest exclude=kernel*,foo*&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除</span></span><br><span class="line">[root@ansible ~]#ansible webservers -m yum -a <span class="string">&#x27;name=httpd state=absent&#x27;</span> </span><br><span class="line">[root@ansible ~]#ansible webservers -m yum -a <span class="string">&#x27;name=sl,cowsay&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-2-yum-repository-模块"><a href="#4-2-yum-repository-模块" class="headerlink" title="4.2 yum_repository 模块"></a>4.2 yum_repository 模块</h2><p>功能: 此模块实现yum的仓库配置管理</p>
<p>选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">name 									<span class="comment">#仓库id</span></span><br><span class="line">description 					<span class="comment">#仓库描述名称,对应配置文件中的name=</span></span><br><span class="line">baseurl 							<span class="comment">#仓库的地址</span></span><br><span class="line">gpgcheck 							<span class="comment">#验证开启</span></span><br><span class="line">gpgkey        				<span class="comment">#仓库公钥路径</span></span><br><span class="line">enabled=<span class="built_in">yes</span>|no 				<span class="comment">#是否启用</span></span><br><span class="line">state=absent|present 	<span class="comment">#absent删除， present安装，默认present</span></span><br><span class="line"><span class="built_in">timeout</span>=30 						<span class="comment">#超时时长，默认30s</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加yum 源</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.150 -m yum_repository -a <span class="string">&#x27;name=nginx description=nginx-desc baseurl=&quot;http://nginx.org/packages/centos/$releasever/$basearch/&quot; gpgcheck=1 enabled=1 gpgkey=https://nginx.org/keys/nginx_signing.key&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.150 -m yum_repository -a <span class="string">&#x27;name=nginx state=absent&#x27;</span></span><br></pre></td></tr></table></figure>

<p>范例：安装zabbix-agent</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@ansible ]#ansible 10.0.0.8 -m yum_repository -a <span class="string">&#x27;name=zabbix description=&quot;zabbix repo&quot; baseurl=&quot;https://mirrors.aliyun.com/zabbix/zabbix/6.0/rhel/$releasever/$basearch/&quot; gpgcheck=no&#x27;</span></span><br><span class="line"></span><br><span class="line">[root@ansible ~]#ansible 10.0.0.8 -m yum -a <span class="string">&#x27;name=zabbix-agent2&#x27;</span></span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ansible webservers -m yum_repository -a <span class="string">&#x27;name=ansible_nginx description=&quot;nginx repo&quot; baseurl=&quot;http://nginx.org/packages/centos/$releasever/$basearch/&quot; gpgcheck=yes gpgkey=&quot;https://nginx.org/keys/nginx_signing.key&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]#<span class="built_in">cat</span> /etc/yum.repos.d/ansible_nginx.repo</span><br><span class="line">[ansible_nginx]</span><br><span class="line">baseurl = http://nginx.org/packages/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck = 1</span><br><span class="line">gpgkey = https://nginx.org/keys/nginx_signing.key</span><br><span class="line">name = nginx repo</span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Add</span> <span class="string">multiple</span> <span class="string">repositories</span> <span class="string">into</span> <span class="string">the</span> <span class="string">same</span> <span class="string">file</span> <span class="string">(1/2)</span></span><br><span class="line">  <span class="attr">yum_repository:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">epel</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">EPEL</span> <span class="string">YUM</span> <span class="string">repo</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">external_repos</span></span><br><span class="line">    <span class="attr">baseurl:</span> <span class="string">https://download.fedoraproject.org/pub/epel/$releasever/$basearch/</span></span><br><span class="line">    <span class="attr">gpgcheck:</span> <span class="literal">no</span></span><br><span class="line">    </span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Add</span> <span class="string">multiple</span> <span class="string">repositories</span> <span class="string">into</span> <span class="string">the</span> <span class="string">same</span> <span class="string">file</span> <span class="string">(2/2)</span></span><br><span class="line">  <span class="attr">yum_repository:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">rpmforge</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">RPMforge</span> <span class="string">YUM</span> <span class="string">repo</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">external_repos</span></span><br><span class="line">    <span class="attr">baseurl:</span> <span class="string">http://apt.sw.be/redhat/el7/en/$basearch/rpmforge</span></span><br><span class="line">    <span class="attr">mirrorlist:</span> <span class="string">http://mirrorlist.repoforge.org/el7/mirrors-rpmforge</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">no</span></span><br><span class="line"> </span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Remove</span> <span class="string">repository</span> <span class="string">from</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">repo</span> <span class="string">file</span></span><br><span class="line">  <span class="attr">yum_repository:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">epel</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">external_repos</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">absent</span></span><br></pre></td></tr></table></figure>

<p>范例: 创建和删除仓库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible ~]#<span class="built_in">cat</span> yum_repo.yml</span><br><span class="line">- hosts: webservers</span><br><span class="line">  tasks:</span><br><span class="line">   - name: Add multiple repositories into the same file</span><br><span class="line">     yum_repository:</span><br><span class="line">       name: <span class="built_in">test</span></span><br><span class="line">       description: EPEL YUM repo</span><br><span class="line">       file: external_repos</span><br><span class="line">       baseurl:https://download.fedoraproject.org/pub/epel/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">       gpgcheck: no</span><br><span class="line">   </span><br><span class="line">[root@ansible ~]#ansible-playbook yum_repo.yml</span><br><span class="line"></span><br><span class="line">[root@web1 ~]#<span class="built_in">cat</span> /etc/yum.repos.d/external_repos.repo</span><br><span class="line">[<span class="built_in">test</span>]</span><br><span class="line">baseurl = https://download.fedoraproject.org/pub/epel/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck = 0</span><br><span class="line">name = EPEL YUM repo</span><br><span class="line"></span><br><span class="line">[root@ansible ~]#<span class="built_in">cat</span> remove_yum_repo.yml</span><br><span class="line">- hosts: webservers</span><br><span class="line">  tasks:</span><br><span class="line">   - name: remove repo</span><br><span class="line">     yum_repository:</span><br><span class="line">       name: <span class="built_in">test</span></span><br><span class="line">       file: external_repos</span><br><span class="line">       state: absent</span><br><span class="line">   </span><br><span class="line">[root@ansible ~]#ansible-playbook remove_yum_repo.yml</span><br></pre></td></tr></table></figure>

<p>范例: 常见仓库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">- name: Add Base Yum Repository</span><br><span class="line">  yum_repository:</span><br><span class="line">    name: base</span><br><span class="line">    description: Base Aliyun Repository</span><br><span class="line">    baseurl: http://mirrors.aliyun.com/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">    gpgcheck: <span class="built_in">yes</span></span><br><span class="line">    gpgkey: http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line">    </span><br><span class="line">- name: Add Epel Yum Repository</span><br><span class="line">  yum_repository:</span><br><span class="line">    name: epel</span><br><span class="line">    description: Epel Aliyun Repository</span><br><span class="line">    baseurl: http://mirrors.aliyun.com/epel/7/<span class="variable">$basearch</span></span><br><span class="line">    gpgcheck: no</span><br><span class="line">    </span><br><span class="line">- name: Add Nginx Yum Repository</span><br><span class="line">  yum_repository:</span><br><span class="line">    name: nginx</span><br><span class="line">    description: Nginx Repository</span><br><span class="line">    baseurl: http://nginx.org/packages/centos/7/<span class="variable">$basearch</span>/</span><br><span class="line">    gpgcheck: no</span><br><span class="line">    </span><br><span class="line">- name: Add PHP Yum Repository</span><br><span class="line">  yum_repository:</span><br><span class="line">    name: php71w</span><br><span class="line">    description: php Repository</span><br><span class="line">    baseurl: http://us-east.repo.webtatic.com/yum/el7/x86_64/</span><br><span class="line">    gpgcheck: no</span><br><span class="line">    </span><br><span class="line">- name: Add Haproxy Yum Repository</span><br><span class="line">  yum_repository:</span><br><span class="line">    name: haproxy</span><br><span class="line">    description: haproxy repository</span><br><span class="line">    baseurl: https://repo.ius.io/archive/7/<span class="variable">$basearch</span>/</span><br><span class="line">    gpgcheck: <span class="built_in">yes</span></span><br><span class="line">    gpgkey: https://repo.ius.io/RPM-GPG-KEY-IUS-7</span><br></pre></td></tr></table></figure>

<h2 id="4-3-apt-模块"><a href="#4-3-apt-模块" class="headerlink" title="4.3 apt 模块"></a>4.3 apt 模块</h2><p>apt 模块管理 Debian 相关版本的软件包</p>
<p>apt 选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">name=packagename 		<span class="comment">#指定包名，可用通配符</span></span><br><span class="line">autoclean=<span class="built_in">yes</span>|no 		<span class="comment">#清除本地安装包，只删除己卸载的软件的 deb包</span></span><br><span class="line">deb=/path/file.deb 	<span class="comment">#指定deb包，可以是本地的，也可以是网络的</span></span><br><span class="line">autoremove=<span class="built_in">yes</span>|no 	<span class="comment">#卸载依赖包,默认no</span></span><br><span class="line">only_upgrade=<span class="built_in">yes</span>|no <span class="comment">#仅更新，不安装</span></span><br><span class="line">update_cache=<span class="built_in">yes</span>|no <span class="comment">#更新索引</span></span><br><span class="line">state=absent|build-dep|latest|present|fixed 	<span class="comment">#absent卸载，build-dep安装依赖包,latest安装或升级到最新版,present安装，fixed修复</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#更新索引</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m apt -a <span class="string">&quot;update_cache=yes&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#清空缓存</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m apt -a <span class="string">&quot;autoclean=yes&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#安装指定版本</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m apt -a <span class="string">&quot;name=nginx=1.18.0-6ubuntu14.3 state=present&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#卸载</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m apt -a <span class="string">&quot;name=nginx* state=absent&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将所有包升级到最新版</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m apt -a <span class="string">&quot;name=* state=latest&quot;</span></span><br></pre></td></tr></table></figure>

<p>范例: Ubuntu 安装软件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]#ansible 10.0.0.100 -m apt -a <span class="string">&#x27;name=bb,sl,cowsay,cmatrix,oneko,hollywood,boxes,libaa-bin,x11-apps update_cache=yes&#x27;</span></span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#ansible webservers -m apt -a <span class="string">&#x27;name=rsync,psmisc state=absent&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-4-apt-repository-模块"><a href="#4-4-apt-repository-模块" class="headerlink" title="4.4 apt_repository 模块"></a>4.4 apt_repository 模块</h2><p>功能: 此模块实现apt的仓库配置管理</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">repo=str 							<span class="comment">#仓库信息，具体源</span></span><br><span class="line">filename=/path/file 	<span class="comment">#仓库文件名，默认加到 /etc/apt/sources.list 中</span></span><br><span class="line">state=absent|present 	<span class="comment">#absent 删除,present 新增，默认 present</span></span><br><span class="line">update_cache=<span class="built_in">yes</span>|no 	<span class="comment">#yes 更新源，相当于执行 apt-get update</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m apt_repository -a <span class="string">&#x27;repo=&quot;deb http://dl.google.com/linux/chrome/deb/ stable main&quot; filename=&quot;chrome&quot; update_cache=no&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#远程主机上查看</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> /etc/apt/sources.list.d/</span><br><span class="line">chrome.list</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> /etc/apt/sources.list.d/chrome.list</span><br><span class="line">deb http://dl.google.com/linux/chrome/deb/ stable main</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除源</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m apt_repository -a <span class="string">&#x27;repo=&quot;deb http://dl.google.com/linux/chrome/deb/ stable main&quot; filename=&quot;chrome&quot; state=absent&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-5-apt-key-模块"><a href="#4-5-apt-key-模块" class="headerlink" title="4.5 apt_key 模块"></a>4.5 apt_key 模块</h2><p>功能: 添加和删除 apt key</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url=URL 								<span class="comment">#key文件路径</span></span><br><span class="line">validate_certs=<span class="built_in">yes</span>|no 	<span class="comment">#是否校验https 的 ssl 证书，默认yes</span></span><br><span class="line">state=absent|present 		<span class="comment">#absent 删除，present 新增，默认 present</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加key</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m apt_key -a <span class="string">&#x27;url=https://download.ceph.com/keys/release.asc state=present&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#远程主机上查看</span></span><br><span class="line">[root@ubuntu ~]# apt-key list</span><br></pre></td></tr></table></figure>

<p>范例: 生成ceph仓库配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#先导入key,注意先后顺序</span></span><br><span class="line">ansible ubuntu-servers -m apt_key -a <span class="string">&#x27;url=https://download.ceph.com/keys/release.asc state=present&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#再生成apt配置,如果不导入key此步会出错</span></span><br><span class="line">ansible ubuntu-servers -m apt_repository -a <span class="string">&#x27;repo=&quot;deb http://mirror.tuna.tsinghua.edu.cn/ceph/debian-pacific focal main&quot; filename=ansible_ceph&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#验证结果</span></span><br><span class="line">[root@ubuntu2004 ~]#<span class="built_in">cat</span> /etc/apt/sources.list.d/ansible_ceph.list</span><br><span class="line">deb http://mirror.tuna.tsinghua.edu.cn/ceph/debian-pacific focal main</span><br></pre></td></tr></table></figure>

<h1 id="5-系统配置相关"><a href="#5-系统配置相关" class="headerlink" title="5 系统配置相关"></a>5 系统配置相关</h1><h2 id="5-1-Hostname-模块"><a href="#5-1-Hostname-模块" class="headerlink" title="5.1 Hostname 模块"></a>5.1 Hostname 模块</h2><p>功能：管理主机名</p>
<p>修改后永久生效</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name  <span class="comment">#修改后的主机名称</span></span><br></pre></td></tr></table></figure>

<p>范例：Ubuntu上对rocky使用hostname模块失败，原因是兼容性的问题，需要改源代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu2004 ~]#ansible 10.0.0.180 -m hostname -a name=<span class="string">&#x27;web&#x27;</span></span><br><span class="line">10.0.0.180 | FAILED! =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/libexec/platform-python&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;hostname module cannot be used on platform Linux (Rocky)&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#加上这一段代码</span></span><br><span class="line">[root@ubuntu2004 ~]#vim /usr/lib/python3/dist-packages/ansible/modules/system/hostname.py +721</span><br><span class="line">class ALTLinuxHostname(Hostname):</span><br><span class="line">    platform = <span class="string">&#x27;Linux&#x27;</span></span><br><span class="line">    distribution = <span class="string">&#x27;Rocky&#x27;</span></span><br><span class="line">    strategy_class = RedHatStrategy</span><br></pre></td></tr></table></figure>

<h2 id="5-2-Cron-模块"><a href="#5-2-Cron-模块" class="headerlink" title="5.2 Cron 模块"></a>5.2 Cron 模块</h2><p>功能：计划任务</p>
<p>支持时间：minute，hour，day，month，weekday</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">name=str 							<span class="comment">#任务名称,描述脚本的作用</span></span><br><span class="line">job=/path/cmd args 		<span class="comment">#具体任务命令</span></span><br><span class="line">disabled=<span class="built_in">yes</span>|no 			<span class="comment">#是否禁用，默认 false</span></span><br><span class="line">state=absent|present 	<span class="comment">#absent 删除,默认present</span></span><br><span class="line"><span class="built_in">env</span>=<span class="built_in">yes</span>|no 						<span class="comment">#yes设置环境变量，no 设置定时任务，默认 no</span></span><br><span class="line">user=UNAME 						<span class="comment">#指定任务用户,默认root</span></span><br><span class="line">special_time=annually|daily|hourly|monthly|reboot|weekly|yearly 	<span class="comment">#指定特殊时间</span></span><br><span class="line">minute= 		<span class="comment">#指定分钟参数</span></span><br><span class="line">hour= 			<span class="comment">#小时参数</span></span><br><span class="line">day= 			  <span class="comment">#自然天参数</span></span><br><span class="line">month= 			<span class="comment">#自然月参数</span></span><br><span class="line">weekday= 		<span class="comment">#星期参数</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m cron -a <span class="string">&#x27;job=&quot;/usr/bin/wall test-crontab&quot; name=test-crontab&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#指定时间</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m cron -a <span class="string">&#x27;job=&quot;/usr/bin/wall test-crontab2&quot; minute=*/5 hour=12 day=10,20,30 month=3,4,5 weekday=1-5 name=test-crontab2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在远程主机上查看</span></span><br><span class="line">[root@ubuntu ~]# crontab -l</span><br><span class="line"><span class="comment">#Ansible: test-crontab</span></span><br><span class="line">* * * * * /usr/bin/wall test-crontab</span><br><span class="line"><span class="comment">#Ansible: test-crontab2</span></span><br><span class="line">*/5 12 10,20,30 3,4,5 1-5 /usr/bin/wall test-crontab2</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m cron -a <span class="string">&#x27;job=&quot;/usr/bin/wall test-crontab-new-msg&quot; name=test-crontab&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#再次查看</span></span><br><span class="line">[root@ubuntu ~]# crontab -l</span><br><span class="line"><span class="comment">#Ansible: test-crontab</span></span><br><span class="line">* * * * * /usr/bin/wall test-crontab-new-msg 		<span class="comment">#此处被修改</span></span><br><span class="line"><span class="comment">#Ansible: test-crontab2</span></span><br><span class="line">*/5 12 10,20,30 3,4,5 1-5 /usr/bin/wall test-crontab2</span><br><span class="line"></span><br><span class="line"><span class="comment">#禁用</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m cron -a <span class="string">&#x27;job=&quot;/usr/bin/wall test-crontab-new-msg&quot; name=test-crontab disabled=yes&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#再次查看</span></span><br><span class="line">[root@ubuntu ~]# crontab -l</span><br><span class="line"><span class="comment">#Ansible: test-crontab</span></span><br><span class="line"><span class="comment">#* * * * * /usr/bin/wall test-crontab-new-msg</span></span><br><span class="line"><span class="comment">#Ansible: test-crontab2</span></span><br><span class="line">*/5 12 10,20,30 3,4,5 1-5 /usr/bin/wall test-crontab2</span><br></pre></td></tr></table></figure>

<p>范例：设置环境变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m cron -a <span class="string">&#x27;name=APP_HOME job=/dir/app env=yes&#x27;</span></span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# crontab -l</span><br><span class="line">APP_HOME=<span class="string">&quot;/dir/app&quot;</span></span><br><span class="line"><span class="comment">#Ansible: test-crontab</span></span><br><span class="line"><span class="comment">#* * * * * /usr/bin/wall test-crontab-new-msg</span></span><br><span class="line"><span class="comment">#Ansible: test-crontab2</span></span><br><span class="line">*/5 12 10,20,30 3,4,5 1-5 /usr/bin/wall test-crontab2</span><br></pre></td></tr></table></figure>

<p>范例：删除</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除变量</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m cron -a <span class="string">&#x27;name=APP_HOME job=/dir/app env=yes state=absent&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除定时任务</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m cron -a <span class="string">&#x27;job=&quot;/usr/bin/wall test-crontab-new-msg&quot; name=test-crontab state=absent&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看远程主机</span></span><br><span class="line">[root@ubuntu ~]# crontab -l</span><br><span class="line"><span class="comment">#Ansible: test-crontab2</span></span><br><span class="line">*/5 12 10,20,30 3,4,5 1-5 /usr/bin/wall test-crontab2</span><br></pre></td></tr></table></figure>

<p>为远程主机上的指定用户创建</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m cron -a <span class="string">&#x27;job=&quot;/usr/bin/wall test-crontab3&quot; user=tom name=test-crontab&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在远程主机上查看</span></span><br><span class="line">[root@ubuntu ~]# crontab -u tom -l</span><br><span class="line"><span class="comment">#Ansible: test-crontab</span></span><br><span class="line">* * * * * /usr/bin/wall test-crontab3</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#备份数据库脚本</span></span><br><span class="line">[root@centos8 ~]#<span class="built_in">cat</span> /root/mysql_backup.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">mysqldump -A -F --single-transaction --master-data=2 -q -uroot |gzip &gt; /data/mysql_`<span class="built_in">date</span> +%F_%T`.sql.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建任务</span></span><br><span class="line">ansible 10.0.0.8 -m cron -a <span class="string">&#x27;hour=2 minute=30 weekday=1-5 name=&quot;backup mysql&quot; job=/root/mysql_backup.sh&#x27;</span></span><br><span class="line">ansible webservers  -m cron -a <span class="string">&quot;minute=*/5 job=&#x27;/usr/sbin/ntpdate ntp.aliyun.com &amp;&gt;/dev/null&#x27; name=Synctime&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#禁用计划任务</span></span><br><span class="line">ansible webservers  -m cron -a <span class="string">&quot;minute=*/5 job=&#x27;/usr/sbin/ntpdate 172.20.0.1 &amp;&gt;/dev/null&#x27; name=Synctime disabled=yes&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#启用计划任务</span></span><br><span class="line">ansible webservers  -m cron -a <span class="string">&quot;minute=*/5 job=&#x27;/usr/sbin/ntpdate 172.20.0.1 &amp;&gt;/dev/null&#x27; name=Synctime disabled=no&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除任务</span></span><br><span class="line">ansible webservers -m cron -a <span class="string">&quot;name=&#x27;backup mysql&#x27; state=absent&quot;</span></span><br><span class="line">ansible webservers -m cron -a <span class="string">&#x27;state=absent name=Synctime&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-3-Service-模块"><a href="#5-3-Service-模块" class="headerlink" title="5.3 Service 模块"></a>5.3 Service 模块</h2><p>此模块和sytemd功能相似,选项很多相同</p>
<p>功能：管理服务</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">name 				<span class="comment">#服务名称</span></span><br><span class="line">state 			<span class="comment">#服务状态</span></span><br><span class="line">    =started 		<span class="comment">#启动</span></span><br><span class="line">    =stopped 		<span class="comment">#停止</span></span><br><span class="line">    =restarted  <span class="comment">#重启</span></span><br><span class="line">    =reloaded   <span class="comment">#重载</span></span><br><span class="line">enabled 			<span class="comment">#开启自启动</span></span><br><span class="line">daemon_reload <span class="comment">#加载新的配置文件,适用于systemd模块</span></span><br><span class="line">args=val 			<span class="comment">#参数</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#启动服务</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m service -a <span class="string">&quot;name=nginx state=started&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重载</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m service -a <span class="string">&#x27;name=nginx state=reloaded&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#加开机启动</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m service -a <span class="string">&#x27;name=nginx enabled=yes&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重启动指定网卡服务</span></span><br><span class="line">ansible all -m service -a <span class="string">&#x27;name=network state=absent args=eth0&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-4-SELinux-模块"><a href="#5-4-SELinux-模块" class="headerlink" title="5.4 SELinux 模块"></a>5.4 SELinux 模块</h2><p>功能: 该模块管理 SELinux 策略</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">policy   				<span class="comment">#指定SELINUXTYPE=targeted</span></span><br><span class="line">state    				<span class="comment">#指定SELINUX=disabled</span></span><br><span class="line">configfile=/path/file 	<span class="comment">#selinux 配置文件路径，默认/etc/selinux/config</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# ansible 10.0.0.150 -m selinux -a <span class="string">&#x27;state=enforcing policy=targeted&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#python3.9没有相关模块，需要修改远程主机的python路径</span></span><br><span class="line">[root@rocky86 ~]# ansible 10.0.0.150 -m selinux -a <span class="string">&#x27;state=disabled policy=targeted&#x27;</span></span><br><span class="line">An exception occurred during task execution. To see the full traceback, use -vvv. The error was: ModuleNotFoundError: No module named <span class="string">&#x27;selinux&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#用 -e 选项指定远程主机的python</span></span><br><span class="line">[root@rocky86 ~]# ansible 10.0.0.150 -m selinux -e <span class="string">&#x27;ansible_python_interpreter=/usr/bin/python3.6&#x27;</span> -a <span class="string">&#x27;state=enforcing policy=targeted&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#或者修改配置</span></span><br><span class="line">[root@ubuntu ~]# vim /etc/ansible/hosts</span><br><span class="line"><span class="comment">##10.0.0.150 ansible_python_interpreter=/usr/bin/python3.9 ansible_ssh_password=123456</span></span><br><span class="line">10.0.0.150 ansible_python_interpreter=/usr/bin/python3.6 	ansible_ssh_password=123456</span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible ~]#ansible 10.0.0.8 -m selinux -a <span class="string">&#x27;state=disabled&#x27;</span></span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#grep -v <span class="string">&#x27;#&#x27;</span> /etc/selinux/config</span><br><span class="line">SELINUX=disabled</span><br><span class="line">SELINUXTYPE=targeted</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#getenforce</span><br><span class="line">Permissive</span><br></pre></td></tr></table></figure>

<h2 id="5-5-Reboot-模块"><a href="#5-5-Reboot-模块" class="headerlink" title="5.5 Reboot 模块"></a>5.5 Reboot 模块</h2><p>功能: 重启</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msg=str 						<span class="comment">#广播重启提示消息，默认为空</span></span><br><span class="line">test_command=str 		<span class="comment">#重启后执行验证命令，即执行测试成功与否的命令，默认 whoami</span></span><br><span class="line">reboot_timeout=600 	<span class="comment">#超时时长，即重启后延迟时间再执行测试成功与否的命令，默认600S</span></span><br><span class="line">pre_reboot_delay=0 	<span class="comment">#重启前等待时长，即重启前延迟时间的秒数，如果小于60S，此字段会被置0，也就是无效</span></span><br><span class="line">post_reboot_delay=0 <span class="comment">#重启后等待一个时长后再验证是否重启完成</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#远程主机在重启过程中此进程会一直等待，直到超时</span></span><br><span class="line">[root@ubuntu ~]# ansible <span class="string">&quot;10.0.0.150 10.0.0.206&quot;</span> -m reboot -a <span class="string">&#x27;pre_reboot_delay=65 msg=&quot;this is test msg&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#远程主机上收到广播消息</span></span><br><span class="line">this is <span class="built_in">test</span> msg</span><br><span class="line">The system is going down <span class="keyword">for</span> reboot at Sun 2023-02-05 13:48:10 CST!</span><br></pre></td></tr></table></figure>

<h2 id="5-6-Mount-模块"><a href="#5-6-Mount-模块" class="headerlink" title="5.6 Mount 模块"></a>5.6 Mount 模块</h2><p>功能: 挂载和卸载文件系统</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">src   						<span class="comment">#源设备路径，或网络地址</span></span><br><span class="line">path  						<span class="comment">#挂载至本地哪个路径下</span></span><br><span class="line">fstype 						<span class="comment">#设备类型； nfs</span></span><br><span class="line">opts  						<span class="comment">#挂载的选项</span></span><br><span class="line">fstab=/path/file 	<span class="comment">#指定挂载配置文件路径，默认 /etc/fstab</span></span><br><span class="line">state  						<span class="comment">#挂载还是卸载</span></span><br><span class="line"> =present 				<span class="comment">#永久挂载，但没有立即生效</span></span><br><span class="line"> =absent 					<span class="comment">#卸载临时挂载,并删除永久挂载</span></span><br><span class="line"> =mounted 				<span class="comment">#永久和临时挂载，立即生效，挂载点不存在会自动创建</span></span><br><span class="line"> =unmounted 			<span class="comment">#临时卸载</span></span><br><span class="line"> =remounted				<span class="comment">#重新挂载，但不会改变配置文件</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#挂载光盘,永久挂载，并立即生效</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m mount -a <span class="string">&#x27;src=/dev/sr0 path=/mnt/ state=mounted fstype=iso9660&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#取消挂载，临时生效</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m mount -a <span class="string">&#x27;src=/dev/sr0 path=/mnt/ state=unmounted&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#取消挂载，永久生效</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m mount -a <span class="string">&#x27;src=/dev/sr0 path=/mnt/ state=absent&#x27;</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改fstab文件永久挂载,但不立即生效</span></span><br><span class="line">mount webservers -m mount -a <span class="string">&#x27;src=&quot;UUID=b3e48f45-f933-4c8e-a700-22a159ec9077&quot; path=/home fstype=xfs opts=noatime state=present&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#临时取消挂载</span></span><br><span class="line">mount webservers -m mount -a <span class="string">&#x27;path=/home fstype=xfs opts=noatime state=unmounted&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#永久挂载,并立即生效</span></span><br><span class="line">ansible webservers -m mount -a <span class="string">&#x27;src=10.0.0.8:/data/wordpress path=/var/www/html/wp-content/uploads opts=&quot;_netdev&quot; state=mounted&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#永久卸载,并立即生效</span></span><br><span class="line">ansible webservers -m mount -a <span class="string">&#x27;src=10.0.0.8:/data/wordpress path=/var/www/html/wp-content/uploads fstype=nfs state=absent&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-7-sysctl-模块"><a href="#5-7-sysctl-模块" class="headerlink" title="5.7 sysctl 模块"></a>5.7 sysctl 模块</h2><p>功能: 修改内核参数</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">name=str 								<span class="comment">#参数名称</span></span><br><span class="line">value=str 							<span class="comment">#参数值</span></span><br><span class="line">reload=<span class="built_in">yes</span>|no 					<span class="comment">#默认yes，调用 /sbin/sysctl -p 生效</span></span><br><span class="line">state=present|absent 		<span class="comment">#是否保存在sysctl.conf文件中，默认present</span></span><br><span class="line">sysctl_file=/path/file 	<span class="comment">#指定保存文件路径，默认 /etc/sysctl.conf</span></span><br><span class="line">sysctl_set=<span class="built_in">yes</span>|no 			<span class="comment">#是否使用systctl -w 校验，默认no</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改内核参数，并写文件</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m sysctl -a <span class="string">&#x27;name=net.ipv4.ip_forward value=1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在远程主机上查看</span></span><br><span class="line">[root@ubuntu ~]# sysctl -a | grep <span class="string">&quot;ip_forward =&quot;</span></span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line"></span><br><span class="line"><span class="comment">#从文件中删除</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m sysctl -a <span class="string">&#x27;name=net.ipv4.ip_forward state=absent&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#远程主机的文件中没有了</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> /etc/sysctl.conf | grep ip_forward</span><br><span class="line"></span><br><span class="line"><span class="comment">#但值没有刷新，从文件中同步，文件没有此项了，所以此项不会改变</span></span><br><span class="line">[root@ubuntu ~]# sysctl -a | grep <span class="string">&quot;ip_forward =&quot;</span></span><br><span class="line">net.ipv4.ip_forward = 1</span><br></pre></td></tr></table></figure>

<p>范例: 内核参数优化</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Change</span> <span class="string">Port</span> <span class="string">Range</span></span><br><span class="line">  <span class="attr">sysctl:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">net.ipv4.ip_local_port_range</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&#x27;1024 65000&#x27;</span></span><br><span class="line">    <span class="attr">sysctl_set:</span> <span class="literal">yes</span></span><br><span class="line">    </span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Enabled</span> <span class="string">Forward</span></span><br><span class="line">  <span class="attr">sysctl:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">net.ipv4.ip_forward</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="attr">sysctl_set:</span> <span class="literal">yes</span></span><br><span class="line"> </span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Enabled</span> <span class="string">tcp_reuse</span></span><br><span class="line">  <span class="attr">sysctl:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">net.ipv4.tcp_tw_reuse</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="attr">sysctl_set:</span> <span class="literal">yes</span></span><br><span class="line">    </span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Chanage</span> <span class="string">tcp</span> <span class="string">tw_buckets</span></span><br><span class="line">  <span class="attr">sysctl:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">net.ipv4.tcp_max_tw_buckets</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&#x27;5000&#x27;</span></span><br><span class="line">    <span class="attr">sysctl_set:</span> <span class="literal">yes</span></span><br><span class="line">    </span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Chanage</span> <span class="string">tcp_syncookies</span></span><br><span class="line">  <span class="attr">sysctl:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">net.ipv4.tcp_syncookies</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="attr">sysctl_set:</span> <span class="literal">yes</span></span><br><span class="line">    </span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Chanage</span> <span class="string">tcp</span> <span class="string">max_syn_backlog</span></span><br><span class="line">  <span class="attr">sysctl:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">net.ipv4.tcp_max_syn_backlog</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&#x27;8192&#x27;</span></span><br><span class="line">    <span class="attr">sysctl_set:</span> <span class="literal">yes</span></span><br><span class="line">    </span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Chanage</span> <span class="string">tcp</span> <span class="string">Established</span> <span class="string">Maxconn</span></span><br><span class="line">  <span class="attr">sysctl:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">net.core.somaxconn</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&#x27;32768&#x27;</span></span><br><span class="line">    <span class="attr">sysctl_set:</span> <span class="literal">yes</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    </span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Chanage</span> <span class="string">tcp_syn_retries</span></span><br><span class="line">  <span class="attr">sysctl:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">net.ipv4.tcp_syn_retries</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line">    <span class="attr">sysctl_set:</span> <span class="literal">yes</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    </span><br><span class="line"> <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Chanage</span> <span class="string">net.ipv4.tcp_synack_retries</span></span><br><span class="line">   <span class="attr">sysctl:</span></span><br><span class="line">     <span class="attr">name:</span> <span class="string">net.ipv4.tcp_synack_retries</span></span><br><span class="line">     <span class="attr">value:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line">     <span class="attr">sysctl_set:</span> <span class="literal">yes</span></span><br><span class="line">     <span class="attr">state:</span> <span class="string">present</span></span><br></pre></td></tr></table></figure>

<h2 id="5-8-pam-limits模块"><a href="#5-8-pam-limits模块" class="headerlink" title="5.8 pam_limits模块"></a>5.8 pam_limits模块</h2><p>功能: 管理资源限制</p>
<p>常用选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">domain=username|@groupname|UID|GID 	<span class="comment">#具体对象</span></span><br><span class="line">limit_item=core|data|fsize|memlock|nofile|rss|stack|cpu|<span class="built_in">nproc</span>|as|maxlogins|maxsyslogins|priority|locks|sigpending|msgqueue|<span class="built_in">nice</span>|rtprio|<span class="built_in">chroot</span> 	<span class="comment">#修改内容</span></span><br><span class="line">limit_type=hard|soft|- 	<span class="comment">#限定类型</span></span><br><span class="line">value=str 							<span class="comment">#具体值</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m pam_limits -a <span class="string">&#x27;domain=tom limit_type=- limit_item=nproc value=200&#x27;</span></span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> /etc/security/limits.conf | grep tom</span><br><span class="line">tom - <span class="built_in">nproc</span> 200</span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Change</span> <span class="string">Limit</span> <span class="string">/etc/security/limit.conf</span></span><br><span class="line">  <span class="attr">pam_limits:</span></span><br><span class="line">    <span class="attr">domain:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">    <span class="attr">limit_type:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.limit_type &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">limit_item:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.limit_item &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.value &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">limit_type:</span> <span class="string">&#x27;soft&#x27;</span>, <span class="attr">limit_item:</span> <span class="string">&#x27;nofile&#x27;</span>,<span class="attr">value:</span> <span class="string">&#x27;100000&#x27;</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">limit_type:</span> <span class="string">&#x27;hard&#x27;</span>, <span class="attr">limit_item:</span> <span class="string">&#x27;nofile&#x27;</span>,<span class="attr">value:</span> <span class="string">&#x27;10000&#x27;</span> &#125;</span><br></pre></td></tr></table></figure>

<h1 id="6-Setup-模块"><a href="#6-Setup-模块" class="headerlink" title="6 Setup 模块"></a>6 Setup 模块</h1><p>功能： setup 模块来收集主机的系统信息，这些 facts 信息可以直接以变量的形式使用，但是如果主机较多，会影响执行速度</p>
<p>可以使用 <code>gather_facts: no</code> 来禁止 Ansible 收集 facts 信息</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filter=filed1,filed2  <span class="comment">#指定过滤条件，只显示指定字段，可以用通配符，可以写多个，可以用 !取反</span></span><br><span class="line">gather_timeout=10     <span class="comment">#超时时长，默认10S</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#显示本机所有信息</span></span><br><span class="line">[root@ubuntu ~]# ansible 127.0.0.1 -m setup</span><br><span class="line"></span><br><span class="line"><span class="comment">#收集所有字段</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m setup</span><br><span class="line"></span><br><span class="line"><span class="comment">#只显示主机名</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m setup -a <span class="string">&#x27;filter=ansible_hostname&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#显示主机名和IPV4</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m setup -a</span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ansible all -m setup</span><br><span class="line">ansible all -m setup -a <span class="string">&quot;filter=ansible_nodename&quot;</span></span><br><span class="line">ansible all -m setup -a <span class="string">&quot;filter=ansible_hostname&quot;</span></span><br><span class="line">ansible all -m setup -a <span class="string">&quot;filter=ansible_domain&quot;</span></span><br><span class="line">ansible all -m setup -a <span class="string">&quot;filter=ansible_memtotal_mb&quot;</span>				<span class="comment"># 系统的总内存大小</span></span><br><span class="line">ansible all -m setup -a <span class="string">&quot;filter=ansible_memory_mb&quot;</span>					<span class="comment"># 包含了关于内存的多种信息，如总内存、可用内存等</span></span><br><span class="line">ansible all -m setup -a <span class="string">&quot;filter=ansible_memfree_mb&quot;</span>					<span class="comment"># 系统当前的空闲内存大小</span></span><br><span class="line">ansible all -m setup -a <span class="string">&quot;filter=ansible_os_family&quot;</span>					<span class="comment"># 操作系统家族</span></span><br><span class="line">ansible all -m setup -a <span class="string">&quot;filter=ansible_distribution&quot;</span>				<span class="comment"># 具体的 Linux 发行版名称</span></span><br><span class="line">ansible all -m setup -a <span class="string">&quot;filter=ansible_distribution_major_version&quot;</span>	<span class="comment"># 发行版的主要版本号</span></span><br><span class="line">ansible all -m setup -a <span class="string">&quot;filter=ansible_distribution_version&quot;</span>		<span class="comment"># 完整的发行版版本号</span></span><br><span class="line">ansible all -m setup -a <span class="string">&quot;filter=ansible_processor_vcpus&quot;</span>			<span class="comment"># 处理器的虚拟 CPU 数量</span></span><br><span class="line">ansible all -m setup -a <span class="string">&quot;filter=ansible_all_ipv4_addresses&quot;</span>			<span class="comment"># 主机上的所有 IPv4 地址</span></span><br><span class="line">ansible all -m setup -a <span class="string">&quot;filter=ansible_architecture&quot;</span>				<span class="comment"># 主机的架构类型</span></span><br><span class="line">ansible all -m setup -a <span class="string">&quot;filter=ansible_uptime_seconds&quot;</span>				<span class="comment"># 自上次启动以来的系统运行时间	</span></span><br><span class="line">ansible all -m setup -a <span class="string">&quot;filter=ansible_processor*&quot;</span>					<span class="comment"># 匹配所有与处理器相关的变量</span></span><br><span class="line">ansible all -m setup -a <span class="string">&#x27;filter=ansible_env&#x27;</span></span><br></pre></td></tr></table></figure>

<p>范例：取IP地址</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#取所有IP</span></span><br><span class="line">ansible 10.0.0.101 -m setup -a <span class="string">&#x27;filter=ansible_all_ipv4_addresses&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#取默认IP</span></span><br><span class="line">ansible all -m setup -a <span class="string">&#x27;filter=&quot;ansible_default_ipv4&quot;&#x27;</span></span><br></pre></td></tr></table></figure>

<h1 id="7-debug-模块"><a href="#7-debug-模块" class="headerlink" title="7 debug 模块"></a>7 debug 模块</h1><p>功能: 此模块可以用于输出信息,并且通过 msg 定制输出的信息内容,功能类似于echo命令</p>
<p>注意: msg后面的变量有时需要加 “ “ 引起来</p>
<p>常见选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msg=str 			<span class="comment">#输出消息内容，默认 Hello world!</span></span><br><span class="line">var    				<span class="comment">#指定变量名,和msg互斥</span></span><br><span class="line">verbosity=0|1|2|3 	<span class="comment">#指定调试级别，verbosity=2 则表示仅在 -vv|-vvv|-vvvv 的级别下显示</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#默认消息</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m debug</span><br><span class="line">10.0.0.206 | SUCCESS =&gt; &#123;</span><br><span class="line">  	<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Hello world!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#设定了运行级别，当前跳过</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m debug -a <span class="string">&#x27;msg=&quot;this is test msg&quot; verbosity=2&#x27;</span></span><br><span class="line">10.0.0.206 | SKIPPED</span><br><span class="line"></span><br><span class="line"><span class="comment">#可以正常显示</span></span><br><span class="line">[root@ubuntu ~]# ansible 10.0.0.206 -m debug -a <span class="string">&#x27;msg=&quot;this is test msg&quot; verbosity=2&#x27;</span> -vv</span><br><span class="line">10.0.0.206 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;this is test msg&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>范例: 利用debug 输出shell命令的执行结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible ansible]#<span class="built_in">cat</span> debug.yml</span><br><span class="line">- hosts: webservers</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">    - name: <span class="built_in">echo</span> hello</span><br><span class="line">      shell:</span><br><span class="line">        cmd: <span class="built_in">echo</span> hello</span><br><span class="line">        register: result</span><br><span class="line">    - name: Display all variables/facts known <span class="keyword">for</span> a host</span><br><span class="line">      debug:</span><br><span class="line">        msg: <span class="string">&quot;&#123;&#123; result.stdout &#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure>

<p>范例: 利用debug 模块输出变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]#<span class="built_in">cat</span> debug.yaml</span><br><span class="line">---</span><br><span class="line">- hosts: webservers</span><br><span class="line">  tasks:</span><br><span class="line">    - name: output variables</span><br><span class="line">        debug:</span><br><span class="line">          msg: Host <span class="string">&quot;&#123;&#123; ansible_nodename &#125;&#125;&quot;</span> Ip  <span class="string">&quot;&#123;&#123; ansible_default_ipv4.address &#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#ansible-playbook debug.yaml</span><br><span class="line">ok: [10.0.0.7] =&gt; &#123;</span><br><span class="line">  	<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Host \&quot;centos7.wangxiaochun.com\&quot; Ip \&quot;10.0.0.7\&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [10.0.0.8] =&gt; &#123;</span><br><span class="line">  	<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Host \&quot;centos8.wangxiaochun.com\&quot; Ip \&quot;10.0.0.8\&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>范例: 显示字符串特定字符</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat debug.yml</span></span><br><span class="line">- hosts: all</span><br><span class="line">  gather_facts: no</span><br><span class="line">  vars:</span><br><span class="line">    a: <span class="string">&quot;12345&quot;</span></span><br><span class="line">  tasks:</span><br><span class="line">    - debug:</span><br><span class="line">      msg:</span><br><span class="line">        - <span class="string">&quot;&#123;&#123;a[0]&#125;&#125;&quot;</span></span><br><span class="line">        - <span class="string">&quot;&#123;&#123;a[1]&#125;&#125;&quot;</span></span><br><span class="line">        - <span class="string">&quot;&#123;&#123;a[2]&#125;&#125;&quot;</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">#定义了一个字符串变量a，如果想要获取a字符串的第3个字符，则可以使用”a[2]”获取，索引从0开始，执行上例playbook，debug的输出信息如下：</span></span><br><span class="line">TASK [debug] *************************</span><br><span class="line">ok: [test1] =&gt; &#123;</span><br><span class="line">  	<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line">  	<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;2&quot;</span></span><br><span class="line">  	<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;3&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible ansible]#<span class="built_in">cat</span> debug.yml</span><br><span class="line">- hosts: webservers</span><br><span class="line">  remote_user: root</span><br><span class="line">  </span><br><span class="line">  tasks:</span><br><span class="line">  - name: Display all variables/facts known <span class="keyword">for</span> a host</span><br><span class="line">    debug:</span><br><span class="line">      var: ansible_nodename</span><br><span class="line">      </span><br><span class="line">[root@ansible ansible]#ansible-playbook debug.yml</span><br><span class="line">......</span><br><span class="line">TASK [Display all variables/facts known <span class="keyword">for</span> a host]</span><br><span class="line">********************************************************************************</span><br><span class="line">ok: [10.0.0.8] =&gt; &#123;</span><br><span class="line">  	<span class="string">&quot;ansible_nodename&quot;</span>: <span class="string">&quot;rocky8.magedu.org&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ok: [10.0.0.7] =&gt; &#123;</span><br><span class="line">  	<span class="string">&quot;ansible_nodename&quot;</span>: <span class="string">&quot;centos7.magedu.org&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="8-其他模块"><a href="#8-其他模块" class="headerlink" title="8 其他模块"></a>8 其他模块</h1><p>除了上述模块之外，ansible 还提供了很多其它的模块，在我们需要使用时，可以再进行查询</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ansible-doc -l | grep <span class="string">&quot;模块关键字&quot;</span></span><br><span class="line">ansible-doc 模块名</span><br></pre></td></tr></table></figure>

<p>ansible 还提供了很多针对各种应用的模块,比如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nginx_status_info</span><br><span class="line">nginx_status_facts</span><br><span class="line">mysql_db  			<span class="comment">#需要安装MySQL-python包</span></span><br><span class="line">mysql_user 			<span class="comment">#需要安装MySQL-python包</span></span><br><span class="line">redis</span><br><span class="line">mongodb</span><br><span class="line">postgresql</span><br><span class="line">haproxy</span><br><span class="line">git</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://AquaPluto.github.io">Aquarius</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://aquapluto.github.io/CICD/ansible/module/">https://aquapluto.github.io/CICD/ansible/module/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://AquaPluto.github.io" target="_blank">代码推演录</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Ansible/">Ansible</a></div><div class="post-share"><div class="social-share" data-image="/img/paper4.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://unpkg.com/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://unpkg.com/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/CICD/ansible/playbook/" title="PlayBook"><img class="cover" src="/img/paper2.jpg" onerror="onerror=null;src='/img/error-page.png'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">PlayBook</div></div><div class="info-2"><div class="info-item-1">1 YAML语言介绍YAML官方网...</div></div></div></a><a class="pagination-related" href="/CICD/ansible/command/" title="相关命令"><img class="cover" src="/img/paper6.png" onerror="onerror=null;src='/img/error-page.png'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">相关命令</div></div><div class="info-2"><div class="info-item-1">1 Ansible相关工具   命...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/CICD/ansible/introduce/" title="架构概述"><img class="cover" src="/img/paper2.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-13</div><div class="info-item-2">架构概述</div></div><div class="info-2"><div class="info-item-1">1 Ansible介绍Ansibl...</div></div></div></a><a class="pagination-related" href="/CICD/ansible/deploy/" title="部署与配置"><img class="cover" src="/img/paper1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-13</div><div class="info-item-2">部署与配置</div></div><div class="info-2"><div class="info-item-1">1 Ansible安装ansibl...</div></div></div></a><a class="pagination-related" href="/CICD/ansible/command/" title="相关命令"><img class="cover" src="/img/paper6.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-13</div><div class="info-item-2">相关命令</div></div><div class="info-2"><div class="info-item-1">1 Ansible相关工具   命...</div></div></div></a><a class="pagination-related" href="/CICD/ansible/role/" title="Role角色"><img class="cover" src="/img/paper3.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-13</div><div class="info-item-2">Role角色</div></div><div class="info-2"><div class="info-item-1">Ansible Roles目录编排...</div></div></div></a><a class="pagination-related" href="/CICD/ansible/playbook/" title="PlayBook"><img class="cover" src="/img/paper2.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-13</div><div class="info-item-2">PlayBook</div></div><div class="info-2"><div class="info-item-1">1 YAML语言介绍YAML官方网...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avator.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Aquarius</div><div class="author-info-description">分享运维开发相关技术</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">138</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" href="https://github.com/AquaPluto"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/AquaPluto" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://blog.csdn.net/m0_75233142" target="_blank" title="CSDN"><i class="fa-solid fa-code" style="color: #8a2be2;"></i></a><a class="social-icon" href="mailto:wujunlinq@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content"><p>持续更新文章中，有问题请添加wx</p>
<div>
  <img src="/img/wx.jpg" alt="wx" style="width: 100px">
</div>
</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%9B%B8%E5%85%B3"><span class="toc-text">1 命令执行相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-Command-%E6%A8%A1%E5%9D%97"><span class="toc-text">1.1 Command 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-Shell-%E6%A8%A1%E5%9D%97"><span class="toc-text">1.2 Shell 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-Script-%E6%A8%A1%E5%9D%97"><span class="toc-text">1.3 Script 模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E7%9B%B8%E5%85%B3"><span class="toc-text">2 文件管理相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-Copy-%E6%A8%A1%E5%9D%97"><span class="toc-text">2.1 Copy 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-Get-url-%E6%A8%A1%E5%9D%97"><span class="toc-text">2.2 Get_url 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-Fetch-%E6%A8%A1%E5%9D%97"><span class="toc-text">2.3 Fetch 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-File-%E6%A8%A1%E5%9D%97"><span class="toc-text">2.4 File 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-Stat-%E6%A8%A1%E5%9D%97"><span class="toc-text">2.5 Stat 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-Unarchive-%E6%A8%A1%E5%9D%97"><span class="toc-text">2.6 Unarchive 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-7-Archive-%E6%A8%A1%E5%9D%97"><span class="toc-text">2.7 Archive 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-8-Lineinfile-%E6%A8%A1%E5%9D%97"><span class="toc-text">2.8 Lineinfile 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-9-Replace-%E6%A8%A1%E5%9D%97"><span class="toc-text">2.9 Replace 模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E7%94%A8%E6%88%B7%E5%92%8C%E7%BB%84%E7%9B%B8%E5%85%B3"><span class="toc-text">3 用户和组相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-User-%E6%A8%A1%E5%9D%97"><span class="toc-text">3.1 User 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-Group-%E6%A8%A1%E5%9D%97"><span class="toc-text">3.2 Group 模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86%E7%9B%B8%E5%85%B3"><span class="toc-text">4 仓库管理相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-yum-%E6%A8%A1%E5%9D%97"><span class="toc-text">4.1 yum 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-yum-repository-%E6%A8%A1%E5%9D%97"><span class="toc-text">4.2 yum_repository 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-apt-%E6%A8%A1%E5%9D%97"><span class="toc-text">4.3 apt 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-apt-repository-%E6%A8%A1%E5%9D%97"><span class="toc-text">4.4 apt_repository 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-apt-key-%E6%A8%A1%E5%9D%97"><span class="toc-text">4.5 apt_key 模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE%E7%9B%B8%E5%85%B3"><span class="toc-text">5 系统配置相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-Hostname-%E6%A8%A1%E5%9D%97"><span class="toc-text">5.1 Hostname 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-Cron-%E6%A8%A1%E5%9D%97"><span class="toc-text">5.2 Cron 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-Service-%E6%A8%A1%E5%9D%97"><span class="toc-text">5.3 Service 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-SELinux-%E6%A8%A1%E5%9D%97"><span class="toc-text">5.4 SELinux 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-5-Reboot-%E6%A8%A1%E5%9D%97"><span class="toc-text">5.5 Reboot 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-6-Mount-%E6%A8%A1%E5%9D%97"><span class="toc-text">5.6 Mount 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-7-sysctl-%E6%A8%A1%E5%9D%97"><span class="toc-text">5.7 sysctl 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-8-pam-limits%E6%A8%A1%E5%9D%97"><span class="toc-text">5.8 pam_limits模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-Setup-%E6%A8%A1%E5%9D%97"><span class="toc-text">6 Setup 模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-debug-%E6%A8%A1%E5%9D%97"><span class="toc-text">7 debug 模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E5%85%B6%E4%BB%96%E6%A8%A1%E5%9D%97"><span class="toc-text">8 其他模块</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/role/" title="Role角色"><img src="/img/paper3.png" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="Role角色"/></a><div class="content"><a class="title" href="/CICD/ansible/role/" title="Role角色">Role角色</a><time datetime="2025-09-13T10:07:53.000Z" title="发表于 2025-09-13 18:07">2025-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/playbook/" title="PlayBook"><img src="/img/paper2.jpg" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="PlayBook"/></a><div class="content"><a class="title" href="/CICD/ansible/playbook/" title="PlayBook">PlayBook</a><time datetime="2025-09-13T10:07:48.000Z" title="发表于 2025-09-13 18:07">2025-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/module/" title="常用模块"><img src="/img/paper4.png" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="常用模块"/></a><div class="content"><a class="title" href="/CICD/ansible/module/" title="常用模块">常用模块</a><time datetime="2025-09-13T10:07:42.000Z" title="发表于 2025-09-13 18:07">2025-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/command/" title="相关命令"><img src="/img/paper6.png" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="相关命令"/></a><div class="content"><a class="title" href="/CICD/ansible/command/" title="相关命令">相关命令</a><time datetime="2025-09-13T10:07:38.000Z" title="发表于 2025-09-13 18:07">2025-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/deploy/" title="部署与配置"><img src="/img/paper1.jpg" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="部署与配置"/></a><div class="content"><a class="title" href="/CICD/ansible/deploy/" title="部署与配置">部署与配置</a><time datetime="2025-09-13T10:07:29.000Z" title="发表于 2025-09-13 18:07">2025-09-13</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Aquarius</span></div><div class="footer_custom_text"><style>
div#runtime {
  font-size: 13px;
  font-weight: bold;
}

div#ghbdages_list {
  height: 1.5rem;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 10px
}

.github-badge {
  display: flex;
  align-items: center;
  margin-inline: 6px;
}
</style>
<div id="runtime"></div>
<div id="ghbdages"></div>
<script>
  function createtime() {
    const now = new Date();
    const grt = new Date("08/01/2025 00:00:00"); // 网站诞生时间

    // 计算天、小时、分钟和秒
    const days = Math.floor((now - grt) / (1000 * 60 * 60 * 24));
    const hours = Math.floor(((now - grt) / (1000 * 60 * 60)) % 24)
      .toString()
      .padStart(2, "0");
    const minutes = Math.floor(((now - grt) / (1000 * 60)) % 60)
      .toString()
      .padStart(2, "0");
    const seconds = Math.floor(((now - grt) / 1000) % 60)
      .toString()
      .padStart(2, "0");

    // HTML 输出
    const currentTimeHtml = `
          <div>
              本站已运行 ${days} 天 ${hours} 小时 ${minutes} 分 ${seconds} 秒 
          </div>`;

    const runtime = document.getElementById("runtime");
    if (runtime) runtime.innerHTML = currentTimeHtml;
  }

  // 设置每秒调用函数
  setInterval(createtime, 1000);

  function renderBadge() {
    const currentTimeHtml = `
      <div id="ghbdages_list">
          <a class="github-badge" target="_blank" href="https://hexo.io/" title="hexo:7.3.0">
              <img src="https://img.shields.io/badge/Frame-Hexo-blue?logo=hexo" alt="Static Badge">
          </a>
          <a class="github-badge" target="_blank" href="https://github.com/" title="github">
              <img src="https://img.shields.io/badge/Code-GitHub-181717?logo=GitHub&color=%23FF7102" alt="Static Badge">
          </a>
          <a class="github-badge" target="_blank" href="https://vercel.com/" title="vercel">
              <img src="https://img.shields.io/badge/Host-Vercel-%23F0D722?logo=Vercel" alt="Static Badge">
          </a>
          <a class="github-badge" target="_blank" href="https://analytics.sysio.ai/" title="umami">
              <img src="https://img.shields.io/badge/Analytics-Umami-%237FB100?logo=umami&logoColor=%237FB100" alt="Static Badge">
          </a>
      </div>`;

    const ghbdages = document.getElementById("ghbdages");
    if (ghbdages) {
      ghbdages.innerHTML = currentTimeHtml;
    }
  }

  window.onload = renderBadge;
</script>
</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://unpkg.com/@fancyapps/ui/dist/fancybox/fancybox.umd.js"></script><script src="https://unpkg.com/instant.page/instantpage.js" type="module"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = 'https://unpkg.com/mathjax/es5/tex-mml-chtml.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'forest'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://unpkg.com/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script src="https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fishes.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://unpkg.com/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章..." type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>