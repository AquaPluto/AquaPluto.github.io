<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>数据的实时同步 | 代码推演录</title><meta name="author" content="Aquarius"><meta name="copyright" content="Aquarius"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="1 数据的实时同步方式在生产环境，要将数据或文件进行实时同步，保证数据更新后其它节点能立即获得最新的数据，会需要两台主机的特定目录实现实时同步。比如，将NFS共享目录的数据文件，自动实时同步到备份服务器特定目录中 数据同步的两种方式  PULL：拉，使用定时任务的方式配合同步命令或脚本等，从指定服务器上将数据同步到本地，一般是周期性定时同步  PUSH：推，如果当前机器上的数据或文件发生更新了，立">
<meta property="og:type" content="article">
<meta property="og:title" content="数据的实时同步">
<meta property="og:url" content="https://aquapluto.github.io/Linux/service-manage/data-synchronization/">
<meta property="og:site_name" content="代码推演录">
<meta property="og:description" content="1 数据的实时同步方式在生产环境，要将数据或文件进行实时同步，保证数据更新后其它节点能立即获得最新的数据，会需要两台主机的特定目录实现实时同步。比如，将NFS共享目录的数据文件，自动实时同步到备份服务器特定目录中 数据同步的两种方式  PULL：拉，使用定时任务的方式配合同步命令或脚本等，从指定服务器上将数据同步到本地，一般是周期性定时同步  PUSH：推，如果当前机器上的数据或文件发生更新了，立">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://aquapluto.github.io/img/paper4.png">
<meta property="article:published_time" content="2025-08-20T08:52:20.000Z">
<meta property="article:modified_time" content="2025-09-09T09:05:05.967Z">
<meta property="article:author" content="Aquarius">
<meta property="article:tag" content="服务管理">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://aquapluto.github.io/img/paper4.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "数据的实时同步",
  "url": "https://aquapluto.github.io/Linux/service-manage/data-synchronization/",
  "image": "https://aquapluto.github.io/img/paper4.png",
  "datePublished": "2025-08-20T08:52:20.000Z",
  "dateModified": "2025-09-09T09:05:05.967Z",
  "author": [
    {
      "@type": "Person",
      "name": "Aquarius",
      "url": "https://AquaPluto.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://aquapluto.github.io/Linux/service-manage/data-synchronization/"><link rel="preconnect" href="//unpkg.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://unpkg.com/@fancyapps/ui/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":true,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://unpkg.com/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '数据的实时同步',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/wave.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(/img/background.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avator.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">138</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="menus_items"><!-- 一级菜单项（非目录）--><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>计算机基础</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>计算机组成原理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/hardware-composition/"><span>计算机硬件组成</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/CPU/"><span>CPU</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/memory/"><span>内存</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/hard-disk/"><span>硬盘</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>操作系统</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/concept/"><span>操作系统的概念</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/processes-threads/"><span>进程与线程</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/IO-model/"><span>IO模型</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Linux</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>linux基础</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/introduce/"><span>linux介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/file-structure-and-IO-redirects/"><span>文件结构与IO重定向</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/file-command/"><span>文件管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/text-command/"><span>文本管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/GSA/"><span>文本处理三剑客</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/user-permission/"><span>用户和权限管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/regular-expression/"><span>正则表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/software-manage/"><span>软件包管理</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>进程管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/command/"><span>进程相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/signal/"><span>信号发送</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/job-parallel/"><span>作业管理与并行运行</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/OOM/"><span>OOM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>磁盘管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/disk-partition/"><span>磁盘分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/file-system/"><span>文件系统</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/swap/"><span>Swap分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/LVM/"><span>逻辑卷管理器LVM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>网络管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/configuration/"><span>网络配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/test-diagnostic/"><span>网络测试诊断工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/bridge/"><span>网桥配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/troubleshoot/"><span>网络问题排查</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/DNS/"><span>域名DNS解析服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/time-synchronization/"><span>时间同步服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/plan-tasks/"><span>计划任务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/log/"><span>日志服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/data-synchronization/"><span>数据的实时同步</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/ssh/"><span>ssh远程连接服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/mail/"><span>邮件服务</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/kernel-manage/"><span>内核和启动管理</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>防火墙</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/introduce/"><span>安全技术和防火墙</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/iptables/"><span>iptables</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/firewalld/"><span>firewalld</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/nft/"><span>nft</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>加密和安全</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/security-mechanisms/"><span>安全机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/OpenSSL/"><span>OpenSSL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/sudo/"><span>sudo实现授权</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/PAM/"><span>PAM认证机制</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>shell编程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/introduce/"><span>shell脚本介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/variable/"><span>变量</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/operations-conditional/"><span>运算和条件测试</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-control/"><span>流程控制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/function/"><span>函数</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/array/"><span>数组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/string/"><span>字符串</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/script-tools/"><span>脚本相关工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-lock/"><span>进程锁</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/queue/"><span>队列实现线程并发控制</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/system-optimization/"><span>系统优化</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>数据库</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>MySQL</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/DataBase/MySQL/SQL/"><span>SQL语句</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Redis</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/DataBase/Redis/deploy/"><span>部署安装</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>中间件</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Nginx</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Nginx/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>HAProxy</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/HAProxy/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Keepalived</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Keepalived/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kafka</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Kafka/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Tomcat</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Tomcat/111/"><span>111</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>日志</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>存储</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Storage/conspect/"><span>存储概论</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Storage/nfs/"><span>NFS</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>容器</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/basics/"><span>容器基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Docker</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/conspect/"><span>Docker概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/image/"><span>镜像管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/container/"><span>容器管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/volume/"><span>数据卷</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/network/"><span>网络管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/compose/"><span>Docker-Compose</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>镜像</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/conspect/"><span>镜像概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/dockerfile/"><span>dockerfile</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/build/"><span>构建镜像</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/harbor/"><span>镜像仓库</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>容器进程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/management/"><span>容器里的进程管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/cpu-cgroup/"><span>cpu cgroup使用</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/cpu-usage/"><span>监控容器真实的cpu使用率</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/memory/"><span>容器内存</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/storage/"><span>容器存储</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/network/"><span>容器网络</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/safe/"><span>容器安全</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/containerd/"><span>Containerd</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>K8s</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kubernetes概论</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/architecture/"><span>Kubernetes架构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/cri/"><span>容器运行时接口CRI</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/list-watch/"><span>List-Watch机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/object/"><span>Kubernetes对象</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/namespace/"><span>Namespace</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/kubectl/"><span>kubectl命令</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>部署安装</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/explanation/"><span>部署说明</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/docker/"><span>基于docker部署k8s-v1.30</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/containerd/"><span>基于containerd部署k8s-v1.30</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/cluster/"><span>集群管理指南</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Pod</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/conspect/"><span>Pod概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/configuration/"><span>Pod的配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/schedule/"><span>Pod的调度</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/eviction/"><span>Pod的驱逐</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>控制器</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/introduce/"><span>控制器介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/deployment/"><span>Deployment</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/statefulset/"><span>StatefulSet</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/daemonset/"><span>DaemonSet</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/job-cronjob/"><span>Job和CronJob</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/HPA/"><span>HPA</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/operator/"><span>Operator</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务发现与负载均衡</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/service/"><span>Service</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/ingress/"><span>Ingress</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/coredns/"><span>CoreDNS</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/localdns/"><span>LocalDNS</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>数据存储持久化</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/csi/"><span>存储接口CSI</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/pv-pvc/"><span>PV和PVC</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/storageclass/"><span>StorageClass</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/configmap-secret/"><span>ConfigMap和Secret</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>认证与鉴权体系</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/conspect/"><span>体系概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/kubeconfig/"><span>kubeconfig</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/user-account/"><span>User Account</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/service-account/"><span>Service Account</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>监控</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/conspect/"><span>监控概论</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Prometheus</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/introduce/"><span>prometheus概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/exporter/"><span>Exporter</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/promql/"><span>PromQL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/query-persist/"><span>查询结果持久化</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/service-discovery/"><span>服务发现</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/indicators-remarked/"><span>指标重新打标</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/pushmanager/"><span>Pushmanager</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/cluster-ha/"><span>集群与高可用</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Alertmanager</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/introduce/"><span>告警功能概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/alarm/"><span>实现告警功能</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/ha/"><span>高可用架构</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/grafana/"><span>Grafana</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/streaming/"><span>基于流处理的可观测性架构</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>CICD</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Ansible</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/introduce/"><span>架构概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/command/"><span>相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/module/"><span>常用模块</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/playbook/"><span>PlayBook</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>SRE</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/SRE/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Python</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>python基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>线性表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>列表</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>元组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字符串</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>哈希表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>封装与解构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>集合</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字典</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>解析式与生成器表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>函数</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>IO操作</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>面向对象编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>并发编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>网络编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>数据库编程</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Django</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/paper4.png);"><nav id="nav"><!-- 左侧博客信息区域--><span id="blog-info"><a class="nav-site-title" href="/"></a><a class="nav-page-title" href="/"><span class="site-name">数据的实时同步</span></a></span><!-- 新增的导航菜单容器（居中布局关键）--><div id="nav-menus-container"><!-- 菜单主体部分--><div id="menus"><!-- 菜单项--><div class="menus_items"><!-- 一级菜单项（非目录）--><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>计算机基础</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>计算机组成原理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/hardware-composition/"><span>计算机硬件组成</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/CPU/"><span>CPU</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/memory/"><span>内存</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/hard-disk/"><span>硬盘</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>操作系统</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/concept/"><span>操作系统的概念</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/processes-threads/"><span>进程与线程</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/IO-model/"><span>IO模型</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Linux</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>linux基础</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/introduce/"><span>linux介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/file-structure-and-IO-redirects/"><span>文件结构与IO重定向</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/file-command/"><span>文件管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/text-command/"><span>文本管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/GSA/"><span>文本处理三剑客</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/user-permission/"><span>用户和权限管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/regular-expression/"><span>正则表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/software-manage/"><span>软件包管理</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>进程管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/command/"><span>进程相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/signal/"><span>信号发送</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/job-parallel/"><span>作业管理与并行运行</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/OOM/"><span>OOM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>磁盘管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/disk-partition/"><span>磁盘分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/file-system/"><span>文件系统</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/swap/"><span>Swap分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/LVM/"><span>逻辑卷管理器LVM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>网络管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/configuration/"><span>网络配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/test-diagnostic/"><span>网络测试诊断工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/bridge/"><span>网桥配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/troubleshoot/"><span>网络问题排查</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/DNS/"><span>域名DNS解析服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/time-synchronization/"><span>时间同步服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/plan-tasks/"><span>计划任务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/log/"><span>日志服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/data-synchronization/"><span>数据的实时同步</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/ssh/"><span>ssh远程连接服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/mail/"><span>邮件服务</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/kernel-manage/"><span>内核和启动管理</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>防火墙</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/introduce/"><span>安全技术和防火墙</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/iptables/"><span>iptables</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/firewalld/"><span>firewalld</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/nft/"><span>nft</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>加密和安全</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/security-mechanisms/"><span>安全机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/OpenSSL/"><span>OpenSSL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/sudo/"><span>sudo实现授权</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/PAM/"><span>PAM认证机制</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>shell编程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/introduce/"><span>shell脚本介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/variable/"><span>变量</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/operations-conditional/"><span>运算和条件测试</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-control/"><span>流程控制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/function/"><span>函数</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/array/"><span>数组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/string/"><span>字符串</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/script-tools/"><span>脚本相关工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-lock/"><span>进程锁</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/queue/"><span>队列实现线程并发控制</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/system-optimization/"><span>系统优化</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>数据库</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>MySQL</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/DataBase/MySQL/SQL/"><span>SQL语句</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Redis</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/DataBase/Redis/deploy/"><span>部署安装</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>中间件</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Nginx</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Nginx/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>HAProxy</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/HAProxy/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Keepalived</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Keepalived/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kafka</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Kafka/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Tomcat</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Tomcat/111/"><span>111</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>日志</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>存储</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Storage/conspect/"><span>存储概论</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Storage/nfs/"><span>NFS</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>容器</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/basics/"><span>容器基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Docker</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/conspect/"><span>Docker概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/image/"><span>镜像管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/container/"><span>容器管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/volume/"><span>数据卷</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/network/"><span>网络管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/compose/"><span>Docker-Compose</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>镜像</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/conspect/"><span>镜像概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/dockerfile/"><span>dockerfile</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/build/"><span>构建镜像</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/harbor/"><span>镜像仓库</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>容器进程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/management/"><span>容器里的进程管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/cpu-cgroup/"><span>cpu cgroup使用</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/cpu-usage/"><span>监控容器真实的cpu使用率</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/memory/"><span>容器内存</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/storage/"><span>容器存储</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/network/"><span>容器网络</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/safe/"><span>容器安全</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/containerd/"><span>Containerd</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>K8s</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kubernetes概论</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/architecture/"><span>Kubernetes架构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/cri/"><span>容器运行时接口CRI</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/list-watch/"><span>List-Watch机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/object/"><span>Kubernetes对象</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/namespace/"><span>Namespace</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/kubectl/"><span>kubectl命令</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>部署安装</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/explanation/"><span>部署说明</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/docker/"><span>基于docker部署k8s-v1.30</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/containerd/"><span>基于containerd部署k8s-v1.30</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/cluster/"><span>集群管理指南</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Pod</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/conspect/"><span>Pod概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/configuration/"><span>Pod的配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/schedule/"><span>Pod的调度</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/eviction/"><span>Pod的驱逐</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>控制器</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/introduce/"><span>控制器介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/deployment/"><span>Deployment</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/statefulset/"><span>StatefulSet</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/daemonset/"><span>DaemonSet</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/job-cronjob/"><span>Job和CronJob</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/HPA/"><span>HPA</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/operator/"><span>Operator</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务发现与负载均衡</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/service/"><span>Service</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/ingress/"><span>Ingress</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/coredns/"><span>CoreDNS</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/localdns/"><span>LocalDNS</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>数据存储持久化</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/csi/"><span>存储接口CSI</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/pv-pvc/"><span>PV和PVC</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/storageclass/"><span>StorageClass</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/configmap-secret/"><span>ConfigMap和Secret</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>认证与鉴权体系</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/conspect/"><span>体系概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/kubeconfig/"><span>kubeconfig</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/user-account/"><span>User Account</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/service-account/"><span>Service Account</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>监控</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/conspect/"><span>监控概论</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Prometheus</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/introduce/"><span>prometheus概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/exporter/"><span>Exporter</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/promql/"><span>PromQL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/query-persist/"><span>查询结果持久化</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/service-discovery/"><span>服务发现</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/indicators-remarked/"><span>指标重新打标</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/pushmanager/"><span>Pushmanager</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/cluster-ha/"><span>集群与高可用</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Alertmanager</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/introduce/"><span>告警功能概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/alarm/"><span>实现告警功能</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/ha/"><span>高可用架构</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/grafana/"><span>Grafana</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/streaming/"><span>基于流处理的可观测性架构</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>CICD</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Ansible</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/introduce/"><span>架构概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/command/"><span>相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/module/"><span>常用模块</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/playbook/"><span>PlayBook</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>SRE</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/SRE/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Python</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>python基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>线性表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>列表</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>元组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字符串</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>哈希表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>封装与解构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>集合</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字典</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>解析式与生成器表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>函数</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>IO操作</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>面向对象编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>并发编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>网络编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>数据库编程</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Django</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div></div></div></div><!-- 右侧功能区域（新增容器）--><div id="nav-right-container"><!-- 搜索按钮（移动到右侧）--><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i></span></div><!-- 移动端汉堡菜单按钮--><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">数据的实时同步</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-08-20T08:52:20.000Z" title="发表于 2025-08-20 16:52">2025-08-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-09T09:05:05.967Z" title="更新于 2025-09-09 17:05">2025-09-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/">Linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>35分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="1-数据的实时同步方式"><a href="#1-数据的实时同步方式" class="headerlink" title="1 数据的实时同步方式"></a>1 数据的实时同步方式</h1><p>在生产环境，要将数据或文件进行实时同步，保证数据更新后其它节点能立即获得最新的数据，会需要两台主机的特定目录实现实时同步。比如，将NFS共享目录的数据文件，自动实时同步到备份服务器特定目录中</p>
<p>数据同步的两种方式</p>
<ul>
<li><p>PULL：拉，使用定时任务的方式配合同步命令或脚本等，从指定服务器上将数据同步到本地，一般是周期性定时同步</p>
</li>
<li><p>PUSH：推，如果当前机器上的数据或文件发生更新了，立即推送到指定的节点上，可以做到实时同步</p>
</li>
</ul>
<p><img src="/Linux/service-manage/data-synchronization/1753757619271-a2dcc534-e361-4df1-b9f9-f504e332b3be-17556838846747.png" alt="null"></p>
<h1 id="2-实现实时同步的方法"><a href="#2-实现实时同步的方法" class="headerlink" title="2 实现实时同步的方法"></a>2 实现实时同步的方法</h1><h2 id="2-1-inotify-rsync"><a href="#2-1-inotify-rsync" class="headerlink" title="2.1 inotify+rsync"></a>2.1 inotify+rsync</h2><p>inotify + rsync 方式实现数据同步，需自行编写脚本组合 inotify 和 rsync 实现</p>
<p>同步原理：利用监控服务（inotify），监控同步数据服务器目录中信息的变化，如果发现目录中数据产生变化，就利用rsync服务推送到备份服务器上</p>
<h3 id="2-1-1-inotify服务"><a href="#2-1-1-inotify服务" class="headerlink" title="2.1.1 inotify服务"></a>2.1.1 inotify服务</h3><p>inotify 是用于通知用户空间程序文件系统变化的服务，它通过异步的文件系统事件监控机制和事件驱动机制，而无须通过诸如cron等的轮询机制来获取事件。linux内核从2.6.13起支持 inotify，通过inotify监控文件系统中添加、删除，修改、移动等各种事件，在监听到文件系统发生变化后，会向相应的应用程序发送事件，立即让用户空间知道。<a href="https://github.com/rvoicilas/inotify-tools">项目地址</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu2204 ~]#grep -i inotify /boot/config-5.15.0-52-generic</span><br><span class="line">CONFIG_INOTIFY_USER=y</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#grep -i inotify /boot/config-4.18.0-80.el8.x86_64</span><br><span class="line">CONFIG_INOTIFY_USER=y</span><br><span class="line"></span><br><span class="line"><span class="comment">#列出下面的参数，也说明服务器内核支持inotify</span></span><br><span class="line">[root@centos8 ~]#<span class="built_in">ls</span> -l /proc/sys/fs/inotify </span><br><span class="line">-rw-r--r-- 1 root root 0 Dec  7 10:10 max_queued_events</span><br><span class="line">-rw-r--r-- 1 root root 0 Dec  7 10:10 max_user_instances</span><br><span class="line">-rw-r--r-- 1 root root 0 Dec  6 05:54 max_user_watches</span><br></pre></td></tr></table></figure>

<p>内核参数说明</p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>作用</th>
<th>默认值</th>
<th>调整场景</th>
</tr>
</thead>
<tbody><tr>
<td><code>max_queued_events</code></td>
<td>限制单个 inotify 实例的事件队列最大长度（未处理事件的缓存上限）</td>
<td>16384</td>
<td>应用需处理高频事件（如监控频繁更新的日志目录），避免队列溢出导致事件丢失</td>
</tr>
<tr>
<td><code>max_user_instances</code></td>
<td>限制单个用户（UID）可创建的 inotify 实例最大数量</td>
<td>128</td>
<td>单个用户需运行多个独立监控程序（如多进程分别监控不同目录），默认数量不足时</td>
</tr>
<tr>
<td><code>max_user_watches</code></td>
<td>限制单个示例可监控的文件 &#x2F; 目录总数量（即 “watch” 的上限）</td>
<td>8192</td>
<td>监控大量文件（如包含数万文件的代码仓库、网站目录），避免 “监控数量超限” 错误</td>
</tr>
</tbody></table>
<p>修改内核参数示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# vim /etc/sysctl.conf</span><br><span class="line">fs.inotify.max_queued_events=66666</span><br><span class="line">fs.inotify.max_user_instances=256</span><br><span class="line">fs.inotify.max_user_watches=100000</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# sysctl -p</span><br><span class="line">fs.inotify.max_queued_events = 66666</span><br><span class="line">fs.inotify.max_user_instances = 256</span><br><span class="line">fs.inotify.max_user_watches = 100000</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#<span class="built_in">cat</span> /proc/sys/fs/inotify/*</span><br><span class="line">66666</span><br><span class="line">256</span><br><span class="line">100000</span><br></pre></td></tr></table></figure>

<h3 id="2-1-2-inotify-tools工具"><a href="#2-1-2-inotify-tools工具" class="headerlink" title="2.1.2 inotify-tools工具"></a>2.1.2 inotify-tools工具</h3><p>由于 inotify 是内核中的功能模块，只能通过调用API接口的形式使用其功能，所以我们可以通过 inotify-tools 来对其进行操作 </p>
<p><a href="https://github.com/rvoicilas/inotify-tools/wiki">inotify-tools参考文档</a></p>
<p>安装inotify-tools：基于epel源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@data-centos8 ~]# yum -y install inotify-tools</span><br><span class="line">[root@data-ubuntu2004]#apt -y install inotify-tools</span><br><span class="line"></span><br><span class="line"><span class="comment">#主要工具</span></span><br><span class="line">/usr/bin/fsnotifywait 	<span class="comment">#fsnotify监控工具，fsnotify 是 inotify 的新版本</span></span><br><span class="line">/usr/bin/fsnotifywatch 	<span class="comment">#fsnotify统计工具</span></span><br><span class="line">/usr/bin/inotifywait 		<span class="comment">#实时监控指定目录的所有事件，在被监控的文件或目录上等待特定事件发生(open,close,write..)</span></span><br><span class="line">/usr/bin/inotifywatch 	<span class="comment">#收集被监控的文件系统使用的统计数据，指文件系统事件发生的次数统计</span></span><br></pre></td></tr></table></figure>

<p>inotifywait 命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">inotifywait [ options ] file1 [ file2 ] [ file3 ] [ ... ]</span><br><span class="line"></span><br><span class="line">-m, --monitor 		 		<span class="comment">#始终保持事件监听</span></span><br><span class="line">-d, --daemon 		 			<span class="comment">#以守护进程方式执行，和-m相似，配合-o使用</span></span><br><span class="line">-r, --recursive 	 		<span class="comment">#递归监控目录数据信息变化</span></span><br><span class="line">-q, --quiet 		 			<span class="comment">#输出少量事件信息</span></span><br><span class="line">--exclude &lt;pattern&gt;  	<span class="comment">#指定排除文件或目录，使用扩展的正则表达式匹配的模式实现</span></span><br><span class="line">--excludei &lt;pattern&gt; 	<span class="comment">#和exclude相似，不区分大小写</span></span><br><span class="line">-o, --outfile &lt;file&gt; 	<span class="comment">#打印事件到文件中，相当于标准正确输出，注意：使用绝对路径</span></span><br><span class="line">-s, --syslogOutput 	 	<span class="comment">#发送错误到syslog相当于标准错误输出</span></span><br><span class="line"></span><br><span class="line">--timefmt &lt;<span class="built_in">fmt</span>&gt;  <span class="comment">#指定时间输出格式</span></span><br><span class="line">	%Y 	<span class="comment">#年份信息，包含世纪信息</span></span><br><span class="line">	%y 	<span class="comment">#年份信息，不包括世纪信息</span></span><br><span class="line">	%m 	<span class="comment">#显示月份，范围 01-12</span></span><br><span class="line">	%d 	<span class="comment">#每月的第几天，范围是 01-31</span></span><br><span class="line">	%H 	<span class="comment">#小时信息，使用 24小时制，范围 00-23</span></span><br><span class="line">	%M 	<span class="comment">#分钟，范围 00-59</span></span><br><span class="line">	%S 	<span class="comment">#秒，范例 0-60</span></span><br><span class="line">	例子：	--timefmt <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span></span><br><span class="line">	</span><br><span class="line">--format &lt;<span class="built_in">fmt</span>&gt; 	 <span class="comment">#指定的输出格式；即实际监控输出内容</span></span><br><span class="line">	%T  <span class="comment">#输出时间格式中定义的时间格式信息，通过 --timefmt option 语法格式指定时间信息</span></span><br><span class="line">	%w  <span class="comment">#事件出现时，监控文件或目录的名称信息，相当于dirname</span></span><br><span class="line">	%f  <span class="comment">#事件出现时，将显示监控目录下触发事件的文件或目录信息，否则为空，相当于basename</span></span><br><span class="line">	%e  <span class="comment">#显示发生的事件信息，不同的事件默认用逗号分隔</span></span><br><span class="line">	%Xe <span class="comment">#显示发生的事件信息，不同的事件指定用X进行分隔</span></span><br><span class="line">	例子：	--format <span class="string">&quot;%T %w%f event: %;e&quot;</span></span><br><span class="line">				--format <span class="string">&#x27;%T %w %f&#x27;</span></span><br><span class="line"></span><br><span class="line">-e 		<span class="comment">#指定监听指定的事件，如果省略，表示所有事件都进行监听</span></span><br><span class="line">	create 					<span class="comment">#文件或目录创建</span></span><br><span class="line">	delete 					<span class="comment">#文件或目录被删除</span></span><br><span class="line">	modify 					<span class="comment">#文件或目录内容被写入</span></span><br><span class="line">	attrib 					<span class="comment">#文件或目录属性改变</span></span><br><span class="line">	close_write   	<span class="comment">#文件或目录关闭，在写入模式打开之后关闭的</span></span><br><span class="line">	close_nowrite 	<span class="comment">#文件或目录关闭，在只读模式打开之后关闭的</span></span><br><span class="line">	close 					<span class="comment">#文件或目录关闭，不管读或是写模式</span></span><br><span class="line">	open 						<span class="comment">#文件或目录被打开</span></span><br><span class="line">	lsdir 					<span class="comment">#浏览目录内容</span></span><br><span class="line">	moved_to 				<span class="comment">#文件或目录被移动到监控的目录中</span></span><br><span class="line">	moved_from 			<span class="comment">#文件或目录从监控的目录中被移动</span></span><br><span class="line">	move 						<span class="comment">#文件或目录不管移动到或是移出监控目录都触发事件</span></span><br><span class="line">	access 					<span class="comment">#文件或目录内容被读取</span></span><br><span class="line">	delete_self 		<span class="comment">#文件或目录被删除，目录本身被删除</span></span><br><span class="line">	unmount 				<span class="comment">#取消挂载</span></span><br><span class="line">	例子： -e create,delete,moved_to,close_write,attrib，moved_from</span><br></pre></td></tr></table></figure>

<p>范例：只监控一个事件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# tree /data/</span><br><span class="line">/data/</span><br><span class="line">├── dir1</span><br><span class="line">└── dir2</span><br><span class="line">2 directories, 0 files</span><br><span class="line"></span><br><span class="line"><span class="comment">#开始监控</span></span><br><span class="line">[root@ubuntu ~]# inotifywait /data/</span><br><span class="line">Setting up watches.</span><br><span class="line">Watches established.</span><br><span class="line"></span><br><span class="line"><span class="comment">#在另一个终端中执行</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> /data/</span><br><span class="line">dir1 dir2</span><br><span class="line"></span><br><span class="line"><span class="comment">#提示open事件并退出</span></span><br><span class="line">[root@ubuntu ~]# inotifywait /data/</span><br><span class="line">Setting up watches.</span><br><span class="line">Watches established.</span><br><span class="line">/data/ OPEN,ISDIR</span><br></pre></td></tr></table></figure>

<p>范例：持续监控</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# inotifywait -m /data/</span><br><span class="line">Setting up watches.</span><br><span class="line">Watches established.</span><br><span class="line"></span><br><span class="line"><span class="comment">#另一个终端操作</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> /data</span><br><span class="line">dir1 dir2</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> /data/dir1</span><br><span class="line">[root@ubuntu ~]# <span class="built_in">touch</span> /data/test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看监控，一条命令可能有多个事件</span></span><br><span class="line">[root@ubuntu ~]# inotifywait -m /data/</span><br><span class="line">Setting up watches.</span><br><span class="line">Watches established.</span><br><span class="line">/data/ OPEN,ISDIR</span><br><span class="line">/data/ ACCESS,ISDIR</span><br><span class="line">/data/ ACCESS,ISDIR</span><br><span class="line">/data/ CLOSE_NOWRITE,CLOSE,ISDIR</span><br><span class="line">/data/ OPEN,ISDIR dir1</span><br><span class="line">/data/ ACCESS,ISDIR dir1</span><br><span class="line">/data/ ACCESS,ISDIR dir1</span><br><span class="line">/data/ CLOSE_NOWRITE,CLOSE,ISDIR dir1</span><br><span class="line">/data/ CREATE test.txt</span><br><span class="line">/data/ OPEN test.txt</span><br><span class="line">/data/ ATTRIB test.txt	<span class="comment">#ATTRIB表示属性更改</span></span><br><span class="line">/data/ CLOSE_WRITE,CLOSE test.txt	<span class="comment">#CLOSE_WRITE表示有文件内容发生变化	</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#递归监控</span></span><br><span class="line">inotifywait -mrq /data/www  --exclude=<span class="string">&quot;.*\.swx|\.swp&quot;</span></span><br><span class="line">/data/www/ OPEN f1.txt</span><br><span class="line">/data/www/ ACCESS f1.txt</span><br><span class="line">/data/www/ CLOSE_NOWRITE,CLOSE f1.txt</span><br></pre></td></tr></table></figure>

<p>范例：持续后台监控，并指定输出格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# inotifywait -drq /data/ -o inotify.log --timefmt <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span> --format <span class="string">&quot;%T %w%f event: %e&quot;</span></span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> inotify.log</span><br><span class="line">2023-07-11 14:45:53 /data/ event: OPEN,ISDIR</span><br><span class="line">2023-07-11 14:45:53 /data/ event: ACCESS,ISDIR</span><br><span class="line">2023-07-11 14:45:53 /data/ event: CLOSE_NOWRITE,CLOSE,ISDIR</span><br></pre></td></tr></table></figure>

<p>范例：持续前台监控特定事件，指定输出格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> /data/</span><br><span class="line">dir1 dir2 test.txt</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">touch</span> /data/test.log</span><br><span class="line">[root@ubuntu ~]# <span class="built_in">touch</span> /data/test.log</span><br><span class="line">[root@ubuntu ~]# <span class="built_in">rm</span> -f /data/test.log</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# inotifywait -mrq /data/ --timefmt <span class="string">&quot;%F %H:%M:%S&quot;</span> --format <span class="string">&quot;%T %w%f event:%;e&quot;</span> -e create,delete,moved_to,close_write,attrib</span><br><span class="line">2023-07-11 14:58:03 /data/test.log event:CREATE</span><br><span class="line">2023-07-11 14:58:03 /data/test.log event:ATTRIB</span><br><span class="line">2023-07-11 14:58:03 /data/test.log event:CLOSE_WRITE;CLOSE</span><br><span class="line">2023-07-11 14:58:06 /data/test.log event:ATTRIB</span><br><span class="line">2023-07-11 14:58:06 /data/test.log event:CLOSE_WRITE;CLOSE</span><br><span class="line">2023-07-11 14:58:09 /data/test.log event:DELETE</span><br></pre></td></tr></table></figure>

<p>范例：将结果输出到文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# inotifywait -m -r /data/ -o inotify.txt</span><br><span class="line">Setting up watches. Beware: since -r was given, this may take a <span class="keyword">while</span>!</span><br><span class="line">Watches established.</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> /data/</span><br><span class="line">dir1 dir2 test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看结果文件</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> inotify.txt</span><br><span class="line">/data/ OPEN,ISDIR</span><br><span class="line">/data/ ACCESS,ISDIR</span><br><span class="line">/data/ CLOSE_NOWRITE,CLOSE,ISDIR</span><br></pre></td></tr></table></figure>

<p>范例：从文件中读取要监控的内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> a.txt</span><br><span class="line">/data/</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# inotifywait -<span class="built_in">rm</span> --fromfile a.txt</span><br><span class="line">Setting up watches. Beware: since -r was given, this may take a <span class="keyword">while</span>!</span><br><span class="line">Watches established.</span><br></pre></td></tr></table></figure>

<h3 id="2-1-3-rsync服务"><a href="#2-1-3-rsync服务" class="headerlink" title="2.1.3 rsync服务"></a>2.1.3 rsync服务</h3><p>rsync 常作为 Linux 系统下的数据镜像备份工具，支持本地复制、与其他 SSH 主机的远程同步以及增量备份；配合任务计划可实现定时或间隔同步，配合 inotify 或 sersync 则能实现触发式的实时数据同步。<a href="http://rsync.samba.org/">官方网站</a></p>
<ul>
<li><p>软件包：rsync（Ubuntu20.04），rsync-daemon（CentOS 8）</p>
</li>
<li><p>服务文件：<code>/usr/lib/systemd/system/rsyncd.service</code></p>
</li>
<li><p>配置文件：<code>/etc/rsyncd.conf</code></p>
</li>
<li><p>端口：873&#x2F;tcp</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Ubuntu默认提供了service文件</span></span><br><span class="line">[root@ubuntu2204 ~]#systemctl <span class="built_in">cat</span> rsync.service</span><br><span class="line"><span class="comment"># /lib/systemd/system/rsync.service</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=fast remote file copy program daemon</span><br><span class="line">ConditionPathExists=/etc/rsyncd.conf</span><br><span class="line">After=network.target</span><br><span class="line">Documentation=man:rsync(1) man:rsyncd.conf(5)</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/bin/rsync --daemon --no-detach</span><br><span class="line">RestartSec=1</span><br><span class="line"><span class="comment"># Citing README.md:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  [...] Using ssh is recommended for its security features.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  Alternatively, rsync can run in `daemon&#x27; mode, listening on a socket.</span></span><br><span class="line"><span class="comment">#  This is generally used for public file distribution, [...]</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># So let&#x27;s assume some extra security is more than welcome here. We do full</span></span><br><span class="line"><span class="comment"># system protection (which makes /usr, /boot, &amp; /etc read-only) and hide</span></span><br><span class="line"><span class="comment"># devices. To override these defaults, it&#x27;s best to do so in the drop-in</span></span><br><span class="line"><span class="comment"># directory, often done via `systemctl edit rsync.service`. The file needs</span></span><br><span class="line"><span class="comment"># just the bare minimum of the right [heading] and override values.</span></span><br><span class="line"><span class="comment"># See systemd.unit(5) and search for &quot;drop-in&quot; for full details.</span></span><br><span class="line">ProtectSystem=full</span><br><span class="line"><span class="comment">#ProtectHome=on|off|read-only</span></span><br><span class="line">PrivateDevices=on</span><br><span class="line">NoNewPrivileges=on</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"><span class="comment">#红帽系统需要安装rsync-daemon包提供service文件</span></span><br><span class="line">[root@backup-centos8 ~]#dnf -y install rsync-daemon</span><br><span class="line">[root@backup-centos8 ~]#rpm -ql rsync-daemon</span><br><span class="line">/etc/rsyncd.conf</span><br><span class="line">/etc/sysconfig/rsyncd</span><br><span class="line">/usr/lib/systemd/system/rsyncd.service</span><br><span class="line">/usr/lib/systemd/system/rsyncd.socket</span><br><span class="line">/usr/lib/systemd/system/rsyncd@.service</span><br><span class="line">/usr/share/man/man5/rsyncd.conf.5.gz</span><br></pre></td></tr></table></figure>

<h4 id="2-1-3-1-rsync命令"><a href="#2-1-3-1-rsync命令" class="headerlink" title="2.1.3.1 rsync命令"></a>2.1.3.1 rsync命令</h4><p>rsync 有三种工作方式</p>
<ol>
<li>本地文件系统上实现同步</li>
<li>本地主机使用远程ssh和远程主机通信</li>
<li>本地主机通过网络套接字连接远程主机上的 rsync daemon</li>
</ol>
<p>前两者的本质是通过本地或远程ssh，而第3种方式则是让远程主机上运行rsyncd服务，使其监听在一个端口上，等待客户端的连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#本地文件同步：代替cp</span></span><br><span class="line">rsync [OPTION]... SRC [SRC]... DEST</span><br><span class="line"></span><br><span class="line"><span class="comment">#远程主机需要开启ssh协议</span></span><br><span class="line">rsync [OPTION]... [USER@]HOST:SRC [DEST] 				<span class="comment">#PULL 拉，将远程主机上的文件拉到本地</span></span><br><span class="line">rsync [OPTION]... SRC [SRC]... [USER@]HOST:DEST <span class="comment">#PUSH 推，将本地文件推送到远程主机上</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#远程主机需要开启rsync协议，需要搭建rsync服务器</span></span><br><span class="line">rsync [OPTION]... [USER@]HOST::SRC [DEST] 											<span class="comment">#PULL 拉，将远程主机上的文件拉到本地</span></span><br><span class="line">rsync [OPTION]... rsync://[USER@]HOST[:PORT]/SRC [DEST] 				<span class="comment">#PULL 拉，将远程主机上的文件拉到本地</span></span><br><span class="line">rsync [OPTION]... SRC [SRC]... [USER@]HOST::DEST 								<span class="comment">#PUSH 推，将本地文件推送到远程主机上</span></span><br><span class="line">rsync [OPTION]... SRC [SRC]... rsync://[USER@]HOST[:PORT]/DEST 	<span class="comment">#PUSH 推，将本地文件推送到远程主机上</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 详细输出与测试选项</span></span><br><span class="line">-v                      <span class="comment"># 显示rsync过程中详细信息。可使用&quot;-vvvv&quot;获取更详细信息。</span></span><br><span class="line">-P                      <span class="comment"># 显示文件传输进度信息（等价于 --partial --progress）。</span></span><br><span class="line">-n --dry-run            <span class="comment"># 仅测试传输，不实际执行，常用于查看rsync行为。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 归档与递归传输选项</span></span><br><span class="line">-a --archive            <span class="comment"># 归档模式，递归传输并保持文件属性，等同于 -rtopgDl。</span></span><br><span class="line">-r --recursive          <span class="comment"># 递归进入目录传输文件。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件属性保持选项</span></span><br><span class="line">-t --<span class="built_in">times</span>              <span class="comment"># 保持文件的修改时间（mtime）。</span></span><br><span class="line">-o --owner              <span class="comment"># 保持文件属主（owner）属性。</span></span><br><span class="line">-g --group              <span class="comment"># 保持文件属组（group）属性。</span></span><br><span class="line">-p --perms              <span class="comment"># 保持文件权限（perms，不包括特殊权限）。</span></span><br><span class="line">-D                      <span class="comment"># 等价于 --device --specials，复制设备文件和特殊文件。</span></span><br><span class="line">-l --links              <span class="comment"># 复制软链接本身，而非其指向的目标文件。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩与传输模式</span></span><br><span class="line">-z                      <span class="comment"># 传输时压缩数据，提高网络效率。</span></span><br><span class="line">-W --whole-file         <span class="comment"># 禁用增量传输，始终全量传输。适合网络带宽高于磁盘I/O的场景。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 路径与结构控制</span></span><br><span class="line">-R --relative           <span class="comment"># 使用相对路径传输，保留命令行中的完整路径结构。</span></span><br><span class="line">-d --<span class="built_in">dirs</span>               <span class="comment"># 仅拷贝目录本身，不递归内容（与-r相反）。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件选择与过滤</span></span><br><span class="line">--size-only             <span class="comment"># 仅根据文件大小判断是否需要传输（忽略mtime）。</span></span><br><span class="line">-u --update             <span class="comment"># 仅当源文件比目标文件新时才传输（基于mtime）。</span></span><br><span class="line">--max-size=SIZE         <span class="comment"># 限制传输的最大文件大小（如 --max-size=1.5m）。</span></span><br><span class="line">--min-size=SIZE         <span class="comment"># 限制传输的最小文件大小。</span></span><br><span class="line">--exclude=PATTERN       <span class="comment"># 排除匹配模式的文件或目录不传输。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 同步与删除策略</span></span><br><span class="line">--delete                <span class="comment"># 以源端为准，删除目标端多余文件（执行在接收端，排除规则后）。</span></span><br><span class="line">--existing              <span class="comment"># 只更新目标端已存在的文件，不创建新文件。</span></span><br><span class="line">--ignore-existing       <span class="comment"># 只传输目标端不存在的文件。</span></span><br><span class="line">--remove-source-files   <span class="comment"># 成功传输后删除源端文件（用于移动语义）。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份相关</span></span><br><span class="line">-b --backup             <span class="comment"># 对已存在的目标文件进行备份，默认后缀为 ~。</span></span><br><span class="line">--backup-dir=DIR        <span class="comment"># 指定备份文件存放目录。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 网络与连接配置</span></span><br><span class="line">-e REMOTE_SHELL         <span class="comment"># 指定远程shell程序（如ssh），用于远程传输。</span></span><br><span class="line">--port=PORT             <span class="comment"># 指定连接rsync daemon的端口（默认873）。</span></span><br><span class="line">--password-file=FILE    <span class="comment"># 指定rsync daemon认证的密码文件（非ssh密码）。</span></span><br><span class="line">--bwlimit=RATE          <span class="comment"># 限制传输带宽（单位MB/s，默认）。</span></span><br></pre></td></tr></table></figure>

<h4 id="2-1-3-2-实现-rsync-daemon-服务"><a href="#2-1-3-2-实现-rsync-daemon-服务" class="headerlink" title="2.1.3.2 实现 rsync daemon 服务"></a>2.1.3.2 实现 rsync daemon 服务</h4><p>开启服务方式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rsync --daemon</span><br><span class="line"></span><br><span class="line">服务方式（守护进程）：持续运行，后台执行，一般都有对应的配置文件</span><br><span class="line">命令方式：一次性，前台执行，<span class="built_in">ls</span> -l -a </span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在备份服务器启动 rsync 进程，启动失败，因为 /etc/rsyncd.conf 配置文件不存在</span></span><br><span class="line">[root@backup-centos8 ~]#rsync --daemon</span><br><span class="line">Failed to parse config file: /etc/rsyncd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建空配置文件</span></span><br><span class="line">[root@backup-centos8 ~]#<span class="built_in">touch</span> /etc/rsyncd.conf</span><br><span class="line"></span><br><span class="line">[root@backup-centos8 ~]#rsync --daemon</span><br><span class="line"></span><br><span class="line"><span class="comment">#监听 873 端口</span></span><br><span class="line">[root@backup-centos8 ~]#ss -ntlp|grep rsync</span><br><span class="line">LISTEN  0     5          0.0.0.0:873        0.0.0.0:*   <span class="built_in">users</span>:((&quot;rsync&quot;,pid=<span class="number">2921</span>,fd=<span class="number">4</span>)) </span><br><span class="line">LISTEN  0     5           [::]:873         [::]:*   <span class="built_in">users</span>:((&quot;rsync&quot;,pid=<span class="number">2921</span>,fd=<span class="number">5</span>)) </span><br><span class="line"></span><br><span class="line"><span class="comment">#修改服务端配置，指定共享目录</span></span><br><span class="line">[root@backup-centos8 ~]#<span class="built_in">cat</span> /etc/rsyncd.conf</span><br><span class="line">[backup] <span class="comment">#对外给用户看到的共享名</span></span><br><span class="line">path = /data/backup/ <span class="comment">#定义一个文件夹实现共享，实际的共享名	</span></span><br><span class="line"><span class="built_in">read</span> only = no  <span class="comment">#指定可读写,默认只读</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Ubuntu要重启，centos不用，直接生效</span></span><br><span class="line">[root@ubuntu ~]# systemctl restart rsync.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看rsync服务器的模块名称</span></span><br><span class="line">[root@data-centos8 ~]#rsync rsync://10.0.0.18</span><br><span class="line">backup</span><br><span class="line"></span><br><span class="line"><span class="comment">#两种写法都可以， :: 表示走rsync协议</span></span><br><span class="line">[root@data-centos8 ~]#rsync 10.0.0.18::</span><br><span class="line">backup</span><br><span class="line"></span><br><span class="line"><span class="comment">##访问rsync服务器的共享目录，看到有文件</span></span><br><span class="line">[root@data-centos8 ~]#rsync rsync://10.0.0.18/backup</span><br><span class="line">drwxr-xr-x             19 2023/12/11 17:23:49 .</span><br><span class="line">-rw-r--r--              0 2023/12/11 17:23:49 a.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#拉</span></span><br><span class="line">[root@data-centos8 ~]#rsync 10.0.0.18::backup/* .</span><br><span class="line">[root@data-centos8 ~]#rsync rsync://10.0.0.18/backup/* .</span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">ls</span></span><br><span class="line">anaconda-ks.cfg  a.txt  </span><br><span class="line"></span><br><span class="line"><span class="comment">#推</span></span><br><span class="line"><span class="comment">#传输文件到远程失败，此处的 root 是指rsync服务的用户，当前服务端并没有配置此信息，默认会被映射成 nobody</span></span><br><span class="line"><span class="comment">#注意：Ubuntu的nobody的组为nogroup，centos8nobody的组为nobody</span></span><br><span class="line">[root@data-centos8 ~]#rsync /etc/hosts 10.0.0.18::backup/hosts.txt</span><br><span class="line">rsync: mkstemp <span class="string">&quot;/.hosts.txt.84dX4G&quot;</span> (<span class="keyword">in</span> backup) failed: Permission denied (13)</span><br><span class="line">rsync error: some files/attrs were not transferred (see previous errors) (code 23) at main.c(1189) [sender=3.1.3]</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定目录给nobody权限，默认用户以nobody访问此目录</span></span><br><span class="line">[root@backup-centos8 ~]#setfacl -m u:nobody:rwx /data/backup/</span><br><span class="line"></span><br><span class="line"><span class="comment">#现在使用的是匿名连接</span></span><br><span class="line">[root@data-centos8 ~]#rsync /etc/networks root@10.0.0.18::backup <span class="comment">#默认所有用户都映射为nobody用户</span></span><br><span class="line">[root@data-centos8 ~]#rsync /etc/issue wang@10.0.0.18::backup    <span class="comment">#wang用户在服务端并不存在</span></span><br><span class="line">[root@data-centos8 ~]#rsync /etc/passwd 10.0.0.18::backup</span><br><span class="line">[root@data-centos8 ~]#rsync /etc/shells rsync://root@10.0.0.18/backup</span><br><span class="line"></span><br><span class="line"><span class="comment">#服务端查看，属主属组都是 nobody</span></span><br><span class="line">[root@backup-centos8 backup]#ll /data/backup/</span><br><span class="line">total 16</span><br><span class="line">-rw-r--r-- 1 root   root      0 Dec 11 17:23 a.txt</span><br><span class="line">-rw-r--r-- 1 nobody nobody   23 Dec 11 17:53 issue</span><br><span class="line">-rw-r--r-- 1 nobody nobody   58 Dec 11 17:52 networks</span><br><span class="line">-rw-r--r-- 1 nobody nobody 1522 Dec 11 17:53 passwd</span><br><span class="line">-rw-r--r-- 1 nobody nobody   44 Dec 11 17:53 shells</span><br></pre></td></tr></table></figure>

<p>基于上述示例，添加指定用户（uid, gid）、用户认证后可访问（auth users, secrets file）功能</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建rsync服务器的配置文件，指定映射账号，指定日志文件，指定远程连接用户名和密码，禁用匿名连接</span></span><br><span class="line">[root@centos8 ~]#vi /etc/rsyncd.conf</span><br><span class="line">uid = root  			<span class="comment">#指定以哪个用户身份访问共享目录，默认为nobody,注意:共享目录需要给此用户权限,否则无法访问</span></span><br><span class="line">gid = root  			<span class="comment">#指定以哪个组身份访问共享目录，默认为nobody,Ubuntu中为nogroup</span></span><br><span class="line"><span class="comment">#port = 874 			#可指定非标准端口,默认873/tcp</span></span><br><span class="line"><span class="comment">#use chroot = no</span></span><br><span class="line">max connections = 0  		<span class="comment">#最大并发连接数，0表示不限制</span></span><br><span class="line">ignore errors  					<span class="comment">#有错误可以跳过</span></span><br><span class="line">exclude = lost+found/  	<span class="comment">#排除lost+found目录</span></span><br><span class="line"><span class="built_in">log</span> file = /var/log/rsyncd.log  		<span class="comment">#日志文件</span></span><br><span class="line">pid file = /var/run/rsyncd.pid  		<span class="comment">#pid文件，存主进程编号</span></span><br><span class="line">lock file = /var/run/rsyncd.lock  	<span class="comment">#锁文件，避免这个服务（多个进程）重复启动</span></span><br><span class="line">reverse lookup = no  								<span class="comment">#反向解析	</span></span><br><span class="line"><span class="comment">#hosts allow = 10.0.0.0/24</span></span><br><span class="line"></span><br><span class="line">[backup]  	<span class="comment">#每个模块名对应一个不同的path目录，如果同名后面模块生效</span></span><br><span class="line">path = /data/backup/ </span><br><span class="line">comment = backup <span class="built_in">dir</span>  		<span class="comment">#描述</span></span><br><span class="line"><span class="built_in">read</span> only = no   					<span class="comment">#默认是yes,即只读</span></span><br><span class="line">auth <span class="built_in">users</span> = rsyncuser  	<span class="comment">#验证用户信息，必须以rsyncuser用户，并且以/etc/rsync.pas里存的密码成对验证才能访问，默认anonymous可以访问rsync服务器</span></span><br><span class="line">secrets file = /etc/rsync.pas</span><br><span class="line"></span><br><span class="line"><span class="comment">#最后的配置文件内容</span></span><br><span class="line">[root@ubuntu2204 ~]#<span class="built_in">cat</span> /etc/rsyncd.conf</span><br><span class="line">uid = root</span><br><span class="line">gid = root</span><br><span class="line">max connections = 0</span><br><span class="line">ignore errors</span><br><span class="line">exclude = lost+found/</span><br><span class="line"><span class="built_in">log</span> file = /var/log/rsyncd.log</span><br><span class="line">pid file = /var/run/rsyncd.pid</span><br><span class="line">lock file = /var/run/rsyncd.lock</span><br><span class="line">reverse lookup = no</span><br><span class="line"></span><br><span class="line">[backup]</span><br><span class="line">path = /data/backup/</span><br><span class="line">comment = backup <span class="built_in">dir</span></span><br><span class="line"><span class="built_in">read</span> only = no</span><br><span class="line">auth <span class="built_in">users</span> = rsyncuser</span><br><span class="line">secrets file = /etc/rsync.pas</span><br><span class="line"></span><br><span class="line"><span class="comment">#服务器端准备目录</span></span><br><span class="line">[root@backup-centos8 ~]#<span class="built_in">mkdir</span> -pv /data/backup</span><br><span class="line"></span><br><span class="line"><span class="comment">#服务器端生成验证文件</span></span><br><span class="line">[root@backup-centos8 ~]#<span class="built_in">echo</span> <span class="string">&quot;rsyncuser:123456&quot;</span> &gt; /etc/rsync.pas</span><br><span class="line">[root@backup-centos8 ~]#<span class="built_in">chmod</span> 600 /etc/rsync.pas</span><br><span class="line"></span><br><span class="line"><span class="comment">#服务器端启动rsync服务</span></span><br><span class="line">[root@backup-centos8 ~]#rsync --daemon 				<span class="comment">#可加入/etc/rc.d/rc.local实现开机启动</span></span><br><span class="line">[root@backup-centos8 ~]#systemctl start rsyncd  	<span class="comment">#CentOS 7 以上版本</span></span><br><span class="line">[root@ubuntu ~]# systemctl restart rsync.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#客户端配置密码文件</span></span><br><span class="line"><span class="comment">#也可将密码赋值给环境变量RSYNC_PASSWORD变量,但不安全</span></span><br><span class="line"><span class="comment">#export RSYNC_PASSWORD=123456	</span></span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">echo</span> <span class="string">&quot;123456&quot;</span> &gt; /etc/rsync.pas</span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">chmod</span> 600 /etc/rsync.pas  <span class="comment">#此为必要项,权限必须修改</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看远程rsync服务器的模块信息</span></span><br><span class="line">[root@data-server ~]#rsync rsync://rsync服务器IP</span><br><span class="line">backup     backup <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#交互式验证查看具体模块内的文件</span></span><br><span class="line">[root@data-server ~]#rsync rsync://rsyncuser@rsync服务器IP/backup</span><br><span class="line">Password:</span><br><span class="line"></span><br><span class="line"><span class="comment">#非交互式查看共享目录</span></span><br><span class="line">[root@data-server ~]#rsync --password-file=/etc/rsync.pas rsync://rsyncuser@rsync服务器IP/backup</span><br><span class="line"></span><br><span class="line"><span class="comment">#客户端测试同步数据</span></span><br><span class="line">[root@data-centos8 ~]#rsync -avz --delete --password-file=/etc/rsync.pas /data/www/ rsyncuser@rsync服务器IP::backup</span><br><span class="line"></span><br><span class="line">[root@data-centos8 ~]#rsync -avz --delete  --password-file=/etc/rsync.pas rsyncuser@rsync服务器IP::backup  /data/www/</span><br></pre></td></tr></table></figure>

<h3 id="2-1-4-inotify-rsync通过脚本实现实时数据同步"><a href="#2-1-4-inotify-rsync通过脚本实现实时数据同步" class="headerlink" title="2.1.4 inotify+rsync通过脚本实现实时数据同步"></a>2.1.4 inotify+rsync通过脚本实现实时数据同步</h3><p><img src="/Linux/service-manage/data-synchronization/1753757619402-54475ac7-0a7c-4d05-9c30-e54c62a2aad5-175568388467410.png" alt="null"></p>
<p>在运行这个脚本之前，需要先确保 rsync 服务器的<code>/data/www/</code>目录和目标服务器（rsync 服务器的<code>backup</code>模块对应目录）中的初始数据是完全一致的；因为这个脚本的作用是在初始数据同步的基础上，监控后续源目录的变化（如文件创建、删除、修改等），并自动将变化同步到目标主机，保持两者实时一致。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@data-centos8 ~]#vim inotify_rsync.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 源目录（注意末尾的斜杠，表示同步目录内内容）</span></span><br><span class="line">SRC=<span class="string">&#x27;/data/www/&#x27;</span></span><br><span class="line"><span class="comment"># 目标地址（rsync服务器的备份模块）</span></span><br><span class="line">DEST=<span class="string">&#x27;rsyncuser@rsync服务器IP::backup&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Ubuntu 20.04不支持--password-file参数，通过环境变量传递密码</span></span><br><span class="line"><span class="built_in">export</span> RSYNC_PASSWORD=123456</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装依赖（可选，根据实际环境开启）</span></span><br><span class="line"><span class="comment"># rpm -q inotify-tools &amp;&gt; /dev/null || yum -y install inotify-tools</span></span><br><span class="line"><span class="comment"># rpm -q rsync &amp;&gt; /dev/null || yum -y install rsync</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 监控源目录变化，触发同步</span></span><br><span class="line">inotifywait -mrq \</span><br><span class="line">    --exclude=<span class="string">&quot;.*\.swp&quot;</span> \                   <span class="comment"># 排除临时交换文件（如vim的.swp文件）</span></span><br><span class="line">    --timefmt <span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span> \         <span class="comment"># 时间格式</span></span><br><span class="line">    --format <span class="string">&#x27;%T %w %f&#x27;</span> \                   <span class="comment"># 输出格式：时间 目录 文件</span></span><br><span class="line">    -e create,delete,moved_from,moved_to,close_write,attrib \  <span class="comment"># 监控的事件类型</span></span><br><span class="line">    <span class="variable">$&#123;SRC&#125;</span> | <span class="keyword">while</span> <span class="built_in">read</span> DATE TIME DIR FILE; <span class="keyword">do</span></span><br><span class="line">        FILEPATH=<span class="variable">$&#123;DIR&#125;</span><span class="variable">$&#123;FILE&#125;</span></span><br><span class="line">        <span class="comment"># 同步源目录到目标，删除目标多余文件，并记录日志</span></span><br><span class="line">        rsync -az --delete <span class="variable">$SRC</span> <span class="variable">$DEST</span> &amp;&amp; \</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;At <span class="variable">$&#123;TIME&#125;</span> on <span class="variable">$&#123;DATE&#125;</span>, file <span class="variable">$FILEPATH</span> was backuped up via rsync&quot;</span> &gt;&gt; /var/log/changelist.log</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 若系统支持--password-file，可替换为下面的命令</span></span><br><span class="line">        <span class="comment"># rsync -az --delete --password-file=/etc/rsync.pas $SRC $DEST &amp;&amp; \</span></span><br><span class="line">        <span class="comment">#     echo &quot;At $&#123;TIME&#125; on $&#123;DATE&#125;, file $FILEPATH was backuped up via rsync&quot; &gt;&gt; /var/log/changelist.log</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看文件传输日志</span></span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">tail</span> -f /var/log/changelist.log</span><br></pre></td></tr></table></figure>

<p>后台执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 开启screen窗口</span><br><span class="line">2 <span class="built_in">nohup</span> bash inotify_rsync.sh &amp;&gt;/dev/dull &amp;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-sersync-rsync"><a href="#2-2-sersync-rsync" class="headerlink" title="2.2 sersync+rsync"></a>2.2 sersync+rsync</h2><h3 id="3-4-1-sersync-介绍"><a href="#3-4-1-sersync-介绍" class="headerlink" title="3.4.1 sersync 介绍"></a>3.4.1 sersync 介绍</h3><p>inotify最大的不足在于事件重复 &#x2F; 冗余和无关事件干扰</p>
<ul>
<li>产生重复事件：当监控的目录中有5个文件时，删除目录时会产生6个监控事件（1 个目录被删除事件和5 个目录内每个文件被删除事件），从而导致重复调用rsync命令。但实际上，删除目录是一个整体操作，只需要一次 rsync 就能同步这个变化，即删除目标端的对应目录就行，多余的 5 次 rsync 调用都是重复且无意义的，会浪费系统资源</li>
<li>无关事件干扰：用 vim 编辑文件时，会先创建一个临时文件，而inotify会监控到临时文件的事件，但这个事件相对于rsync来说是不应该被监控的，因为vim保存文件后会删除这个临时文件</li>
</ul>
<p>所以sersync是基于inotify的基础上开发的，同样用于监控，克服了inotify的缺点，功能更加强大，特别适用于对实时性要求较高的环境，并且还可以进行二次开发。<a href="https://code.google.com/archive/p/sersync/">sersync项目地址</a>；<a href="https://code.google.com/archive/p/sersync/downloads">sersync下载地址</a></p>
<ul>
<li>对linux系统文件系统产生的临时文件和重复的文件操作进行过滤，在结合rsync同步的时候节省了运行时耗和网络资源，因此更快</li>
<li>配置简单，其中提供了静态编译好的二进制文件和xml配置文件，直接使用即可</li>
<li>使用多线程进行同步，尤其在同步较大文件时，能够保证多个服务器实时保持同步状态</li>
<li>有出错处理机制，通过失败队列对出错的文件重新同步，如果仍旧失败，则按设定时长对同步失败的文件重新同步</li>
<li>不仅可以实现实时同步，另外还自带crontab功能，只需在xml配置文件中开启，即也可以按要求隔一段时间整体同步一次，而无需再额外配置crontab功能</li>
</ul>
<p>同步原理</p>
<ul>
<li>首先在Master服务器上面安装sersync服务及要确保有rsync命令，在Slave服务器上面配置rsync server</li>
<li>在Master服务器上开启sersync服务，sersync负责监控配置路径中文件系统事件的变化</li>
<li>Master服务器上面的sersync服务调用rsync命令把更新的文件推送到目标服务器Slave上面</li>
</ul>
<h3 id="3-4-2-部署sersync"><a href="#3-4-2-部署sersync" class="headerlink" title="3.4.2 部署sersync"></a>3.4.2 部署sersync</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#下载</span></span><br><span class="line">[root@ubuntu ~]# wget https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/sersync/sersync2.5.4_64bit_binary_stable_final.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#解压</span></span><br><span class="line">[root@ubuntu ~]# tar xf sersync2.5.4_64bit_binary_stable_final.tar.gz</span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span></span><br><span class="line">GNU-Linux-x86 sersync2.5.4_64bit_binary_stable_final.tar.gz snap</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> GNU-Linux-x86/</span><br><span class="line">confxml.xml sersync2</span><br><span class="line"></span><br><span class="line"><span class="comment">#移动</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">mv</span> GNU-Linux-x86/ /usr/local/sersync</span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> /usr/local/sersync/</span><br><span class="line">confxml.xml sersync2</span><br></pre></td></tr></table></figure>

<p>sersync2 命令用法和参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu sersync]# ./sersync2 -h</span><br><span class="line"><span class="built_in">set</span> the system param</span><br><span class="line">execute：<span class="built_in">echo</span> 50000000 &gt; /proc/sys/fs/inotify/max_user_watches</span><br><span class="line">execute：<span class="built_in">echo</span> 327679 &gt; /proc/sys/fs/inotify/max_queued_events</span><br><span class="line">parse the <span class="built_in">command</span> param</span><br><span class="line">_______________________________________________________</span><br><span class="line">参数-d：启用守护进程模式</span><br><span class="line">参数-r：在监控前，将监控目录与远程主机用rsync命令推送一遍</span><br><span class="line">参数-n：指定开启守护线程的数量，默认为10个</span><br><span class="line">参数-o：指定配置文件，默认使用confxml.xml文件</span><br><span class="line">参数-m：单独启用其他模块，不加-m参数，则默认执行同步程序</span><br><span class="line">	-m refreshCDN 开启刷新CDN模块</span><br><span class="line">	-m socket 开启socket模块</span><br><span class="line">	-m http 开启http模块</span><br><span class="line">________________________________________________________________</span><br></pre></td></tr></table></figure>

<h3 id="3-4-3-基于rsync-daemon实现数据同步"><a href="#3-4-3-基于rsync-daemon实现数据同步" class="headerlink" title="3.4.3 基于rsync daemon实现数据同步"></a>3.4.3 基于rsync daemon实现数据同步</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在数据服务器上下载sersync，并拷贝至相应的目录，设置PATH变量</span></span><br><span class="line">[root@data-centos8 ~]#wget https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/sersync/sersync2.5.4_64bit_binary_stable_final.tar.gz</span><br><span class="line"></span><br><span class="line">[root@data-centos8 ~]#tar xf sersync2.5.4_64bit_binary_stable_final.tar.gz</span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">cp</span> -a GNU-Linux-x86 /usr/local/sersync</span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">echo</span> <span class="string">&#x27;PATH=/usr/local/sersync:$PATH&#x27;</span> &gt;/etc/profile.d/sersync.sh</span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">source</span> /etc/profile.d/sersync.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#sersync目录只有两个文件：一个是二进制程序文件，一个是xml格式的配置文件</span></span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">ls</span> /usr/local/sersync/</span><br><span class="line">confxml.xml sersync2</span><br><span class="line"></span><br><span class="line"><span class="comment">#确认安装rsync客户端工具</span></span><br><span class="line">[root@data-centos8 ~]#rpm -q rsync &amp;&gt; /dev/null || dnf -y install rsync</span><br><span class="line"></span><br><span class="line"><span class="comment">#备份sersync配置文件</span></span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">cp</span> /usr/local/sersync/confxml.xml&#123;,.bak&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改sersync配置文件</span></span><br><span class="line">[root@data-centos8 ~]#vim /usr/local/sersync/confxml.xml</span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;ISO-8859-1&quot;</span>?&gt;</span><br><span class="line">&lt;<span class="built_in">head</span> version=<span class="string">&quot;2.5&quot;</span>&gt;</span><br><span class="line"> 	&lt;host hostip=<span class="string">&quot;localhost&quot;</span> port=<span class="string">&quot;8008&quot;</span>&gt;&lt;/host&gt;</span><br><span class="line"></span><br><span class="line"> 	&lt;debug start=<span class="string">&quot;false&quot;</span>/&gt;  		<span class="comment">#是否开启调试模式</span></span><br><span class="line"> 	&lt;fileSystem xfs=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line"> 	&lt;filter start=<span class="string">&quot;false&quot;</span>&gt;  		<span class="comment">#不开启文件过滤功能，当为true时,以下类型的文件将不同步</span></span><br><span class="line">    &lt;exclude expression=<span class="string">&quot;(.*)\.svn&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line">    &lt;exclude expression=<span class="string">&quot;(.*)\.gz&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line">    &lt;exclude expression=<span class="string">&quot;^info/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line">    &lt;exclude expression=<span class="string">&quot;^static/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/filter&gt;</span><br><span class="line"></span><br><span class="line"> 	&lt;inotify&gt;  	<span class="comment">#监控事件，默认监控delete/close_write/moved_from/moved_to/create folder</span></span><br><span class="line">    &lt;delete start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;createFolder start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;createFile start=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">    &lt;closeWrite start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;moveFrom start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;moveTo start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;attrib start=<span class="string">&quot;true&quot;</span>/&gt;  			<span class="comment">#修改此行为true，文件属性变化后也会同步</span></span><br><span class="line">    &lt;modify start=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line"> 	&lt;/inotify&gt;</span><br><span class="line"></span><br><span class="line"> 	</span><br><span class="line"> 	&lt;sersync&gt;  		<span class="comment">#rsync命令的配置段</span></span><br><span class="line">    &lt;localpath watch=<span class="string">&quot;/data/www&quot;</span>&gt; 		<span class="comment">#修改此行,需要同步的源目录或文件，建议同步目录</span></span><br><span class="line"> 		&lt;remote ip=<span class="string">&quot;备份服务器IP&quot;</span> name=<span class="string">&quot;backup&quot;</span>/&gt;  	<span class="comment">#修改此行,指定远程主机地址和目录，即备份服务器地址和rsyncdaemon的模块名，如果下面开启了ssh start，此时name为远程shell方式运行时的目标目录</span></span><br><span class="line"> 		&lt;!--&lt;remote ip=<span class="string">&quot;192.168.8.39&quot;</span> name=<span class="string">&quot;tongbu&quot;</span>/&gt;--&gt;</span><br><span class="line"> 		&lt;!--&lt;remote ip=<span class="string">&quot;192.168.8.40&quot;</span> name=<span class="string">&quot;tongbu&quot;</span>/&gt;--&gt;</span><br><span class="line">    &lt;/localpath&gt;</span><br><span class="line"></span><br><span class="line">    &lt;rsync&gt;</span><br><span class="line"> 	&lt;commonParams params=<span class="string">&quot;-artuz&quot;</span>/&gt;  	<span class="comment">#指定rsync选项</span></span><br><span class="line"> 	&lt;auth start=<span class="string">&quot;true&quot;</span> <span class="built_in">users</span>=<span class="string">&quot;rsyncuser&quot;</span> passwordfile=<span class="string">&quot;/etc/rsync.pas&quot;</span>/&gt; 	<span class="comment">#修改此行为true,指定备份服务器的rsync配置的用户和密码文件</span></span><br><span class="line"> 	&lt;userDefinedPort start=<span class="string">&quot;false&quot;</span> port=<span class="string">&quot;874&quot;</span>/&gt;&lt;!-- port=874 --&gt;		<span class="comment">#指定rsync的非标准端口号</span></span><br><span class="line"> 	&lt;<span class="built_in">timeout</span> start=<span class="string">&quot;false&quot;</span> <span class="keyword">time</span>=<span class="string">&quot;100&quot;</span>/&gt;&lt;!-- <span class="built_in">timeout</span>=100 --&gt;</span><br><span class="line"> 	&lt;ssh start=<span class="string">&quot;false&quot;</span>/&gt; 		<span class="comment">#默认使用rsync daemon运行rsync命令,true为使用远程shell模式</span></span><br><span class="line">    &lt;/rsync&gt;</span><br><span class="line"></span><br><span class="line">    &lt;failLog path=<span class="string">&quot;/tmp/rsync_fail_log.sh&quot;</span> timeToExecute=<span class="string">&quot;60&quot;</span>/&gt;&lt;!--default every 60mins execute once--&gt;  <span class="comment">#错误重传及日志文件路径</span></span><br><span class="line">    &lt;crontab start=<span class="string">&quot;false&quot;</span> schedule=<span class="string">&quot;600&quot;</span>&gt;&lt;!--600mins--&gt; 	<span class="comment">#不开启crontab功能</span></span><br><span class="line"> 		&lt;crontabfilter start=<span class="string">&quot;false&quot;</span>&gt;  		<span class="comment">#不开启crontab定时传输的筛选功能</span></span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;*.php&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;info/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line"> 		&lt;/crontabfilter&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/crontab&gt;</span><br><span class="line"></span><br><span class="line">    &lt;plugin start=<span class="string">&quot;false&quot;</span> name=<span class="string">&quot;command&quot;</span>/&gt;</span><br><span class="line"> 	&lt;/sersync&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#####################################以下行不需要修改</span></span><br><span class="line"><span class="comment">####################################</span></span><br><span class="line"> 	&lt;plugin name=<span class="string">&quot;command&quot;</span>&gt;</span><br><span class="line">    &lt;param prefix=<span class="string">&quot;/bin/sh&quot;</span> suffix=<span class="string">&quot;&quot;</span> ignoreError=<span class="string">&quot;true&quot;</span>/&gt; &lt;!--prefix /opt/tongbu/mmm.sh suffix--&gt;</span><br><span class="line">    &lt;filter start=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line"> 		&lt;include expression=<span class="string">&quot;(.*)\.php&quot;</span>/&gt;</span><br><span class="line"> 		&lt;include expression=<span class="string">&quot;(.*)\.sh&quot;</span>/&gt;</span><br><span class="line">    &lt;/filter&gt;</span><br><span class="line"></span><br><span class="line"> 	&lt;/plugin&gt;</span><br><span class="line"></span><br><span class="line"> 	</span><br><span class="line"> 	&lt;plugin name=<span class="string">&quot;socket&quot;</span>&gt;</span><br><span class="line">    &lt;localpath watch=<span class="string">&quot;/opt/tongbu&quot;</span>&gt;</span><br><span class="line"> 		&lt;deshost ip=<span class="string">&quot;192.168.138.20&quot;</span> port=<span class="string">&quot;8009&quot;</span>/&gt;</span><br><span class="line">    &lt;/localpath&gt;</span><br><span class="line"></span><br><span class="line"> 	&lt;/plugin&gt;</span><br><span class="line"></span><br><span class="line"> 	&lt;plugin name=<span class="string">&quot;refreshCDN&quot;</span>&gt;</span><br><span class="line">    &lt;localpath watch=<span class="string">&quot;/data0/htdocs/cms.xoyo.com/site/&quot;</span>&gt;</span><br><span class="line"> 		&lt;cdninfo domainname=<span class="string">&quot;ccms.chinacache.com&quot;</span> port=<span class="string">&quot;80&quot;</span> username=<span class="string">&quot;xxxx&quot;</span>passwd=<span class="string">&quot;xxxx&quot;</span>/&gt;</span><br><span class="line"> 		&lt;sendurl base=<span class="string">&quot;http://pic.xoyo.com/cms&quot;</span>/&gt;</span><br><span class="line"> 		&lt;regexurl regex=<span class="string">&quot;false&quot;</span> match=<span class="string">&quot;cms.xoyo.com/site([/a-zA-Z0-9]*).xoyo.com/images&quot;</span>/&gt;</span><br><span class="line">    &lt;/localpath&gt;</span><br><span class="line"></span><br><span class="line"> 	&lt;/plugin&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建连接rsynd服务器的用户密码文件,并必须修改权限</span></span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">echo</span> 123456 &gt; /etc/rsync.pas</span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">chmod</span> 600 /etc/rsync.pas</span><br><span class="line"></span><br><span class="line"><span class="comment">#以后台方式执行同步</span></span><br><span class="line">[root@data-centos8 ~]#sersync2 -dro /usr/local/sersync/confxml.xml</span><br><span class="line"><span class="built_in">set</span> the system param</span><br><span class="line">execute：<span class="built_in">echo</span> 50000000 &gt; /proc/sys/fs/inotify/max_user_watches</span><br><span class="line">execute：<span class="built_in">echo</span> 327679 &gt; /proc/sys/fs/inotify/max_queued_events</span><br><span class="line">parse the <span class="built_in">command</span> param</span><br><span class="line">option: -d run as a daemon</span><br><span class="line">option: -r rsync all the <span class="built_in">local</span> files to the remote servers before the sersync</span><br><span class="line">work</span><br><span class="line">option: -o config xml name： /usr/local/sersync/confxml.xml</span><br><span class="line">daemon thread num: 10</span><br><span class="line">parse xml config file</span><br><span class="line">host ip : localhost host port: 8008</span><br><span class="line">daemon start，sersync run behind the console</span><br><span class="line">use rsync password-file :</span><br><span class="line">user is rsyncuser</span><br><span class="line">passwordfile is /etc/rsync.pas</span><br><span class="line">config xml parse success</span><br><span class="line">please <span class="built_in">set</span> /etc/rsyncd.conf max connections=0 Manually</span><br><span class="line">sersync working thread 12  = 1(primary thread) + 1(fail retry thread) +</span><br><span class="line">10(daemon sub threads)</span><br><span class="line">Max threads numbers is: 22 = 12(Thread pool nums) + 10(Sub threads)</span><br><span class="line">please according your cpu ，use -n param to adjust the cpu rate</span><br><span class="line">------------------------------------------</span><br><span class="line">rsync the directory recursivly to the remote servers once</span><br><span class="line">working please <span class="built_in">wait</span>...</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果同步失败,可以手动执行下面命令,观察过程</span></span><br><span class="line">[root@data-centos8 ~]# <span class="built_in">cd</span> /data/www &amp;&amp; rsync -artuz -R --delete ./ rsyncuser@backup-server::backup --password-file=/etc/rsync.pas &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">run the sersync:</span><br><span class="line">watch path is: /data/www</span><br><span class="line">________________________________________________________________</span><br><span class="line">    </span><br><span class="line"><span class="comment">#sersync支持多实例，也即监控多个目录时，只需分别配置不同配置文件，然后使用sersync2指定对应配置文件运行</span></span><br><span class="line">[root@data-centos8 ~]#sersync2 -rd -o /etc/sersync.d/nginx.xml</span><br></pre></td></tr></table></figure>

<h3 id="3-4-3-基于远程ssh实现数据同步"><a href="#3-4-3-基于远程ssh实现数据同步" class="headerlink" title="3.4.3 基于远程ssh实现数据同步"></a>3.4.3 基于远程ssh实现数据同步</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#不需要配置rsync daemon,只需要配置基于key验证的ssh即可</span></span><br><span class="line">[root@data-centos8 ~]#ssh-keygen</span><br><span class="line">[root@data-centos8 ~]#ssh-copy-id backup-server</span><br><span class="line"></span><br><span class="line"><span class="comment">#下载sersync，并拷贝至相应的目录，设置PATH变量同5.5.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改sersync配置文件</span></span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">cat</span> /usr/local/sersync/confxml.xml</span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;ISO-8859-1&quot;</span>?&gt;</span><br><span class="line">&lt;<span class="built_in">head</span> version=<span class="string">&quot;2.5&quot;</span>&gt;</span><br><span class="line"> 	&lt;host hostip=<span class="string">&quot;localhost&quot;</span> port=<span class="string">&quot;8008&quot;</span>&gt;&lt;/host&gt;</span><br><span class="line"></span><br><span class="line"> 	&lt;debug start=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">     &lt;fileSystem xfs=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line"> 	&lt;filter start=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line">    &lt;exclude expression=<span class="string">&quot;(.*)\.svn&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line">    &lt;exclude expression=<span class="string">&quot;(.*)\.gz&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line">    &lt;exclude expression=<span class="string">&quot;^info/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line">    &lt;exclude expression=<span class="string">&quot;^static/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line"> 	&lt;/filter&gt;</span><br><span class="line"></span><br><span class="line"> 	&lt;inotify&gt;</span><br><span class="line">    &lt;delete start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;createFolder start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;createFile start=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">    &lt;closeWrite start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;moveFrom start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;moveTo start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;attrib start=<span class="string">&quot;true&quot;</span>/&gt;  <span class="comment">#修改此行为true</span></span><br><span class="line">    &lt;modify start=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line"> 	&lt;/inotify&gt;</span><br><span class="line"></span><br><span class="line">     &lt;sersync&gt;</span><br><span class="line">    &lt;localpath watch=<span class="string">&quot;/data/www&quot;</span>&gt;  <span class="comment">#修改此行,指定源数据目录</span></span><br><span class="line"> 		&lt;remote ip=<span class="string">&quot;备份服务器IP&quot;</span> name=<span class="string">&quot;/data/backup&quot;</span>/&gt;  <span class="comment">#修改此行指定备份服务器地址和备份目标目录</span></span><br><span class="line"> 		&lt;!--&lt;remote ip=<span class="string">&quot;192.168.8.39&quot;</span> name=<span class="string">&quot;tongbu&quot;</span>/&gt;--&gt;</span><br><span class="line"> 		&lt;!--&lt;remote ip=<span class="string">&quot;192.168.8.40&quot;</span> name=<span class="string">&quot;tongbu&quot;</span>/&gt;--&gt;</span><br><span class="line">    &lt;/localpath&gt;</span><br><span class="line"></span><br><span class="line">    &lt;rsync&gt;</span><br><span class="line"> 		&lt;commonParams params=<span class="string">&quot;-artuz&quot;</span>/&gt;</span><br><span class="line"> 		&lt;auth start=<span class="string">&quot;false&quot;</span> <span class="built_in">users</span>=<span class="string">&quot;root&quot;</span> passwordfile=<span class="string">&quot;/etc/rsync.pas&quot;</span>/&gt;  <span class="comment">#必须修改此行,不启用认证start=false</span></span><br><span class="line"> 		&lt;userDefinedPort start=<span class="string">&quot;false&quot;</span> port=<span class="string">&quot;874&quot;</span>/&gt;&lt;!-- port=874 --&gt;</span><br><span class="line"> 		&lt;<span class="built_in">timeout</span> start=<span class="string">&quot;false&quot;</span> <span class="keyword">time</span>=<span class="string">&quot;100&quot;</span>/&gt;&lt;!-- <span class="built_in">timeout</span>=100 --&gt;</span><br><span class="line"> 		&lt;ssh start=<span class="string">&quot;true&quot;</span>/&gt;  <span class="comment">#修改此行为true,使用远程shell方式的rsync连接方式，无需在目标主机上配置启动rsync daemon服务</span></span><br><span class="line"> 		</span><br><span class="line"> 		</span><br><span class="line"><span class="comment">#####################################以下行不需要修改</span></span><br><span class="line"><span class="comment">####################################</span></span><br><span class="line">    &lt;/rsync&gt;</span><br><span class="line"></span><br><span class="line">    &lt;failLog path=<span class="string">&quot;/tmp/rsync_fail_log.sh&quot;</span> timeToExecute=<span class="string">&quot;60&quot;</span>/&gt;&lt;!--default every 60mins execute once--&gt;</span><br><span class="line">    &lt;crontab start=<span class="string">&quot;false&quot;</span> schedule=<span class="string">&quot;600&quot;</span>&gt;&lt;!--600mins--&gt;</span><br><span class="line"> 		&lt;crontabfilter start=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;*.php&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;info/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line"> 		&lt;/crontabfilter&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/crontab&gt;</span><br><span class="line"></span><br><span class="line">    &lt;plugin start=<span class="string">&quot;false&quot;</span> name=<span class="string">&quot;command&quot;</span>/&gt;</span><br><span class="line"> 	&lt;/sersync&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#中间的行可以删除</span></span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">[root@data-centos8 ~]#sersync2 -dro /usr/local/sersync/confxml.xml</span><br><span class="line"><span class="built_in">set</span> the system param</span><br><span class="line">execute：<span class="built_in">echo</span> 50000000 &gt; /proc/sys/fs/inotify/max_user_watches</span><br><span class="line">execute：<span class="built_in">echo</span> 327679 &gt; /proc/sys/fs/inotify/max_queued_events</span><br><span class="line">parse the <span class="built_in">command</span> param</span><br><span class="line">option: -d run as a daemon</span><br><span class="line">option: -r rsync all the <span class="built_in">local</span> files to the remote servers before the sersync</span><br><span class="line">work</span><br><span class="line">option: -o config xml name： /apps/sersync/confxml.xml</span><br><span class="line">daemon thread num: 10</span><br><span class="line">parse xml config file</span><br><span class="line">host ip : localhost host port: 8008</span><br><span class="line">daemon start，sersync run behind the console</span><br><span class="line">config xml parse success</span><br><span class="line">please <span class="built_in">set</span> /etc/rsyncd.conf max connections=0 Manually</span><br><span class="line">sersync working thread 12  = 1(primary thread) + 1(fail retry thread) +</span><br><span class="line">10(daemon sub threads)</span><br><span class="line">Max threads numbers is: 22 = 12(Thread pool nums) + 10(Sub threads)</span><br><span class="line">please according your cpu ，use -n param to adjust the cpu rate</span><br><span class="line">------------------------------------------</span><br><span class="line">rsync the directory recursivly to the remote servers once</span><br><span class="line">working please <span class="built_in">wait</span>...</span><br><span class="line">execute <span class="built_in">command</span>: <span class="built_in">cd</span> /data/www &amp;&amp; rsync -auz -R --delete ./  -e ssh</span><br><span class="line">10.0.0.18:/data/backup &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">run the sersync:</span><br><span class="line">watch path is: /data/www</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://AquaPluto.github.io">Aquarius</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://aquapluto.github.io/Linux/service-manage/data-synchronization/">https://aquapluto.github.io/Linux/service-manage/data-synchronization/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://AquaPluto.github.io" target="_blank">代码推演录</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/">服务管理</a></div><div class="post-share"><div class="social-share" data-image="/img/paper4.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://unpkg.com/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://unpkg.com/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/Linux/system-optimization/" title="系统优化"><img class="cover" src="/img/paper1.jpg" onerror="onerror=null;src='/img/error-page.png'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">系统优化</div></div><div class="info-2"><div class="info-item-1">1 文件描述符和进程系统正在经历着...</div></div></div></a><a class="pagination-related" href="/Storage/conspect/" title="存储概论"><img class="cover" src="/img/paper6.png" onerror="onerror=null;src='/img/error-page.png'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">存储概论</div></div><div class="info-2"><div class="info-item-1">1 存储类型IT 基础设施有三个主...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/Linux/service-manage/mail/" title="邮件服务"><img class="cover" src="/img/paper6.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">邮件服务</div></div><div class="info-2"><div class="info-item-1">1 邮件协议邮件服务的运作基于多个...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/DNS/" title="域名DNS解析服务"><img class="cover" src="/img/paper1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">域名DNS解析服务</div></div><div class="info-2"><div class="info-item-1">一、DNS服务相关技术linux上...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/plan-tasks/" title="计划任务"><img class="cover" src="/img/paper5.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">计划任务</div></div><div class="info-2"><div class="info-item-1">1 一次性任务at 工具  由包 ...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/time-synchronization/" title="时间同步服务"><img class="cover" src="/img/paper2.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">时间同步服务</div></div><div class="info-2"><div class="info-item-1">1 前言加密和安全当前都离不开时间...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/log/" title="日志服务"><img class="cover" src="/img/paper3.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">日志服务</div></div><div class="info-2"><div class="info-item-1">1 系统日志管理1.1 系统日志介...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/ssh/" title="ssh远程连接服务"><img class="cover" src="/img/paper4.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-21</div><div class="info-item-2">ssh远程连接服务</div></div><div class="info-2"><div class="info-item-1">1 ssh服务介绍ssh: sec...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avator.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Aquarius</div><div class="author-info-description">分享运维开发相关技术</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">138</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" href="https://github.com/AquaPluto"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/AquaPluto" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://blog.csdn.net/m0_75233142" target="_blank" title="CSDN"><i class="fa-solid fa-code" style="color: #8a2be2;"></i></a><a class="social-icon" href="mailto:wujunlinq@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content"><p>持续更新文章中，有问题请添加wx</p>
<div>
  <img src="/img/wx.jpg" alt="wx" style="width: 100px">
</div>
</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E6%96%B9%E5%BC%8F"><span class="toc-text">1 数据的实时同步方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%AE%9E%E7%8E%B0%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-text">2 实现实时同步的方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-inotify-rsync"><span class="toc-text">2.1 inotify+rsync</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-inotify%E6%9C%8D%E5%8A%A1"><span class="toc-text">2.1.1 inotify服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-inotify-tools%E5%B7%A5%E5%85%B7"><span class="toc-text">2.1.2 inotify-tools工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-3-rsync%E6%9C%8D%E5%8A%A1"><span class="toc-text">2.1.3 rsync服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-1-rsync%E5%91%BD%E4%BB%A4"><span class="toc-text">2.1.3.1 rsync命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-2-%E5%AE%9E%E7%8E%B0-rsync-daemon-%E6%9C%8D%E5%8A%A1"><span class="toc-text">2.1.3.2 实现 rsync daemon 服务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-4-inotify-rsync%E9%80%9A%E8%BF%87%E8%84%9A%E6%9C%AC%E5%AE%9E%E7%8E%B0%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5"><span class="toc-text">2.1.4 inotify+rsync通过脚本实现实时数据同步</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-sersync-rsync"><span class="toc-text">2.2 sersync+rsync</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-1-sersync-%E4%BB%8B%E7%BB%8D"><span class="toc-text">3.4.1 sersync 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-2-%E9%83%A8%E7%BD%B2sersync"><span class="toc-text">3.4.2 部署sersync</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-3-%E5%9F%BA%E4%BA%8Ersync-daemon%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5"><span class="toc-text">3.4.3 基于rsync daemon实现数据同步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-3-%E5%9F%BA%E4%BA%8E%E8%BF%9C%E7%A8%8Bssh%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5"><span class="toc-text">3.4.3 基于远程ssh实现数据同步</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/role/" title="Role角色"><img src="/img/paper3.png" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="Role角色"/></a><div class="content"><a class="title" href="/CICD/ansible/role/" title="Role角色">Role角色</a><time datetime="2025-09-13T10:07:53.000Z" title="发表于 2025-09-13 18:07">2025-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/playbook/" title="PlayBook"><img src="/img/paper2.jpg" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="PlayBook"/></a><div class="content"><a class="title" href="/CICD/ansible/playbook/" title="PlayBook">PlayBook</a><time datetime="2025-09-13T10:07:48.000Z" title="发表于 2025-09-13 18:07">2025-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/module/" title="常用模块"><img src="/img/paper4.png" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="常用模块"/></a><div class="content"><a class="title" href="/CICD/ansible/module/" title="常用模块">常用模块</a><time datetime="2025-09-13T10:07:42.000Z" title="发表于 2025-09-13 18:07">2025-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/command/" title="相关命令"><img src="/img/paper6.png" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="相关命令"/></a><div class="content"><a class="title" href="/CICD/ansible/command/" title="相关命令">相关命令</a><time datetime="2025-09-13T10:07:38.000Z" title="发表于 2025-09-13 18:07">2025-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/deploy/" title="部署与配置"><img src="/img/paper1.jpg" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="部署与配置"/></a><div class="content"><a class="title" href="/CICD/ansible/deploy/" title="部署与配置">部署与配置</a><time datetime="2025-09-13T10:07:29.000Z" title="发表于 2025-09-13 18:07">2025-09-13</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Aquarius</span></div><div class="footer_custom_text"><style>
div#runtime {
  font-size: 13px;
  font-weight: bold;
}

div#ghbdages_list {
  height: 1.5rem;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 10px
}

.github-badge {
  display: flex;
  align-items: center;
  margin-inline: 6px;
}
</style>
<div id="runtime"></div>
<div id="ghbdages"></div>
<script>
  function createtime() {
    const now = new Date();
    const grt = new Date("08/01/2025 00:00:00"); // 网站诞生时间

    // 计算天、小时、分钟和秒
    const days = Math.floor((now - grt) / (1000 * 60 * 60 * 24));
    const hours = Math.floor(((now - grt) / (1000 * 60 * 60)) % 24)
      .toString()
      .padStart(2, "0");
    const minutes = Math.floor(((now - grt) / (1000 * 60)) % 60)
      .toString()
      .padStart(2, "0");
    const seconds = Math.floor(((now - grt) / 1000) % 60)
      .toString()
      .padStart(2, "0");

    // HTML 输出
    const currentTimeHtml = `
          <div>
              本站已运行 ${days} 天 ${hours} 小时 ${minutes} 分 ${seconds} 秒 
          </div>`;

    const runtime = document.getElementById("runtime");
    if (runtime) runtime.innerHTML = currentTimeHtml;
  }

  // 设置每秒调用函数
  setInterval(createtime, 1000);

  function renderBadge() {
    const currentTimeHtml = `
      <div id="ghbdages_list">
          <a class="github-badge" target="_blank" href="https://hexo.io/" title="hexo:7.3.0">
              <img src="https://img.shields.io/badge/Frame-Hexo-blue?logo=hexo" alt="Static Badge">
          </a>
          <a class="github-badge" target="_blank" href="https://github.com/" title="github">
              <img src="https://img.shields.io/badge/Code-GitHub-181717?logo=GitHub&color=%23FF7102" alt="Static Badge">
          </a>
          <a class="github-badge" target="_blank" href="https://vercel.com/" title="vercel">
              <img src="https://img.shields.io/badge/Host-Vercel-%23F0D722?logo=Vercel" alt="Static Badge">
          </a>
          <a class="github-badge" target="_blank" href="https://analytics.sysio.ai/" title="umami">
              <img src="https://img.shields.io/badge/Analytics-Umami-%237FB100?logo=umami&logoColor=%237FB100" alt="Static Badge">
          </a>
      </div>`;

    const ghbdages = document.getElementById("ghbdages");
    if (ghbdages) {
      ghbdages.innerHTML = currentTimeHtml;
    }
  }

  window.onload = renderBadge;
</script>
</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://unpkg.com/@fancyapps/ui/dist/fancybox/fancybox.umd.js"></script><script src="https://unpkg.com/instant.page/instantpage.js" type="module"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = 'https://unpkg.com/mathjax/es5/tex-mml-chtml.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'forest'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://unpkg.com/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script src="https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fishes.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://unpkg.com/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章..." type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>