<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>文件共享服务 | 代码推演录</title><meta name="author" content="Aquarius"><meta name="copyright" content="Aquarius"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="1 存储介绍IT 基础设施有三个主要组成，分别是 计算，存储，网络  存储类型分为三种  直连式存储：Direct-Attached Storage，简称 DAS（本地存储）  存储区域网络：Storage Area Network，简称 SAN（远程存储，块，共享空间给远程用户，用户独占，可以分区，创建文件系统，挂载）  网络附加存储：Network-Attached Storage，简称 NA">
<meta property="og:type" content="article">
<meta property="og:title" content="文件共享服务">
<meta property="og:url" content="https://aquapluto.github.io/Linux/service-manage/file-share/">
<meta property="og:site_name" content="代码推演录">
<meta property="og:description" content="1 存储介绍IT 基础设施有三个主要组成，分别是 计算，存储，网络  存储类型分为三种  直连式存储：Direct-Attached Storage，简称 DAS（本地存储）  存储区域网络：Storage Area Network，简称 SAN（远程存储，块，共享空间给远程用户，用户独占，可以分区，创建文件系统，挂载）  网络附加存储：Network-Attached Storage，简称 NA">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://aquapluto.github.io/img/paper6.png">
<meta property="article:published_time" content="2025-08-20T08:52:20.000Z">
<meta property="article:modified_time" content="2025-08-28T12:33:05.336Z">
<meta property="article:author" content="Aquarius">
<meta property="article:tag" content="服务管理">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://aquapluto.github.io/img/paper6.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "文件共享服务",
  "url": "https://aquapluto.github.io/Linux/service-manage/file-share/",
  "image": "https://aquapluto.github.io/img/paper6.png",
  "datePublished": "2025-08-20T08:52:20.000Z",
  "dateModified": "2025-08-28T12:33:05.336Z",
  "author": [
    {
      "@type": "Person",
      "name": "Aquarius",
      "url": "https://AquaPluto.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://aquapluto.github.io/Linux/service-manage/file-share/"><link rel="preconnect" href="//unpkg.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://unpkg.com/@fancyapps/ui/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":true,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://unpkg.com/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '文件共享服务',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/wave.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(/img/background.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avator.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">78</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><div class="menus_items"><!-- 一级菜单项（非目录）--><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>计算机基础</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>计算机组成原理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/computer-composition/hardware-composition/"><span>计算机硬件组成</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/computer-composition/CPU/"><span>CPU</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/computer-composition/memory/"><span>内存</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/computer-composition/hard-disk/"><span>硬盘</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>操作系统</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/operating-system/concept/"><span>操作系统的概念</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/operating-system/processes-threads/"><span>进程与线程</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/operating-system/IO-model/"><span>IO模型</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>计算机网络</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/network/network-layer/"><span>网络层</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/network/transport-layer/"><span>传输层</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/network/application-layer/"><span>应用层</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/network/network-architecture/"><span>物理网络架构全链路</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Linux</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>linux基础</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/linux-basics/introduce/"><span>linux介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/linux-basics/file-structure-and-IO-redirects/"><span>文件结构与IO重定向</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/linux-basics/file-command/"><span>文件管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/linux-basics/text-command/"><span>文本管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/linux-basics/GSA/"><span>文本处理三剑客</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/linux-basics/user-permission/"><span>用户和权限管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/linux-basics/regular-expression/"><span>正则表达式</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>软件包管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/software-manage/introduce/"><span>软件包介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/software-manage/Centos/"><span>Centos软件管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/software-manage/Ubuntu/"><span>Ubuntu软件管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/software-manage/source-code-compilation/"><span>源码编译安装</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>进程管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/performance-analysis/"><span>性能分析命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/command/"><span>进程管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/signal/"><span>信号发送</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/job-parallel/"><span>作业管理与并行运行</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>磁盘管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/disk-partition/"><span>磁盘分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/file-system/"><span>文件系统</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/disk-command/"><span>磁盘管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/LVM/"><span>逻辑卷管理器LVM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>网络管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/configuration/"><span>网络配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/configuration-command/"><span>网络配置命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/test-diagnostic/"><span>网络测试诊断工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/bridge/"><span>网桥配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/troubleshoot/"><span>网络问题排查</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/DNS/"><span>域名DNS解析服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/time-synchronization/"><span>时间同步服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/plan-tasks/"><span>计划任务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/log/"><span>日志服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/file-share/"><span>文件共享服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/ssh/"><span>ssh远程连接服务</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>防火墙</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/introduce/"><span>安全技术和防火墙</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/iptables/"><span>iptables</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/firewalld/"><span>firewalld</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/nft/"><span>nft</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>加密和安全</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/security-mechanisms/"><span>安全机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/OpenSSL/"><span>OpenSSL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/sudo/"><span>sudo实现授权</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/PAM/"><span>PAM认证机制</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>shell编程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/introduce/"><span>shell脚本介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/variable/"><span>变量</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/operations-conditional/"><span>运算和条件测试</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-control/"><span>流程控制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/function/"><span>函数</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/array/"><span>数组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/string/"><span>字符串</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/script-tools/"><span>脚本相关工具</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/system-optimization/"><span>系统优化</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>数据库</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>MySQL</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/MySQL/SQL%E8%AF%AD%E5%8F%A5/"><span>SQL语句</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Redis</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Redis/Redis%E5%AE%89%E8%A3%85/"><span>Redis安装</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>中间件</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Nginx</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Nginx/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>HAProxy</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/HAProxy/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Keepalived</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Keepalived/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kafka</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kafka/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Tomcat</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kafka/111/"><span>111</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>日志</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>容器</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/container/basics/"><span>容器基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Docker</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/container/docker/"><span>概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/docker/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/docker/"><span>镜像管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/docker/"><span>容器管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/docker/"><span>数据卷</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/docker/"><span>网络模式</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/docker/"><span>docker compose</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>构建镜像</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/container/mirror/"><span>概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/mirror/"><span>dockerfile</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/mirror/"><span>docker build构建镜像</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/mirror/"><span>分布式镜像仓库Harbor</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>容器进程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/container/process/"><span>容器里的进程管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/process/"><span>cpu cgroup使用</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/process/"><span>监控容器真实的cpu使用率</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/process/"><span>不可中断睡眠对容器的影响</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/container/memory/"><span>容器内存</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/container/storage/"><span>容器存储</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/container/network/"><span>容器网络</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/container/safe/"><span>容器安全</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/container/containerd/"><span>containerd</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Kubernetes</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/kubernetes/conspect/"><span>概论</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/kubernetes/deploy/"><span>部署安装</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/kubernetes/pod/"><span>Pod</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/kubernetes/controller/"><span>控制器</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/kubernetes/service-loadbalancer/"><span>服务发现与负载均衡</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/kubernetes/data-storage/"><span>数据存储持久化</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/kubernetes/certification-authentication/"><span>认证与鉴权体系</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/kubernetes/network/"><span>网络</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/kubernetes/helm/"><span>Helm</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/kubernetes/monitor/"><span>监控</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>监控</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/monitor/conspect/"><span>监控概论</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Prometheus</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/prometheus/introduce/"><span>概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/prometheus/deploy/"><span>部署安装</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/prometheus/exporter/"><span>Exporter</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/prometheus/promql/"><span>PromQL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/prometheus/query-results-persist/"><span>查询结果持久化</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/prometheus/service-discovery/"><span>服务发现</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/prometheus/indicators-re-marked/"><span>指标重新打标</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Alertmanager</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/alertmanager/introduce/"><span>告警功能概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/alertmanager/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/alertmanager/alarm/"><span>实现告警功能</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Grafana</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/grafana/deploy/"><span>部署安装</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/grafana/data-source/"><span>配置数据源</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/grafana/charts/"><span>自定义图表</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>CICD</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Ansible</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/introduce/"><span>架构概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/command/"><span>相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/module/"><span>常用模块</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/playbook/"><span>PlayBook</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/role/"><span>Role角色</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>SRE</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/SRE/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Python</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>python基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>线性表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>列表</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>元组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字符串</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>哈希表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>封装与解构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>集合</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字典</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>解析式与生成器表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>函数</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>IO操作</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>面向对象编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>并发编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>网络编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>数据库编程</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Django</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/paper6.png);"><nav id="nav"><!-- 左侧博客信息区域--><span id="blog-info"><a class="nav-site-title" href="/"></a><a class="nav-page-title" href="/"><span class="site-name">文件共享服务</span></a></span><!-- 新增的导航菜单容器（居中布局关键）--><div id="nav-menus-container"><!-- 菜单主体部分--><div id="menus"><!-- 菜单项--><div class="menus_items"><!-- 一级菜单项（非目录）--><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>计算机基础</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>计算机组成原理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/computer-composition/hardware-composition/"><span>计算机硬件组成</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/computer-composition/CPU/"><span>CPU</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/computer-composition/memory/"><span>内存</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/computer-composition/hard-disk/"><span>硬盘</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>操作系统</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/operating-system/concept/"><span>操作系统的概念</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/operating-system/processes-threads/"><span>进程与线程</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/operating-system/IO-model/"><span>IO模型</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>计算机网络</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/network/network-layer/"><span>网络层</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/network/transport-layer/"><span>传输层</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/network/application-layer/"><span>应用层</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/computer-basics/network/network-architecture/"><span>物理网络架构全链路</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Linux</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>linux基础</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/linux-basics/introduce/"><span>linux介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/linux-basics/file-structure-and-IO-redirects/"><span>文件结构与IO重定向</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/linux-basics/file-command/"><span>文件管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/linux-basics/text-command/"><span>文本管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/linux-basics/GSA/"><span>文本处理三剑客</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/linux-basics/user-permission/"><span>用户和权限管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/linux-basics/regular-expression/"><span>正则表达式</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>软件包管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/software-manage/introduce/"><span>软件包介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/software-manage/Centos/"><span>Centos软件管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/software-manage/Ubuntu/"><span>Ubuntu软件管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/software-manage/source-code-compilation/"><span>源码编译安装</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>进程管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/performance-analysis/"><span>性能分析命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/command/"><span>进程管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/signal/"><span>信号发送</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/job-parallel/"><span>作业管理与并行运行</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>磁盘管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/disk-partition/"><span>磁盘分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/file-system/"><span>文件系统</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/disk-command/"><span>磁盘管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/LVM/"><span>逻辑卷管理器LVM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>网络管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/configuration/"><span>网络配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/configuration-command/"><span>网络配置命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/test-diagnostic/"><span>网络测试诊断工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/bridge/"><span>网桥配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/troubleshoot/"><span>网络问题排查</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/DNS/"><span>域名DNS解析服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/time-synchronization/"><span>时间同步服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/plan-tasks/"><span>计划任务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/log/"><span>日志服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/file-share/"><span>文件共享服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/ssh/"><span>ssh远程连接服务</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>防火墙</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/introduce/"><span>安全技术和防火墙</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/iptables/"><span>iptables</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/firewalld/"><span>firewalld</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/nft/"><span>nft</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>加密和安全</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/security-mechanisms/"><span>安全机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/OpenSSL/"><span>OpenSSL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/sudo/"><span>sudo实现授权</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/PAM/"><span>PAM认证机制</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>shell编程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/introduce/"><span>shell脚本介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/variable/"><span>变量</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/operations-conditional/"><span>运算和条件测试</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-control/"><span>流程控制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/function/"><span>函数</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/array/"><span>数组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/string/"><span>字符串</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/script-tools/"><span>脚本相关工具</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/system-optimization/"><span>系统优化</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>数据库</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>MySQL</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/MySQL/SQL%E8%AF%AD%E5%8F%A5/"><span>SQL语句</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Redis</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Redis/Redis%E5%AE%89%E8%A3%85/"><span>Redis安装</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>中间件</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Nginx</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Nginx/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>HAProxy</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/HAProxy/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Keepalived</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Keepalived/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kafka</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kafka/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Tomcat</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kafka/111/"><span>111</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>日志</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>容器</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/container/basics/"><span>容器基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Docker</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/container/docker/"><span>概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/docker/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/docker/"><span>镜像管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/docker/"><span>容器管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/docker/"><span>数据卷</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/docker/"><span>网络模式</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/docker/"><span>docker compose</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>构建镜像</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/container/mirror/"><span>概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/mirror/"><span>dockerfile</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/mirror/"><span>docker build构建镜像</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/mirror/"><span>分布式镜像仓库Harbor</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>容器进程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/container/process/"><span>容器里的进程管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/process/"><span>cpu cgroup使用</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/process/"><span>监控容器真实的cpu使用率</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/container/process/"><span>不可中断睡眠对容器的影响</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/container/memory/"><span>容器内存</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/container/storage/"><span>容器存储</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/container/network/"><span>容器网络</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/container/safe/"><span>容器安全</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/container/containerd/"><span>containerd</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Kubernetes</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/kubernetes/conspect/"><span>概论</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/kubernetes/deploy/"><span>部署安装</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/kubernetes/pod/"><span>Pod</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/kubernetes/controller/"><span>控制器</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/kubernetes/service-loadbalancer/"><span>服务发现与负载均衡</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/kubernetes/data-storage/"><span>数据存储持久化</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/kubernetes/certification-authentication/"><span>认证与鉴权体系</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/kubernetes/network/"><span>网络</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/kubernetes/helm/"><span>Helm</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/kubernetes/monitor/"><span>监控</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>监控</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/monitor/conspect/"><span>监控概论</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Prometheus</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/prometheus/introduce/"><span>概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/prometheus/deploy/"><span>部署安装</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/prometheus/exporter/"><span>Exporter</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/prometheus/promql/"><span>PromQL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/prometheus/query-results-persist/"><span>查询结果持久化</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/prometheus/service-discovery/"><span>服务发现</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/prometheus/indicators-re-marked/"><span>指标重新打标</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Alertmanager</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/alertmanager/introduce/"><span>告警功能概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/alertmanager/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/alertmanager/alarm/"><span>实现告警功能</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Grafana</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/grafana/deploy/"><span>部署安装</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/grafana/data-source/"><span>配置数据源</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/monitor/grafana/charts/"><span>自定义图表</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>CICD</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Ansible</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/introduce/"><span>架构概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/command/"><span>相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/module/"><span>常用模块</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/playbook/"><span>PlayBook</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/role/"><span>Role角色</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>SRE</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/SRE/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Python</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>python基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>线性表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>列表</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>元组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字符串</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>哈希表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>封装与解构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>集合</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字典</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>解析式与生成器表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>函数</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>IO操作</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>面向对象编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>并发编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>网络编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>数据库编程</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Django</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div></div></div></div><!-- 右侧功能区域（新增容器）--><div id="nav-right-container"><!-- 搜索按钮（移动到右侧）--><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i></span></div><!-- 移动端汉堡菜单按钮--><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">文件共享服务</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-08-20T08:52:20.000Z" title="发表于 2025-08-20 16:52">2025-08-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-08-28T12:33:05.336Z" title="更新于 2025-08-28 20:33">2025-08-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/">Linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">15.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>70分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="1-存储介绍"><a href="#1-存储介绍" class="headerlink" title="1 存储介绍"></a>1 存储介绍</h1><p>IT 基础设施有三个主要组成，分别是 计算，存储，网络</p>
<p><img src="/Linux/service-manage/file-share/1753757618712-6d98e327-b1b9-44ae-a6d5-bd54abafd153.png" alt="null"></p>
<p>存储类型分为三种</p>
<ul>
<li><p>直连式存储：Direct-Attached Storage，简称 DAS（本地存储）</p>
</li>
<li><p>存储区域网络：Storage Area Network，简称 SAN（远程存储，块，共享空间给远程用户，用户独占，可以分区，创建文件系统，挂载）</p>
</li>
<li><p>网络附加存储：Network-Attached Storage，简称 NAS（远程存储，文件，共享目录文件）</p>
</li>
</ul>
<h2 id="1-1-三种存储比较"><a href="#1-1-三种存储比较" class="headerlink" title="1.1 三种存储比较"></a>1.1 三种存储比较</h2><p>SAN与NAS的主要区别体现在文件系统所在的位置</p>
<p><img src="/Linux/service-manage/file-share/1753757618862-e1e84a36-fd0f-4bc3-8cfb-28cf394d4b06-17556838846742.png" alt="null"></p>
<p>三种存储架构的应用场景</p>
<ul>
<li><p>DAS虽然比较古老了，但是还是很适用于那些数据量不大，对磁盘访问速度要求较高的中小企业</p>
</li>
<li><p>NAS多适用于文件服务器，用来存储非结构化数据，虽然受限于以太网的速度，但是部署灵活，成本低</p>
</li>
<li><p>SAN则适用于大型应用或数据库系统，缺点是成本高、较为复杂</p>
</li>
</ul>
<h2 id="1-2-常见存储方式"><a href="#1-2-常见存储方式" class="headerlink" title="1.2 常见存储方式"></a>1.2 常见存储方式</h2><p><strong>块存储</strong>：像硬盘，高性能，挂载后用。</p>
<p><strong>文件存储</strong>：像U盘&#x2F;网盘，有目录，直接读写文件，可共享。</p>
<p><strong>对象存储</strong>：像网盘（如OSS&#x2F;S3），通过URL操作，无目录层级，适合大文件。</p>
<p><strong>分布式存储</strong>：底层整合多台机器，可统一提供以上三种服务。</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>核心特点</th>
<th>访问方式</th>
<th>优点</th>
<th>缺点</th>
<th>典型应用</th>
</tr>
</thead>
<tbody><tr>
<td><strong>块存储</strong></td>
<td>原始“磁盘”，需格式化 + 挂载</td>
<td>通过设备（如 <code>/dev/sdb</code>）访问</td>
<td>⚡ 读写快、低延迟</td>
<td>❌ 不易扩展、难共享</td>
<td>虚拟机磁盘、数据库</td>
</tr>
<tr>
<td><strong>文件存储</strong></td>
<td>层次化目录结构（如文件夹）</td>
<td>标准文件接口（<code>open/read/write</code>）</td>
<td>✅ 易共享、易管理、POSIX 兼容</td>
<td>🐢 速度较慢</td>
<td>NAS、共享文件夹、Web 静态资源</td>
</tr>
<tr>
<td><strong>对象存储</strong></td>
<td>扁平结构，唯一 ID 标识对象</td>
<td>RESTful API &#x2F; SDK（如 S3）</td>
<td>☁️ 海量扩展、高可用、支持元数据</td>
<td>🔒 不支持随机读写、只能全量操作</td>
<td>图片&#x2F;视频存储、备份归档、云存储</td>
</tr>
<tr>
<td><strong>分布式存储</strong></td>
<td>多节点协同，统一资源池</td>
<td>可提供块、文件、对象三种接口</td>
<td>🌐 高扩展、高性能、高可靠</td>
<td>⚙️ 架构复杂</td>
<td>云平台、大数据、AI 训练</td>
</tr>
</tbody></table>
<h1 id="2-NFS-服务"><a href="#2-NFS-服务" class="headerlink" title="2 NFS 服务"></a>2 NFS 服务</h1><h2 id="2-1-NFS工作原理"><a href="#2-1-NFS工作原理" class="headerlink" title="2.1 NFS工作原理"></a>2.1 NFS工作原理</h2><p><img src="/Linux/service-manage/file-share/1753757618938-d9f6204f-b197-48fc-8002-a6c166fb43ef-17556838846746.png" alt="null"></p>
<p>NFS：Network File System 网络文件系统，基于内核的文件系统。Sun 公司开发，通过使用 NFS，用户和程序可以像访问本地文件一样访问远端系统上的文件，NFS 是内核里的功能，基于RPC（Remote Procedure CallProtocol 远程过程调用）实现</p>
<p>RPC采用C&#x2F;S模式，客户机请求程序调用进程发送一个有进程参数的调用信息到服务进程，然后等待应答信息。在服务器端，进程保持睡眠状态直到调用信息到达为止。当一个调用信息到达，服务器获得进程参数，计算结果，发送答复信息，然后等待下一个调用信息，最后，客户端调用进程接收答复信息，获得进程结果，然后调用执行继续进行</p>
<p>注册中心：假设Aserver对外提供web服务，它的地址通过容器的方法实现，地址自动分配，不固定，用户想访问没办法直接访问，所以Aserver启动后，就会把地址向注册中心进行注册，用户就可以向注册中心寻找自己想要的服务查找IP地址</p>
<p><img src="/Linux/service-manage/file-share/1753757619043-bfa486f3-2fd7-4ecf-af1d-c7e8e654b97b-17556838846745.png" alt="null"></p>
<p>因为NFS的端口不固定，启动NFS服务时就会将端口号向RPC服务注册，RPC服务的端口号是固定的，111，用户想访问NFS服务就去访问111端口RPC服务，询问NFS的端口号，拿到NFS的端口号就可以去访问NFS了</p>
<p>NFS优势：节省本地存储空间，将常用的数据,如：&#x2F;home目录，存放在NFS服务器上且可以通过网络访问，本地终端将可减少自身存储空间的使用</p>
<p>简单例子</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A的/data/通过NFS共享出来</span><br><span class="line">B将A的/data/挂载到/tmp，在/tmp写数据实际上是写到了/data/，并且A也写数据到/data/，这样子B以后想访问/data/直接访问/tmp，不用到A机器去访问</span><br></pre></td></tr></table></figure>

<h2 id="2-2-NFS软件介绍"><a href="#2-2-NFS软件介绍" class="headerlink" title="2.2 NFS软件介绍"></a>2.2 NFS软件介绍</h2><p>软件包：</p>
<ul>
<li><p>红帽系统: nfs-utils: 包括服务器和客户端相关工具，CentOS8 最小化安装时默认没有安装</p>
</li>
<li><p>Ubuntu: nfs-server（nfs-kernel-server） 服务器包名，nfs-common 客户端包名</p>
</li>
</ul>
<p>相关软件包：rpcbind（必须），tcp_wrappers</p>
<p>Kernel支持：nfs.ko</p>
<p>端口：2049(nfsd),，其它端口由portmap(111)分配</p>
<p>NFS服务主要进程：</p>
<ul>
<li><p>rpc.nfsd：最主要的NFS进程，管理客户端是否可登录</p>
</li>
<li><p>rpc.mountd：挂载和卸载NFS文件系统，包括权限管理</p>
</li>
<li><p>rpc.lockd：非必要，管理文件锁，避免同时写出错</p>
</li>
<li><p>rpc.statd：非必要，检查文件一致性，可修复文件</p>
</li>
</ul>
<p>说明：CentOS 6 开始portmap进程由rpcbind代替</p>
<p>日志：&#x2F;var&#x2F;lib&#x2F;nfs&#x2F;</p>
<p>比较NFS和其他服务的端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tcp/ip</span><br><span class="line">tcp/udp</span><br><span class="line">mysql 3306/tcp</span><br><span class="line">dns   53/tcp/udp</span><br><span class="line">http  80/tcp</span><br><span class="line">ftp   21, 20（主动）</span><br><span class="line">samba 445/tcp139/tcp 137,138/udp</span><br><span class="line">NFS   固定和不固定，这时候需要用到注册中心</span><br></pre></td></tr></table></figure>

<p>NFS配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/exports				<span class="comment">#共享规则配置</span></span><br><span class="line">/etc/exports.d/*.exports	<span class="comment">#按业务创建规则，后缀必须为exports</span></span><br></pre></td></tr></table></figure>

<p>NFS 基于 C&#x2F;S 模式实现，所以有客户端软件和服务端软件</p>
<p>范例：红帽系统安装NFS软件包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]#yum -y install nfs-utils</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看支持的NFS版本,注意:只有服务启动才能看此文件</span></span><br><span class="line">[root@centos8 ~]#<span class="built_in">cat</span> /proc/fs/nfsd/versions</span><br><span class="line">-2 +3 +4 +4.1 +4.2</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#systemctl <span class="built_in">enable</span> --now nfs-server.service</span><br></pre></td></tr></table></figure>

<p>范例：Ubuntu 安装NFS软件包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务器</span></span><br><span class="line">[root@ubuntu2004 ~]#apt update &amp;&amp; apt -y install nfs-kernel-server</span><br><span class="line">[root@ubuntu2004 ~]#systemctl status nfs-server</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看支持的NFS版本,注意:只有服务启动才能看此文件</span></span><br><span class="line">[root@ubuntu2004 ~]#<span class="built_in">cat</span> /proc/fs/nfsd/versions</span><br><span class="line">-2 +3 +4 +4.1 +4.2</span><br><span class="line"></span><br><span class="line"><span class="comment">#客户端</span></span><br><span class="line">[root@ubuntu2004 ~]#apt -y install nfs-common</span><br></pre></td></tr></table></figure>

<p>服务端依赖包，注册中心，nfs 服务中有大量的组件，部份组件端口并不固定，需要依赖rpcbind发布端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# dpkg -l rpcbind</span><br><span class="line">Desired=Unknown/Install/Remove/Purge/Hold</span><br><span class="line">| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend</span><br><span class="line">|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)</span><br><span class="line">||/ Name      Version    Architecture Description</span><br><span class="line">+++-==============-=============-============-</span><br><span class="line">=====================================================</span><br><span class="line">ii rpcbind     1.2.6-2build1 amd64    converts RPC program numbers into universal addresses</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看服务端端口</span></span><br><span class="line">[root@ubuntu ~]# ss -tunlp | grep rpc</span><br><span class="line">udp UNCONN 0  0   127.0.0.1:603   0.0.0.0:* <span class="built_in">users</span>:((&quot;rpc.statd&quot;,pid=<span class="number">14843</span>,fd=<span class="number">5</span>))</span><br><span class="line">udp UNCONN 0  0    0.0.0.0:38632  0.0.0.0:* <span class="built_in">users</span>:((&quot;rpc.statd&quot;,pid=<span class="number">14843</span>,fd=<span class="number">8</span>))</span><br><span class="line">udp UNCONN 0  0    0.0.0.0:58332  0.0.0.0:* <span class="built_in">users</span>:((&quot;rpc.mountd&quot;,pid=<span class="number">15464</span>,fd=<span class="number">4</span>))</span><br><span class="line">udp UNCONN 0  0    0.0.0.0:54239  0.0.0.0:* <span class="built_in">users</span>:((&quot;rpc.mountd&quot;,pid=<span class="number">15464</span>,fd=<span class="number">12</span>))</span><br><span class="line">udp UNCONN 0  0    0.0.0.0:48141  0.0.0.0:* <span class="built_in">users</span>:((&quot;rpc.mountd&quot;,pid=<span class="number">15464</span>,fd=<span class="number">8</span>))</span><br><span class="line">udp UNCONN 0  0    0.0.0.0:111    0.0.0.0:* <span class="built_in">users</span>:((&quot;rpcbind&quot;,pid=<span class="number">14257</span>,fd=<span class="number">5</span>),(&quot;systemd&quot;,pid=<span class="number">1</span>,fd=<span class="number">138</span>))</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">[root@ubuntu ~]# systemctl restart nfs-server.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#再次查看端口，端口发生了变化</span></span><br><span class="line">[root@ubuntu ~]# ss -tunlp | grep rpc</span><br><span class="line">udp UNCONN 0  0    0.0.0.0:36333  0.0.0.0:* <span class="built_in">users</span>:((&quot;rpc.mountd&quot;,pid=<span class="number">15507</span>,fd=<span class="number">12</span>))</span><br><span class="line">udp UNCONN 0  0   127.0.0.1:603   0.0.0.0:* <span class="built_in">users</span>:((&quot;rpc.statd&quot;,pid=<span class="number">14843</span>,fd=<span class="number">5</span>))</span><br><span class="line">udp UNCONN 0  0    0.0.0.0:38632  0.0.0.0:* <span class="built_in">users</span>:((&quot;rpc.statd&quot;,pid=<span class="number">14843</span>,fd=<span class="number">8</span>))</span><br><span class="line">udp UNCONN 0  0    0.0.0.0:111    0.0.0.0:* <span class="built_in">users</span>:((&quot;rpcbind&quot;,pid=<span class="number">14257</span>,fd=<span class="number">5</span>),(&quot;systemd&quot;,pid=<span class="number">1</span>,fd=<span class="number">138</span>))</span><br><span class="line">udp UNCONN 0  0    0.0.0.0:48272  0.0.0.0:* <span class="built_in">users</span>:((&quot;rpc.mountd&quot;,pid=<span class="number">15507</span>,fd=<span class="number">4</span>))</span><br><span class="line">udp UNCONN 0  0    0.0.0.0:38052  0.0.0.0:* <span class="built_in">users</span>:((&quot;rpc.mountd&quot;,pid=<span class="number">15507</span>,fd=<span class="number">8</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#由于服务端监听的端口会发生变化，所以需要依赖rpcbind对客户端提供注册服务，rpcbind端口不会发生变化</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看服务端使用的端口</span></span><br><span class="line">[root@ubuntu ~]# rpcinfo -p</span><br><span class="line"> program vers proto  port  service</span><br><span class="line">  100000   4  tcp   111 portmapper  <span class="comment">#rpcbind，早期叫portmapper</span></span><br><span class="line">  ....</span><br></pre></td></tr></table></figure>

<h2 id="2-3-NFS共享配置文件格式"><a href="#2-3-NFS共享配置文件格式" class="headerlink" title="2.3 NFS共享配置文件格式"></a>2.3 NFS共享配置文件格式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> /etc/exports</span><br><span class="line"><span class="comment"># /etc/exports: the access control list for filesystems which may be exported</span></span><br><span class="line"><span class="comment"># to NFS clients. See exports(5).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Example for NFSv2 and NFSv3:</span></span><br><span class="line"><span class="comment"># /srv/homes    hostname1(rw,sync,no_subtree_check)hostname2(ro,sync,no_subtree_check)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Example for NFSv4:</span></span><br><span class="line"><span class="comment"># /srv/nfs4    gss/krb5i(rw,sync,fsid=0,crossmnt,no_subtree_check)</span></span><br><span class="line"><span class="comment"># /srv/nfs4/homes gss/krb5i(rw,sync,no_subtree_check)</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/dir 主机1(opt1,opt2) 主机2(opt1,opt2)...</span><br><span class="line"></span><br><span class="line"><span class="comment">#NFS服务器上要被共享的目录路径 </span></span><br><span class="line"><span class="comment">#可以共享此目录的客户端主机1(配置项1...) </span></span><br><span class="line"><span class="comment">#可以共享此目录的客户端主机2(配置项1...)</span></span><br></pre></td></tr></table></figure>

<p>格式说明：</p>
<ul>
<li><p>以#开始的行为注释</p>
</li>
<li><p>客户端主机格式：</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">anonymous  <span class="comment"># *表示不限制，即任何主机都能访问</span></span><br><span class="line">单个主机    <span class="comment">#可以写具体的IPV4,IPV6，FQDN，主机名</span></span><br><span class="line"></span><br><span class="line">IP networks（网段） <span class="comment">#两种掩码格式均支持</span></span><br><span class="line">172.18.0.0/255.255.0.0</span><br><span class="line">172.18.0.0/16</span><br><span class="line"></span><br><span class="line">wildcards <span class="comment">#主机名通配，例如:*.wang.org，IP不可以</span></span><br><span class="line">netgroups <span class="comment">#NIS域的主机组，@group_name</span></span><br><span class="line">gss/krb5i <span class="comment">#这种写法来限制对使用rpcsec_gss安全性的客户端的访问</span></span><br></pre></td></tr></table></figure>

<ul>
<li>每个条目指定目录导出到的哪些主机，及相关的权限和选项</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">默认选项：(ro,<span class="built_in">sync</span>,root_squash,no_all_squash)</span><br><span class="line"></span><br><span class="line">ro,rw 			 <span class="comment">#只读和读写</span></span><br><span class="line">async 			 <span class="comment">#异步，数据变化后不立即写磁盘，先写入到缓冲区中，过一段时间再写入磁盘，性能高,安全性低</span></span><br><span class="line"><span class="built_in">sync</span>  			 <span class="comment">#（1.0.0后为默认）同步，数据在请求时立即写入共享存储磁盘,性能低,安全性高</span></span><br><span class="line">root_squash 	 <span class="comment">#（默认）远程客户端主机上的root用户映射为nfsnobody,UID为65534的用户，CentOS8为nobody,CentOS7以前的版本为nfsnobody</span></span><br><span class="line">no_root_squash 	 <span class="comment">#远程客户端主机root用户映射成NFS服务器的root</span></span><br><span class="line">all_squash     	 <span class="comment">#所有远程客户端主机用户都映射成NFS主机上的UID=65534的用户，此项会覆盖no_root_squash，CentOS8为nobody</span></span><br><span class="line">no_all_squash  	 <span class="comment">#（默认）保留共享文件的UID和GID</span></span><br><span class="line">anonuid,anongid  <span class="comment">#指明匿名用户映射为特定用户UID和组GID，而非nobody,可配合all_squash使用,注意:目录需要给此用户权限,否则无法访问	</span></span><br><span class="line"></span><br><span class="line">insecure         <span class="comment">#允许非授权访问</span></span><br><span class="line">subtree_check    <span class="comment">#如果共享子目录，强制NFS 检查父目录权限</span></span><br><span class="line">no_subtree_check <span class="comment">#不检查父目录权限</span></span><br><span class="line">wdelay 			 <span class="comment">#多个用户写时等待同时写</span></span><br><span class="line">no_wdelay 		 <span class="comment">#多个用户写时不等待，立即写，当使用 async 项时，无需此设置</span></span><br><span class="line">hide 			 <span class="comment">#不共享NFS 服务中的子目录，在 NFSv4中无效</span></span><br><span class="line">no_hide 		 <span class="comment">#共享NFS 服务器上的子目录，在 NFSv4中无效</span></span><br><span class="line">secure NFS 		 <span class="comment">#服务通过1024以下的安全TCP/IP端口通讯</span></span><br><span class="line">insecure NFS 	 <span class="comment">#服务通过1024以上的安全TCP/IP端口通讯</span></span><br></pre></td></tr></table></figure>

<p>范例：NFS配置示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]#vim /etc/exports</span><br><span class="line">/myshare server.example.com</span><br><span class="line">/myshare *.example.com</span><br><span class="line">/myshare server?.example.com</span><br><span class="line">/myshare server[0-20].example.com</span><br><span class="line">/myshare 172.25.11.10</span><br><span class="line">/myshare 172.25.0.0/16</span><br><span class="line">/myshare 2000:472:18:b51:c32:a21</span><br><span class="line">/myshare 2000:472:18:b51::/64</span><br><span class="line">/myshare *.example.com 172.25.0.0/16</span><br><span class="line">/myshare desktop.example.com(ro)</span><br><span class="line">/myshare desktop.example.com(ro) server[0-20].example.com(rw)</span><br><span class="line">/myshare diskless.example.com(rw,no_root_squash)</span><br></pre></td></tr></table></figure>

<p>范例：默认挂载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务器</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">mkdir</span> /data/dir&#123;a,b&#125;</span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cp</span> /etc/fstab /data/dira/</span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> /etc/exports</span><br><span class="line">/data/dira  *</span><br><span class="line"></span><br><span class="line"><span class="comment">#读取配置，生效</span></span><br><span class="line">[root@ubuntu ~]# exportfs -r</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@ubuntu ~]# exportfs -v</span><br><span class="line">/data/dira  &lt;world&gt;</span><br><span class="line">(<span class="built_in">sync</span>,wdelay,hide,no_subtree_check,sec=sys,ro,secure,root_squash,no_all_squash)</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# mount</span><br><span class="line">10.0.0.208:/data/dira on /data/dir1 <span class="built_in">type</span> nfs4</span><br><span class="line">(ro,relatime,vers=4.2,rsize=262144,wsize=262144,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=10.0.0.206,local_lock=none,addr=10.0.0.208)</span><br><span class="line"></span><br><span class="line"><span class="comment">#在客户端</span></span><br><span class="line"><span class="comment">#查看NFS服务器上有什么共享文件夹</span></span><br><span class="line">[root@ubuntu ~]# showmount -e 10.0.0.208</span><br><span class="line">Export list <span class="keyword">for</span> 10.0.0.208:</span><br><span class="line">/data/dira *</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">mkdir</span> -pv /data/dir&#123;1,2&#125;</span><br><span class="line"><span class="built_in">mkdir</span>: created directory <span class="string">&#x27;/data&#x27;</span></span><br><span class="line"><span class="built_in">mkdir</span>: created directory <span class="string">&#x27;/data/dir1&#x27;</span></span><br><span class="line"><span class="built_in">mkdir</span>: created directory <span class="string">&#x27;/data/dir2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将远程主机上的 /data/dira 目录挂载到本机的 /data/dir1 上</span></span><br><span class="line">[root@ubuntu ~]# mount 10.0.0.208:/data/dira /data/dir1</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">df</span> -h /data/dir1/</span><br><span class="line">Filesystem       Size Used Avail Use% Mounted on</span><br><span class="line">10.0.0.208:/data/dira  97G  7.4G  85G  9% /data/dir1</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> -l /data/dir1</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 root root 657 Jul  9 09:58 fstab</span><br><span class="line"></span><br><span class="line"><span class="comment">#可读</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> /data/dir1/fstab</span><br><span class="line"><span class="comment"># /etc/fstab: static file system information.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="comment">#不可写</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">echo</span> <span class="string">&quot;123&quot;</span> &gt;&gt; /data/dir1/fstab</span><br><span class="line">-bash: /data/dir1/fstab: Read-only file system</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">touch</span> /data/dir1/test</span><br><span class="line"><span class="built_in">touch</span>: cannot <span class="built_in">touch</span> <span class="string">&#x27;/data/dir1/test&#x27;</span>: Read-only file system</span><br></pre></td></tr></table></figure>

<p>范例：指定客户端主机</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> /etc/exports</span><br><span class="line"><span class="comment">#10.0.0.206 可读写， 10.0.0.150 默认选项</span></span><br><span class="line">/data/dira  10.0.0.206(rw)  10.0.0.150</span><br><span class="line"></span><br><span class="line"><span class="comment">#生效</span></span><br><span class="line">[root@ubuntu ~]# exportfs -r</span><br><span class="line">[root@ubuntu ~]# exportfs -v</span><br><span class="line">/data/dira 10.0.0.206(<span class="built_in">sync</span>,wdelay,hide,no_subtree_check,sec=sys,rw,secure,root_squash,no_all_squash)</span><br><span class="line">/data/dira 10.0.0.150(<span class="built_in">sync</span>,wdelay,hide,no_subtree_check,sec=sys,ro,secure,root_squash,no_all_squash)</span><br><span class="line"></span><br><span class="line"><span class="comment">#206 主机上测试，还是可读不可写</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> -l /data/dir1/</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 root root 657 Jul  9 09:58 fstab</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> /data/dir1/fstab</span><br><span class="line"><span class="comment"># /etc/fstab: static file system information.</span></span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">touch</span> /data/dir1/test-206</span><br><span class="line"><span class="built_in">touch</span>: cannot <span class="built_in">touch</span> <span class="string">&#x27;/data/dir1/test-206&#x27;</span>: Permission denied	<span class="comment">#权限不够</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看服务器上共享目录的权限</span></span><br><span class="line">[root@ubuntu ~]# ll /data/dira/</span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x 1 root root 657 Jul  9 09:58 /data/dira</span><br><span class="line"><span class="comment">#虽然root上w权限，但是仅限于服务器的root，206虽然是以root用户远程连接，但是属于其他</span></span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]#<span class="built_in">chmod</span> 777 /data/dira</span><br><span class="line"><span class="comment">#成功</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">touch</span> /data/dir1/test-206</span><br><span class="line"></span><br><span class="line"><span class="comment">#客户端去服务器访问数据的时候，如果是以root身份，将映射成服务器的nobody用户，所以解释了为什么206虽然是以root用户远程连接，但是属于其他用户，之前无权限创建时因为没有给nobody用户授权</span></span><br><span class="line">[root@ubuntu ~]# ll /data/dir1/</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 root   root    657 Jul  9 09:58 fstab</span><br><span class="line">-rw-r--r-- 1 nobody nogroup   0 Jul  9 10:02 test-206</span><br><span class="line"></span><br><span class="line"><span class="comment">#所以解决权限问题有三种办法</span></span><br><span class="line"><span class="comment">#第一种</span></span><br><span class="line">[root@ubuntu ~]#<span class="built_in">chown</span> nobody /data/dira/</span><br><span class="line"><span class="comment">#第二种</span></span><br><span class="line">[root@ubuntu ~]#setfacl -m u:nobody:rwx /data/dira/</span><br><span class="line"><span class="comment">#第三种</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> /etc/exports</span><br><span class="line">/data/dira  10.0.0.206(rw,no_root_squash)  10.0.0.150</span><br><span class="line"></span><br><span class="line"><span class="comment">#150 主机上测试</span></span><br><span class="line">[root@rocky ~]# <span class="built_in">mkdir</span> /data/dir&#123;1,2&#125;</span><br><span class="line">[root@rocky ~]# showmount -e 10.0.0.208</span><br><span class="line">Export list <span class="keyword">for</span> 10.0.0.208:</span><br><span class="line">/data/dira 10.0.0.150,10.0.0.206</span><br><span class="line"></span><br><span class="line"><span class="comment">#挂载</span></span><br><span class="line">[root@rocky ~]# mount 10.0.0.208:/data/dira /data/dir1</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@rocky ~]# <span class="built_in">df</span> /data/dir1/</span><br><span class="line">Filesystem      1K-blocks  Used Available Use% Mounted on</span><br><span class="line">10.0.0.208:/data/dira 101590016 7749888  88633344  9% /data/dir1</span><br><span class="line"></span><br><span class="line">[root@rocky ~]# mount</span><br><span class="line">10.0.0.208:/data/dira on /data/dir1 <span class="built_in">type</span> nfs4</span><br><span class="line">(rw,relatime,vers=4.2,rsize=262144,wsize=262144,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=10.0.0.150,local_lock=none,addr=10.0.0.208)</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看，可读不可写</span></span><br><span class="line">[root@rocky ~]# <span class="built_in">ls</span> -l /data/dir1</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 root root 657 Jul  9 09:58 fstab</span><br><span class="line"></span><br><span class="line">[root@rocky ~]# <span class="built_in">cat</span> /data/dir1/fstab</span><br><span class="line"><span class="comment"># /etc/fstab: static file system information.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">[root@rocky ~]# <span class="built_in">touch</span> /data/dir1/test-150</span><br><span class="line"><span class="built_in">touch</span>: cannot <span class="built_in">touch</span> <span class="string">&#x27;/data/dir1/test-150&#x27;</span>: Read-only file system	</span><br></pre></td></tr></table></figure>

<p>范例：没有权限的主机无法挂载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#10.0.0.210 主机</span></span><br><span class="line">[root@ubuntu ~]# showmount -e 10.0.0.208</span><br><span class="line">Export list <span class="keyword">for</span> 10.0.0.208:</span><br><span class="line">/data/dira 10.0.0.150,10.0.0.206</span><br><span class="line"></span><br><span class="line"><span class="comment">#当前主机不在NFS 服务器配置的客户端主机列表中，无法挂载</span></span><br><span class="line">[root@ubuntu ~]# mount 10.0.0.208:/data/dira /data/dir1</span><br><span class="line">mount.nfs: access denied by server <span class="keyword">while</span> mounting 10.0.0.208:/data/dira</span><br></pre></td></tr></table></figure>

<p>范例：网段写法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> /etc/exports</span><br><span class="line">/data/dira  10.0.0.0/24(rw)</span><br></pre></td></tr></table></figure>

<p>范例：永久挂载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在客户端主机添加如下配置</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> /etc/fstab</span><br><span class="line">10.0.0.208:/data/dira /var/www/html nfs  defaults,_netdev   0  0</span><br></pre></td></tr></table></figure>

<h2 id="2-4-NFS工具"><a href="#2-4-NFS工具" class="headerlink" title="2.4 NFS工具"></a>2.4 NFS工具</h2><h3 id="2-4-1-rpcinfo"><a href="#2-4-1-rpcinfo" class="headerlink" title="2.4.1 rpcinfo"></a>2.4.1 rpcinfo</h3><p>rpcinfo 可以访问指定的 RPC 服务器，显示其响应信息，从而查询出在该服务器上注册的RPC服务，如果不指定主机，则默认是当前主机</p>
<p>查看注册在指定主机的RPC程序</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpcinfo -p hostname</span><br></pre></td></tr></table></figure>

<p>查看RPC注册程序</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpcinfo -s hostname</span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#显示已注册到本机的所有RPC服务</span></span><br><span class="line">[root@ubuntu ~]# rpcinfo</span><br><span class="line"></span><br><span class="line"><span class="comment">#显示已注册到本机的rpcbind V2 版本的 RPC 服务</span></span><br><span class="line">[root@ubuntu ~]# rpcinfo -p</span><br><span class="line"> program vers proto  port  service</span><br><span class="line">  100000   4  tcp   111 portmapper</span><br><span class="line">  100000   3  tcp   111 portmapper</span><br><span class="line">  100000   2  tcp   111 portmapper</span><br><span class="line">  </span><br><span class="line"><span class="comment">#简短格式显示</span></span><br><span class="line">[root@ubuntu ~]# rpcinfo -s</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看远程主机</span></span><br><span class="line">[root@ubuntu ~]# rpcinfo -s 10.0.0.208</span><br></pre></td></tr></table></figure>

<h3 id="2-4-2-exportfs"><a href="#2-4-2-exportfs" class="headerlink" title="2.4.2 exportfs"></a>2.4.2 exportfs</h3><p>exportfs 命令用于管理本机 NFS 文件系统，默认配置文件是 &#x2F;etc&#x2F;exports</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-v  <span class="comment">#查看本机所有NFS共享</span></span><br><span class="line">-r  <span class="comment">#重读配置文件，并共享目录</span></span><br><span class="line">-a  <span class="comment">#输出本机所有共享</span></span><br><span class="line">-au <span class="comment">#停止本机所有共享</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4-3-showmount"><a href="#2-4-3-showmount" class="headerlink" title="2.4.3 showmount"></a>2.4.3 showmount</h3><p>shoumount 可以查看远程主机的共享设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">showmount [ -opt... ] [ host ]</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-h|--<span class="built_in">help</span> <span class="comment">#显示帮助</span></span><br><span class="line">-a|--all <span class="comment">#显示己连接的客户端</span></span><br><span class="line">-e|--exports <span class="comment">#显示指定NFS服务器上的配置列表</span></span><br></pre></td></tr></table></figure>

<p>常见用法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看远程主机的NFS共享</span></span><br><span class="line">showmount -e hostname</span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]#showmount -e 10.0.0.8</span><br><span class="line">Export list <span class="keyword">for</span> 10.0.0.8:</span><br><span class="line">/data/wordpress *</span><br></pre></td></tr></table></figure>

<h3 id="2-4-4-mount-nfs"><a href="#2-4-4-mount-nfs" class="headerlink" title="2.4.4 mount.nfs"></a>2.4.4 mount.nfs</h3><p>客户端 NFS 服务挂载命令，将远程NFS 服务器上共享出来的目录挂载到本机，可以直接写成 mount</p>
<p>NFS相关的挂载选项：man 5 nfs</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-r <span class="comment">#只读挂载</span></span><br><span class="line">-v <span class="comment">#显示详细信息</span></span><br><span class="line">-V <span class="comment">#显示版本</span></span><br><span class="line">-w <span class="comment">#读写挂载</span></span><br><span class="line">-n <span class="comment">#不更新/etc/fstab 文件，默认项</span></span><br><span class="line">-o <span class="comment">#指定挂载参数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#常用挂载参数</span></span><br><span class="line"><span class="built_in">fg</span> 		<span class="comment">#（默认）前台挂载</span></span><br><span class="line"><span class="built_in">bg</span> 		<span class="comment">#后台挂载</span></span><br><span class="line">hard 	<span class="comment">#（默认）持续请求，如果挂不上，一直重试</span></span><br><span class="line">soft   	<span class="comment">#非持续请求</span></span><br><span class="line">intr   	<span class="comment">#是否可以强制中断，配合hard 选项，如果挂不上，可以ctrl+c 中断</span></span><br><span class="line">rsize和wsize <span class="comment">#指定一次读的最大字节数，值必须为1024的倍数，最大为1048576，最小为1024，如果小于1024会被替换成4096</span></span><br><span class="line">_netdev <span class="comment">#无网络服务时不挂载NFS资源</span></span><br><span class="line">vers   	<span class="comment">#指定版本，客户端centos8默认4.2 ，centos7默认4.1 centos6默认4.0，如果NFS 服务端不支持此版本，则无法挂载</span></span><br></pre></td></tr></table></figure>

<p>提示：基于安全考虑，建议使用 nosuid , _netdev , noexec  挂载选项</p>
<p>范例：临时挂载NFS共享</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# mount -o rw,<span class="built_in">fg</span>,hard,intr 10.0.0.208:/testdir /mnt/nfs/</span><br></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]#<span class="built_in">mkdir</span> /mnt/nfs</span><br><span class="line">[root@centos7 ~]#mount 10.0.0.8:/data/wordpress /mnt/nfs</span><br><span class="line">[root@centos7 ~]#<span class="built_in">ls</span> /mnt/nfs</span><br><span class="line">index.html</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]#<span class="built_in">df</span> -T /mnt/nfs</span><br><span class="line">Filesystem        Type 1K-blocks  Used Available Use% Mounted on</span><br><span class="line">10.0.0.8:/data/wordpress nfs4  52403200 398336  52004864  1% /mnt/nfs</span><br></pre></td></tr></table></figure>

<p>范例：开机挂载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vim /etc/fstab </span></span><br><span class="line">172.16.0.1:/public  /mnt/nfs  nfs  defaults,_netdev  0  0</span><br></pre></td></tr></table></figure>

<p>范例: 远程的 root 映射为NFS服务器的nobody用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@centos6 ~]#grep nobody /etc/passwd</span><br><span class="line">nobody:x:99:99:Nobody:/:/sbin/nologin</span><br><span class="line">nfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]#grep nobody /etc/passwd</span><br><span class="line">nobody:x:99:99:Nobody:/:/sbin/nologin</span><br><span class="line">nfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#grep nobody /etc/passwd</span><br><span class="line">nobody:x:65534:65534:Kernel Overflow User:/:/sbin/nologin</span><br></pre></td></tr></table></figure>

<h2 id="2-5-NFS-共享实现"><a href="#2-5-NFS-共享实现" class="headerlink" title="2.5 NFS 共享实现"></a>2.5 NFS 共享实现</h2><h3 id="2-5-1-目标"><a href="#2-5-1-目标" class="headerlink" title="2.5.1 目标"></a>2.5.1 目标</h3><p>将NFS的共享目录，做为远程主机用户的家目录</p>
<h3 id="2-5-2-环境准备"><a href="#2-5-2-环境准备" class="headerlink" title="2.5.2 环境准备"></a>2.5.2 环境准备</h3><p><img src="/Linux/service-manage/file-share/1753757619122-10db5517-4fdc-4dfc-af51-1165c40e44f6-175568388467411.png" alt="null"></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">共三台主机</span><br><span class="line">一台主机 nfs server</span><br><span class="line">IP:10.0.0.8</span><br><span class="line">另两台当 nfs client</span><br><span class="line">IP:10.0.0.7</span><br><span class="line">IP:10.0.0.6</span><br></pre></td></tr></table></figure>

<h3 id="2-5-3-步骤"><a href="#2-5-3-步骤" class="headerlink" title="2.5.3 步骤"></a>2.5.3 步骤</h3><h4 id="2-5-3-1-在服务端配置共享"><a href="#2-5-3-1-在服务端配置共享" class="headerlink" title="2.5.3.1 在服务端配置共享"></a>2.5.3.1 在服务端配置共享</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#NFS服务器创建用户和相应的家目录，将用户wang的家目录共享</span></span><br><span class="line">[root@centos8 ~]#yum -y install nfs-utils</span><br><span class="line">[root@centos8 ~]#systemctl <span class="built_in">enable</span> --now nfs-server</span><br><span class="line">[root@centos8 ~]#<span class="built_in">mkdir</span> -pv /data/home/wang</span><br><span class="line">[root@centos8 ~]#Vim /etc/exports.d/test.exports</span><br><span class="line">/data/home/wang *(rw)</span><br><span class="line">[root@centos8 ~]#exportfs -r</span><br></pre></td></tr></table></figure>

<h4 id="2-5-3-2-客户端配置"><a href="#2-5-3-2-客户端配置" class="headerlink" title="2.5.3.2 客户端配置"></a>2.5.3.2 客户端配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在第一台NFS客户端主机10.0.0.7上实现</span></span><br><span class="line">[root@centos7 ~]#yum -y install nfs-utils</span><br><span class="line">[root@centos7 ~]#useradd -u 2000 wang</span><br><span class="line">[root@centos7 ~]#vim /etc/fstab</span><br><span class="line">10.0.0.8:/data/home/wang /home/wang  nfs _netdev 0 0</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]#mount -a</span><br><span class="line">[root@centos7 ~]#su - wang</span><br><span class="line">Last login: Fri Jul  3 16:33:34 CST 2020 on pts/0</span><br><span class="line"></span><br><span class="line">[wang@centos7 ~]<span class="variable">$pwd</span></span><br><span class="line">/home/wang</span><br><span class="line"></span><br><span class="line">[wang@centos7 ~]<span class="variable">$df</span> /home/wang -T</span><br><span class="line">Filesystem               Type 1K-blocks  Used Available Use% Mounted on</span><br><span class="line">10.0.0.8:/data/home/wang nfs4  52403200 398464  52004736  1% /home/wang</span><br><span class="line"></span><br><span class="line"><span class="comment">#在第二台NFS客户端主机10.0.0.6上实现</span></span><br><span class="line">[root@centos6 ~]#yum -y install nfs-utils</span><br><span class="line">[root@centos6 ~]#useradd -u 2000 wang</span><br><span class="line">[root@centos6 ~]#vim /etc/fstab</span><br><span class="line">10.0.0.8:/data/home/wang /home/wang  nfs _netdev 0 0</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#su - wang</span><br><span class="line">[wang@centos6 ~]<span class="variable">$pwd</span></span><br><span class="line">/home/wang</span><br><span class="line"></span><br><span class="line">[wang@centos6 ~]<span class="variable">$df</span> -T /home/wang</span><br><span class="line">Filesystem               Type 1K-blocks  Used Available Use% Mounted on</span><br><span class="line">10.0.0.8:/data/home/wang nfs  52403200 398464  52004736  1% /home/wang</span><br></pre></td></tr></table></figure>

<h4 id="2-5-3-3-用户映射"><a href="#2-5-3-3-用户映射" class="headerlink" title="2.5.3.3 用户映射"></a>2.5.3.3 用户映射</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#普通用户不映射</span></span><br><span class="line"><span class="comment">#在客户机上以普通用户创建文件</span></span><br><span class="line">[wang@centos7 ~]$ <span class="built_in">touch</span> /home/wang/wang.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#客户机上显示属主属组是wang</span></span><br><span class="line">[wang@centos7 ~]$ <span class="built_in">ls</span> -l /home/wang/wang.txt</span><br><span class="line">-rw-rw-r-- 1 wang wang 0 Jul  9 00:31 /home/wang/wang.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#NFS 服务器上查看，找不到对应的用户，直接显示UID</span></span><br><span class="line">[root@centos8 ~]#<span class="built_in">ls</span> -l /data/home/wang/wang.txt</span><br><span class="line">-rw-rw-r-- 1 2000 2000 0 Jul  9 00:31 /data/home/wang/wang.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#NFS 服务器上以相同UID 创建用户,再查看</span></span><br><span class="line">[root@centos8 ~]#useradd -d /data/home/wang -u 2000 wang</span><br><span class="line">[root@centos8 ~]#<span class="built_in">ls</span> -l /data/home/wang/wang.txt</span><br><span class="line">-rw-rw-r-- 1 wang wang 0 Jul  9 00:31 /data/home/wang/wang.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#再次修改规则，all_squash 项会覆盖 no_root_squash</span></span><br><span class="line">[root@centos8 ~]#<span class="built_in">cat</span> /etc/exports</span><br><span class="line">/data/www *(rw,no_root_squash,all_squash)</span><br><span class="line"></span><br><span class="line"><span class="comment">#生效</span></span><br><span class="line">[root@centos8 ~]# exportfs -r</span><br><span class="line">[root@centos8 ~]# exportfs -v</span><br><span class="line">/data/www   &lt;world&gt;</span><br><span class="line">(<span class="built_in">sync</span>,wdelay,hide,no_subtree_check,sec=sys,rw,secure,no_root_squash,all_squash)</span><br><span class="line"></span><br><span class="line"><span class="comment">#在客户端创建文件</span></span><br><span class="line">[root@centos7 ~]#<span class="built_in">touch</span> /home/wang/wang1.txt</span><br><span class="line">[root@centos7 ~]#su - wang </span><br><span class="line">[wang@centos7 ~]$ <span class="built_in">touch</span> /home/wang/wang2.txt</span><br><span class="line">[wang@centos7 ~]$ <span class="built_in">exit</span></span><br><span class="line"><span class="built_in">logout</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在客户端查看</span></span><br><span class="line">[root@centos7 ~]# ll /home/wang/wang&#123;1,2&#125;.txt</span><br><span class="line">-rw-r--r-- 1 nobody nogroup 0 Jul  9 08:51 /home/wang/wang2.txt</span><br><span class="line">-rw-rw-r-- 1 nobody nogroup 0 Jul  9 08:51 /home/wang/wang1.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#在NFS服务端查看，普通用户和 root 都被映射</span></span><br><span class="line">[root@centos8 ~]# ll /data/home/wang/wang&#123;1,2&#125;.txt</span><br><span class="line">-rw-r--r-- 1 nobody nogroup 0 Jul  9 08:51 /data/home/wang/wang2.txt</span><br><span class="line">-rw-rw-r-- 1 nobody nogroup 0 Jul  9 08:51 /data/home/wang/wang1.txt</span><br></pre></td></tr></table></figure>

<h4 id="2-5-3-4-统一用户映射"><a href="#2-5-3-4-统一用户映射" class="headerlink" title="2.5.3.4 统一用户映射"></a>2.5.3.4 统一用户映射</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#NFS 服务端配置</span></span><br><span class="line">[root@centos8 ~]# groupadd -g 12345 www</span><br><span class="line">[root@centos8 ~]# useradd -u 12345 -g 12345 -s /sbin/nologin www</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定映射用户，对 root 和普通用户都生效</span></span><br><span class="line">[root@centos7 ~]# <span class="built_in">cat</span> /etc/exports</span><br><span class="line">/data/www *(rw,all_squash,anongid=12345,anonuid=12345)</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# exportfs -r</span><br><span class="line">[root@ubuntu ~]# exportfs -v</span><br><span class="line">/data/www   &lt;world&gt;</span><br><span class="line">(<span class="built_in">sync</span>,wdelay,hide,no_subtree_check,anonuid=12345,anongid=12345	,sec=sys,rw,secure,root_squash,all_squash)</span><br><span class="line"></span><br><span class="line"><span class="comment">#客户端创建文件</span></span><br><span class="line">[root@centos7 ~]# <span class="built_in">touch</span> /home/wang/wang3.txt</span><br><span class="line">[root@centos7 ~]# su - wang</span><br><span class="line">[wang@centos7 ~]$ <span class="built_in">touch</span> /home/wang/wang4.txt</span><br><span class="line">[wang@centos7 ~]$ <span class="built_in">exit</span></span><br><span class="line"><span class="built_in">logout</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#客户端查看</span></span><br><span class="line">[root@centos7 ~]# ll /home/wang/wang&#123;3,4&#125;.txt</span><br><span class="line">-rw-r--r-- 1 12345 12345 0 Jul  9 09:37 /home/wang/wang4.txt</span><br><span class="line">-rw-rw-r-- 1 12345 12345 0 Jul  9 09:37 /home/wang/wang3.txt</span><br></pre></td></tr></table></figure>

<p><strong>统一客户端主机用户和权限的方法</strong></p>
<ol>
<li><p>保证客户端主机使用相同的用户(相同的用户ID)对共享目录进行读写</p>
</li>
<li><p>在NFS 服务器上统一映射</p>
</li>
<li><p>新建服务器使用 LDAP（轻量级目录访问协议） 服务进行集中的帐号管理</p>
</li>
</ol>
<p><img src="/Linux/service-manage/file-share/1753757619201-920adb99-6634-4d4a-8286-b1244f09d801-17556838846744.png" alt="null"></p>
<h1 id="3-数据的实时同步"><a href="#3-数据的实时同步" class="headerlink" title="3 数据的实时同步"></a>3 数据的实时同步</h1><p>在生产环境，要将数据或文件进行实时同步，保证数据更新后其它节点能立即获得最新的数据，会需要两台主机的特定目录实现实时同步。比如，将NFS共享目录的数据文件，自动实时同步到备份服务器特定目录中</p>
<p>数据同步的两种方式</p>
<ul>
<li><p>PULL：拉，使用定时任务的方式配合同步命令或脚本等，从指定服务器上将数据同步到本地，一般是周期性定时同步</p>
</li>
<li><p>PUSH：推，如果当前机器上的数据或文件发生更新了，立即推送到指定的节点上，可以做到实时同步</p>
</li>
</ul>
<p><img src="/Linux/service-manage/file-share/1753757619271-a2dcc534-e361-4df1-b9f9-f504e332b3be-17556838846747.png" alt="null"></p>
<h2 id="3-1-实时同步技术介绍"><a href="#3-1-实时同步技术介绍" class="headerlink" title="3.1 实时同步技术介绍"></a>3.1 实时同步技术介绍</h2><p>实现实时同步的方法</p>
<ul>
<li><p>inotify + rsync 方式实现数据同步,需自行编写脚本组合inotify和 rsync 实现</p>
</li>
<li><p>sersync ：前金山公司周洋（花椒直播）在 inotify+rsync 软件基础上进行开发的，功能更加强大</p>
</li>
</ul>
<p><strong>工作原理：</strong></p>
<ul>
<li><p>要利用监控服务（inotify），监控同步数据服务器目录中信息的变化</p>
</li>
<li><p>发现目录中数据产生变化，就利用rsync服务推送到备份服务器上</p>
</li>
</ul>
<p><strong>inotify：</strong></p>
<p>异步的文件系统事件监控机制，利用事件驱动机制，而无须通过诸如cron等的轮询机制来获取事件，linux内核从2.6.13起支持 inotify，通过inotify可以监控文件系统中添加、删除，修改、移动等各种事件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu2204 ~]#grep -i inotify /boot/config-5.15.0-52-generic</span><br><span class="line">CONFIG_INOTIFY_USER=y</span><br><span class="line">[root@centos8 ~]#grep -i inotify /boot/config-4.18.0-80.el8.x86_64</span><br><span class="line">CONFIG_INOTIFY_USER=y</span><br></pre></td></tr></table></figure>

<p><strong>实现inotify软件：</strong></p>
<ul>
<li><p>inotify-tools</p>
</li>
<li><p>sersync</p>
</li>
<li><p>lrsyncd</p>
</li>
</ul>
<p><strong>inotify+rsync使用方式</strong></p>
<ul>
<li><p>inotify 对同步数据目录信息的监控</p>
</li>
<li><p>rsync 完成对数据的同步</p>
</li>
<li><p>利用脚本进行结合</p>
</li>
</ul>
<h2 id="3-2-inotify-rsync-实现数据实时同步"><a href="#3-2-inotify-rsync-实现数据实时同步" class="headerlink" title="3.2 inotify + rsync 实现数据实时同步"></a>3.2 inotify + rsync 实现数据实时同步</h2><p><strong>实现原理</strong>：利用内核中的 inotify 监控指定目录，当目录中的文件或数据发生变化时，立即调用 rsync 服务将数据推送到远程主机上。</p>
<h3 id="3-2-1-实现-inotify"><a href="#3-2-1-实现-inotify" class="headerlink" title="3.2.1 实现 inotify"></a>3.2.1 实现 inotify</h3><p>inotify 是一个内核，用于通知用户空间程序文件系统变化的机制，在监听到文件系统发生变化后，会向相应的应用程序发送事件，如文件增加，修改，删除等事件发生后可以立即让用户空间知道</p>
<p><a target="_blank" rel="noopener" href="https://github.com/rvoicilas/inotify-tools">项目地址</a></p>
<h4 id="3-2-1-1-内核支持"><a href="#3-2-1-1-内核支持" class="headerlink" title="3.2.1.1 内核支持"></a>3.2.1.1 内核支持</h4><p><strong>内核是否支持inotify</strong></p>
<p>Linux支持inotify的内核最小版本为 2.6.13，参看man 7 inotify</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#列出下面的文件，说明服务器内核支持inotify</span></span><br><span class="line">[root@centos8 ~]#<span class="built_in">ls</span> -l /proc/sys/fs/inotify </span><br><span class="line">-rw-r--r-- 1 root root 0 Dec  7 10:10 max_queued_events</span><br><span class="line">-rw-r--r-- 1 root root 0 Dec  7 10:10 max_user_instances</span><br><span class="line">-rw-r--r-- 1 root root 0 Dec  6 05:54 max_user_watches</span><br><span class="line"></span><br><span class="line"><span class="comment">#inotify事件队列最大长度，如值太小会出现Event Queue Overflow错误，默认16384, 生产环境建议调大,比如 27679</span></span><br><span class="line">[root@centos8 ~]#<span class="built_in">cat</span> /proc/sys/fs/inotify/max_queued_events</span><br><span class="line">16384</span><br><span class="line"></span><br><span class="line"><span class="comment">#每个用户创建inotify实例最大值，默认值128</span></span><br><span class="line">[root@centos8 ~]#<span class="built_in">cat</span> /proc/sys/fs/inotify/max_user_instances</span><br><span class="line">128</span><br><span class="line"></span><br><span class="line"><span class="comment">#每个inotify实例可以监视的文件的总数量（inotifywait 单进程），默认值：8192,建议调大</span></span><br><span class="line">[root@centos8 ~]#<span class="built_in">cat</span> /proc/sys/fs/inotify/max_user_watches</span><br><span class="line">8192</span><br><span class="line"></span><br><span class="line">[root@ubuntu2204 ~]#<span class="built_in">cat</span> /proc/sys/fs/inotify/max_queued_events</span><br><span class="line">16384</span><br><span class="line">[root@ubuntu2204 ~]#<span class="built_in">cat</span> /proc/sys/fs/inotify/max_user_instances</span><br><span class="line">128</span><br><span class="line">[root@ubuntu2204 ~]#<span class="built_in">cat</span> /proc/sys/fs/inotify/max_user_watches</span><br><span class="line">14281</span><br><span class="line"></span><br><span class="line"><span class="comment">#一个用户可以最多开128个inotify实例，每个实例最多可以监控14165个文件</span></span><br></pre></td></tr></table></figure>

<p>内核参数如果需要修改，可以配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> /etc/sysctl.conf</span><br><span class="line">fs.inotify.max_queued_events=66666</span><br><span class="line">fs.inotify.max_user_instances=256</span><br><span class="line">fs.inotify.max_user_watches=100000</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# sysctl -p</span><br><span class="line">fs.inotify.max_queued_events = 66666</span><br><span class="line">fs.inotify.max_user_instances = 256</span><br><span class="line">fs.inotify.max_user_watches = 100000</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#<span class="built_in">cat</span> /proc/sys/fs/inotify/*</span><br><span class="line">66666</span><br><span class="line">256</span><br><span class="line">100000</span><br></pre></td></tr></table></figure>

<h4 id="3-2-1-2-inotify-tools工具"><a href="#3-2-1-2-inotify-tools工具" class="headerlink" title="3.2.1.2 inotify-tools工具"></a>3.2.1.2 inotify-tools工具</h4><p>inotify 是内核中的功能模块，只能通过调用API接口的形式使用其功能，我们可以通过相关软件来对其进行操作，能实现内核中 inotify 调用的软件主要有：inotify-tools，sersync，lrsyncd</p>
<p><a target="_blank" rel="noopener" href="https://github.com/rvoicilas/inotify-tools/wiki">inotify-tools参考文档</a></p>
<p>安装inotify-tools：基于epel源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@data-centos8 ~]# yum -y install inotify-tools</span><br><span class="line">[root@data-ubuntu2004]#apt -y install inotify-tools</span><br><span class="line"></span><br><span class="line"><span class="comment">#主要工具</span></span><br><span class="line">/usr/bin/fsnotifywait 	<span class="comment">#fsnotify监控工具，fsnotify 是 inotify 的新版本</span></span><br><span class="line">/usr/bin/fsnotifywatch 	<span class="comment">#fsnotify统计工具</span></span><br><span class="line">/usr/bin/inotifywait 	<span class="comment">#实时监控指定目录的所有事件，在被监控的文件或目录上等待特定事件发生(open,close,write..)</span></span><br><span class="line">/usr/bin/inotifywatch 	<span class="comment">#收集被监控的文件系统使用的统计数据，指文件系统事件发生的次数统计</span></span><br></pre></td></tr></table></figure>

<p><strong>inotify-tools包主要工具：</strong></p>
<ul>
<li><p>inotifywait： 在被监控的文件或目录上等待特定文件系统事件（open ，close，delete等）发生，常用于实时同步的目录监控</p>
</li>
<li><p>inotifywatch：收集被监控的文件系统使用的统计数据，指文件系统事件发生的次数统计</p>
</li>
</ul>
<p><strong>inotifywait 命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">inotifywait [ options ] file1 [ file2 ] [ file3 ] [ ... ]</span><br><span class="line"></span><br><span class="line">-m, --monitor 		 <span class="comment">#始终保持事件监听</span></span><br><span class="line">-d, --daemon 		 <span class="comment">#以守护进程方式执行，和-m相似，配合-o使用</span></span><br><span class="line">-r, --recursive 	 <span class="comment">#递归监控目录数据信息变化</span></span><br><span class="line">-q, --quiet 		 <span class="comment">#输出少量事件信息</span></span><br><span class="line">--exclude &lt;pattern&gt;  <span class="comment">#指定排除文件或目录，使用扩展的正则表达式匹配的模式实现</span></span><br><span class="line">--excludei &lt;pattern&gt; <span class="comment">#和exclude相似，不区分大小写</span></span><br><span class="line">-o, --outfile &lt;file&gt; <span class="comment">#打印事件到文件中，相当于标准正确输出，注意：使用绝对路径</span></span><br><span class="line">-s, --syslogOutput 	 <span class="comment">#发送错误到syslog相当于标准错误输出</span></span><br><span class="line">--timefmt &lt;<span class="built_in">fmt</span>&gt; 	 <span class="comment">#指定时间输出格式</span></span><br><span class="line">--format &lt;<span class="built_in">fmt</span>&gt; 		 <span class="comment">#指定的输出格式；即实际监控输出内容</span></span><br><span class="line">-e 					 <span class="comment">#指定监听指定的事件，如果省略，表示所有事件都进行监听</span></span><br></pre></td></tr></table></figure>

<p><strong>inotifywait 的–timefmt 时间格式</strong></p>
<p>参考 man 3 strftime</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">%Y <span class="comment">#年份信息，包含世纪信息</span></span><br><span class="line">%y <span class="comment">#年份信息，不包括世纪信息</span></span><br><span class="line">%m <span class="comment">#显示月份，范围 01-12</span></span><br><span class="line">%d <span class="comment">#每月的第几天，范围是 01-31</span></span><br><span class="line">%H <span class="comment">#小时信息，使用 24小时制，范围 00-23</span></span><br><span class="line">%M <span class="comment">#分钟，范围 00-59</span></span><br><span class="line">%S <span class="comment">#秒，范例 0-60</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--timefmt <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>inotifywait 的 –format 格式定义</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">%T  <span class="comment">#输出时间格式中定义的时间格式信息，通过 --timefmt option 语法格式指定时间信息</span></span><br><span class="line">%w  <span class="comment">#事件出现时，监控文件或目录的名称信息，相当于dirname</span></span><br><span class="line">%f  <span class="comment">#事件出现时，将显示监控目录下触发事件的文件或目录信息，否则为空，相当于basename</span></span><br><span class="line">%e  <span class="comment">#显示发生的事件信息，不同的事件默认用逗号分隔</span></span><br><span class="line">%Xe <span class="comment">#显示发生的事件信息，不同的事件指定用X进行分隔</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--format <span class="string">&quot;%T %w%f event: %;e&quot;</span></span><br><span class="line">--format <span class="string">&#x27;%T %w %f&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>inotifywait -e 选项指定的事件类型</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">create 			<span class="comment">#文件或目录创建</span></span><br><span class="line">delete 			<span class="comment">#文件或目录被删除</span></span><br><span class="line">modify 			<span class="comment">#文件或目录内容被写入</span></span><br><span class="line">attrib 			<span class="comment">#文件或目录属性改变</span></span><br><span class="line">close_write   	<span class="comment">#文件或目录关闭，在写入模式打开之后关闭的</span></span><br><span class="line">close_nowrite 	<span class="comment">#文件或目录关闭，在只读模式打开之后关闭的</span></span><br><span class="line">close 			<span class="comment">#文件或目录关闭，不管读或是写模式</span></span><br><span class="line">open 			<span class="comment">#文件或目录被打开</span></span><br><span class="line">lsdir 			<span class="comment">#浏览目录内容</span></span><br><span class="line">moved_to 		<span class="comment">#文件或目录被移动到监控的目录中</span></span><br><span class="line">moved_from 		<span class="comment">#文件或目录从监控的目录中被移动</span></span><br><span class="line">move 			<span class="comment">#文件或目录不管移动到或是移出监控目录都触发事件</span></span><br><span class="line">access 			<span class="comment">#文件或目录内容被读取</span></span><br><span class="line">delete_self 	<span class="comment">#文件或目录被删除，目录本身被删除</span></span><br><span class="line">unmount 		<span class="comment">#取消挂载</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-e create,delete,moved_to,close_write,attrib，moved_from</span><br></pre></td></tr></table></figure>

<p>范例：只监控一个事件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# tree /data/</span><br><span class="line">/data/</span><br><span class="line">├── dir1</span><br><span class="line">└── dir2</span><br><span class="line">2 directories, 0 files</span><br><span class="line"></span><br><span class="line"><span class="comment">#开始监控</span></span><br><span class="line">[root@ubuntu ~]# inotifywait /data/</span><br><span class="line">Setting up watches.</span><br><span class="line">Watches established.</span><br><span class="line"></span><br><span class="line"><span class="comment">#在另一个终端中执行</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> /data/</span><br><span class="line">dir1 dir2</span><br><span class="line"></span><br><span class="line"><span class="comment">#提示open事件并退出</span></span><br><span class="line">[root@ubuntu ~]# inotifywait /data/</span><br><span class="line">Setting up watches.</span><br><span class="line">Watches established.</span><br><span class="line">/data/ OPEN,ISDIR</span><br></pre></td></tr></table></figure>

<p>范例：持续监控</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# inotifywait -m /data/</span><br><span class="line">Setting up watches.</span><br><span class="line">Watches established.</span><br><span class="line"></span><br><span class="line"><span class="comment">#另一个终端操作</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> /data</span><br><span class="line">dir1 dir2</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> /data/dir1</span><br><span class="line">[root@ubuntu ~]# <span class="built_in">touch</span> /data/test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看监控，一条命令可能有多个事件</span></span><br><span class="line">[root@ubuntu ~]# inotifywait -m /data/</span><br><span class="line">Setting up watches.</span><br><span class="line">Watches established.</span><br><span class="line">/data/ OPEN,ISDIR</span><br><span class="line">/data/ ACCESS,ISDIR</span><br><span class="line">/data/ ACCESS,ISDIR</span><br><span class="line">/data/ CLOSE_NOWRITE,CLOSE,ISDIR</span><br><span class="line">/data/ OPEN,ISDIR dir1</span><br><span class="line">/data/ ACCESS,ISDIR dir1</span><br><span class="line">/data/ ACCESS,ISDIR dir1</span><br><span class="line">/data/ CLOSE_NOWRITE,CLOSE,ISDIR dir1</span><br><span class="line">/data/ CREATE test.txt</span><br><span class="line">/data/ OPEN test.txt</span><br><span class="line">/data/ ATTRIB test.txt	<span class="comment">#ATTRIB表示属性更改</span></span><br><span class="line">/data/ CLOSE_WRITE,CLOSE test.txt	<span class="comment">#CLOSE_WRITE表示有文件内容发生变化	</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#递归监控</span></span><br><span class="line">inotifywait -mrq /data/www  --exclude=<span class="string">&quot;.*\.swx|\.swp&quot;</span></span><br><span class="line">/data/www/ OPEN f1.txt</span><br><span class="line">/data/www/ ACCESS f1.txt</span><br><span class="line">/data/www/ CLOSE_NOWRITE,CLOSE f1.txt</span><br></pre></td></tr></table></figure>

<p>范例：持续后台监控，并指定输出格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# inotifywait -drq /data/ -o inotify.log --timefmt <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span> --format <span class="string">&quot;%T %w%f event: %e&quot;</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> inotify.log</span><br><span class="line">2023-07-11 14:45:53 /data/ event: OPEN,ISDIR</span><br><span class="line">2023-07-11 14:45:53 /data/ event: ACCESS,ISDIR</span><br><span class="line">2023-07-11 14:45:53 /data/ event: CLOSE_NOWRITE,CLOSE,ISDIR</span><br></pre></td></tr></table></figure>

<p>范例：持续前台监控特定事件，指定输出格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> /data/</span><br><span class="line">dir1 dir2 test.txt</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">touch</span> /data/test.log</span><br><span class="line">[root@ubuntu ~]# <span class="built_in">touch</span> /data/test.log</span><br><span class="line">[root@ubuntu ~]# <span class="built_in">rm</span> -f /data/test.log</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# inotifywait -mrq /data/ --timefmt <span class="string">&quot;%F %H:%M:%S&quot;</span> --format <span class="string">&quot;%T %w%f event:%;e&quot;</span> -e create,delete,moved_to,close_write,attrib</span><br><span class="line">2023-07-11 14:58:03 /data/test.log event:CREATE</span><br><span class="line">2023-07-11 14:58:03 /data/test.log event:ATTRIB</span><br><span class="line">2023-07-11 14:58:03 /data/test.log event:CLOSE_WRITE;CLOSE</span><br><span class="line">2023-07-11 14:58:06 /data/test.log event:ATTRIB</span><br><span class="line">2023-07-11 14:58:06 /data/test.log event:CLOSE_WRITE;CLOSE</span><br><span class="line">2023-07-11 14:58:09 /data/test.log event:DELETE</span><br></pre></td></tr></table></figure>

<p>范例：将结果输出到文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# inotifywait -m -r /data/ -o inotify.txt</span><br><span class="line">Setting up watches. Beware: since -r was given, this may take a <span class="keyword">while</span>!</span><br><span class="line">Watches established.</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> /data/</span><br><span class="line">dir1 dir2 test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看结果文件</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> inotify.txt</span><br><span class="line">/data/ OPEN,ISDIR</span><br><span class="line">/data/ ACCESS,ISDIR</span><br><span class="line">/data/ CLOSE_NOWRITE,CLOSE,ISDIR</span><br></pre></td></tr></table></figure>

<p>范例：从文件中读取要监控的内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> a.txt</span><br><span class="line">/data/</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# inotifywait -<span class="built_in">rm</span> --fromfile a.txt</span><br><span class="line">Setting up watches. Beware: since -r was given, this may take a <span class="keyword">while</span>!</span><br><span class="line">Watches established.</span><br></pre></td></tr></table></figure>

<h3 id="3-2-2-rsync-服务"><a href="#3-2-2-rsync-服务" class="headerlink" title="3.2.2 rsync 服务"></a>3.2.2 rsync 服务</h3><p>rsync 常用于做为 linux系统下的数据镜像备份工具，实现远程同步，支持本地复制，或者与其他SSH</p>
<p>rsync主机同步数据，支持增量备份，配合任务计划，rsync能实现定时或间隔同步，配合inotify或sersync，可以实现触发式的实时数据同步</p>
<p><a target="_blank" rel="noopener" href="http://rsync.samba.org/">官方网站</a></p>
<p>服务器软件包：rsync（Ubuntu20.04），rsync-daemon（CentOS 8）</p>
<p>服务文件：&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;rsyncd.service</p>
<p>配置文件：&#x2F;etc&#x2F;rsyncd.conf</p>
<p>端口：873&#x2F;tcp</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Ubuntu默认提供了service文件</span></span><br><span class="line">[root@ubuntu2204 ~]#systemctl <span class="built_in">cat</span> rsync.service</span><br><span class="line"><span class="comment"># /lib/systemd/system/rsync.service</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=fast remote file copy program daemon</span><br><span class="line">ConditionPathExists=/etc/rsyncd.conf</span><br><span class="line">After=network.target</span><br><span class="line">Documentation=man:rsync(1) man:rsyncd.conf(5)</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/bin/rsync --daemon --no-detach</span><br><span class="line">RestartSec=1</span><br><span class="line"><span class="comment"># Citing README.md:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  [...] Using ssh is recommended for its security features.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  Alternatively, rsync can run in `daemon&#x27; mode, listening on a socket.</span></span><br><span class="line"><span class="comment">#  This is generally used for public file distribution, [...]</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># So let&#x27;s assume some extra security is more than welcome here. We do full</span></span><br><span class="line"><span class="comment"># system protection (which makes /usr, /boot, &amp; /etc read-only) and hide</span></span><br><span class="line"><span class="comment"># devices. To override these defaults, it&#x27;s best to do so in the drop-in</span></span><br><span class="line"><span class="comment"># directory, often done via `systemctl edit rsync.service`. The file needs</span></span><br><span class="line"><span class="comment"># just the bare minimum of the right [heading] and override values.</span></span><br><span class="line"><span class="comment"># See systemd.unit(5) and search for &quot;drop-in&quot; for full details.</span></span><br><span class="line">ProtectSystem=full</span><br><span class="line"><span class="comment">#ProtectHome=on|off|read-only</span></span><br><span class="line">PrivateDevices=on</span><br><span class="line">NoNewPrivileges=on</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"><span class="comment">#红帽系统需要安装rsync-daemon包提供service文件</span></span><br><span class="line">[root@backup-centos8 ~]#dnf -y install rsync-daemon</span><br><span class="line">[root@backup-centos8 ~]#rpm -ql rsync-daemon</span><br><span class="line">/etc/rsyncd.conf</span><br><span class="line">/etc/sysconfig/rsyncd</span><br><span class="line">/usr/lib/systemd/system/rsyncd.service</span><br><span class="line">/usr/lib/systemd/system/rsyncd.socket</span><br><span class="line">/usr/lib/systemd/system/rsyncd@.service</span><br><span class="line">/usr/share/man/man5/rsyncd.conf.5.gz</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-1-rsync命令"><a href="#3-2-2-1-rsync命令" class="headerlink" title="3.2.2.1 rsync命令"></a>3.2.2.1 rsync命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Local：代替cp</span></span><br><span class="line">rsync [OPTION]... SRC [SRC]... DEST <span class="comment">#本地文件同步</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#远程主机需要开启ssh协议</span></span><br><span class="line">rsync [OPTION]... [USER@]HOST:SRC [DEST] 		<span class="comment">#PULL 拉，将远程主机上的文件拉到本地</span></span><br><span class="line">rsync [OPTION]... SRC [SRC]... [USER@]HOST:DEST <span class="comment">#PUSH 推，将本地文件推送到远程主机上</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#远程主机需要开启rsync协议，需要搭建rsync服务器</span></span><br><span class="line">rsync [OPTION]... [USER@]HOST::SRC [DEST] 						<span class="comment">#PULL 拉，将远程主机上的文件拉到本地</span></span><br><span class="line">rsync [OPTION]... rsync://[USER@]HOST[:PORT]/SRC [DEST] 		<span class="comment">#PULL 拉，将远程主机上的文件拉到本地</span></span><br><span class="line">rsync [OPTION]... SRC [SRC]... [USER@]HOST::DEST 				<span class="comment">#PUSH 推，将本地文件推送到远程主机上</span></span><br><span class="line">rsync [OPTION]... SRC [SRC]... rsync://[USER@]HOST[:PORT]/DEST 	<span class="comment">#PUSH 推，将本地文件推送到远程主机上</span></span><br></pre></td></tr></table></figure>

<p><strong>rsync 有三种工作方式：</strong></p>
<ol>
<li><p>本地文件系统上实现同步。命令行语法格式为上述”Local”段的格式。</p>
</li>
<li><p>本地主机使用远程shell和远程主机通信。命令行语法格式为上述”Access via remote shell”段的格式。</p>
</li>
<li><p>本地主机通过网络套接字连接远程主机上的 rsync daemon。命令行语法格式为上述”Access via rsync daemon”段的格式。</p>
</li>
</ol>
<p>前两者的本质是通过本地或远程shell，而第3种方式则是让远程主机上运行rsyncd服务，使其监听在一个端口上，等待客户端的连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">-v						<span class="comment">#显示rsync过程中详细信息。可以使用&quot;-vvvv&quot;获取更详细信息。</span></span><br><span class="line">-P						<span class="comment">#显示文件传输的进度信息。(实际上&quot;-P&quot;=&quot;--partial --progress&quot;，其中的&quot;--progress&quot;才是显示进度信息的)。</span></span><br><span class="line">-n --dry-run			<span class="comment">#仅测试传输，而不实际传输。常和&quot;-vvvv&quot;配合使用来查看rsync是如何工作的。</span></span><br><span class="line">-a --archive			<span class="comment">#归档模式，表示递归传输并保持文件属性。等同于&quot;-rtopgDl&quot;。</span></span><br><span class="line">-r --recursive			<span class="comment">#递归到目录中去。</span></span><br><span class="line">-t --<span class="built_in">times</span>				<span class="comment">#保持mtime属性。强烈建议任何时候都加上&quot;-t&quot;，否则目标文件mtime会设置为系统时间，导致下次更新检查出mtime不同从而导致增量传输无效。</span></span><br><span class="line">-o --owner				<span class="comment">#保持owner属性(属主)。</span></span><br><span class="line">-g --group				<span class="comment">#保持group属性(属组)。</span></span><br><span class="line">-p --perms				<span class="comment">#保持perms属性(权限，不包括特殊权限)。</span></span><br><span class="line">-D						<span class="comment">#是&quot;--device --specials&quot;选项的组合，即也拷贝设备文件和特殊文件。</span></span><br><span class="line">-l --links				<span class="comment">#如果文件是软链接文件，则拷贝软链接本身而非软链接所指向的对象</span></span><br><span class="line">-z						<span class="comment">#传输时进行压缩提高效率</span></span><br><span class="line">-R --relative			<span class="comment">#使用相对路径。意味着将命令行中指定的全路径而非路径最尾部的文件名发送给服务端，包括它们的属性。用法见下文示例。</span></span><br><span class="line">--size-only				<span class="comment">#默认算法是检查文件大小和mtime不同的文件，使用此选项将只检查文件大小。</span></span><br><span class="line">-u --update				<span class="comment">#仅在源mtime比目标已存在文件的mtime新时才拷贝。注意，该选项是接收端判断的，不会影响删除行为。</span></span><br><span class="line">-d --<span class="built_in">dirs</span>				<span class="comment">#以不递归的方式拷贝目录本身。默认递归时，如果源为&quot;dir1/file1&quot;，则不会拷贝dir1目录，使用该选项将拷贝dir1但不拷贝file1。</span></span><br><span class="line">--max-size				<span class="comment">#限制rsync传输的最大文件大小。可以使用单位后缀，还可以是一个小数值(例如：&quot;--max-size=1.5m&quot;)</span></span><br><span class="line">--min-size				<span class="comment">#限制rsync传输的最小文件大小。这可以用于禁止传输小文件或那些垃圾文件。</span></span><br><span class="line">--exclude				<span class="comment">#指定排除规则来排除不需要传输的文件。</span></span><br><span class="line">--delete				<span class="comment">#以SRC为主，对DEST进行同步。多则删之，少则补之。注意&quot;--delete&quot;是在接收端执行的，所以它是在exclude/include规则生效之后才执行的。</span></span><br><span class="line">-b --backup				<span class="comment">#对目标上已存在的文件做一个备份，备份的文件名后默认使用&quot;~&quot;做后缀。</span></span><br><span class="line">--backup-dir			<span class="comment">#指定备份文件的保存路径。不指定时默认和待备份文件保存在同一目录下。</span></span><br><span class="line">-e						<span class="comment">#指定所要使用的远程shell程序，默认为ssh。</span></span><br><span class="line">--port					<span class="comment">#连接daemon时使用的端口号，默认为873端口。</span></span><br><span class="line">--password-file			<span class="comment">#daemon模式时的密码文件，可以从中读取密码实现非交互式。注意，这不是远程shell认证的密码，而是rsync模块认证的密码。</span></span><br><span class="line">-W --whole-file			<span class="comment">#sync将不再使用增量传输，而是全量传输。在网络带宽高于磁盘带宽时，该选项比增量传输更高效。</span></span><br><span class="line">--existing				<span class="comment">#要求只更新目标端已存在的文件，目标端还不存在的文件不传输。注意，使用相对路径时如果上层目录不存在也不会传输。</span></span><br><span class="line">--ignore-existing		<span class="comment">#要求只更新目标端不存在的文件。和&quot;--existing&quot;结合使用有特殊功能，见下文示例。</span></span><br><span class="line">--remove-source-files	<span class="comment">#要求删除源端已经成功传输的文件</span></span><br><span class="line">--bwlimit=RATE   		<span class="comment">#指定限速,单位默为为MB/s</span></span><br></pre></td></tr></table></figure>

<p>开启服务方式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rsync --daemon</span><br><span class="line"></span><br><span class="line">服务方式（守护进程）：持续运行，后台执行，一般都有对应的配置文件</span><br><span class="line">命令方式：一次性，前台执行，<span class="built_in">ls</span> -l -a </span><br></pre></td></tr></table></figure>

<p>范例：实现 rsync daemon 服务</p>
<p><img src="/Linux/service-manage/file-share/1753757619333-0d071e56-7f92-4910-a49c-208d825b70a5-17556838846748.png" alt="null"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在备份服务器启动 rsync 进程，启动失败，因为 /etc/rsyncd.conf 配置文件不存在</span></span><br><span class="line">[root@backup-centos8 ~]#rsync --daemon</span><br><span class="line">Failed to parse config file: /etc/rsyncd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建空配置文件</span></span><br><span class="line">[root@backup-centos8 ~]#<span class="built_in">touch</span> /etc/rsyncd.conf</span><br><span class="line"></span><br><span class="line">[root@backup-centos8 ~]#rsync --daemon</span><br><span class="line"></span><br><span class="line"><span class="comment">#监听 873 端口</span></span><br><span class="line">[root@backup-centos8 ~]#ss -ntlp|grep rsync</span><br><span class="line">LISTEN  0     5          0.0.0.0:873        0.0.0.0:*   <span class="built_in">users</span>:((&quot;rsync&quot;,pid=<span class="number">2921</span>,fd=<span class="number">4</span>)) </span><br><span class="line">LISTEN  0     5           [::]:873         [::]:*   <span class="built_in">users</span>:((&quot;rsync&quot;,pid=<span class="number">2921</span>,fd=<span class="number">5</span>)) </span><br><span class="line"></span><br><span class="line"><span class="comment">#修改服务端配置，指定共享目录</span></span><br><span class="line">[root@backup-centos8 ~]#<span class="built_in">cat</span> /etc/rsyncd.conf</span><br><span class="line">[backup] <span class="comment">#对外给用户看到的共享名</span></span><br><span class="line">path = /data/backup/ <span class="comment">#定义一个文件夹实现共享，实际的共享名	</span></span><br><span class="line"><span class="built_in">read</span> only = no  <span class="comment">#指定可读写,默认只读</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Ubuntu要重启，centos不用，直接生效</span></span><br><span class="line">[root@ubuntu ~]# systemctl restart rsync.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看rsync服务器的模块名称</span></span><br><span class="line">[root@data-centos8 ~]#rsync rsync://10.0.0.18</span><br><span class="line">backup</span><br><span class="line"></span><br><span class="line"><span class="comment">#两种写法都可以， :: 表示走rsync协议</span></span><br><span class="line">[root@data-centos8 ~]#rsync 10.0.0.18::</span><br><span class="line">backup</span><br><span class="line"></span><br><span class="line"><span class="comment">##访问rsync服务器的共享目录，看到有文件</span></span><br><span class="line">[root@data-centos8 ~]#rsync rsync://10.0.0.18/backup</span><br><span class="line">drwxr-xr-x             19 2023/12/11 17:23:49 .</span><br><span class="line">-rw-r--r--              0 2023/12/11 17:23:49 a.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#拉</span></span><br><span class="line">[root@data-centos8 ~]#rsync 10.0.0.18::backup/* .</span><br><span class="line">[root@data-centos8 ~]#rsync rsync://10.0.0.18/backup/* .</span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">ls</span></span><br><span class="line">anaconda-ks.cfg  a.txt  </span><br><span class="line"></span><br><span class="line"><span class="comment">#推</span></span><br><span class="line"><span class="comment">#传输文件到远程失败，此处的 root 是指rsync服务的用户，当前服务端并没有配置此信息，默认会被映射成 nobody</span></span><br><span class="line"><span class="comment">#注意：Ubuntu的nobody的组为nogroup，centos8nobody的组为nobody</span></span><br><span class="line">[root@data-centos8 ~]#rsync /etc/hosts 10.0.0.18::backup/hosts.txt</span><br><span class="line">rsync: mkstemp <span class="string">&quot;/.hosts.txt.84dX4G&quot;</span> (<span class="keyword">in</span> backup) failed: Permission denied (13)</span><br><span class="line">rsync error: some files/attrs were not transferred (see previous errors) (code 23) at main.c(1189) [sender=3.1.3]</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定目录给nobody权限，默认用户以nobody访问此目录</span></span><br><span class="line">[root@backup-centos8 ~]#setfacl -m u:nobody:rwx /data/backup/</span><br><span class="line"></span><br><span class="line"><span class="comment">#现在使用的是匿名连接</span></span><br><span class="line">[root@data-centos8 ~]#rsync /etc/networks root@10.0.0.18::backup <span class="comment">#默认所有用户都映射为nobody用户</span></span><br><span class="line">[root@data-centos8 ~]#rsync /etc/issue wang@10.0.0.18::backup    <span class="comment">#wang用户在服务端并不存在</span></span><br><span class="line">[root@data-centos8 ~]#rsync /etc/passwd 10.0.0.18::backup</span><br><span class="line">[root@data-centos8 ~]#rsync /etc/shells rsync://root@10.0.0.18/backup</span><br><span class="line"></span><br><span class="line"><span class="comment">#服务端查看，属主属组都是 nobody</span></span><br><span class="line">[root@backup-centos8 backup]#ll /data/backup/</span><br><span class="line">total 16</span><br><span class="line">-rw-r--r-- 1 root   root      0 Dec 11 17:23 a.txt</span><br><span class="line">-rw-r--r-- 1 nobody nobody   23 Dec 11 17:53 issue</span><br><span class="line">-rw-r--r-- 1 nobody nobody   58 Dec 11 17:52 networks</span><br><span class="line">-rw-r--r-- 1 nobody nobody 1522 Dec 11 17:53 passwd</span><br><span class="line">-rw-r--r-- 1 nobody nobody   44 Dec 11 17:53 shells</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-2-以独立服务方式运行rsync并实现验证功能"><a href="#3-2-2-2-以独立服务方式运行rsync并实现验证功能" class="headerlink" title="3.2.2.2 以独立服务方式运行rsync并实现验证功能"></a>3.2.2.2 以独立服务方式运行rsync并实现验证功能</h4><p>范例：以独立服务方式运行 rsync</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建rsync服务器的配置文件，指定映射账号，指定日志文件，指定远程连接用户名和密码，禁用匿名连接</span></span><br><span class="line">[root@centos8 ~]#vi /etc/rsyncd.conf</span><br><span class="line">uid = root  			<span class="comment">#指定以哪个用户身份访问共享目录，默认为nobody,注意:共享目录需要给此用户权限,否则无法访问</span></span><br><span class="line">gid = root  			<span class="comment">#指定以哪个组身份访问共享目录，默认为nobody,Ubuntu中为nogroup</span></span><br><span class="line"><span class="comment">#port = 874 			#可指定非标准端口,默认873/tcp</span></span><br><span class="line"><span class="comment">#use chroot = no</span></span><br><span class="line">max connections = 0  	<span class="comment">#最大并发连接数，0表示不限制</span></span><br><span class="line">ignore errors  			<span class="comment">#有错误可以跳过</span></span><br><span class="line">exclude = lost+found/  	<span class="comment">#排除lost+found目录，lost+found目录是在ext4文件系统才有，在/boot下，有些文件在使用的时候，因为文件系统出了问题等，使文件找不到自己所在的目录，那么就会放在lost+found目录里</span></span><br><span class="line"><span class="built_in">log</span> file = /var/log/rsyncd.log  	<span class="comment">#日志文件</span></span><br><span class="line">pid file = /var/run/rsyncd.pid  	<span class="comment">#pid文件，存主进程编号</span></span><br><span class="line">lock file = /var/run/rsyncd.lock  	<span class="comment">#锁文件，避免这个服务（多个进程）重复启动</span></span><br><span class="line">reverse lookup = no  				<span class="comment">#反向解析	</span></span><br><span class="line"><span class="comment">#hosts allow = 10.0.0.0/24</span></span><br><span class="line"></span><br><span class="line">[backup]  				<span class="comment">#每个模块名对应一个不同的path目录，如果同名后面模块生效</span></span><br><span class="line">path = /data/backup/ </span><br><span class="line">comment = backup <span class="built_in">dir</span>  	<span class="comment">#描述</span></span><br><span class="line"><span class="built_in">read</span> only = no   		<span class="comment">#默认是yes,即只读</span></span><br><span class="line">auth <span class="built_in">users</span> = rsyncuser  <span class="comment">#验证用户信息，必须以rsyncuser用户，并且以/etc/rsync.pas里存的密码成对验证才能访问，	默认anonymous可以访问rsync服务器</span></span><br><span class="line">secrets file = /etc/rsync.pas</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置文件内容</span></span><br><span class="line">[root@ubuntu2204 ~]#<span class="built_in">cat</span> /etc/rsyncd.conf</span><br><span class="line">uid = root</span><br><span class="line">gid = root</span><br><span class="line">max connections = 0</span><br><span class="line">ignore errors</span><br><span class="line">exclude = lost+found/</span><br><span class="line"><span class="built_in">log</span> file = /var/log/rsyncd.log</span><br><span class="line">pid file = /var/run/rsyncd.pid</span><br><span class="line">lock file = /var/run/rsyncd.lock</span><br><span class="line">reverse lookup = no</span><br><span class="line"></span><br><span class="line">[backup]</span><br><span class="line">path = /data/backup/</span><br><span class="line">comment = backup <span class="built_in">dir</span></span><br><span class="line"><span class="built_in">read</span> only = no</span><br><span class="line">auth <span class="built_in">users</span> = rsyncuser</span><br><span class="line">secrets file = /etc/rsync.pas</span><br><span class="line"></span><br><span class="line"><span class="comment">#服务器端准备目录</span></span><br><span class="line">[root@backup-centos8 ~]#<span class="built_in">mkdir</span> -pv /data/backup</span><br><span class="line"></span><br><span class="line"><span class="comment">#服务器端生成验证文件</span></span><br><span class="line">[root@backup-centos8 ~]#<span class="built_in">echo</span> <span class="string">&quot;rsyncuser:123456&quot;</span> &gt; /etc/rsync.pas</span><br><span class="line">[root@backup-centos8 ~]#<span class="built_in">chmod</span> 600 /etc/rsync.pas</span><br><span class="line"></span><br><span class="line"><span class="comment">#服务器端启动rsync服务</span></span><br><span class="line">[root@backup-centos8 ~]#rsync --daemon 				<span class="comment">#可加入/etc/rc.d/rc.local实现开机启动</span></span><br><span class="line">[root@backup-centos8 ~]#systemctl start rsyncd  	<span class="comment">#CentOS 7 以上版本</span></span><br><span class="line">[root@ubuntu ~]# systemctl restart rsync.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#客户端配置密码文件</span></span><br><span class="line"><span class="comment">#也可将密码赋值给环境变量RSYNC_PASSWORD变量,但不安全</span></span><br><span class="line"><span class="comment">#export RSYNC_PASSWORD=123456	</span></span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">echo</span> <span class="string">&quot;123456&quot;</span> &gt; /etc/rsync.pas</span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">chmod</span> 600 /etc/rsync.pas  <span class="comment">#此为必要项,权限必须修改</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看远程rsync服务器的模块信息</span></span><br><span class="line">[root@data-server ~]#rsync rsync://rsync服务器IP</span><br><span class="line">backup     backup <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#交互式验证查看具体模块内的文件</span></span><br><span class="line">[root@data-server ~]#rsync rsync://rsyncuser@rsync服务器IP/backup</span><br><span class="line">Password:</span><br><span class="line"></span><br><span class="line"><span class="comment">#非交互式查看共享目录</span></span><br><span class="line">[root@data-server ~]#rsync --password-file=/etc/rsync.pas rsync://rsyncuser@rsync服务器IP/backup</span><br><span class="line"></span><br><span class="line"><span class="comment">#客户端测试同步数据</span></span><br><span class="line">[root@data-centos8 ~]#rsync -avz --delete --password-file=/etc/rsync.pas /data/www/ rsyncuser@rsync服务器IP::backup</span><br><span class="line"></span><br><span class="line">[root@data-centos8 ~]#rsync -avz --delete  --password-file=/etc/rsync.pas rsyncuser@rsync服务器IP::backup  /data/www/</span><br></pre></td></tr></table></figure>

<h2 id="3-3-inotify-rsync-shell-脚本实现实时数据同步"><a href="#3-3-inotify-rsync-shell-脚本实现实时数据同步" class="headerlink" title="3.3 inotify+rsync+shell 脚本实现实时数据同步"></a>3.3 inotify+rsync+shell 脚本实现实时数据同步</h2><p><img src="/Linux/service-manage/file-share/1753757619402-54475ac7-0a7c-4d05-9c30-e54c62a2aad5-175568388467410.png" alt="null"></p>
<p><strong>注意: 此脚本执行前先确保两主机初始数据处于同步状态,此脚本实现后续的数据同步</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@data-centos8 ~]#vim inotify_rsync.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">SRC=<span class="string">&#x27;/data/www/&#x27;</span>   							<span class="comment">#注意最后的/</span></span><br><span class="line">DEST=<span class="string">&#x27;rsyncuser@rsync服务器IP::backup&#x27;</span></span><br><span class="line"><span class="comment">#Ubuntu20.04不支持 --password-file=/etc/rsync.pas，可以使用下面的变量实现</span></span><br><span class="line"><span class="built_in">export</span> RSYNC_PASSWORD=123456</span><br><span class="line"><span class="comment">#rpm -q inotify-tools &amp;&gt; /dev/null ||yum -y install inotify-tools</span></span><br><span class="line"><span class="comment">#rpm -q rsync &amp;&gt; /dev/null || yum -y install rsync</span></span><br><span class="line"></span><br><span class="line">inotifywait  -mrq  --exclude=<span class="string">&quot;.*\.swp&quot;</span> --timefmt <span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span> --format <span class="string">&#x27;%T %w %f&#x27;</span> -e create,delete,moved_from,moved_to,close_write,attrib <span class="variable">$&#123;SRC&#125;</span> | <span class="keyword">while</span> <span class="built_in">read</span> DATE TIME DIR FILE;<span class="keyword">do</span> 					FILEPATH=<span class="variable">$&#123;DIR&#125;</span><span class="variable">$&#123;FILE&#125;</span></span><br><span class="line">    rsync -az --delete  <span class="variable">$SRC</span> <span class="variable">$DEST</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;At <span class="variable">$&#123;TIME&#125;</span> on <span class="variable">$&#123;DATE&#125;</span>, file <span class="variable">$FILEPATH</span> was backuped up via rsync&quot;</span> &gt;&gt; /var/log/changelist.log</span><br><span class="line">    <span class="comment">#rsync -az --delete --password-file=/etc/rsync.pas $SRC $DEST &amp;&amp; echo &quot;At $&#123;TIME&#125; on $&#123;DATE&#125;, file $FILEPATH was backuped up via rsync&quot; &gt;&gt; /var/log/changelist.log</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看文件传输日志</span></span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">tail</span> -f /var/log/changelist.log</span><br></pre></td></tr></table></figure>

<p>后台执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 开启screen窗口</span><br><span class="line">2 <span class="built_in">nohup</span> bash inotify_rsync.sh &amp;&gt;/dev/dull &amp;</span><br></pre></td></tr></table></figure>

<h2 id="3-4-sersync-实现实时数据同步"><a href="#3-4-sersync-实现实时数据同步" class="headerlink" title="3.4 sersync 实现实时数据同步"></a>3.4 sersync 实现实时数据同步</h2><h3 id="3-4-1-sersync-介绍"><a href="#3-4-1-sersync-介绍" class="headerlink" title="3.4.1 sersync 介绍"></a>3.4.1 sersync 介绍</h3><p>sersync类似于inotify，同样用于监控，但它克服了inotify的缺点，功能更加强大</p>
<p>inotify最大的不足是会产生重复事件，或者同一个目录下多个文件的操作会产生多个事件，例如，当监控目录中有5个文件时，删除目录时会产生6个监控事件，从而导致重复调用rsync命令。另外比如：vim文件时，inotify会监控到临时文件的事件，但这些事件相对于rsync来说是不应该被监控的</p>
<p>sersync 优点：</p>
<ul>
<li><p>sersync是使用c++编写，而且对linux系统文件系统产生的临时文件和重复的文件操作进行过滤，</p>
</li>
<li><p>所以在结合rsync同步的时候，节省了运行时耗和网络资源。因此更快。</p>
</li>
<li><p>sersync配置很简单，其中提供了静态编译好的二进制文件和xml配置文件，直接使用即可</p>
</li>
<li><p>sersync使用多线程进行同步，尤其在同步较大文件时，能够保证多个服务器实时保持同步状态</p>
</li>
<li><p>sersync有出错处理机制，通过失败队列对出错的文件重新同步，如果仍旧失败，则按设定时长对同步失败的文件重新同步</p>
</li>
<li><p>sersync不仅可以实现实时同步，另外还自带crontab功能，只需在xml配置文件中开启，即也可以按要求隔一段时间整体同步一次，而无需再额外配置crontab功能</p>
</li>
</ul>
<p>sersync使用场景</p>
<ul>
<li><p>网站数据实时备份：自动同步网站服务器上的数据变更到备份服务器。</p>
</li>
<li><p>集群数据一致性维护：在多个服务器之间同步文件，保持数据的一致性。</p>
</li>
<li><p>文件共享：在不同的机器或位置之间实时共享文件数据。</p>
</li>
</ul>
<p>sersync 配合 rsync 使用，可以实现较为高效和稳定的文件同步解冗，特别适用于对实时性要求较高的环境。sersync 可以二次开发</p>
<p>同步原理</p>
<ul>
<li><p>在Master服务器上开启sersync服务，sersync负责监控配置路径中文件系统事件的变化；</p>
</li>
<li><p>Master服务器上面的sersync服务调用rsync命令把更新的文件推送到目标服务器Slave上面；</p>
</li>
<li><p>在Master服务器上面安装sersync服务及要确保有rsync命令，在Slave服务器上面配置rsync server。</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://code.google.com/archive/p/sersync/">sersync项目地址</a></p>
<p><a target="_blank" rel="noopener" href="https://code.google.com/archive/p/sersync/downloads">sersync下载地址</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#下载</span></span><br><span class="line">[root@ubuntu ~]# wget https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/sersync/sersync2.5.4_64bit_binary_stable_final.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#解压</span></span><br><span class="line">[root@ubuntu ~]# tar xf sersync2.5.4_64bit_binary_stable_final.tar.gz</span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span></span><br><span class="line">GNU-Linux-x86 sersync2.5.4_64bit_binary_stable_final.tar.gz snap</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> GNU-Linux-x86/</span><br><span class="line">confxml.xml sersync2</span><br><span class="line"></span><br><span class="line"><span class="comment">#移动</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">mv</span> GNU-Linux-x86/ /usr/local/sersync</span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> /usr/local/sersync/</span><br><span class="line">confxml.xml sersync2</span><br></pre></td></tr></table></figure>

<p>sersync2 命令用法和参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu sersync]# ./sersync2 -h</span><br><span class="line"><span class="built_in">set</span> the system param</span><br><span class="line">execute：<span class="built_in">echo</span> 50000000 &gt; /proc/sys/fs/inotify/max_user_watches</span><br><span class="line">execute：<span class="built_in">echo</span> 327679 &gt; /proc/sys/fs/inotify/max_queued_events</span><br><span class="line">parse the <span class="built_in">command</span> param</span><br><span class="line">_______________________________________________________</span><br><span class="line">参数-d:启用守护进程模式</span><br><span class="line">参数-r:在监控前，将监控目录与远程主机用rsync命令推送一遍</span><br><span class="line">c参数-n: 指定开启守护线程的数量，默认为10个</span><br><span class="line">参数-o:指定配置文件，默认使用confxml.xml文件</span><br><span class="line">参数-m:单独启用其他模块，使用 -m refreshCDN 开启刷新CDN模块</span><br><span class="line">参数-m:单独启用其他模块，使用 -m socket 开启socket模块</span><br><span class="line">参数-m:单独启用其他模块，使用 -m http 开启http模块</span><br><span class="line">不加-m参数，则默认执行同步程序</span><br><span class="line">________________________________________________________________</span><br></pre></td></tr></table></figure>

<h3 id="3-4-2-基于rsync-daemon-实现-sersync"><a href="#3-4-2-基于rsync-daemon-实现-sersync" class="headerlink" title="3.4.2 基于rsync daemon 实现 sersync"></a>3.4.2 基于rsync daemon 实现 sersync</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在数据服务器上下载sersync，并拷贝至相应的目录，设置PATH变量</span></span><br><span class="line">[root@data-centos8 ~]#wget https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/sersync/sersync2.5.4_64bit_binary_stable_final.tar.gz</span><br><span class="line"></span><br><span class="line">[root@data-centos8 ~]#tar xf sersync2.5.4_64bit_binary_stable_final.tar.gz</span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">cp</span> -a GNU-Linux-x86 /usr/local/sersync</span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">echo</span> <span class="string">&#x27;PATH=/usr/local/sersync:$PATH&#x27;</span> &gt;/etc/profile.d/sersync.sh</span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">source</span> /etc/profile.d/sersync.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#sersync目录只有两个文件：一个是二进制程序文件，一个是xml格式的配置文件</span></span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">ls</span> /usr/local/sersync/</span><br><span class="line">confxml.xml sersync2</span><br><span class="line"></span><br><span class="line"><span class="comment">#确认安装rsync客户端工具</span></span><br><span class="line">[root@data-centos8 ~]#rpm -q rsync &amp;&gt; /dev/null || dnf -y install rsync</span><br><span class="line"></span><br><span class="line"><span class="comment">#备份sersync配置文件</span></span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">cp</span> /usr/local/sersync/confxml.xml&#123;,.bak&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改sersync配置文件</span></span><br><span class="line">[root@data-centos8 ~]#vim /usr/local/sersync/confxml.xml</span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;ISO-8859-1&quot;</span>?&gt;</span><br><span class="line">&lt;<span class="built_in">head</span> version=<span class="string">&quot;2.5&quot;</span>&gt;</span><br><span class="line"> 	&lt;host hostip=<span class="string">&quot;localhost&quot;</span> port=<span class="string">&quot;8008&quot;</span>&gt;&lt;/host&gt;</span><br><span class="line"></span><br><span class="line"> 	&lt;debug start=<span class="string">&quot;false&quot;</span>/&gt;  						<span class="comment">#是否开启调试模式</span></span><br><span class="line"> 	&lt;fileSystem xfs=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line"> 	&lt;filter start=<span class="string">&quot;false&quot;</span>&gt;  						<span class="comment">#不开启文件过滤功能，当为true时,以下类型的文件将不同步</span></span><br><span class="line">    &lt;exclude expression=<span class="string">&quot;(.*)\.svn&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line">    &lt;exclude expression=<span class="string">&quot;(.*)\.gz&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line">    &lt;exclude expression=<span class="string">&quot;^info/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line">    &lt;exclude expression=<span class="string">&quot;^static/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/filter&gt;</span><br><span class="line"></span><br><span class="line"> 	&lt;inotify&gt;  							<span class="comment">#监控事件，默认监控delete/close_write/moved_from/moved_to/create folder</span></span><br><span class="line">    &lt;delete start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;createFolder start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;createFile start=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">    &lt;closeWrite start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;moveFrom start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;moveTo start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;attrib start=<span class="string">&quot;true&quot;</span>/&gt;  			<span class="comment">#修改此行为true，文件属性变化后也会同步</span></span><br><span class="line">    &lt;modify start=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line"> 	&lt;/inotify&gt;</span><br><span class="line"></span><br><span class="line"> 	</span><br><span class="line"> 	&lt;sersync&gt;  							<span class="comment">#rsync命令的配置段</span></span><br><span class="line">    &lt;localpath watch=<span class="string">&quot;/data/www&quot;</span>&gt; 		<span class="comment">#修改此行,需要同步的源目录或文件，建议同步目录</span></span><br><span class="line"> 		&lt;remote ip=<span class="string">&quot;备份服务器IP&quot;</span> name=<span class="string">&quot;backup&quot;</span>/&gt;  	<span class="comment">#修改此行,指定远程主机地址和目录，即备份服务器地址和rsyncdaemon的模块名，如果下面开启了ssh start，此时name为远程shell方式运行时的目标目录</span></span><br><span class="line"> 		&lt;!--&lt;remote ip=<span class="string">&quot;192.168.8.39&quot;</span> name=<span class="string">&quot;tongbu&quot;</span>/&gt;--&gt;</span><br><span class="line"> 		&lt;!--&lt;remote ip=<span class="string">&quot;192.168.8.40&quot;</span> name=<span class="string">&quot;tongbu&quot;</span>/&gt;--&gt;</span><br><span class="line">    &lt;/localpath&gt;</span><br><span class="line"></span><br><span class="line">    &lt;rsync&gt;</span><br><span class="line"> 	&lt;commonParams params=<span class="string">&quot;-artuz&quot;</span>/&gt;  	<span class="comment">#指定rsync选项</span></span><br><span class="line"> 	&lt;auth start=<span class="string">&quot;true&quot;</span> <span class="built_in">users</span>=<span class="string">&quot;rsyncuser&quot;</span> passwordfile=<span class="string">&quot;/etc/rsync.pas&quot;</span>/&gt; 		<span class="comment">#修改此行为true,指定备份服务器的rsync配置的用户和密码文件</span></span><br><span class="line"> 	&lt;userDefinedPort start=<span class="string">&quot;false&quot;</span> port=<span class="string">&quot;874&quot;</span>/&gt;&lt;!-- port=874 --&gt;				<span class="comment">#指定rsync的非标准端口号</span></span><br><span class="line"> 	&lt;<span class="built_in">timeout</span> start=<span class="string">&quot;false&quot;</span> <span class="keyword">time</span>=<span class="string">&quot;100&quot;</span>/&gt;&lt;!-- <span class="built_in">timeout</span>=100 --&gt;</span><br><span class="line"> 	&lt;ssh start=<span class="string">&quot;false&quot;</span>/&gt; 							<span class="comment">#默认使用rsync daemon运行rsync命令,true为使用远程shell模式</span></span><br><span class="line">    &lt;/rsync&gt;</span><br><span class="line"></span><br><span class="line">    &lt;failLog path=<span class="string">&quot;/tmp/rsync_fail_log.sh&quot;</span> timeToExecute=<span class="string">&quot;60&quot;</span>/&gt;&lt;!--default every 60mins execute once--&gt;  <span class="comment">#错误重传及日志文件路径</span></span><br><span class="line">    &lt;crontab start=<span class="string">&quot;false&quot;</span> schedule=<span class="string">&quot;600&quot;</span>&gt;&lt;!--600mins--&gt; 	<span class="comment">#不开启crontab功能</span></span><br><span class="line"> 		&lt;crontabfilter start=<span class="string">&quot;false&quot;</span>&gt;  						<span class="comment">#不开启crontab定时传输的筛选功能</span></span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;*.php&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;info/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line"> 		&lt;/crontabfilter&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/crontab&gt;</span><br><span class="line"></span><br><span class="line">    &lt;plugin start=<span class="string">&quot;false&quot;</span> name=<span class="string">&quot;command&quot;</span>/&gt;</span><br><span class="line"> 	&lt;/sersync&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#####################################以下行不需要修改</span></span><br><span class="line"><span class="comment">####################################</span></span><br><span class="line"> 	&lt;plugin name=<span class="string">&quot;command&quot;</span>&gt;</span><br><span class="line">    &lt;param prefix=<span class="string">&quot;/bin/sh&quot;</span> suffix=<span class="string">&quot;&quot;</span> ignoreError=<span class="string">&quot;true&quot;</span>/&gt; &lt;!--prefix /opt/tongbu/mmm.sh suffix--&gt;</span><br><span class="line">    &lt;filter start=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line"> 		&lt;include expression=<span class="string">&quot;(.*)\.php&quot;</span>/&gt;</span><br><span class="line"> 		&lt;include expression=<span class="string">&quot;(.*)\.sh&quot;</span>/&gt;</span><br><span class="line">    &lt;/filter&gt;</span><br><span class="line"></span><br><span class="line"> 	&lt;/plugin&gt;</span><br><span class="line"></span><br><span class="line"> 	</span><br><span class="line"> 	&lt;plugin name=<span class="string">&quot;socket&quot;</span>&gt;</span><br><span class="line">    &lt;localpath watch=<span class="string">&quot;/opt/tongbu&quot;</span>&gt;</span><br><span class="line"> 		&lt;deshost ip=<span class="string">&quot;192.168.138.20&quot;</span> port=<span class="string">&quot;8009&quot;</span>/&gt;</span><br><span class="line">    &lt;/localpath&gt;</span><br><span class="line"></span><br><span class="line"> 	&lt;/plugin&gt;</span><br><span class="line"></span><br><span class="line"> 	&lt;plugin name=<span class="string">&quot;refreshCDN&quot;</span>&gt;</span><br><span class="line">    &lt;localpath watch=<span class="string">&quot;/data0/htdocs/cms.xoyo.com/site/&quot;</span>&gt;</span><br><span class="line"> 		&lt;cdninfo domainname=<span class="string">&quot;ccms.chinacache.com&quot;</span> port=<span class="string">&quot;80&quot;</span> username=<span class="string">&quot;xxxx&quot;</span>passwd=<span class="string">&quot;xxxx&quot;</span>/&gt;</span><br><span class="line"> 		&lt;sendurl base=<span class="string">&quot;http://pic.xoyo.com/cms&quot;</span>/&gt;</span><br><span class="line"> 		&lt;regexurl regex=<span class="string">&quot;false&quot;</span> match=<span class="string">&quot;cms.xoyo.com/site([/a-zA-Z0-9]*).xoyo.com/images&quot;</span>/&gt;</span><br><span class="line">    &lt;/localpath&gt;</span><br><span class="line"></span><br><span class="line"> 	&lt;/plugin&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建连接rsynd服务器的用户密码文件,并必须修改权限</span></span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">echo</span> 123456 &gt; /etc/rsync.pas</span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">chmod</span> 600 /etc/rsync.pas</span><br><span class="line"></span><br><span class="line"><span class="comment">#以后台方式执行同步</span></span><br><span class="line">[root@data-centos8 ~]#sersync2 -dro /usr/local/sersync/confxml.xml</span><br><span class="line"><span class="built_in">set</span> the system param</span><br><span class="line">execute：<span class="built_in">echo</span> 50000000 &gt; /proc/sys/fs/inotify/max_user_watches</span><br><span class="line">execute：<span class="built_in">echo</span> 327679 &gt; /proc/sys/fs/inotify/max_queued_events</span><br><span class="line">parse the <span class="built_in">command</span> param</span><br><span class="line">option: -d run as a daemon</span><br><span class="line">option: -r rsync all the <span class="built_in">local</span> files to the remote servers before the sersync</span><br><span class="line">work</span><br><span class="line">option: -o config xml name： /usr/local/sersync/confxml.xml</span><br><span class="line">daemon thread num: 10</span><br><span class="line">parse xml config file</span><br><span class="line">host ip : localhost host port: 8008</span><br><span class="line">daemon start，sersync run behind the console</span><br><span class="line">use rsync password-file :</span><br><span class="line">user is rsyncuser</span><br><span class="line">passwordfile is /etc/rsync.pas</span><br><span class="line">config xml parse success</span><br><span class="line">please <span class="built_in">set</span> /etc/rsyncd.conf max connections=0 Manually</span><br><span class="line">sersync working thread 12  = 1(primary thread) + 1(fail retry thread) +</span><br><span class="line">10(daemon sub threads)</span><br><span class="line">Max threads numbers is: 22 = 12(Thread pool nums) + 10(Sub threads)</span><br><span class="line">please according your cpu ，use -n param to adjust the cpu rate</span><br><span class="line">------------------------------------------</span><br><span class="line">rsync the directory recursivly to the remote servers once</span><br><span class="line">working please <span class="built_in">wait</span>...</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果同步失败,可以手动执行下面命令,观察过程</span></span><br><span class="line">[root@data-centos8 ~]# <span class="built_in">cd</span> /data/www &amp;&amp; rsync -artuz -R --delete ./ rsyncuser@backup-server::backup --password-file=/etc/rsync.pas &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">run the sersync:</span><br><span class="line">watch path is: /data/www</span><br><span class="line">________________________________________________________________</span><br><span class="line">    </span><br><span class="line"><span class="comment">#sersync支持多实例，也即监控多个目录时，只需分别配置不同配置文件，然后使用sersync2指定对应配置文件运行</span></span><br><span class="line">[root@data-centos8 ~]#sersync2 -rd -o /etc/sersync.d/nginx.xml</span><br></pre></td></tr></table></figure>

<h3 id="3-4-3-基于远程shell-实现-sersync"><a href="#3-4-3-基于远程shell-实现-sersync" class="headerlink" title="3.4.3 基于远程shell 实现 sersync"></a>3.4.3 基于远程shell 实现 sersync</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#不需要配置rsync daemon,只需要配置基于key验证的ssh即可</span></span><br><span class="line">[root@data-centos8 ~]#ssh-keygen</span><br><span class="line">[root@data-centos8 ~]#ssh-copy-id backup-server</span><br><span class="line"></span><br><span class="line"><span class="comment">#下载sersync，并拷贝至相应的目录，设置PATH变量同5.5.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改sersync配置文件</span></span><br><span class="line">[root@data-centos8 ~]#<span class="built_in">cat</span> /usr/local/sersync/confxml.xml</span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;ISO-8859-1&quot;</span>?&gt;</span><br><span class="line">&lt;<span class="built_in">head</span> version=<span class="string">&quot;2.5&quot;</span>&gt;</span><br><span class="line"> 	&lt;host hostip=<span class="string">&quot;localhost&quot;</span> port=<span class="string">&quot;8008&quot;</span>&gt;&lt;/host&gt;</span><br><span class="line"></span><br><span class="line"> 	&lt;debug start=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">     &lt;fileSystem xfs=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line"> 	&lt;filter start=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line">    &lt;exclude expression=<span class="string">&quot;(.*)\.svn&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line">    &lt;exclude expression=<span class="string">&quot;(.*)\.gz&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line">    &lt;exclude expression=<span class="string">&quot;^info/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line">    &lt;exclude expression=<span class="string">&quot;^static/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line"> 	&lt;/filter&gt;</span><br><span class="line"></span><br><span class="line"> 	&lt;inotify&gt;</span><br><span class="line">    &lt;delete start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;createFolder start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;createFile start=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">    &lt;closeWrite start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;moveFrom start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;moveTo start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;attrib start=<span class="string">&quot;true&quot;</span>/&gt;  <span class="comment">#修改此行为true</span></span><br><span class="line">    &lt;modify start=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line"> 	&lt;/inotify&gt;</span><br><span class="line"></span><br><span class="line">     &lt;sersync&gt;</span><br><span class="line">    &lt;localpath watch=<span class="string">&quot;/data/www&quot;</span>&gt; <span class="comment">#修改此行,指定源数据目录</span></span><br><span class="line"> 		&lt;remote ip=<span class="string">&quot;备份服务器IP&quot;</span> name=<span class="string">&quot;/data/backup&quot;</span>/&gt; <span class="comment">#修改此行指定备份服务器地址和备份目标目录</span></span><br><span class="line"> 		&lt;!--&lt;remote ip=<span class="string">&quot;192.168.8.39&quot;</span> name=<span class="string">&quot;tongbu&quot;</span>/&gt;--&gt;</span><br><span class="line"> 		&lt;!--&lt;remote ip=<span class="string">&quot;192.168.8.40&quot;</span> name=<span class="string">&quot;tongbu&quot;</span>/&gt;--&gt;</span><br><span class="line">    &lt;/localpath&gt;</span><br><span class="line"></span><br><span class="line">    &lt;rsync&gt;</span><br><span class="line"> 		&lt;commonParams params=<span class="string">&quot;-artuz&quot;</span>/&gt;</span><br><span class="line"> 		&lt;auth start=<span class="string">&quot;false&quot;</span> <span class="built_in">users</span>=<span class="string">&quot;root&quot;</span> passwordfile=<span class="string">&quot;/etc/rsync.pas&quot;</span>/&gt; <span class="comment">#必须修改此行,不启用认证start=false</span></span><br><span class="line"> 		&lt;userDefinedPort start=<span class="string">&quot;false&quot;</span> port=<span class="string">&quot;874&quot;</span>/&gt;&lt;!-- port=874 --&gt;</span><br><span class="line"> 		&lt;<span class="built_in">timeout</span> start=<span class="string">&quot;false&quot;</span> <span class="keyword">time</span>=<span class="string">&quot;100&quot;</span>/&gt;&lt;!-- <span class="built_in">timeout</span>=100 --&gt;</span><br><span class="line"> 		&lt;ssh start=<span class="string">&quot;true&quot;</span>/&gt; <span class="comment">#修改此行为true,使用远程shell方式的rsync连接方式，无需在目标主机上配置启动rsync daemon服务</span></span><br><span class="line"> 		</span><br><span class="line"> 		</span><br><span class="line"><span class="comment">#####################################以下行不需要修改</span></span><br><span class="line"><span class="comment">####################################</span></span><br><span class="line">    &lt;/rsync&gt;</span><br><span class="line"></span><br><span class="line">    &lt;failLog path=<span class="string">&quot;/tmp/rsync_fail_log.sh&quot;</span> timeToExecute=<span class="string">&quot;60&quot;</span>/&gt;&lt;!--default every 60mins execute once--&gt;</span><br><span class="line">    &lt;crontab start=<span class="string">&quot;false&quot;</span> schedule=<span class="string">&quot;600&quot;</span>&gt;&lt;!--600mins--&gt;</span><br><span class="line"> 		&lt;crontabfilter start=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;*.php&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;info/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line"></span><br><span class="line"> 		&lt;/crontabfilter&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/crontab&gt;</span><br><span class="line"></span><br><span class="line">    &lt;plugin start=<span class="string">&quot;false&quot;</span> name=<span class="string">&quot;command&quot;</span>/&gt;</span><br><span class="line"> 	&lt;/sersync&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#将中间的行可以删除</span></span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">[root@data-centos8 ~]#sersync2 -dro /usr/local/sersync/confxml.xml</span><br><span class="line"><span class="built_in">set</span> the system param</span><br><span class="line">execute：<span class="built_in">echo</span> 50000000 &gt; /proc/sys/fs/inotify/max_user_watches</span><br><span class="line">execute：<span class="built_in">echo</span> 327679 &gt; /proc/sys/fs/inotify/max_queued_events</span><br><span class="line">parse the <span class="built_in">command</span> param</span><br><span class="line">option: -d run as a daemon</span><br><span class="line">option: -r rsync all the <span class="built_in">local</span> files to the remote servers before the sersync</span><br><span class="line">work</span><br><span class="line">option: -o config xml name： /apps/sersync/confxml.xml</span><br><span class="line">daemon thread num: 10</span><br><span class="line">parse xml config file</span><br><span class="line">host ip : localhost host port: 8008</span><br><span class="line">daemon start，sersync run behind the console</span><br><span class="line">config xml parse success</span><br><span class="line">please <span class="built_in">set</span> /etc/rsyncd.conf max connections=0 Manually</span><br><span class="line">sersync working thread 12  = 1(primary thread) + 1(fail retry thread) +</span><br><span class="line">10(daemon sub threads)</span><br><span class="line">Max threads numbers is: 22 = 12(Thread pool nums) + 10(Sub threads)</span><br><span class="line">please according your cpu ，use -n param to adjust the cpu rate</span><br><span class="line">------------------------------------------</span><br><span class="line">rsync the directory recursivly to the remote servers once</span><br><span class="line">working please <span class="built_in">wait</span>...</span><br><span class="line">execute <span class="built_in">command</span>: <span class="built_in">cd</span> /data/www &amp;&amp; rsync -auz -R --delete ./  -e ssh</span><br><span class="line">10.0.0.18:/data/backup &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">run the sersync:</span><br><span class="line">watch path is: /data/www</span><br></pre></td></tr></table></figure>

<h1 id="4-实战案例：实现基于分布式的LAMP架构，并将NFS实时同步到备份服务器"><a href="#4-实战案例：实现基于分布式的LAMP架构，并将NFS实时同步到备份服务器" class="headerlink" title="4 实战案例：实现基于分布式的LAMP架构，并将NFS实时同步到备份服务器"></a>4 实战案例：实现基于分布式的LAMP架构，并将NFS实时同步到备份服务器</h1><p><img src="/Linux/service-manage/file-share/1753757619488-6a4e9c59-197f-42e8-ab7a-9dea2cd4a17b-17556838846749.png" alt="null"></p>
<table>
<thead>
<tr>
<th>配置</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>10.0.0.176（centos）</td>
<td>DNS</td>
</tr>
<tr>
<td>10.0.0.177</td>
<td>MySQL</td>
</tr>
<tr>
<td>10.0.0.179（rocky）</td>
<td>Web</td>
</tr>
<tr>
<td>10.0.0.180</td>
<td>Web</td>
</tr>
<tr>
<td>10.0.0.182（Ubuntu）</td>
<td>NFS</td>
</tr>
<tr>
<td>10.0.0.183</td>
<td>NFS BACKUP</td>
</tr>
</tbody></table>
<p>配置DNS</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@DNS ~]#yum -y install <span class="built_in">bind</span> bind-utils</span><br><span class="line">[root@DNS ~]#systemctl <span class="built_in">enable</span> --now named</span><br><span class="line">[root@DNS ~]#vim /etc/named.rfc1912.zones</span><br><span class="line">zone <span class="string">&quot;wu.org&quot;</span> IN &#123;</span><br><span class="line">    <span class="built_in">type</span> master;</span><br><span class="line">    file <span class="string">&quot;wu.org.zone&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@DNS ~]#vim /etc/named.conf      </span><br><span class="line">// listen-on port 53 &#123; 127.0.0.1; &#125;;</span><br><span class="line">// allow-query   &#123; localhost; &#125;;</span><br><span class="line"></span><br><span class="line">[root@DNS ~]#vim /var/named/wu.org.zone</span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@   IN  SOA     wu.org. admin.wu.com. (1 3H 1M 1D 1W)</span><br><span class="line">        NS      master    </span><br><span class="line">master  A       10.0.0.176</span><br><span class="line">www     A       10.0.0.179</span><br><span class="line">www     A       10.0.0.180</span><br><span class="line"></span><br><span class="line">[root@DNS ~]#<span class="built_in">chmod</span> 640 /var/named/wu.org.zone </span><br><span class="line">[root@DNS ~]#<span class="built_in">chgrp</span> named /var/named/wu.org.zone</span><br><span class="line">[root@DNS ~]#named-checkconf</span><br><span class="line">[root@DNS ~]#named-checkzone wu.org /var/named/wu.org.zone</span><br><span class="line">[root@DNS ~]#rndc reload</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@DNS ~]#host www.wu.org 127.0.0.1</span><br><span class="line">Using domain server:</span><br><span class="line">Name: 127.0.0.1</span><br><span class="line">Address: 127.0.0.1#53</span><br><span class="line">Aliases: </span><br><span class="line"></span><br><span class="line">www.wu.org has address 10.0.0.179</span><br><span class="line">www.wu.org has address 10.0.0.180</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator&gt;nslookup</span><br><span class="line"></span><br><span class="line">&gt; server 10.0.0.176</span><br><span class="line">默认服务器:  [10.0.0.176]</span><br><span class="line">Address:  10.0.0.176</span><br><span class="line"></span><br><span class="line">&gt; www.wu.org</span><br><span class="line">服务器:  [10.0.0.176]</span><br><span class="line">Address:  10.0.0.176</span><br><span class="line"></span><br><span class="line">名称:    www.wu.org</span><br><span class="line">Addresses:  10.0.0.180</span><br><span class="line">          10.0.0.179</span><br><span class="line">          </span><br><span class="line"><span class="comment">#Switchhosts软件</span></span><br><span class="line">10.0.0.179 www.wu.org</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator&gt;ping www.wu.org</span><br><span class="line">正在 Ping www.wu.org [10.0.0.179] 具有 32 字节的数据:</span><br><span class="line">来自 10.0.0.179 的回复: 字节=32 时间&lt;1ms TTL=64</span><br><span class="line">来自 10.0.0.179 的回复: 字节=32 时间&lt;1ms TTL=64</span><br></pre></td></tr></table></figure>

<p>配置Web1和MySQL</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@Web1 ~]#yum -y install httpd php php-mysqlnd php-json nfs-utils</span><br><span class="line">[root@Web1 ~]#systemctl enable --now httpd</span><br><span class="line">[root@Web1 ~]#wget https://cn.wordpress.org/latest-zh_CN.zip</span><br><span class="line">[root@Web1 ~]#unzip latest-zh_CN.zip</span><br><span class="line">[root@Web1 ~]#mv wordpress/* /var/www/html/</span><br><span class="line">[root@Web1 ~]#chown apache.apache /var/www/html/ -R</span><br><span class="line"></span><br><span class="line">[root@MySQL ~]#yum install -y mysql-server</span><br><span class="line">[root@MySQL ~]#systemctl enable --now mysqld</span><br><span class="line">#Ubuntu默认开启mysql，但是要改端口指向地址</span><br><span class="line">vim /etc/mysql/mysql.conf.d/mysqld.cnf</span><br><span class="line">#bind...</span><br><span class="line">#mysql...</span><br><span class="line">systemctl restart mysql</span><br><span class="line"></span><br><span class="line">mysql&gt; create database wordpress;</span><br><span class="line">mysql&gt; create user wordpress@&#x27;10.0.0.%&#x27; identified by &#x27;123456&#x27;;</span><br><span class="line">mysql&gt; grant all on wordpress.* to wordpress@&#x27;10.0.0.%&#x27;;</span><br><span class="line"></span><br><span class="line">Windows访问：www.wu.org</span><br><span class="line"></span><br><span class="line">[root@Web1 ~]#cd /var/www/html/wp-content/</span><br><span class="line">[root@Web1 wp-content]#ls</span><br><span class="line">index.php  languages  plugins  themes  uploads</span><br><span class="line">#说明</span><br><span class="line">themes:主题</span><br><span class="line">uploads：图片</span><br></pre></td></tr></table></figure>

<p>配置NFS</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[root@NFS ~]#apt update &amp;&amp; apt install -y nfs-server</span><br><span class="line">[root@NFS ~]#<span class="built_in">mkdir</span> -p /data/www</span><br><span class="line">[root@NFS ~]#<span class="built_in">mkdir</span> /etc/exports.d</span><br><span class="line"></span><br><span class="line">[root@NFS ~]#vim /etc/exports.d/wordpress.exports</span><br><span class="line">/data/www 10.0.0.0/24(rw)</span><br><span class="line">[root@NFS ~]#exportfs -r</span><br><span class="line"></span><br><span class="line">[root@NFS ~]#groupadd -g 48 apache</span><br><span class="line">[root@NFS ~]#useradd -u 48 -g 48 apache</span><br><span class="line">[root@NFS ~]#<span class="built_in">chown</span> -R apache.apache /data/www/</span><br><span class="line"><span class="comment">#说明</span></span><br><span class="line">如果web服务器为Ubuntu，就只需执行<span class="built_in">chown</span> -R www-data.www-data /data/www/，因为Ubuntu共有www-data账号</span><br><span class="line"></span><br><span class="line">[root@Web1 ~]#rsync -av /var/www/html/ 10.0.0.182:/data/www/</span><br><span class="line">[root@NFS ~]#ll /data/www/</span><br><span class="line">total 244</span><br><span class="line">drwxr-xr-x  5 apache apache  4096 Dec 13 06:23 ./</span><br><span class="line">drwxr-xr-x  3 root   root    4096 Dec 13 06:50 ../</span><br><span class="line">-rw-r--r--  1 apache apache   228 Dec 13 06:23 .htaccess</span><br><span class="line">-rw-r--r--  1 apache apache   405 Feb  6  2020 index.php</span><br><span class="line">-rw-r--r--  1 apache apache 19915 Dec  6 18:09 license.txt</span><br><span class="line">-rw-r--r--  1 apache apache  7399 Dec  6 18:09 readme.html</span><br><span class="line">-rw-r--r--  1 apache apache  7211 May 12  2023 wp-activate.php</span><br><span class="line">drwxr-xr-x  9 apache apache  4096 Dec  6 18:00 wp-admin/</span><br><span class="line">-rw-r--r--  1 apache apache   351 Feb  6  2020 wp-blog-header.php</span><br><span class="line">-rw-r--r--  1 apache apache  2323 Jun 14 14:11 wp-comments-post.php</span><br><span class="line">-rw-rw-rw-  1 apache apache  3293 Dec 13 06:09 wp-config.php</span><br><span class="line">-rw-r--r--  1 apache apache  3013 Dec  6 18:09 wp-config-sample.php</span><br><span class="line">drwxr-xr-x  6 apache apache  4096 Dec 13 06:28 wp-content/</span><br><span class="line">-rw-r--r--  1 apache apache  5638 May 30  2023 wp-cron.php</span><br><span class="line">drwxr-xr-x 27 apache apache 12288 Dec  6 18:09 wp-includes/</span><br><span class="line">-rw-r--r--  1 apache apache  2502 Nov 26  2022 wp-links-opml.php</span><br><span class="line">-rw-r--r--  1 apache apache  3927 Jul 16 12:16 wp-load.php</span><br><span class="line">-rw-r--r--  1 apache apache 50924 Sep 29 22:01 wp-login.php</span><br><span class="line">-rw-r--r--  1 apache apache  8525 Sep 16 06:50 wp-mail.php</span><br><span class="line">-rw-r--r--  1 apache apache 26409 Oct 10 14:05 wp-settings.php</span><br><span class="line">-rw-r--r--  1 apache apache 34385 Jun 19 18:27 wp-signup.php</span><br><span class="line">-rw-r--r--  1 apache apache  4885 Jun 22 14:36 wp-trackback.php</span><br><span class="line">-rw-r--r--  1 apache apache  3154 Sep 30 07:39 xmlrpc.php</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@Web1 ~]#showmount -e 10.0.0.182</span><br><span class="line">Export list <span class="keyword">for</span> 10.0.0.182:</span><br><span class="line">/data/www 10.0.0.0/24</span><br><span class="line"></span><br><span class="line">[root@Web1 ~]#<span class="built_in">mv</span> /var/www/html/* /opt/</span><br><span class="line">[root@Web1 ~]#vim /etc/fstab </span><br><span class="line">10.0.0.182:/data/www /var/www/html nfs _netdev 0 0 </span><br><span class="line"></span><br><span class="line">[root@Web1 ~]#mount -a</span><br><span class="line">[root@Web1 ~]#<span class="built_in">df</span></span><br><span class="line">Filesystem           1K-blocks    Used Available Use% Mounted on</span><br><span class="line">devtmpfs                894016       0    894016   0% /dev</span><br><span class="line">tmpfs                   914116       0    914116   0% /dev/shm</span><br><span class="line">tmpfs                   914116    8936    905180   1% /run</span><br><span class="line">tmpfs                   914116       0    914116   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/rl-root   17811456 2600584  15210872  15% /</span><br><span class="line">/dev/sda1              1038336  217304    821032  21% /boot</span><br><span class="line">tmpfs                   182820       0    182820   0% /run/user/0</span><br><span class="line">10.0.0.182:/data/www  10219008 3314688   6363648  35% /var/www/html</span><br><span class="line"></span><br><span class="line">[root@Web1 ~]#<span class="built_in">ls</span> /var/www/html/</span><br><span class="line">index.php        wp-admin              wp-config-sample.php  wp-links-opml.php  wp-settings.php</span><br><span class="line">license.txt      wp-blog-header.php    wp-content            wp-load.php        wp-signup.php</span><br><span class="line">readme.html      wp-comments-post.php  wp-cron.php           wp-login.php       wp-trackback.php</span><br><span class="line">wp-activate.php  wp-config.php         wp-includes           wp-mail.php        xmlrpc.php</span><br><span class="line"></span><br><span class="line"><span class="comment">#Windows访问正常</span></span><br></pre></td></tr></table></figure>

<p>配置Web2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@Web2 ~]#yum -y install httpd php php-mysqlnd php-json nfs-utils</span><br><span class="line">[root@Web2 ~]#systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line">[root@Web2 ~]#vim /etc/fstab </span><br><span class="line">10.0.0.182:/data/www /var/www/html nfs _netdev 0 0 </span><br><span class="line"></span><br><span class="line">[root@Web2 ~]#mount -a</span><br><span class="line">[root@Web2 ~]#<span class="built_in">df</span></span><br><span class="line">Filesystem           1K-blocks    Used Available Use% Mounted on</span><br><span class="line">devtmpfs                894016       0    894016   0% /dev</span><br><span class="line">tmpfs                   914116       0    914116   0% /dev/shm</span><br><span class="line">tmpfs                   914116    8916    905200   1% /run</span><br><span class="line">tmpfs                   914116       0    914116   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/rl-root   17811456 2431172  15380284  14% /</span><br><span class="line">/dev/sda1              1038336  217304    821032  21% /boot</span><br><span class="line">tmpfs                   182820       0    182820   0% /run/user/0</span><br><span class="line">10.0.0.182:/data/www  10219008 3314688   6363648  35% /var/www/html</span><br><span class="line"></span><br><span class="line">[root@Web2 ~]#<span class="built_in">ls</span> /var/www/html/</span><br><span class="line">index.php        wp-admin              wp-config-sample.php  wp-links-opml.php  wp-settings.php</span><br><span class="line">license.txt      wp-blog-header.php    wp-content            wp-load.php        wp-signup.php</span><br><span class="line">readme.html      wp-comments-post.php  wp-cron.php           wp-login.php       wp-trackback.php</span><br><span class="line">wp-activate.php  wp-config.php         wp-includes           wp-mail.php        xmlrpc.php</span><br><span class="line"></span><br><span class="line"><span class="comment">#Switchhosts软件</span></span><br><span class="line">10.0.0.180 www.wu.org</span><br></pre></td></tr></table></figure>

<p>配置backup</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@BACKUP ~]#vim /etc/rsyncd.conf</span><br><span class="line">uid = root</span><br><span class="line">gid = root</span><br><span class="line">max connections = 0</span><br><span class="line">ignore errors</span><br><span class="line">exclude = lost+found/</span><br><span class="line"><span class="built_in">log</span> file = /var/log/rsyncd.log</span><br><span class="line">pid file = /var/run/rsyncd.pid</span><br><span class="line">lock file = /var/run/rsyncd.lock</span><br><span class="line">reverse lookup = no</span><br><span class="line"></span><br><span class="line">[backup]</span><br><span class="line">path = /data/backup/</span><br><span class="line">comment = backup <span class="built_in">dir</span></span><br><span class="line"><span class="built_in">read</span> only = no</span><br><span class="line">auth <span class="built_in">users</span> = rsyncuser</span><br><span class="line">secrets file = /etc/rsync.pas</span><br><span class="line"></span><br><span class="line">[root@BACKUP ~]#<span class="built_in">mkdir</span> -pv /data/backup</span><br><span class="line">[root@BACKUP ~]#<span class="built_in">echo</span> <span class="string">&quot;rsyncuser:123456&quot;</span> &gt; /etc/rsync.pas</span><br><span class="line">[root@BACKUP ~]#<span class="built_in">chmod</span> 600 /etc/rsync.pas</span><br><span class="line">[root@BACKUP ~]#systemctl restart rsync.service</span><br><span class="line"></span><br><span class="line">[root@NFS ~]#tar xf sersync2.5.4_64bit_binary_stable_final.tar.gz -C /usr/local/</span><br><span class="line">[root@NFS ~]#<span class="built_in">cd</span> /usr/local/</span><br><span class="line">[root@NFS <span class="built_in">local</span>]#<span class="built_in">ls</span></span><br><span class="line">bin  etc  games  GNU-Linux-x86  include  lib  man  sbin  share  src</span><br><span class="line"></span><br><span class="line">[root@NFS <span class="built_in">local</span>]#<span class="built_in">ln</span> -s GNU-Linux-x86/ sersync</span><br><span class="line">[root@NFS <span class="built_in">local</span>]#<span class="built_in">ln</span> -s /usr/local/sersync/sersync2 /usr/local/bin/</span><br><span class="line">[root@NFS <span class="built_in">local</span>]#<span class="built_in">cd</span> sersync</span><br><span class="line">[root@NFS sersync]#<span class="built_in">rm</span> -rf confxml.xml </span><br><span class="line">[root@NFS sersync]#rz</span><br><span class="line">[root@NFS sersync]#<span class="built_in">ls</span></span><br><span class="line">confxml.xml  sersync2</span><br><span class="line"></span><br><span class="line">[root@NFS sersync]#vim confxml.xml</span><br><span class="line">&lt;remote ip=<span class="string">&quot;10.0.0.183&quot;</span> name=<span class="string">&quot;backup&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">[root@NFS sersync]#<span class="built_in">echo</span> 123456 &gt; /etc/rsync.pas</span><br><span class="line">[root@NFS sersync]#<span class="built_in">chmod</span> 600 /etc/rsync.pas</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@NFS ~]#sersync2 -dro /usr/local/sersync/confxml.xml</span><br><span class="line">后台执行：<span class="built_in">nohup</span> sersync2 -dro /usr/local/sersync/confxml.xml &amp;&gt; /dev/null &amp;</span><br><span class="line"></span><br><span class="line">[root@BACKUP ~]#<span class="built_in">ls</span> /data/backup/</span><br><span class="line">index.php        wp-admin              wp-config-sample.php  wp-links-opml.php  wp-settings.php</span><br><span class="line">license.txt      wp-blog-header.php    wp-content            wp-load.php        wp-signup.php</span><br><span class="line">readme.html      wp-comments-post.php  wp-cron.php           wp-login.php       wp-trackback.php</span><br><span class="line">wp-activate.php  wp-config.php         wp-includes           wp-mail.php        xmlrpc.php</span><br><span class="line"></span><br><span class="line">[root@BACKUP ~]#tree /data/backup/wp-content/uploads/</span><br><span class="line">/data/backup/wp-content/uploads/</span><br><span class="line">└── 2023</span><br><span class="line">    └── 12</span><br><span class="line">        └── image.png1</span><br><span class="line"></span><br><span class="line"><span class="comment">#Windows发表新的文章</span></span><br><span class="line"></span><br><span class="line">[root@BACKUP ~]#tree /data/backup/wp-content/uploads/</span><br><span class="line">/data/backup/wp-content/uploads/</span><br><span class="line">└── 2023</span><br><span class="line">    └── 12</span><br><span class="line">        └── image.png1</span><br><span class="line">        └── image.png2</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://AquaPluto.github.io">Aquarius</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://aquapluto.github.io/Linux/service-manage/file-share/">https://aquapluto.github.io/Linux/service-manage/file-share/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://AquaPluto.github.io" target="_blank">代码推演录</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/">服务管理</a></div><div class="post-share"><div class="social-share" data-image="/img/paper6.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://unpkg.com/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://unpkg.com/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/Linux/system-optimization/" title="系统优化"><img class="cover" src="/img/paper4.png" onerror="onerror=null;src='/img/error-page.png'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">系统优化</div></div><div class="info-2"><div class="info-item-1">系统内核优文件描述符和进程系统正在...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/log/" title="日志服务"><img class="cover" src="/img/paper2.jpg" onerror="onerror=null;src='/img/error-page.png'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">日志服务</div></div><div class="info-2"><div class="info-item-1">1 系统日志管理1.1 系统日志介...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/Linux/service-manage/DNS/" title="域名DNS解析服务"><img class="cover" src="/img/paper4.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">域名DNS解析服务</div></div><div class="info-2"><div class="info-item-1">一、DNS服务相关概念和技术lin...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/log/" title="日志服务"><img class="cover" src="/img/paper2.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">日志服务</div></div><div class="info-2"><div class="info-item-1">1 系统日志管理1.1 系统日志介...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/plan-tasks/" title="计划任务"><img class="cover" src="/img/paper3.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">计划任务</div></div><div class="info-2"><div class="info-item-1">一次性任务at 工具  由包 at...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/ssh/" title="ssh远程连接服务"><img class="cover" src="/img/paper2.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-21</div><div class="info-item-2">ssh远程连接服务</div></div><div class="info-2"><div class="info-item-1">1 ssh服务介绍ssh: sec...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/time-synchronization/" title="时间同步服务"><img class="cover" src="/img/paper1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">时间同步服务</div></div><div class="info-2"><div class="info-item-1">前言加密和安全当前都离不开时间的同...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avator.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Aquarius</div><div class="author-info-description">分享运维开发相关技术</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">78</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/AquaPluto"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/AquaPluto" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://blog.csdn.net/m0_75233142" target="_blank" title="CSDN"><i class="fa-solid fa-code" style="color: #8a2be2;"></i></a><a class="social-icon" href="mailto:wujunlinq@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content"><p>持续更新文章中，有问题请添加wx</p>
<div>
  <img src="/img/wx.jpg" alt="wx" style="width: 100px">
</div>
</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E5%AD%98%E5%82%A8%E4%BB%8B%E7%BB%8D"><span class="toc-text">1 存储介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E4%B8%89%E7%A7%8D%E5%AD%98%E5%82%A8%E6%AF%94%E8%BE%83"><span class="toc-text">1.1 三种存储比较</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%B8%B8%E8%A7%81%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F"><span class="toc-text">1.2 常见存储方式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-NFS-%E6%9C%8D%E5%8A%A1"><span class="toc-text">2 NFS 服务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-NFS%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">2.1 NFS工作原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-NFS%E8%BD%AF%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="toc-text">2.2 NFS软件介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-NFS%E5%85%B1%E4%BA%AB%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="toc-text">2.3 NFS共享配置文件格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-NFS%E5%B7%A5%E5%85%B7"><span class="toc-text">2.4 NFS工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1-rpcinfo"><span class="toc-text">2.4.1 rpcinfo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-2-exportfs"><span class="toc-text">2.4.2 exportfs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-3-showmount"><span class="toc-text">2.4.3 showmount</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-4-mount-nfs"><span class="toc-text">2.4.4 mount.nfs</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-NFS-%E5%85%B1%E4%BA%AB%E5%AE%9E%E7%8E%B0"><span class="toc-text">2.5 NFS 共享实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-1-%E7%9B%AE%E6%A0%87"><span class="toc-text">2.5.1 目标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-2-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-text">2.5.2 环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-3-%E6%AD%A5%E9%AA%A4"><span class="toc-text">2.5.3 步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-3-1-%E5%9C%A8%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB"><span class="toc-text">2.5.3.1 在服务端配置共享</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-3-2-%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE"><span class="toc-text">2.5.3.2 客户端配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-3-3-%E7%94%A8%E6%88%B7%E6%98%A0%E5%B0%84"><span class="toc-text">2.5.3.3 用户映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-3-4-%E7%BB%9F%E4%B8%80%E7%94%A8%E6%88%B7%E6%98%A0%E5%B0%84"><span class="toc-text">2.5.3.4 统一用户映射</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5"><span class="toc-text">3 数据的实时同步</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E6%8A%80%E6%9C%AF%E4%BB%8B%E7%BB%8D"><span class="toc-text">3.1 实时同步技术介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-inotify-rsync-%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5"><span class="toc-text">3.2 inotify + rsync 实现数据实时同步</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-%E5%AE%9E%E7%8E%B0-inotify"><span class="toc-text">3.2.1 实现 inotify</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-1-%E5%86%85%E6%A0%B8%E6%94%AF%E6%8C%81"><span class="toc-text">3.2.1.1 内核支持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-2-inotify-tools%E5%B7%A5%E5%85%B7"><span class="toc-text">3.2.1.2 inotify-tools工具</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-rsync-%E6%9C%8D%E5%8A%A1"><span class="toc-text">3.2.2 rsync 服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-1-rsync%E5%91%BD%E4%BB%A4"><span class="toc-text">3.2.2.1 rsync命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-2-%E4%BB%A5%E7%8B%AC%E7%AB%8B%E6%9C%8D%E5%8A%A1%E6%96%B9%E5%BC%8F%E8%BF%90%E8%A1%8Crsync%E5%B9%B6%E5%AE%9E%E7%8E%B0%E9%AA%8C%E8%AF%81%E5%8A%9F%E8%83%BD"><span class="toc-text">3.2.2.2 以独立服务方式运行rsync并实现验证功能</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-inotify-rsync-shell-%E8%84%9A%E6%9C%AC%E5%AE%9E%E7%8E%B0%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5"><span class="toc-text">3.3 inotify+rsync+shell 脚本实现实时数据同步</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-sersync-%E5%AE%9E%E7%8E%B0%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5"><span class="toc-text">3.4 sersync 实现实时数据同步</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-1-sersync-%E4%BB%8B%E7%BB%8D"><span class="toc-text">3.4.1 sersync 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-2-%E5%9F%BA%E4%BA%8Ersync-daemon-%E5%AE%9E%E7%8E%B0-sersync"><span class="toc-text">3.4.2 基于rsync daemon 实现 sersync</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-3-%E5%9F%BA%E4%BA%8E%E8%BF%9C%E7%A8%8Bshell-%E5%AE%9E%E7%8E%B0-sersync"><span class="toc-text">3.4.3 基于远程shell 实现 sersync</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%EF%BC%9A%E5%AE%9E%E7%8E%B0%E5%9F%BA%E4%BA%8E%E5%88%86%E5%B8%83%E5%BC%8F%E7%9A%84LAMP%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%B9%B6%E5%B0%86NFS%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E5%88%B0%E5%A4%87%E4%BB%BD%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">4 实战案例：实现基于分布式的LAMP架构，并将NFS实时同步到备份服务器</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/role/" title="role"><img src="/img/paper6.png" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="role"/></a><div class="content"><a class="title" href="/CICD/ansible/role/" title="role">role</a><time datetime="2025-08-27T10:49:36.000Z" title="发表于 2025-08-27 18:49">2025-08-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/playbook/" title="playbook"><img src="/img/paper3.png" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="playbook"/></a><div class="content"><a class="title" href="/CICD/ansible/playbook/" title="playbook">playbook</a><time datetime="2025-08-27T10:49:30.000Z" title="发表于 2025-08-27 18:49">2025-08-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/module/" title="module"><img src="/img/paper4.png" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="module"/></a><div class="content"><a class="title" href="/CICD/ansible/module/" title="module">module</a><time datetime="2025-08-27T10:49:25.000Z" title="发表于 2025-08-27 18:49">2025-08-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/command/" title="command"><img src="/img/paper1.jpg" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="command"/></a><div class="content"><a class="title" href="/CICD/ansible/command/" title="command">command</a><time datetime="2025-08-27T10:49:19.000Z" title="发表于 2025-08-27 18:49">2025-08-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/deploy/" title="deploy"><img src="/img/paper6.png" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="deploy"/></a><div class="content"><a class="title" href="/CICD/ansible/deploy/" title="deploy">deploy</a><time datetime="2025-08-27T10:49:09.000Z" title="发表于 2025-08-27 18:49">2025-08-27</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Aquarius</span></div><div class="footer_custom_text"><style>
div#runtime {
  font-size: 13px;
  font-weight: bold;
}

div#ghbdages_list {
  height: 1.5rem;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 10px
}

.github-badge {
  display: flex;
  align-items: center;
  margin-inline: 6px;
}
</style>
<div id="runtime"></div>
<div id="ghbdages"></div>
<script>
  function createtime() {
    const now = new Date();
    const grt = new Date("08/01/2025 00:00:00"); // 网站诞生时间

    // 计算天、小时、分钟和秒
    const days = Math.floor((now - grt) / (1000 * 60 * 60 * 24));
    const hours = Math.floor(((now - grt) / (1000 * 60 * 60)) % 24)
      .toString()
      .padStart(2, "0");
    const minutes = Math.floor(((now - grt) / (1000 * 60)) % 60)
      .toString()
      .padStart(2, "0");
    const seconds = Math.floor(((now - grt) / 1000) % 60)
      .toString()
      .padStart(2, "0");

    // HTML 输出
    const currentTimeHtml = `
          <div>
              本站已运行 ${days} 天 ${hours} 小时 ${minutes} 分 ${seconds} 秒 
          </div>`;

    const runtime = document.getElementById("runtime");
    if (runtime) runtime.innerHTML = currentTimeHtml;
  }

  // 设置每秒调用函数
  setInterval(createtime, 1000);

  function renderBadge() {
    const currentTimeHtml = `
      <div id="ghbdages_list">
          <a class="github-badge" target="_blank" href="https://hexo.io/" title="hexo:7.3.0">
              <img src="https://img.shields.io/badge/Frame-Hexo-blue?logo=hexo" alt="Static Badge">
          </a>
          <a class="github-badge" target="_blank" href="https://github.com/" title="github">
              <img src="https://img.shields.io/badge/Code-GitHub-181717?logo=GitHub&color=%23FF7102" alt="Static Badge">
          </a>
          <a class="github-badge" target="_blank" href="https://vercel.com/" title="vercel">
              <img src="https://img.shields.io/badge/Host-Vercel-%23F0D722?logo=Vercel" alt="Static Badge">
          </a>
          <a class="github-badge" target="_blank" href="https://analytics.sysio.ai/" title="umami">
              <img src="https://img.shields.io/badge/Analytics-Umami-%237FB100?logo=umami&logoColor=%237FB100" alt="Static Badge">
          </a>
      </div>`;

    const ghbdages = document.getElementById("ghbdages");
    if (ghbdages) {
      ghbdages.innerHTML = currentTimeHtml;
    }
  }

  window.onload = renderBadge;
</script>
</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://unpkg.com/@fancyapps/ui/dist/fancybox/fancybox.umd.js"></script><script src="https://unpkg.com/instant.page/instantpage.js" type="module"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = 'https://unpkg.com/mathjax/es5/tex-mml-chtml.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script></div><script src="https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fishes.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://unpkg.com/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章..." type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>