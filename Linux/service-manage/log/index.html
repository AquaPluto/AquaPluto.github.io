<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>日志服务 | 代码推演录</title><meta name="author" content="Aquarius"><meta name="copyright" content="Aquarius"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="1 系统日志管理1.1 系统日志介绍在现实生活中，记录日志非常重要﹐比如:银行转账时会有转账记录﹔飞机飞行过程中的黑盒子（飞行数据记录器）记录着飞机的飞行过程. 那么将系统和应用发生的事件记录至日志中，也很意义,常可以助于排错和分析使用 日志记录的内容包括：  历史事件：时间，地点，人物，事件  日志级别：事件的关键性程度，Loglevel   1.1.1 sysklogd系统日志服务CentOS">
<meta property="og:type" content="article">
<meta property="og:title" content="日志服务">
<meta property="og:url" content="https://aquapluto.github.io/Linux/service-manage/log/">
<meta property="og:site_name" content="代码推演录">
<meta property="og:description" content="1 系统日志管理1.1 系统日志介绍在现实生活中，记录日志非常重要﹐比如:银行转账时会有转账记录﹔飞机飞行过程中的黑盒子（飞行数据记录器）记录着飞机的飞行过程. 那么将系统和应用发生的事件记录至日志中，也很意义,常可以助于排错和分析使用 日志记录的内容包括：  历史事件：时间，地点，人物，事件  日志级别：事件的关键性程度，Loglevel   1.1.1 sysklogd系统日志服务CentOS">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://aquapluto.github.io/img/paper3.png">
<meta property="article:published_time" content="2025-08-20T08:52:09.000Z">
<meta property="article:modified_time" content="2025-09-10T02:21:41.954Z">
<meta property="article:author" content="Aquarius">
<meta property="article:tag" content="服务管理">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://aquapluto.github.io/img/paper3.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "日志服务",
  "url": "https://aquapluto.github.io/Linux/service-manage/log/",
  "image": "https://aquapluto.github.io/img/paper3.png",
  "datePublished": "2025-08-20T08:52:09.000Z",
  "dateModified": "2025-09-10T02:21:41.954Z",
  "author": [
    {
      "@type": "Person",
      "name": "Aquarius",
      "url": "https://AquaPluto.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://aquapluto.github.io/Linux/service-manage/log/"><link rel="preconnect" href="//unpkg.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://unpkg.com/@fancyapps/ui/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":true,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://unpkg.com/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '日志服务',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/wave.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(/img/background.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avator.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">138</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="menus_items"><!-- 一级菜单项（非目录）--><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>计算机基础</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>计算机组成原理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/hardware-composition/"><span>计算机硬件组成</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/CPU/"><span>CPU</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/memory/"><span>内存</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/hard-disk/"><span>硬盘</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>操作系统</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/concept/"><span>操作系统的概念</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/processes-threads/"><span>进程与线程</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/IO-model/"><span>IO模型</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Linux</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>linux基础</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/introduce/"><span>linux介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/file-structure-and-IO-redirects/"><span>文件结构与IO重定向</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/file-command/"><span>文件管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/text-command/"><span>文本管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/GSA/"><span>文本处理三剑客</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/user-permission/"><span>用户和权限管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/regular-expression/"><span>正则表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/software-manage/"><span>软件包管理</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>进程管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/command/"><span>进程相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/signal/"><span>信号发送</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/job-parallel/"><span>作业管理与并行运行</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/OOM/"><span>OOM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>磁盘管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/disk-partition/"><span>磁盘分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/file-system/"><span>文件系统</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/swap/"><span>Swap分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/LVM/"><span>逻辑卷管理器LVM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>网络管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/configuration/"><span>网络配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/test-diagnostic/"><span>网络测试诊断工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/bridge/"><span>网桥配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/troubleshoot/"><span>网络问题排查</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/DNS/"><span>域名DNS解析服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/time-synchronization/"><span>时间同步服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/plan-tasks/"><span>计划任务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/log/"><span>日志服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/data-synchronization/"><span>数据的实时同步</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/ssh/"><span>ssh远程连接服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/mail/"><span>邮件服务</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/kernel-manage/"><span>内核和启动管理</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>防火墙</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/introduce/"><span>安全技术和防火墙</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/iptables/"><span>iptables</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/firewalld/"><span>firewalld</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/nft/"><span>nft</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>加密和安全</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/security-mechanisms/"><span>安全机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/OpenSSL/"><span>OpenSSL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/sudo/"><span>sudo实现授权</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/PAM/"><span>PAM认证机制</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>shell编程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/introduce/"><span>shell脚本介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/variable/"><span>变量</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/operations-conditional/"><span>运算和条件测试</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-control/"><span>流程控制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/function/"><span>函数</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/array/"><span>数组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/string/"><span>字符串</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/script-tools/"><span>脚本相关工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-lock/"><span>进程锁</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/queue/"><span>队列实现线程并发控制</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/system-optimization/"><span>系统优化</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>数据库</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>MySQL</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/DataBase/MySQL/SQL/"><span>SQL语句</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Redis</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/DataBase/Redis/deploy/"><span>部署安装</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>中间件</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Nginx</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Nginx/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>HAProxy</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/HAProxy/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Keepalived</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Keepalived/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kafka</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Kafka/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Tomcat</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Tomcat/111/"><span>111</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>日志</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>存储</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Storage/conspect/"><span>存储概论</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Storage/nfs/"><span>NFS</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>容器</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/basics/"><span>容器基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Docker</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/conspect/"><span>Docker概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/image/"><span>镜像管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/container/"><span>容器管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/volume/"><span>数据卷</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/network/"><span>网络管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/compose/"><span>Docker-Compose</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>镜像</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/conspect/"><span>镜像概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/dockerfile/"><span>dockerfile</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/build/"><span>构建镜像</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/harbor/"><span>镜像仓库</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>容器进程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/management/"><span>容器里的进程管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/cpu-cgroup/"><span>cpu cgroup使用</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/cpu-usage/"><span>监控容器真实的cpu使用率</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/memory/"><span>容器内存</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/storage/"><span>容器存储</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/network/"><span>容器网络</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/safe/"><span>容器安全</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/containerd/"><span>Containerd</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>K8s</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kubernetes概论</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/architecture/"><span>Kubernetes架构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/cri/"><span>容器运行时接口CRI</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/list-watch/"><span>List-Watch机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/object/"><span>Kubernetes对象</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/namespace/"><span>Namespace</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/kubectl/"><span>kubectl命令</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>部署安装</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/explanation/"><span>部署说明</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/docker/"><span>基于docker部署k8s-v1.30</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/containerd/"><span>基于containerd部署k8s-v1.30</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/cluster/"><span>集群管理指南</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Pod</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/conspect/"><span>Pod概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/configuration/"><span>Pod的配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/schedule/"><span>Pod的调度</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/eviction/"><span>Pod的驱逐</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>控制器</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/introduce/"><span>控制器介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/deployment/"><span>Deployment</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/statefulset/"><span>StatefulSet</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/daemonset/"><span>DaemonSet</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/job-cronjob/"><span>Job和CronJob</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/HPA/"><span>HPA</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/operator/"><span>Operator</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务发现与负载均衡</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/service/"><span>Service</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/ingress/"><span>Ingress</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/coredns/"><span>CoreDNS</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/localdns/"><span>LocalDNS</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>数据存储持久化</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/csi/"><span>存储接口CSI</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/pv-pvc/"><span>PV和PVC</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/storageclass/"><span>StorageClass</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/configmap-secret/"><span>ConfigMap和Secret</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>认证与鉴权体系</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/conspect/"><span>体系概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/kubeconfig/"><span>kubeconfig</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/user-account/"><span>User Account</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/service-account/"><span>Service Account</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>监控</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/conspect/"><span>监控概论</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Prometheus</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/introduce/"><span>prometheus概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/exporter/"><span>Exporter</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/promql/"><span>PromQL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/query-persist/"><span>查询结果持久化</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/service-discovery/"><span>服务发现</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/indicators-remarked/"><span>指标重新打标</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/pushmanager/"><span>Pushmanager</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/cluster-ha/"><span>集群与高可用</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Alertmanager</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/introduce/"><span>告警功能概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/alarm/"><span>实现告警功能</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/ha/"><span>高可用架构</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/grafana/"><span>Grafana</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/streaming/"><span>基于流处理的可观测性架构</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>CICD</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Ansible</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/introduce/"><span>架构概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/command/"><span>相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/module/"><span>常用模块</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/playbook/"><span>PlayBook</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>SRE</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/SRE/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Python</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>python基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>线性表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>列表</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>元组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字符串</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>哈希表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>封装与解构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>集合</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字典</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>解析式与生成器表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>函数</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>IO操作</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>面向对象编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>并发编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>网络编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>数据库编程</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Django</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/paper3.png);"><nav id="nav"><!-- 左侧博客信息区域--><span id="blog-info"><a class="nav-site-title" href="/"></a><a class="nav-page-title" href="/"><span class="site-name">日志服务</span></a></span><!-- 新增的导航菜单容器（居中布局关键）--><div id="nav-menus-container"><!-- 菜单主体部分--><div id="menus"><!-- 菜单项--><div class="menus_items"><!-- 一级菜单项（非目录）--><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>计算机基础</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>计算机组成原理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/hardware-composition/"><span>计算机硬件组成</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/CPU/"><span>CPU</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/memory/"><span>内存</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/hard-disk/"><span>硬盘</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>操作系统</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/concept/"><span>操作系统的概念</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/processes-threads/"><span>进程与线程</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/IO-model/"><span>IO模型</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Linux</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>linux基础</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/introduce/"><span>linux介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/file-structure-and-IO-redirects/"><span>文件结构与IO重定向</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/file-command/"><span>文件管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/text-command/"><span>文本管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/GSA/"><span>文本处理三剑客</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/user-permission/"><span>用户和权限管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/regular-expression/"><span>正则表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/software-manage/"><span>软件包管理</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>进程管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/command/"><span>进程相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/signal/"><span>信号发送</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/job-parallel/"><span>作业管理与并行运行</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/OOM/"><span>OOM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>磁盘管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/disk-partition/"><span>磁盘分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/file-system/"><span>文件系统</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/swap/"><span>Swap分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/LVM/"><span>逻辑卷管理器LVM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>网络管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/configuration/"><span>网络配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/test-diagnostic/"><span>网络测试诊断工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/bridge/"><span>网桥配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/troubleshoot/"><span>网络问题排查</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/DNS/"><span>域名DNS解析服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/time-synchronization/"><span>时间同步服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/plan-tasks/"><span>计划任务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/log/"><span>日志服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/data-synchronization/"><span>数据的实时同步</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/ssh/"><span>ssh远程连接服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/mail/"><span>邮件服务</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/kernel-manage/"><span>内核和启动管理</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>防火墙</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/introduce/"><span>安全技术和防火墙</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/iptables/"><span>iptables</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/firewalld/"><span>firewalld</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/nft/"><span>nft</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>加密和安全</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/security-mechanisms/"><span>安全机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/OpenSSL/"><span>OpenSSL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/sudo/"><span>sudo实现授权</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/PAM/"><span>PAM认证机制</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>shell编程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/introduce/"><span>shell脚本介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/variable/"><span>变量</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/operations-conditional/"><span>运算和条件测试</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-control/"><span>流程控制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/function/"><span>函数</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/array/"><span>数组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/string/"><span>字符串</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/script-tools/"><span>脚本相关工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-lock/"><span>进程锁</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/queue/"><span>队列实现线程并发控制</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/system-optimization/"><span>系统优化</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>数据库</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>MySQL</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/DataBase/MySQL/SQL/"><span>SQL语句</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Redis</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/DataBase/Redis/deploy/"><span>部署安装</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>中间件</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Nginx</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Nginx/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>HAProxy</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/HAProxy/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Keepalived</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Keepalived/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kafka</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Kafka/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Tomcat</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Tomcat/111/"><span>111</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>日志</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>存储</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Storage/conspect/"><span>存储概论</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Storage/nfs/"><span>NFS</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>容器</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/basics/"><span>容器基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Docker</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/conspect/"><span>Docker概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/image/"><span>镜像管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/container/"><span>容器管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/volume/"><span>数据卷</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/network/"><span>网络管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/compose/"><span>Docker-Compose</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>镜像</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/conspect/"><span>镜像概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/dockerfile/"><span>dockerfile</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/build/"><span>构建镜像</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/harbor/"><span>镜像仓库</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>容器进程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/management/"><span>容器里的进程管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/cpu-cgroup/"><span>cpu cgroup使用</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/cpu-usage/"><span>监控容器真实的cpu使用率</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/memory/"><span>容器内存</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/storage/"><span>容器存储</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/network/"><span>容器网络</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/safe/"><span>容器安全</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/containerd/"><span>Containerd</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>K8s</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kubernetes概论</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/architecture/"><span>Kubernetes架构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/cri/"><span>容器运行时接口CRI</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/list-watch/"><span>List-Watch机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/object/"><span>Kubernetes对象</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/namespace/"><span>Namespace</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/kubectl/"><span>kubectl命令</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>部署安装</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/explanation/"><span>部署说明</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/docker/"><span>基于docker部署k8s-v1.30</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/containerd/"><span>基于containerd部署k8s-v1.30</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/cluster/"><span>集群管理指南</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Pod</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/conspect/"><span>Pod概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/configuration/"><span>Pod的配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/schedule/"><span>Pod的调度</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/eviction/"><span>Pod的驱逐</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>控制器</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/introduce/"><span>控制器介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/deployment/"><span>Deployment</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/statefulset/"><span>StatefulSet</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/daemonset/"><span>DaemonSet</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/job-cronjob/"><span>Job和CronJob</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/HPA/"><span>HPA</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/operator/"><span>Operator</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务发现与负载均衡</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/service/"><span>Service</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/ingress/"><span>Ingress</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/coredns/"><span>CoreDNS</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/localdns/"><span>LocalDNS</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>数据存储持久化</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/csi/"><span>存储接口CSI</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/pv-pvc/"><span>PV和PVC</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/storageclass/"><span>StorageClass</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/configmap-secret/"><span>ConfigMap和Secret</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>认证与鉴权体系</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/conspect/"><span>体系概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/kubeconfig/"><span>kubeconfig</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/user-account/"><span>User Account</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/service-account/"><span>Service Account</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>监控</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/conspect/"><span>监控概论</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Prometheus</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/introduce/"><span>prometheus概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/exporter/"><span>Exporter</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/promql/"><span>PromQL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/query-persist/"><span>查询结果持久化</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/service-discovery/"><span>服务发现</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/indicators-remarked/"><span>指标重新打标</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/pushmanager/"><span>Pushmanager</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/cluster-ha/"><span>集群与高可用</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Alertmanager</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/introduce/"><span>告警功能概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/alarm/"><span>实现告警功能</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/ha/"><span>高可用架构</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/grafana/"><span>Grafana</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/streaming/"><span>基于流处理的可观测性架构</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>CICD</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Ansible</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/introduce/"><span>架构概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/command/"><span>相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/module/"><span>常用模块</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/playbook/"><span>PlayBook</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>SRE</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/SRE/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Python</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>python基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>线性表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>列表</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>元组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字符串</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>哈希表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>封装与解构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>集合</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字典</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>解析式与生成器表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>函数</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>IO操作</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>面向对象编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>并发编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>网络编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>数据库编程</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Django</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div></div></div></div><!-- 右侧功能区域（新增容器）--><div id="nav-right-container"><!-- 搜索按钮（移动到右侧）--><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i></span></div><!-- 移动端汉堡菜单按钮--><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">日志服务</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-08-20T08:52:09.000Z" title="发表于 2025-08-20 16:52">2025-08-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-10T02:21:41.954Z" title="更新于 2025-09-10 10:21">2025-09-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/">Linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">15.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>63分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="1-系统日志管理"><a href="#1-系统日志管理" class="headerlink" title="1 系统日志管理"></a>1 系统日志管理</h1><h2 id="1-1-系统日志介绍"><a href="#1-1-系统日志介绍" class="headerlink" title="1.1 系统日志介绍"></a>1.1 系统日志介绍</h2><p>在现实生活中，记录日志非常重要﹐比如:银行转账时会有转账记录﹔飞机飞行过程中的黑盒子（飞行数据记录器）记录着飞机的飞行过程. 那么将系统和应用发生的事件记录至日志中，也很意义,常可以助于排错和分析使用</p>
<p>日志记录的内容包括：</p>
<ul>
<li><p>历史事件：时间，地点，人物，事件</p>
</li>
<li><p>日志级别：事件的关键性程度，Loglevel</p>
</li>
</ul>
<h3 id="1-1-1-sysklogd系统日志服务"><a href="#1-1-1-sysklogd系统日志服务" class="headerlink" title="1.1.1 sysklogd系统日志服务"></a>1.1.1 sysklogd系统日志服务</h3><p>CentOS 5之前版本采用的日志管理系统服务</p>
<ul>
<li><p>klogd: linux kernel 记录内核日志</p>
</li>
<li><p>syslogd: system application 记录应用日志</p>
</li>
</ul>
<p>事件记录格式：</p>
<ul>
<li><p>日期时间 主机 进程[pid]: 事件内容</p>
</li>
<li><p>C&#x2F;S架构：通过TCP或UDP协议的服务完成日志记录传送，将分布在不同主机的日志实现集中管理</p>
</li>
</ul>
<h3 id="1-1-2-rsyslog系统日志服务"><a href="#1-1-2-rsyslog系统日志服务" class="headerlink" title="1.1.2 rsyslog系统日志服务"></a>1.1.2 rsyslog系统日志服务</h3><p>rsyslog是CentOS 6以后版本的系统管理服务，主要用于单机日志管理，它提供了高性能，出色的安全性和模块化设计。 尽管rsyslog最初是常规的syslogd，但已发展成为一种瑞士军刀式的记录工具，能够接受来自各种来源的输入，并将其转换，然后输出到不同的目的地。当应用有限的处理时，RSYSLOG每秒可以将超过一百万的消息传递到本地目的地。 即使在远程的目的地和更精细的处理中，性能通常也被认为是“惊人的”。<a href="https://www.rsyslog.com/">官方网站</a></p>
<p>rsyslog 特性</p>
<ul>
<li><p>多线程</p>
</li>
<li><p>UDP, TCP, SSL, TLS, RELP</p>
</li>
<li><p>MySQL, PGSQL, Oracle实现日志存储</p>
</li>
<li><p>强大的过滤器，可实现过滤记录日志信息中任意部分</p>
</li>
<li><p>自定义输出格式</p>
</li>
<li><p>适用于企业级中继链</p>
</li>
</ul>
<p>rsyslog会默认安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky ~]# rpm -q rsyslog</span><br><span class="line">rsyslog-8.2102.0-7.el8.x86_64</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# dpkg -l rsyslog</span><br><span class="line">Desired=Unknown/Install/Remove/Purge/Hold</span><br><span class="line">| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend</span><br><span class="line">|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)</span><br><span class="line">||/ Name      Version       Architecture Description</span><br><span class="line">+++-==============-===================-============-</span><br><span class="line">=========================================</span><br><span class="line">ii rsyslog     8.2112.0-2ubuntu2.2 amd64    reliable system and kernel logging daemon</span><br></pre></td></tr></table></figure>

<h2 id="1-2-Rsyslog管理"><a href="#1-2-Rsyslog管理" class="headerlink" title="1.2 Rsyslog管理"></a>1.2 Rsyslog管理</h2><h3 id="1-2-1-系统日志术语"><a href="#1-2-1-系统日志术语" class="headerlink" title="1.2.1 系统日志术语"></a>1.2.1 系统日志术语</h3><p>facility：设施，从功能或程序上对日志进行归类</p>
<p>在一台主机上会同时运行多个服务和软件，每个服务或软件都有可能会产生大量的日志，如果每个服务或软件产生的日志都独立存放管理，那文件数量就太多了，如果都放到一个文件中，似乎也不是很合适，所以 syslog 将日志进行了分类，相同类型的日志放一个文件，这样便于管理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#syslog 内置分类</span></span><br><span class="line">LOG_AUTH 			<span class="comment">#auth 安全和认证相关的日志</span></span><br><span class="line">LOG_AUTHPRIV 	<span class="comment">#authpriv 安全和认证相关的日志，私有</span></span><br><span class="line">LOG_CRON 			<span class="comment">#cron 系统定时任务 crontab 与 at 产生的相关日志</span></span><br><span class="line">LOG_DAEMON 		<span class="comment">#daemon 各守护进程产生的日志</span></span><br><span class="line">LOG_FTP 			<span class="comment">#ftp ftp守护进程产生的日志</span></span><br><span class="line">LOG_KERN 			<span class="comment">#kern 内核产生的日志</span></span><br><span class="line">LOG_LOCAL0 -- LOG_LOCAL7 	<span class="comment">#local0-local7 自定义分类</span></span><br><span class="line">LOG_LPR 			<span class="comment">#lpr 打印服务日志</span></span><br><span class="line">LOG_MAIL 			<span class="comment">#mail 邮件服务日志</span></span><br><span class="line">LOG_NEWS 			<span class="comment">#news 网络新闻服务产生的日志</span></span><br><span class="line">LOG_SYSLOG 		<span class="comment">#syslog syslogd 服务自己的日志</span></span><br><span class="line">LOG_USER 			<span class="comment">#user 用户等级</span></span><br><span class="line">LOG_UUCP 			<span class="comment">#uucp uucp子系统的日志信息</span></span><br><span class="line">* 						<span class="comment">#通配符，代表所有分类</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#自定义的分类</span></span><br><span class="line">local0-local7	<span class="comment">#保留给本机用户使用的一些登录文件讯息，终端信息等</span></span><br></pre></td></tr></table></figure>

<p>Priority 优先级别</p>
<p>rsyslog 在记录日志的时候，将各种产生日志的事件和行为进行了优先级的排序，使用者可以根据不同环境(测试&#x2F;生产)和需求，设置不同的级别来记录日志，这样可以保证，记录下来的内容都是是我们想要的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#syslog 内置优先级分类，从高到低，如果在记录日志时，设置了优先级，则只会记录设定的优先级和高于设定优先级的日志</span></span><br><span class="line">LOG_EMERG 		<span class="comment">#emerg/panic 紧急，致命错误</span></span><br><span class="line">LOG_ALERT 		<span class="comment">#alert 告警，当前状态必须立即进行纠正</span></span><br><span class="line">LOG_CRIT 			<span class="comment">#crit 关键状态的警告，例如 硬件故障</span></span><br><span class="line">LOG_ERR 			<span class="comment">#err/error 其它错误</span></span><br><span class="line">LOG_WARNING 	<span class="comment">#warning/warn 警告级别的信息</span></span><br><span class="line">LOG_NOTICE 		<span class="comment">#notice 通知级别的信息，</span></span><br><span class="line">LOG_INFO 			<span class="comment">#info 通告级别的信息</span></span><br><span class="line">LOG_DEBUG 		<span class="comment">#debug 调试程序时的信息</span></span><br><span class="line">* 						<span class="comment">#所有级别的日志</span></span><br><span class="line">none 					<span class="comment">#不需要任何日志</span></span><br></pre></td></tr></table></figure>

<p>查看帮助</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]#yum -y install man-pages</span><br><span class="line">[root@centos8 ~]#man 3 syslog</span><br><span class="line">[root@centos8 ~]#man 3 logger</span><br></pre></td></tr></table></figure>

<h3 id="1-2-2-rsyslog相关文件"><a href="#1-2-2-rsyslog相关文件" class="headerlink" title="1.2.2 rsyslog相关文件"></a>1.2.2 rsyslog相关文件</h3><table>
<thead>
<tr>
<th>项目</th>
<th>文件</th>
</tr>
</thead>
<tbody><tr>
<td>程序包</td>
<td>rsyslog</td>
</tr>
<tr>
<td>主程序</td>
<td>&#x2F;usr&#x2F;sbin&#x2F;rsyslogd</td>
</tr>
<tr>
<td>服务管理（Ubuntu）</td>
<td>&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;rsyslog.service</td>
</tr>
<tr>
<td>服务管理（CentOS 6）</td>
<td>&#x2F;etc&#x2F;rc.d&#x2F;init.d&#x2F;rsyslog {start|stop|restart|status}</td>
</tr>
<tr>
<td>服务管理（CentOS 7,8）</td>
<td>&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;rsyslog.service</td>
</tr>
<tr>
<td>配置文件</td>
<td>&#x2F;etc&#x2F;rsyslog.conf &#x2F;etc&#x2F;rsyslog.d&#x2F;*.conf</td>
</tr>
<tr>
<td>库文件</td>
<td>&#x2F;lib64&#x2F;rsyslog&#x2F;*.so</td>
</tr>
</tbody></table>
<h3 id="1-2-3-rsyslog配置文件"><a href="#1-2-3-rsyslog配置文件" class="headerlink" title="1.2.3 rsyslog配置文件"></a>1.2.3 rsyslog配置文件</h3><p>&#x2F;etc&#x2F;rsyslog.conf 配置文件格式：由三部分组成 </p>
<ul>
<li><p>MODULES：相关模块配置</p>
</li>
<li><p>GLOBAL DIRECTIVES：全局配置</p>
</li>
<li><p>RULES：日志记录相关的规则配置，ubuntu 系统中，默认 rule 规则是单独放在一个文件中的</p>
</li>
</ul>
<p>Ubuntu的配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> /etc/rsyslog.conf</span><br><span class="line"><span class="comment"># Default logging rules can be found in /etc/rsyslog.d/50-default.conf</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#################</span></span><br><span class="line"><span class="comment">#### MODULES ####</span></span><br><span class="line"><span class="comment">#################	</span></span><br><span class="line"><span class="comment">#rsyslog 在安装是有很多支持模块，但默认不是所有模块都开启，如果有需要，写在MODULES范围即可</span></span><br><span class="line"></span><br><span class="line">module(load=<span class="string">&quot;imuxsock&quot;</span>) <span class="comment"># provides support for local system logging</span></span><br><span class="line"><span class="comment">#module(load=&quot;immark&quot;)  # provides --MARK-- message capability</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># provides UDP syslog reception		#UDP模块，默认没有启用</span></span><br><span class="line"><span class="comment">#module(load=&quot;imudp&quot;)</span></span><br><span class="line"><span class="comment">#input(type=&quot;imudp&quot; port=&quot;514&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># provides TCP syslog reception		#TCP 模块，默认没有启用</span></span><br><span class="line"><span class="comment">#module(load=&quot;imtcp&quot;)</span></span><br><span class="line"><span class="comment">#input(type=&quot;imtcp&quot; port=&quot;514&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># provides kernel logging support and enable non-kernel klog messages</span></span><br><span class="line">module(load=<span class="string">&quot;imklog&quot;</span> permitnonkernelfacility=<span class="string">&quot;on&quot;</span>)		<span class="comment">#内核日志需要的模块</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###########################</span></span><br><span class="line"><span class="comment">#### GLOBAL DIRECTIVES ####</span></span><br><span class="line"><span class="comment">###########################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Use traditional timestamp format.</span></span><br><span class="line"><span class="comment"># To enable high precision timestamps, comment out the following line.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="variable">$ActionFileDefaultTemplate</span> RSYSLOG_TraditionalFileFormat	<span class="comment">#默认日志模板</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Filter duplicated messages</span></span><br><span class="line"><span class="variable">$RepeatedMsgReduction</span> on	<span class="comment">#默认开启重复过滤</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Set the default permissions for all log files.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#创建日志文件的默认权限和属主属组</span></span><br><span class="line"><span class="variable">$FileOwner</span> syslog	</span><br><span class="line"><span class="variable">$FileGroup</span> adm</span><br><span class="line"><span class="variable">$FileCreateMode</span> 0640</span><br><span class="line"><span class="variable">$DirCreateMode</span> 0755</span><br><span class="line"><span class="variable">$Umask</span> 0022</span><br><span class="line"><span class="variable">$PrivDropToUser</span> syslog</span><br><span class="line"><span class="variable">$PrivDropToGroup</span> syslog</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Where to place spool and state files</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="variable">$WorkDirectory</span> /var/spool/rsyslog	 <span class="comment">#工作目录，默认目录为空</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Include all config files in /etc/rsyslog.d/</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="variable">$IncludeConfig</span> /etc/rsyslog.d/*.conf <span class="comment">#独立配置文件引用目录</span></span><br><span class="line"></span><br><span class="line">[root@ubuntu2004 ~]#ll /var/log/syslog</span><br><span class="line">-rw-r----- 1 syslog adm 43342 Dec  8 14:22 /var/log/syslog</span><br><span class="line"></span><br><span class="line">[root@ubuntu2004 ~]#<span class="built_in">ls</span> /etc/rsyslog.d/*.conf</span><br><span class="line">/etc/rsyslog.d/20-ufw.conf  /etc/rsyslog.d/21-cloudinit.conf  /etc/rsyslog.d/50-default.conf</span><br></pre></td></tr></table></figure>

<p><strong>RULES配置格式：</strong></p>
<p>每一行 rule 由两列组成，分别是选择器和处理动作，选择器将过滤后的日志交由处理动作处理；选择器可以同时有多个，用分号分隔，处理动作也可以同时有多个，用 &amp; 分隔，处理动作中可以指定模板，不同的模板会生成不同的日志内容，模板可以自定义。</p>
<p>选择器有以下几种定义方式：</p>
<ul>
<li><p>用分类和优先级来过滤，同一条 rule 中，分类和优先级都可以有多个，用逗号分隔</p>
</li>
<li><p>基于日志内容中的指定字段来过滤</p>
</li>
<li><p>基于表达式构建脚本来过滤</p>
</li>
</ul>
<p>处理动作有以下几种：</p>
<ul>
<li><p>输出到日志文件或某个特定设备</p>
</li>
<li><p>保存到数据库</p>
</li>
<li><p>发送给指定用户，该用户必须己登录，可以同时指定多个用户，用逗号分隔</p>
</li>
<li><p>传送到远程主机</p>
</li>
<li><p>通过管道传送给其它命令</p>
</li>
<li><p>丢弃日志，不处理</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">facility.priority; facility.priority…  target</span><br></pre></td></tr></table></figure>

<p><strong>facility格式：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*   								  <span class="comment">#所有的facility </span></span><br><span class="line">facility1,facility2,facility3,...     <span class="comment">#指定的facility列表</span></span><br></pre></td></tr></table></figure>

<p><strong>priority格式：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*			<span class="comment">#所有级别</span></span><br><span class="line">none		<span class="comment">#没有级别，即不记录</span></span><br><span class="line">PRIORITY	<span class="comment">#指定级别（含）以上的所有级别</span></span><br><span class="line">=PRIORITY	<span class="comment">#仅记录指定级别的日志信息</span></span><br><span class="line">!priority 	<span class="comment">#排除指定的 priority，这种写法不能单独使用</span></span><br></pre></td></tr></table></figure>

<p><strong>target格式：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">输出到日志文件或设备</span><br><span class="line"><span class="comment"># /path/file 将日志内容写到指定文件，通常在/var/log/</span></span><br><span class="line"><span class="comment"># -/path/file 将日志内容写到指定文件，-表示异步写入，异步表示把数据收到后，会先写入内存（缓冲区）中，过一会再写入/path/file</span></span><br><span class="line"><span class="comment"># /dev/null 将日志内容输出到指定设备</span></span><br><span class="line"></span><br><span class="line">保存到数据库，保存到数据库要开启相应模块</span><br><span class="line">module (load=<span class="string">&quot;ommysql&quot;</span>)</span><br><span class="line">*.* action(<span class="built_in">type</span>=<span class="string">&quot;ommysql&quot;</span> server=<span class="string">&quot;10.0.0.210&quot;</span> db=<span class="string">&quot;rsyslog&quot;</span> uid=<span class="string">&quot;rsysloger&quot;</span> <span class="built_in">pwd</span>=<span class="string">&quot;123456&quot;</span>)</span><br><span class="line"></span><br><span class="line">发送给指定用户</span><br><span class="line"><span class="comment"># root      将日志内容发送给用户 root</span></span><br><span class="line"><span class="comment"># root,tom  将日志内容发送给用户 root 和 tom</span></span><br><span class="line"><span class="comment"># *         将日志内容发送给所有己登录用户</span></span><br><span class="line"></span><br><span class="line">发送到远程主机，即日志服务器  </span><br><span class="line"><span class="comment"># @host 把日志送往至指定的远程UDP日志服务器，@@host 将日志发送到远程TCP日志服务器</span></span><br><span class="line"><span class="comment"># @192.168.2.123 使用 UDP 协议发送到远程主机，默认端口514</span></span><br><span class="line"><span class="comment"># @@log.magedu.com:256 使用 TCP 协议发送到远程主机 256 端口，默认端口514</span></span><br><span class="line"><span class="comment"># @(z6)[fe80::20c:29ff:fe7e:ce82] 使用 UPD 协议发送到远程主机(IPV6地址)，启用zlib压缩，压缩级别为9</span></span><br><span class="line"></span><br><span class="line">通过管道传送给其它命令，管道必须有名管道，要事先创建，此功能在 rsyslog8 版本后才支持		 </span><br><span class="line"><span class="comment"># | COMMAND，转发给其它命令处理</span></span><br><span class="line"></span><br><span class="line">不处理</span><br><span class="line"><span class="comment"># stop 不处理，丢弃</span></span><br></pre></td></tr></table></figure>

<p>Ubuntu 系统中默认 rule 配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu2004 ~]#<span class="built_in">cat</span> /etc/rsyslog.d/50-default.conf </span><br><span class="line"><span class="comment">#  Default rules for rsyslog.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#			For more information see rsyslog.conf(5) and /etc/rsyslog.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># First some standard log files.  Log by facility.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">auth,authpriv.*			/var/log/auth.log	<span class="comment">#登录验证相关的日志记录在auth.log中,要经常看，黑客登陆失败或成功会有记录</span></span><br><span class="line">*.*;auth,authpriv.none	-/var/log/syslog	<span class="comment">#除了登录校验之外的日志，都记录在syslog中，异步写，建议将优先级改成info</span></span><br><span class="line"><span class="comment">#cron.*				/var/log/cron.log		#计划任务</span></span><br><span class="line"><span class="comment">#daemon.*			-/var/log/daemon.log</span></span><br><span class="line">kern.*				-/var/log/kern.log		<span class="comment">#内核所有日志都记录在kern.log 中，异步写</span></span><br><span class="line"><span class="comment">#lpr.*				-/var/log/lpr.log</span></span><br><span class="line">mail.*				-/var/log/mail.log		<span class="comment">#邮件相关日志记录在 mail.log中，异步写</span></span><br><span class="line"><span class="comment">#user.*				-/var/log/user.log		#用户账号</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Logging for the mail system.  Split it up so that</span></span><br><span class="line"><span class="comment"># it is easy to write scripts to parse these files.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#mail.info			-/var/log/mail.info</span></span><br><span class="line"><span class="comment">#mail.warn			-/var/log/mail.warn</span></span><br><span class="line">mail.err			/var/log/mail.err			<span class="comment">#邮件服务 err 及以上的日志记录在 mail.err 中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Some &quot;catch-all&quot; log files.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#*.=debug;\</span></span><br><span class="line"><span class="comment">#	auth,authpriv.none;\</span></span><br><span class="line"><span class="comment">#	news.none;mail.none	-/var/log/debug</span></span><br><span class="line"><span class="comment">#*.=info;*.=notice;*.=warn;\</span></span><br><span class="line"><span class="comment">#	auth,authpriv.none;\</span></span><br><span class="line"><span class="comment">#	cron,daemon.none;\</span></span><br><span class="line"><span class="comment">#	mail,news.none		-/var/log/messages</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Emergencies are sent to everybody logged in.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">*.emerg				:omusrmsg:*					<span class="comment">#所有致命错误信息，调用omusrmsg 模块发给所有登录用户</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># I like to have messages displayed on the console, but only on a virtual</span></span><br><span class="line"><span class="comment"># console I usually leave idle.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#daemon,mail.*;\</span></span><br><span class="line"><span class="comment">#	news.=crit;news.=err;news.=notice;\</span></span><br><span class="line"><span class="comment">#	*.=debug;*.=info;\</span></span><br><span class="line"><span class="comment">#	*.=notice;*.=warn	/dev/tty8</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-4-在本机自定义服务日志"><a href="#1-2-4-在本机自定义服务日志" class="headerlink" title="1.2.4 在本机自定义服务日志"></a>1.2.4 在本机自定义服务日志</h3><p>范例：将ssh服务的日志记录至自定义的local的日志设备</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sshd服务日志默认是归属于 AUTH 分类，默认级别是 INFO</span></span><br><span class="line">[root@ubuntu2004 ~]#vim /etc/ssh/sshd_config</span><br><span class="line"><span class="comment"># Logging</span></span><br><span class="line"><span class="comment">#SyslogFacility AUTH</span></span><br><span class="line"><span class="comment">#LogLevel INFO</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#根据配置，此日志记录在 /var/log/auth.log 中</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> /etc/rsyslog.d/50-default.conf | grep <span class="string">&quot;^auth&quot;</span></span><br><span class="line">auth,authpriv.* /var/log/auth.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看日志，能看到相关内容</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">tail</span> -n 3 /var/log/auth.log</span><br><span class="line">Jun 28 20:00:35 ubuntu2204 sshd[920]: Received signal 15; terminating.</span><br><span class="line">Jun 28 20:00:35 ubuntu2204 sshd[3431]: Server listening on 0.0.0.0 port 22.</span><br><span class="line">Jun 28 20:00:35 ubuntu2204 sshd[3431]: Server listening on :: port 22.</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改 sshd 服务日志的配置项，分类改到 LOCAL6，级别不改</span></span><br><span class="line">[root@ubuntu2004 ~]#vim /etc/ssh/sshd_config</span><br><span class="line"><span class="comment"># Logging</span></span><br><span class="line"><span class="comment">#SyslogFacility AUTH</span></span><br><span class="line"><span class="comment">#LogLevel INFO</span></span><br><span class="line">SyslogFacility LOCAL6</span><br><span class="line"></span><br><span class="line"><span class="comment">#可以新增配置文件sshd.log，也可以在原来文件中将local6分类的日志写入</span></span><br><span class="line">[root@ubuntu2004 ~]#vim /etc/rsyslog.d/sshd.conf</span><br><span class="line">[root@ubuntu2004 ~]#vim /etc/rsyslog.d/50-default.conf </span><br><span class="line">local6.info         /var/log/sshd.log</span><br><span class="line"></span><br><span class="line">[root@ubuntu2004 ~]#systemctl restart rsyslog</span><br><span class="line">[root@ubuntu2004 ~]#systemctl restart sshd</span><br><span class="line"></span><br><span class="line"><span class="comment">#生成/var/log/sshd.log</span></span><br><span class="line">[root@ubuntu2004 ~]#ll /var/log/sshd.log </span><br><span class="line">-rw-r----- 1 syslog adm 149 Dec  8 15:53 /var/log/sshd.log</span><br><span class="line"></span><br><span class="line">[root@ubuntu2004 ~]#<span class="built_in">tail</span> -f /var/log/sshd.log</span><br><span class="line">Dec  8 15:53:48 ubuntu2004 sshd[19015]: Server listening on 0.0.0.0 port 22.</span><br><span class="line">Dec  8 15:53:48 ubuntu2004 sshd[19015]: Server listening on :: port 22.</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@ubuntu2004 ~]#ssh 127.0.0.1</span><br><span class="line"></span><br><span class="line">[root@ubuntu2004 ~]#<span class="built_in">tail</span> -f /var/log/sshd.log</span><br><span class="line">....</span><br><span class="line">Dec  8 15:55:54 ubuntu2004 sshd[19080]: Accepted password <span class="keyword">for</span> root from 10.0.0.1 port 64271 ssh2</span><br><span class="line">Dec  8 15:56:09 ubuntu2004 sshd[19225]: Accepted password <span class="keyword">for</span> root from 127.0.0.1 port 33988 ssh2</span><br><span class="line">Dec  8 15:56:18 ubuntu2004 sshd[19225]: Received disconnect from 127.0.0.1 port 33988:11: disconnected by user</span><br><span class="line">Dec  8 15:56:18 ubuntu2004 sshd[19225]: Disconnected from user root 127.0.0.1 port 33988</span><br><span class="line"></span><br><span class="line">[root@ubuntu2004 ~]#logger -p local6.info <span class="string">&quot;hello sshd&quot;</span></span><br><span class="line"></span><br><span class="line">[root@ubuntu2004 ~]#<span class="built_in">tail</span> -f /var/log/sshd.log</span><br><span class="line">....</span><br><span class="line">Dec  8 15:56:59 ubuntu2004 root: hello sshd</span><br></pre></td></tr></table></figure>

<h3 id="1-2-5-rsyslog日志内容和模板"><a href="#1-2-5-rsyslog日志内容和模板" class="headerlink" title="1.2.5 rsyslog日志内容和模板"></a>1.2.5 rsyslog日志内容和模板</h3><p><strong>通常的日志文件的格式：</strong></p>
<p>日志文件有很多，如： &#x2F;var&#x2F;log&#x2F;messages, cron, secure等，基本格式都是类似的。格式如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">事件产生的日期时间（默认精确到秒） 主机 应用程序程序名[进程](pid)：事件内容</span><br></pre></td></tr></table></figure>

<p>centos日志文件格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]#<span class="built_in">tail</span> /var/log/messages</span><br><span class="line">Nov 12 08:34:18 centos8 dnf[14114]: Metadata cache created.</span><br><span class="line">Nov 12 08:34:18 centos8 systemd[1]: Started dnf makecache.</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#<span class="built_in">tail</span> /var/log/secure</span><br><span class="line">Nov 11 18:27:12 centos8 groupadd[11940]: group added to /etc/group: name=dhcpd,GID=177</span><br><span class="line">Nov 11 18:27:12 centos8 groupadd[11940]: group added to /etc/gshadow: name=dhcpd</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Ubuntu 中日志内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# <span class="built_in">tail</span> /var/log/syslog</span><br><span class="line">May  2 03:56:07 ubuntu systemd[1]: systemd-rfkill.service: Deactivatedsuccessfully.</span><br><span class="line">May  2 05:37:36 ubuntu systemd-resolved[87114]: Clock change detected. Flushingcaches.</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">tail</span>  /var/log/auth.log</span><br><span class="line">May  2 03:54:07 ubuntu sshd[903]: Received signal 15; terminating.</span><br><span class="line">May  2 03:54:08 ubuntu sshd[87070]: Server listening on 0.0.0.0 port 22.</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>日志内容由 template 决定，如果没有显式指定，默认使用 RSYSLOG_TraditionalFileFormat，其具体内容如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">template(name=<span class="string">&quot;RSYSLOG_TraditionalFileFormat&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;string&quot;</span></span><br><span class="line">string=<span class="string">&quot;%TIMESTAMP% %HOSTNAME% %syslogtag%%msg:::sp-if-no-1st-sp%%msg:::drop-last-lf%\n&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>rsyslog 中有13个内置的模板，我们可以在配置文件中直接使用，其名称如下，具体定义的内容需要查询相关文档</p>
<p><a href="https://www.rsyslog.com/doc/v8-stable/configuration/templates.html">https://www.rsyslog.com/doc/v8-stable/configuration/templates.html</a></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">RSYSLOG_TraditionalFileFormat</span><br><span class="line">RSYSLOG_FileFormat</span><br><span class="line">RSYSLOG_TraditionalForwardFormat</span><br><span class="line">RSYSLOG_SysklogdFileFormat</span><br><span class="line">RSYSLOG_ForwardFormat</span><br><span class="line">RSYSLOG_SyslogProtocol23Format</span><br><span class="line">RSYSLOG_DebugFormat</span><br><span class="line">RSYSLOG_WallFmt</span><br><span class="line">RSYSLOG_StdUsrMsgFmt</span><br><span class="line">RSYSLOG_StdDBFmt</span><br><span class="line">RSYSLOG_StdPgSQLFmt</span><br><span class="line">RSYSLOG_spoofadr</span><br><span class="line">RSYSLOG_StdJSONFmt</span><br></pre></td></tr></table></figure>

<p>除了使用内置模板外，我们还可以自定义模板。自定义模板可以直接写在配置文件中</p>
<p>生成的日志内容模板决定，而模板是由 rsyslog 中的相关属性组成，这些属性在生成日志内容时会被替换成具体内容。所谓属性是指rsyslog 中的一些特殊关键字，在模板语法中，使用 %属性名% 来表示一个字段</p>
<p>范例：启用高精度时间</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#默认日志时间精确到秒，可以修改配置实现</span></span><br><span class="line">[root@ubuntu2204 ~]#<span class="built_in">head</span> /var/log/syslog</span><br><span class="line">Oct 29 02:27:39 ubuntu2204 systemd-modules-load[521]: Inserted module <span class="string">&#x27;msr&#x27;</span></span><br><span class="line">Oct 29 02:27:39 ubuntu2204 systemd-modules-load[521]: Inserted module<span class="string">&#x27;ipmi_devintf&#x27;</span></span><br><span class="line">Oct 29 02:27:39 ubuntu2204 lvm[506]:  1 logical volume(s) <span class="keyword">in</span> volume group<span class="string">&quot;ubuntu-vg&quot;</span> monitored</span><br><span class="line">Oct 29 02:27:39 ubuntu2204 systemd[1]: Mounted FUSE Control File System.</span><br><span class="line">Oct 29 02:27:39 ubuntu2204 systemd[1]: Mounted Kernel Configuration File System.</span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">[root@ubuntu2204 ~]#vi /etc/rsyslog.conf</span><br><span class="line"><span class="comment">###########################</span></span><br><span class="line"><span class="comment">#### GLOBAL DIRECTIVES ####</span></span><br><span class="line"><span class="comment">###########################</span></span><br><span class="line"><span class="comment">#将下面行注释</span></span><br><span class="line"><span class="comment">#$ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat</span></span><br><span class="line"></span><br><span class="line">[root@ubuntu2204 ~]#systemctl restart rsyslog</span><br><span class="line"></span><br><span class="line"><span class="comment">#验证结果</span></span><br><span class="line">[root@ubuntu2204 ~]#<span class="built_in">tail</span> /var/log/syslog</span><br><span class="line">2022-12-09T19:21:21.717291+08:00 ubuntu2204 systemd[1]: Stopping System Logging Service...</span><br><span class="line">2022-12-09T19:21:21.721852+08:00 ubuntu2204 rsyslogd: [originsoftware=<span class="string">&quot;rsyslogd&quot;</span> swVersion=<span class="string">&quot;8.2112.0&quot;</span> x-pid=<span class="string">&quot;818&quot;</span> x-info=<span class="string">&quot;https://www.rsyslog.com&quot;</span>] exiting on signal 15.</span><br><span class="line">2022-12-09T19:21:21.729966+08:00 ubuntu2204 systemd[1]: rsyslog.service:Deactivated successfully.</span><br><span class="line">2022-12-09T19:21:21.730558+08:00 ubuntu2204 systemd[1]: Stopped System Logging Service.</span><br><span class="line">2022-12-09T19:21:21.732955+08:00 ubuntu2204 systemd[1]: Starting System Logging Service...</span><br></pre></td></tr></table></figure>

<h3 id="1-2-6-启用网络日志服务"><a href="#1-2-6-启用网络日志服务" class="headerlink" title="1.2.6 启用网络日志服务"></a>1.2.6 启用网络日志服务</h3><p>启用网络日志服务功能，可以使用 rsyslog 服务中的远程转发功能，通过 TCP 或 UDP 协议将多个远程主机的日志，发送到集中的日志服务器，进行集中存储，方便统一管理</p>
<p><img src="/Linux/service-manage/log/1753757621496-98112bb1-647a-47c5-ba40-c9b34ba1ef42-17556835715811.png" alt="null"></p>
<p>配置 rsyslog 主机，开启 TCP, UDP 相关功能</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#启用相关模块, 去掉 UDP,TCP 模块的注释</span></span><br><span class="line">[root@rsyslog ~]#vim /etc/rsyslog.conf</span><br><span class="line"><span class="comment"># provides UDP syslog reception</span></span><br><span class="line">module(load=<span class="string">&quot;imudp&quot;</span>)</span><br><span class="line">input(<span class="built_in">type</span>=<span class="string">&quot;imudp&quot;</span> port=<span class="string">&quot;514&quot;</span>)</span><br><span class="line"><span class="comment"># provides TCP syslog reception</span></span><br><span class="line">module(load=<span class="string">&quot;imtcp&quot;</span>)</span><br><span class="line">input(<span class="built_in">type</span>=<span class="string">&quot;imtcp&quot;</span> port=<span class="string">&quot;514&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">[root@rsyslog ~]#systemctl restart rsyslog.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看端口</span></span><br><span class="line">[root@ubuntu ~]# ss -tunlp | grep 514</span><br><span class="line">udp  UNCONN 0    0        0.0.0.0:514    0.0.0.0:*  <span class="built_in">users</span>:((&quot;rsyslogd&quot;,pid=<span class="number">3995</span>,fd=<span class="number">5</span>))</span><br><span class="line">udp  UNCONN 0    0         [::]:514     [::]:*  <span class="built_in">users</span>:((&quot;rsyslogd&quot;,pid=<span class="number">3995</span>,fd=<span class="number">6</span>))</span><br><span class="line">tcp  LISTEN 0    25        0.0.0.0:514    0.0.0.0:*  <span class="built_in">users</span>:((&quot;rsyslogd&quot;,pid=<span class="number">3995</span>,fd=<span class="number">7</span>))</span><br><span class="line">tcp  LISTEN 0    25         [::]:514     [::]:*  <span class="built_in">users</span>:((&quot;rsyslogd&quot;,pid=<span class="number">3995</span>,fd=<span class="number">8</span>))</span><br></pre></td></tr></table></figure>

<p>配置 client-1 主机日志远程转发</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu2004 ~]#hostnamectl set-hostname client-1</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置远程转发，转发到 10.0.0.180 的tcp和udp协议514端口,默认514可以省略</span></span><br><span class="line">[root@client-1 ~]#vim /etc/rsyslog.d/50-default.conf</span><br><span class="line">*.info              @@10.0.0.180:514	<span class="comment">#TCP</span></span><br><span class="line">*.info              @10.0.0.180:514 	<span class="comment">#UDP</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">[root@client-1 ~]# systemctl restart rsyslog</span><br></pre></td></tr></table></figure>

<p>根据 rsyslog 主机中的配置，转发过来的日志会被写到 &#x2F;var&#x2F;log&#x2F;messages 文件中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@rsyslog ~]#vim /etc/rsyslog.conf</span><br><span class="line">*.info;mail.none;authpriv.none;cron.none                /var/log/messages</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试-在client-1主机上写入日志</span></span><br><span class="line">[root@client-1 ~]# logger <span class="string">&quot;this msg from client-1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#client-1 主机上也有该日志</span></span><br><span class="line">[root@client-1 ~]#<span class="built_in">tail</span> -f /var/log/syslog</span><br><span class="line">Mar 20 07:08:40 client-1 root: this msg from client-1</span><br><span class="line"></span><br><span class="line"><span class="comment">#在 rsyslog 上查看</span></span><br><span class="line">[root@rsyslog ~]#<span class="built_in">tail</span> -f /var/log/messages</span><br><span class="line">Mar 20 07:10:01 client-1 root: this msg from client-1</span><br></pre></td></tr></table></figure>

<p>配置 client-2 主机日志远程转发</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置远程转发，转发到10.0.0.18的tcp和udp协议514端口,默认514可以省略</span></span><br><span class="line">[root@client-2 ~]# vim /etc/rsyslog.conf</span><br><span class="line">*.info 		@@10.0.0.18:514		<span class="comment">#TCP</span></span><br><span class="line">*.info 		@10.0.0.18:514		<span class="comment">#UDP</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">[root@client-2 ~]# systemctl restart rsyslog.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@client-2 ~]# logger <span class="string">&quot;this msg from client-2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#本机查看</span></span><br><span class="line">[root@client-1 ~]#<span class="built_in">tail</span> -f /var/log/syslog</span><br><span class="line">Mar 20 07:08:40 client-1 root: this msg from client-2</span><br><span class="line"></span><br><span class="line"><span class="comment">#log-server 查看</span></span><br><span class="line">[root@rsyslog ~]#<span class="built_in">tail</span> -f /var/log/messages</span><br><span class="line">Mar 20 07:10:01 client-1 root: this msg from client-2</span><br></pre></td></tr></table></figure>

<p>范例：CentOS 7 和 6 启用网络日志功能</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/rsyslog.conf</span><br><span class="line"><span class="comment">####MODULES####</span></span><br><span class="line"><span class="comment"># Provides UDP syslog reception</span></span><br><span class="line"><span class="variable">$ModLoad</span> imudp</span><br><span class="line"><span class="variable">$UDPServerRun</span> 514</span><br><span class="line"></span><br><span class="line"><span class="comment"># Provides TCP syslog reception</span></span><br><span class="line"><span class="variable">$ModLoad</span> imtcp</span><br><span class="line"><span class="variable">$InputTCPServerRun</span> 514</span><br></pre></td></tr></table></figure>

<h3 id="1-2-7-常见日志文件"><a href="#1-2-7-常见日志文件" class="headerlink" title="1.2.7 常见日志文件"></a>1.2.7 常见日志文件</h3><p>Rocky 中常见日志说明</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky ~]# <span class="built_in">cat</span> /etc/rsyslog.conf | grep -Ev <span class="string">&quot;^#|^$&quot;</span></span><br><span class="line">*.info;mail.none;authpriv.none;cron.none  /var/log/messages <span class="comment">#除了mail,authpriv,cron 之外都记录</span></span><br><span class="line">authpriv.*                /var/log/secure 					<span class="comment">#安全认证相关日志</span></span><br><span class="line">mail.*                   -/var/log/maillog 					<span class="comment">#邮件服务相关日志</span></span><br><span class="line">cron.*                   /var/log/cron 							<span class="comment">#定时任务相关日志</span></span><br><span class="line">*.emerg                  :omusrmsg:* 								<span class="comment">#所有致命错误信息，调用omusrmsg发给所有登录用户</span></span><br><span class="line">uucp,news.crit           /var/log/spooler 					<span class="comment">#uucp,新闻相关日志</span></span><br><span class="line">local7.*                 /var/log/boot.log 					<span class="comment">#操作系统启动流程日志</span></span><br></pre></td></tr></table></figure>

<p>ubuntu 中常见日志说明</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> /etc/rsyslog.d/*conf | grep -Ev <span class="string">&quot;^#|^$&quot;</span></span><br><span class="line">:msg,contains,<span class="string">&quot;[UFW &quot;</span> /var/log/ufw.log 			<span class="comment">#ufw服务日志</span></span><br><span class="line">:syslogtag, isequal, <span class="string">&quot;[CLOUDINIT]&quot;</span> /var/log/cloud-init.log 	<span class="comment">#cloud-init服务日志</span></span><br><span class="line">&amp; stop 																			<span class="comment">#其它不处理</span></span><br><span class="line">auth,authpriv.* /var/log/auth.log 					<span class="comment">#auth,authpriv的日志</span></span><br><span class="line">*.*;auth,authpriv.none -/var/log/syslog 		<span class="comment">#除了auth,authpriv之外的日志</span></span><br><span class="line">kern.* -/var/log/kern.log 									<span class="comment">#内核产生的日志</span></span><br><span class="line">mail.* -/var/log/mail.log 									<span class="comment">#邮件服务日志</span></span><br><span class="line">mail.err /var/log/mail.err 									<span class="comment">#邮件服务err(含)以上日志</span></span><br><span class="line">*.emerg :omusrmsg:* 												<span class="comment">#所有致命错误信息，调用omusrmsg发给所有登录用户</span></span><br></pre></td></tr></table></figure>

<p>除了在 rsyslog 中定义的日志之外，系统中默认还有 btmp, lastlog, wtmp 三个日志文件，这三个文件都是非文本格式，无法直接打开，这三个文件需要经常看，巡检黑客攻击</p>
<ul>
<li><p><code>/var/log/secure，/var/log/auth.log</code>：系统安全日志，文本格式，应周期性分析</p>
</li>
<li><p><code>/var/log/btmp</code>：当前系统上，用户的失败尝试登录相关的日志信息，二进制格式，lastb命令进行查看</p>
</li>
<li><p><code>/var/log/wtmp</code>：当前系统上，用户正常登录系统的相关日志信息，二进制格式，last命令可以查看</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#显示系统关机项和运行级别更改</span></span><br><span class="line">last -x, --system </span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>/var/log/lastlog</code>：每一个用户最近一次的登录信息，二进制格式，lastlog命令可以查看</p>
</li>
<li><p><code>/var/log/dmesg</code>：CentOS7 之前版本系统引导过程中的日志信息，文本格式，开机后的硬件变化将不再记录，也可以通过专用命dmesg查看，可持续记录硬件变化的情况</p>
</li>
<li><p><code>/var/log/boot.log</code> 系统服务启动的相关信息，文本格式，Ubuntu无此文件</p>
</li>
<li><p><code>/var/log/messages(红帽系统)，/var/log/syslog (Ubuntu)</code> ：系统中大部分的信息</p>
</li>
<li><p><code>/var/log/anaconda</code> : anaconda的日志，Ubuntu无此文件</p>
</li>
</ul>
<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]#file /var/log/&#123;btmp,lastlog,wtmp&#125;</span><br><span class="line">/var/log/btmp:  data</span><br><span class="line">/var/log/lastlog: dBase III DBT, version number 0, next free block index 1653273886</span><br><span class="line">/var/log/wtmp:  firmware 0 v0 (revision 0)  V2, 0 bytes or less, UNKNOWN2 0x2e322e78, at 0x0 0 bytes , at 0x0 0 bytes</span><br></pre></td></tr></table></figure>

<p>范例：找到失败登录的IP</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]#awk <span class="string">&#x27;/Failed password/&#123;print $(NF-3)&#125;&#x27;</span> /var/log/secure</span><br><span class="line">192.168.39.7</span><br><span class="line">192.168.39.18</span><br><span class="line">192.168.39.18</span><br><span class="line"></span><br><span class="line">[root@ubuntu2004 ~]#awk <span class="string">&#x27;/authentication failure/&#123;print $(NF-3)&#125;&#x27;</span> /var/log/auth.log</span><br></pre></td></tr></table></figure>

<p>范例：找出失败登录次数最多的前10个IP</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]#lastb -f btmp-test1 | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>|<span class="built_in">sort</span> | <span class="built_in">uniq</span> -c|<span class="built_in">sort</span> -nr|<span class="built_in">head</span></span><br><span class="line">8374 112.64.33.38</span><br><span class="line">7041 221.125.235.4</span><br><span class="line">6502 183.247.184.220</span><br><span class="line">5970 203.190.163.125</span><br><span class="line">5297 202.89.0.27</span><br><span class="line">3062 119.163.122.32</span><br><span class="line">2961 124.126.248.6</span><br><span class="line">2921 92.222.1.40</span><br><span class="line">2896 112.65.170.186</span><br><span class="line">1955 118.97.213.118</span><br><span class="line"> </span><br><span class="line">[root@centos8 ~]#lastb -f btmp-test2 | awk <span class="string">&#x27;&#123;ip[$3]++&#125;END&#123;for(i in ip)&#123;print ip[i],i&#125;&#125;&#x27;</span>|<span class="built_in">sort</span> -nr|<span class="built_in">head</span></span><br><span class="line">86294 58.218.92.37</span><br><span class="line">43148 58.218.92.26</span><br><span class="line">18036 112.85.42.201</span><br><span class="line">10501 111.26.195.101</span><br><span class="line">10501 111.231.235.49</span><br><span class="line">10501 111.204.186.207</span><br><span class="line">10501 111.11.29.199</span><br><span class="line">10499 118.26.23.225</span><br><span class="line">6288 42.7.26.142</span><br><span class="line">4236 58.218.92.30</span><br></pre></td></tr></table></figure>

<h2 id="1-3-日志相关工具"><a href="#1-3-日志相关工具" class="headerlink" title="1.3 日志相关工具"></a>1.3 日志相关工具</h2><h3 id="1-3-1-dmesg命令"><a href="#1-3-1-dmesg命令" class="headerlink" title="1.3.1 dmesg命令"></a>1.3.1 dmesg命令</h3><p>dmesg 命令用来查看主机硬件相关日志</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>-c</code></td>
<td>显示内核消息后清空缓冲区（仅当前会话有效，内核仍会继续写入新消息）。</td>
</tr>
<tr>
<td><code>-w</code>&#x2F;<code>--follow</code></td>
<td>持续监听并显示新的内核消息（类似 <code>tail -f</code>）。</td>
</tr>
<tr>
<td><code>-T</code></td>
<td>显示消息的人类可读时间戳（默认显示自系统启动以来的秒数）。</td>
</tr>
<tr>
<td><code>-k</code></td>
<td>仅显示内核相关消息（过滤掉用户空间程序的消息）。</td>
</tr>
<tr>
<td><code>-l &lt;级别&gt;</code></td>
<td>仅显示指定日志级别的消息（如 <code>err</code> 错误、<code>warn</code> 警告、<code>info</code> 信息等）。</td>
</tr>
<tr>
<td><code>-H</code></td>
<td>以人类友好的格式输出（自动换行、可读性更强）。</td>
</tr>
</tbody></table>
<h3 id="1-3-2-logger命令"><a href="#1-3-2-logger命令" class="headerlink" title="1.3.2 logger命令"></a>1.3.2 logger命令</h3><p>logger 命令可以手动生成相关日志</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">logger [options] [&lt;message&gt;]</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-p|--priority 	<span class="comment">#指定优先级</span></span><br><span class="line">-f|--file 			<span class="comment">#从文件中读取日志内容</span></span><br><span class="line">-t|--tag 				<span class="comment">#指定日志tag</span></span><br><span class="line">-n|--server 		<span class="comment">#指定远程主机IP或主机名</span></span><br><span class="line">-P|--port 			<span class="comment">#指定远程主机端口</span></span><br><span class="line">-T|--tcp 				<span class="comment">#指定使用TCP协议传输</span></span><br><span class="line">-d|--udp 				<span class="comment">#指定使用UDP协议传输</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#无选项</span></span><br><span class="line">[root@ubuntu ~]# logger <span class="string">&quot;this is test msg&quot;</span></span><br><span class="line">root@ubuntu2204:~# <span class="built_in">tail</span> -n 1 /var/log/syslog</span><br><span class="line">May  3 07:07:08 ubuntu2204 root: this is <span class="built_in">test</span> msg</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> test.txt</span><br><span class="line">this msg from test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#从文件中读取，指定tag，指定优先级</span></span><br><span class="line">[root@ubuntu ~]# logger -t <span class="built_in">test</span> -f test.txt -p error</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">tail</span> -n 1 /var/log/syslog</span><br><span class="line">May  4 14:09:53 ubuntu <span class="built_in">test</span>: this msg from test.txt</span><br></pre></td></tr></table></figure>

<h3 id="1-3-3-journalctl"><a href="#1-3-3-journalctl" class="headerlink" title="1.3.3 journalctl"></a>1.3.3 journalctl</h3><p>在 systemd 为 1号进程的系统版本中，systemd 提供了一个集中的方式来处理所有来自进程，应用程序等的操作系统日志，所有这些日志事件都由 systemd 的 journald 守护进程来处理。journald 守护进程收集所有来自 Linux 操作系统的各种日志，并将其作为二进制数据存储在文件中。以二进制数据集中记录事件、系统问题的好处有很多。例如，由于系统日志是以二进制而不是文本形式存储的，你可以以文本、JSON 对象等多种方式进行转译，以满足各种需求。另外，由于日志是按顺序存储的，通过对日志的日期&#x2F;时间操作，超级容易追踪到单个事件</p>
<p>journald 守护进程的配置文件：<code>/etc/systemd/journald.conf</code></p>
<p>journalctl命令格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">journalctl [OPTIONS...] [MATCHES...]</span><br></pre></td></tr></table></figure>

<p>选项说明：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 日志显示格式与内容控制</span></span><br><span class="line">- --no-full, --full, -l  </span><br><span class="line">  如果字段内容超长则以省略号(...)截断以适应列宽。默认显示完整的字段内容(超长的部分换行显示或者被分页工具截断)。老旧的 -l/--full 选项 仅用于撤销已有的 --no-full 选项，除此之外没有其他用处。</span><br><span class="line">  </span><br><span class="line">- -a, --all  </span><br><span class="line">  完整显示所有字段内容， 即使其中包含不可打印字符或者字段内容超长。</span><br><span class="line">  </span><br><span class="line">- -o, --output=  </span><br><span class="line">  控制日志的输出格式。 可以使用如下选项：short（默认，类似传统syslog格式）、short-iso（时间戳ISO 8601格式）、short-precise（时间戳精确到微秒）、short-monotonic（时间戳从内核启动计算）、short-unix（时间戳为UNIX时间秒数，精确到微秒）、verbose（结构化显示所有字段）、<span class="built_in">export</span>（序列化为二进制字节流）、json（JSON格式，每条一行）、json-pretty（JSON格式，每个字段一行）、json-sse（JSON格式，适应Server-Sent Events）、<span class="built_in">cat</span>（仅显示日志内容，无元数据）。</span><br><span class="line">  </span><br><span class="line">- --utc  </span><br><span class="line">  以世界统一时间(UTC)表示时间</span><br><span class="line">  </span><br><span class="line">- --no-hostname  </span><br><span class="line">  不显示来源于本机的日志消息的主机名字段。 此选项仅对 short 系列输出格式(见上文)有效。</span><br><span class="line">  </span><br><span class="line">- -x, --catalog  </span><br><span class="line">  在日志的输出中增加一些解释性的短文本， 以帮助进一步说明日志的含义、问题的解决方案、支持论坛、 开发文档、以及其他任何内容。并非所有日志都有这些额外的帮助文本， 详见 Message Catalog Developer Documentation 文档。注意，如果要将日志输出用于bug报告， 请不要使用此选项。</span><br><span class="line">  </span><br><span class="line">- -q, --quiet  </span><br><span class="line">  当以普通用户身份运行时， 不显示任何警告信息与提示信息。 例如：<span class="string">&quot;-- Logs begin at...&quot;</span>, <span class="string">&quot;-- Reboot --&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 日志范围与过滤</span></span><br><span class="line">- -f, --follow  </span><br><span class="line">  只显示最新的日志项，并且不断显示新生成的日志项。 此选项隐含了 -n 选项。</span><br><span class="line">  </span><br><span class="line">- -e, --pager-end  </span><br><span class="line">  在分页工具内立即跳转到日志的尾部。 此选项隐含了 -n1000 以确保分页工具不必缓存太多的日志行。 不过这个隐含的行数可以被明确设置的 -n 选项覆盖。 注意，此选项仅可用于 less(1) 分页器。</span><br><span class="line">  </span><br><span class="line">- -n, --lines=  </span><br><span class="line">  限制显示最新的日志行数。 --pager-end 与 --follow 隐含了此选项。此选项的参数：若为正整数则表示最大行数； 若为 <span class="string">&quot;all&quot;</span> 则表示不限制行数；若不设参数则表示默认值10行。</span><br><span class="line">  </span><br><span class="line">- --no-tail  </span><br><span class="line">  显示所有日志行， 也就是用于撤销已有的 --lines= 选项(即使与 -f 连用)。</span><br><span class="line">  </span><br><span class="line">- -r, --reverse  </span><br><span class="line">  反转日志行的输出顺序， 也就是最先显示最新的日志。</span><br><span class="line">  </span><br><span class="line">- -b [ID][±offset], --boot=[ID][±offset]  </span><br><span class="line">  显示特定于某次启动的日志， 这相当于添加了一个 <span class="string">&quot;_BOOT_ID=&quot;</span> 匹配条件。如果参数为空(也就是 ID 与 ±offset 都未指定)， 则表示仅显示本次启动的日志。如果省略了 ID ， 那么当 ±offset 是正数的时候， 将从日志头开始正向查找，否则(也就是为负数或零)将从日志尾开始反响查找。 举例来说， <span class="string">&quot;-b 1&quot;</span>表示按时间顺序排列最早的那次启动， <span class="string">&quot;-b 2&quot;</span>则表示在时间上第二早的那次启动； <span class="string">&quot;-b -0&quot;</span>表示最后一次启动， <span class="string">&quot;-b -1&quot;</span>表示在时间上第二近的那次启动， 以此类推。 如果 ±offset 也省略了， 那么相当于<span class="string">&quot;-b -0&quot;</span>， 除非本次启动不是最后一次启动(例如用--directory 指定了另外一台主机上的日志目录)。如果指定了32字符的 ID ， 那么表示以此 ID 所代表的那次启动为基准计算偏移量(±offset)， 计算方法同上。 换句话说， 省略 ID 表示以本次启动为基准计算偏移量(±offset)。</span><br><span class="line">  </span><br><span class="line">- --list-boots  </span><br><span class="line">  列出每次启动的 序号(也就是相对于本次启动的偏移量)、32字符的ID、第一条日志的时间戳、最后一条日志的时间戳。</span><br><span class="line">  </span><br><span class="line">- -k, --dmesg  </span><br><span class="line">  仅显示内核日志。隐含了 -b 选项以及 <span class="string">&quot;_TRANSPORT=kernel&quot;</span> 匹配项。</span><br><span class="line">  </span><br><span class="line">- -t, --identifier=SYSLOG_IDENTIFIER  </span><br><span class="line">  仅显示 syslog 识别符为 SYSLOG_IDENTIFIER 的日志项。可以多次使用该选项以指定多个识别符。</span><br><span class="line">  </span><br><span class="line">- -u, --unit=UNIT|PATTERN  </span><br><span class="line">  仅显示属于特定单元的日志。 也就是单元名称正好等于 UNIT 或者符合 PATTERN 模式的单元。 这相当于添加了一个 <span class="string">&quot;_SYSTEMD_UNIT=UNIT&quot;</span> 匹配项(对于 UNIT 来说)，或一组匹配项(对于 PATTERN 来说)。可以多次使用此选项以添加多个并列的匹配条件(相当于用<span class="string">&quot;OR&quot;</span>逻辑连接)。</span><br><span class="line">  </span><br><span class="line">- --user-unit=  </span><br><span class="line">  仅显示属于特定用户会话单元的日志。 相当于同时添加了 <span class="string">&quot;_SYSTEMD_USER_UNIT=&quot;</span> 与<span class="string">&quot;_UID=&quot;</span> 两个匹配条件。可以多次使用此选项以添加多个并列的匹配条件(相当于用<span class="string">&quot;OR&quot;</span>逻辑连接)。</span><br><span class="line">  </span><br><span class="line">- -p, --priority=  </span><br><span class="line">  根据日志等级(包括等级范围)过滤输出结果。 日志等级数字与其名称之间的对应关系如下 (参见 syslog(3))： <span class="string">&quot;emerg&quot;</span> (0), <span class="string">&quot;alert&quot;</span> (1), <span class="string">&quot;crit&quot;</span> (2), <span class="string">&quot;err&quot;</span> (3),<span class="string">&quot;warning&quot;</span> (4), <span class="string">&quot;notice&quot;</span> (5), <span class="string">&quot;info&quot;</span> (6), <span class="string">&quot;debug&quot;</span> (7) 。若设为一个单独的数字或日志等级名称， 则表示仅显示小于或等于此等级的日志(也就是重要程度等于或高于此等级的日志)。 若使用 FROM..TO.. 设置一个范围，则表示仅显示指定的等级范围内(含两端)的日志。 此选项相当于添加了 <span class="string">&quot;PRIORITY=&quot;</span> 匹配条件。</span><br><span class="line">  </span><br><span class="line">- -c, --cursor=  </span><br><span class="line">  从指定的游标(cursor)开始显示日志。[提示]每条日志都有一个<span class="string">&quot;__CURSOR&quot;</span>字段，类似于该条日志的指纹。</span><br><span class="line">  </span><br><span class="line">- --after-cursor=  </span><br><span class="line">  从指定的游标(cursor)之后开始显示日志。 如果使用了 --show-cursor 选项，则也会显示游标本身。</span><br><span class="line">  </span><br><span class="line">- --show-cursor  </span><br><span class="line">  在最后一条日志之后显示游标， 类似下面这样，以<span class="string">&quot;--&quot;</span>开头：-- cursor: s=0639... 游标的具体格式是私有的(也就是没有公开的规范)， 并且会变化。</span><br><span class="line">  </span><br><span class="line">- -S, --since=, -U, --<span class="keyword">until</span>=  </span><br><span class="line">  显示晚于指定时间(--since=)的日志、显示早于指定时间(--<span class="keyword">until</span>=)的日志。参数的格式类似 <span class="string">&quot;2012-10-30 18:17:16&quot;</span> 这样。 如果省略了<span class="string">&quot;时:分:秒&quot;</span>部分，则相当于设为 <span class="string">&quot;00:00:00&quot;</span> 。 如果仅省略了<span class="string">&quot;秒&quot;</span>的部分则相当于设为 <span class="string">&quot;:00&quot;</span> 。如果省略了<span class="string">&quot;年-月-日&quot;</span>部分， 则相当于设为当前日期。 除了<span class="string">&quot;年-月-日 时:分:秒&quot;</span>格式，参数还可以进行如下设置：(1)设为 <span class="string">&quot;yesterday&quot;</span>, <span class="string">&quot;today&quot;</span>, <span class="string">&quot;tomorrow&quot;</span>以表示那一天的零点(00:00:00)。 (2)设为 <span class="string">&quot;now&quot;</span> 以表示当前时间。(3)可以在<span class="string">&quot;年-月-日 时:分:秒&quot;</span>前加上 <span class="string">&quot;-&quot;</span>(前移) 或 <span class="string">&quot;+&quot;</span>(后移)前缀以表示相对于当前时间的偏移。 关于时间与日期的详细规范， 参见systemd.time(7)</span><br><span class="line">  </span><br><span class="line">- -m, --merge  </span><br><span class="line">  混合显示包括远程日志在内的所有可见日志。</span><br><span class="line">  </span><br><span class="line">- --system, --user  </span><br><span class="line">  仅显示系统服务与内核的日志(--system)、 仅显示当前用户的日志(--user)。如果两个选项都未指定，则显示当前用户的所有可见日志。</span><br><span class="line">  </span><br><span class="line">- -M, --machine=  </span><br><span class="line">  显示来自于正在运行的、特定名称的本地容器的日志。 参数必须是一个本地容器的名称。</span><br><span class="line">  </span><br><span class="line">- -D DIR, --directory=DIR  </span><br><span class="line">  仅显示来自于特定目录中的日志， 而不是默认的运行时和系统日志目录中的日志。</span><br><span class="line">  </span><br><span class="line">- --file=GLOB  </span><br><span class="line">  GLOB 是一个可以包含<span class="string">&quot;?&quot;</span>与<span class="string">&quot;*&quot;</span>的文件路径匹配模式。 表示仅显示来自与指定的 GLOB模式匹配的文件中的日志， 而不是默认的运行时和系统日志目录中的日志。可以多次使用此选项以指定多个匹配模式(多个模式之间用<span class="string">&quot;OR&quot;</span>逻辑连接)。</span><br><span class="line">  </span><br><span class="line">- --root=ROOT  </span><br><span class="line">  在对日志进行操作时， 将 ROOT 视为系统的根目录。 例如 --update-catalog 将会创ROOT/var/lib/systemd/catalog/database</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 日志字段与分类查询</span></span><br><span class="line">- -F, --field=  </span><br><span class="line">  显示所有日志中某个字段的所有可能值。 [译者注]类似于SQL语句：<span class="string">&quot;SELECT DISTINCT 某字段 FROM 全部日志&quot;</span></span><br><span class="line">  </span><br><span class="line">- -N, --fields  </span><br><span class="line">  输出所有日志字段的名称</span><br><span class="line">  </span><br><span class="line">- --list-catalog [128-bit-ID...]  </span><br><span class="line">  简要列出日志分类信息， 其中包括对分类信息的简要描述。如果明确指定了分类ID(128-bit-ID)， 那么仅显示指定的分类。</span><br><span class="line">  </span><br><span class="line">- --dump-catalog [128-bit-ID...]  </span><br><span class="line">  详细列出日志分类信息 (格式与 .catalog 文件相同)。如果明确指定了分类ID(128-bit-ID)， 那么仅显示指定的分类。</span><br><span class="line">  </span><br><span class="line">- --update-catalog  </span><br><span class="line">  更新日志分类索引二进制文件。每当安装、删除、更新了分类文件，都需要执行一次此动作。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 日志管理与维护</span></span><br><span class="line">- --new-id128  </span><br><span class="line">  此选项并不用于显示日志内容， 而是用于重新生成一个标识日志分类的 128-bit ID 。此选项的目的在于 帮助开发者生成易于辨别的日志消息， 以方便调试。</span><br><span class="line">  </span><br><span class="line">- --header  </span><br><span class="line">  此选项并不用于显示日志内容， 而是用于显示日志文件内部的头信息(类似于元数据)。</span><br><span class="line">  </span><br><span class="line">- --disk-usage  </span><br><span class="line">  此选项并不用于显示日志内容，而是用于显示所有日志文件(归档文件与活动文件)的磁盘占用总量。</span><br><span class="line">  </span><br><span class="line">- --vacuum-size=, --vacuum-time=, --vacuum-files=  </span><br><span class="line">  这些选项并不用于显示日志内容，而是用于清理日志归档文件(并不清理活动的日志文件)， 以释放磁盘空间。--vacuum-size= 可用于限制归档文件的最大磁盘使用量 (可以使用 <span class="string">&quot;K&quot;</span>, <span class="string">&quot;M&quot;</span>, <span class="string">&quot;G&quot;</span>, <span class="string">&quot;T&quot;</span>后缀)； --vacuum-time= 可用于清除指定时间之前的归档 (可以使用 <span class="string">&quot;s&quot;</span>, <span class="string">&quot;m&quot;</span>, <span class="string">&quot;h&quot;</span>,<span class="string">&quot;days&quot;</span>, <span class="string">&quot;weeks&quot;</span>, <span class="string">&quot;months&quot;</span>, <span class="string">&quot;years&quot;</span> 后缀)； --vacuum-files=可用于限制日志归档文件的最大数量。 注意，--vacuum-size= 对 --disk-usage的输出仅有间接效果， 因为 --disk-usage 输出的是归档日志与活动日志的总量。同样，--vacuum-files= 也未必一定会减少日志文件的总数，因为它同样仅作用于归档文件而不会删除活动的日志文件。此三个选项可以同时使用，以同时从三个维度去限制归档文件。若将某选项设为零，则表示取消此选项的限制。</span><br><span class="line">  </span><br><span class="line">- --setup-keys  </span><br><span class="line">  此选项并不用于显示日志内容， 而是用于生成一个新的FSS(Forward Secure Sealing)密钥对。 此密钥对包含一个<span class="string">&quot;sealing key&quot;</span>与一个<span class="string">&quot;verification key&quot;</span>。<span class="string">&quot;sealing key&quot;</span>保存在本地日志目录中， 而<span class="string">&quot;verification key&quot;</span>则必须保存在其他地方。详见 journald.conf(5) 中的 Seal= 选项。</span><br><span class="line">  </span><br><span class="line">- --force  </span><br><span class="line">  与 --setup-keys 连用， 表示即使已经配置了FSS(Forward Secure Sealing)密钥对，也要强制重新生成。</span><br><span class="line">  </span><br><span class="line">- --interval=  </span><br><span class="line">  与 --setup-keys 连用，指定<span class="string">&quot;sealing key&quot;</span>的变化间隔。较短的时间间隔会导致占用更多的CPU资源， 但是能够减少未检测的日志变化时间。默认值是 15min</span><br><span class="line">  </span><br><span class="line">- --verify  </span><br><span class="line">  检查日志文件的内在一致性。 如果日志文件在生成时开启了FSS特性， 并且使用 --verify-key= 指定了FSS的<span class="string">&quot;verification key&quot;</span>，那么，同时还将验证日志文件的真实性。</span><br><span class="line">  </span><br><span class="line">- --verify-key=  </span><br><span class="line">  与 --verify 选项连用， 指定FSS的<span class="string">&quot;verification key&quot;</span></span><br><span class="line">  </span><br><span class="line">- --<span class="built_in">sync</span>  </span><br><span class="line">  要求日志守护进程将所有未写入磁盘的日志数据刷写到磁盘上，并且一直阻塞到刷写操作实际完成之后才返回。 因此该命令可以保证当它返回的时候，所有在调用此命令的时间点之前的日志， 已经全部安全的刷写到了磁盘中。</span><br><span class="line">  </span><br><span class="line">- --flush  </span><br><span class="line">  要求日志守护进程 将 /run/log/journal 中的日志数据 刷写到 /var/log/journal 中(如果持久存储设备当前可用的话)。 此操作会一直阻塞到操作完成之后才会返回，因此可以确保在该命令返回时， 数据转移确实已经完成。注意，此命令仅执行一个单独的、一次性的转移动作， 若没有数据需要转移，则此命令什么也不做， 并且也会返回一个表示操作已正确完成的返回值。</span><br><span class="line">  </span><br><span class="line">- --rotate  </span><br><span class="line">  要求日志守护进程滚动日志文件。 此命令会一直阻塞到滚动完成之后才会返回。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 帮助与版本</span></span><br><span class="line">- -h, --<span class="built_in">help</span>  </span><br><span class="line">  显示简短的帮助信息并退出。</span><br><span class="line">- --version  </span><br><span class="line">  显示简短的版本信息并退出。</span><br><span class="line">- --no-pager  </span><br><span class="line">  不将程序的输出内容管道(pipe)给分页程序</span><br></pre></td></tr></table></figure>

<p>范例：journalctl常用用法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 基础日志查看</span></span><br><span class="line">- 查看所有日志（默认仅本次启动）  </span><br><span class="line">  journalctl  </span><br><span class="line">  </span><br><span class="line">- 查看内核日志（不含应用日志）  </span><br><span class="line">  journalctl -k  </span><br><span class="line">  </span><br><span class="line">- 查看系统本次启动的日志  </span><br><span class="line">  journalctl -b  </span><br><span class="line">  journalctl -b -0  </span><br><span class="line">  </span><br><span class="line">- 查看上一次启动的日志</span><br><span class="line">  journalctl -b -1</span><br><span class="line"></span><br><span class="line">- 直接显示到日志尾部，并附带解释性文本</span><br><span class="line">  journalctl -xe</span><br><span class="line"></span><br><span class="line"><span class="comment">### 按时间筛选日志</span></span><br><span class="line">- 查看指定时间的日志  </span><br><span class="line">  journalctl --since=<span class="string">&quot;2017-10-30 18:10:30&quot;</span>  </span><br><span class="line">  journalctl --since <span class="string">&quot;20 min ago&quot;</span>  </span><br><span class="line">  journalctl --since yesterday  </span><br><span class="line">  journalctl --since <span class="string">&quot;2017-01-10&quot;</span> --<span class="keyword">until</span> <span class="string">&quot;2017-01-11 03:00&quot;</span>  </span><br><span class="line">  journalctl --since 09:00 --<span class="keyword">until</span> <span class="string">&quot;1 hour ago&quot;</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment">### 按日志位置/数量筛选</span></span><br><span class="line">- 显示尾部最新10行日志  </span><br><span class="line">  journalctl -n  </span><br><span class="line">  </span><br><span class="line">- 显示尾部指定行数的日志  </span><br><span class="line">  journalctl -n 20  </span><br><span class="line">  </span><br><span class="line">- 实时滚动显示最新日志  </span><br><span class="line">  journalctl -f  </span><br><span class="line"></span><br><span class="line"><span class="comment">### 按对象筛选日志</span></span><br><span class="line">- 查看指定服务的日志  </span><br><span class="line">  journalctl /usr/lib/systemd/systemd  </span><br><span class="line">  </span><br><span class="line">- 查看指定进程的日志  </span><br><span class="line">  journalctl _PID=1  </span><br><span class="line">  </span><br><span class="line">- 查看某个脚本的日志  </span><br><span class="line">  journalctl /usr/bin/bash  </span><br><span class="line">  </span><br><span class="line">- 查看指定用户的日志  </span><br><span class="line">  journalctl _UID=33 --since today  </span><br><span class="line">  </span><br><span class="line">- 查看某个 Unit 的日志  </span><br><span class="line">  journalctl -u nginx.service  </span><br><span class="line">  journalctl -u nginx.service --since today </span><br><span class="line">  </span><br><span class="line">- 实时滚动显示某个 Unit 的最新日志  </span><br><span class="line">  journalctl -u nginx.service -f  </span><br><span class="line">  </span><br><span class="line">- 合并显示多个 Unit 的日志  </span><br><span class="line">  journalctl -u nginx.service -u php-fpm.service --since today  </span><br><span class="line"></span><br><span class="line"><span class="comment">### 按日志级别筛选</span></span><br><span class="line">- 查看指定优先级（及以上）的日志（级别：0:emerg；1:alert；2:crit；3:err；4:warning；5:notice；6:info；7:debug）  </span><br><span class="line">  journalctl -p err -b  </span><br><span class="line"></span><br><span class="line"><span class="comment">### 输出格式控制</span></span><br><span class="line">- 关闭分页，标准输出  </span><br><span class="line">  journalctl --no-pager  </span><br><span class="line">  </span><br><span class="line">- 以 JSON 格式（单行）输出  </span><br><span class="line">  journalctl -b -u nginx.service -o json  </span><br><span class="line">  </span><br><span class="line">- 以 JSON 格式（多行，可读性好）输出  </span><br><span class="line">  journalctl -b -u nginx.service -o json-pretty  </span><br><span class="line"></span><br><span class="line"><span class="comment">### 日志管理</span></span><br><span class="line">- 显示日志占据的硬盘空间  </span><br><span class="line">  journalctl --disk-usage  </span><br><span class="line">  </span><br><span class="line">- 指定日志文件最大占用空间  </span><br><span class="line">  journalctl --vacuum-size=1G  </span><br><span class="line">  </span><br><span class="line">- 指定日志文件保存时长  </span><br><span class="line">  journalctl --vacuum-time=1years  </span><br></pre></td></tr></table></figure>

<h1 id="2-利用MySQL存储日志信息"><a href="#2-利用MySQL存储日志信息" class="headerlink" title="2 利用MySQL存储日志信息"></a>2 利用MySQL存储日志信息</h1><p><img src="/Linux/service-manage/log/1753757621811-3476b7de-d568-439a-8731-4dcd17cf97c9-17556835715822.png" alt="null"></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">10.0.0.180：rocky</span><br><span class="line">10.0.0.179：Ubuntu</span><br></pre></td></tr></table></figure>

<h2 id="2-1-目标"><a href="#2-1-目标" class="headerlink" title="2.1 目标"></a>2.1 目标</h2><p>在网络转发的基础上，，利用rsyslog日志服务，将收集的日志记录于MySQL中</p>
<h2 id="2-2-环境准备"><a href="#2-2-环境准备" class="headerlink" title="2.2 环境准备"></a>2.2 环境准备</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">两台主机</span><br><span class="line">一台：rsyslog日志服务器，IP：10.0.0.180</span><br><span class="line">一台：mysql数据库服务器，IP：10.0.0.179</span><br></pre></td></tr></table></figure>

<h2 id="2-3-实现步骤"><a href="#2-3-实现步骤" class="headerlink" title="2.3 实现步骤"></a>2.3 实现步骤</h2><h3 id="2-3-1-在rsyslog服务器上安装连接mysql模块相关的程序包"><a href="#2-3-1-在rsyslog服务器上安装连接mysql模块相关的程序包" class="headerlink" title="2.3.1 在rsyslog服务器上安装连接mysql模块相关的程序包"></a>2.3.1 在rsyslog服务器上安装连接mysql模块相关的程序包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">[root@rsyslog ~]#yum -y install rsyslog-mysql</span><br><span class="line">[root@rsyslog ~]#yum install -y mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#补充：Ubuntu</span></span><br><span class="line">[root@ubuntu2004 ~]#apt -y install rsyslog-mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#模块配置文件，到时创建数据库和账号要按照这个来</span></span><br><span class="line">[root@rsyslog ~]#vim /etc/rsyslog.d/mysql.conf</span><br><span class="line"><span class="comment">### Configuration file for rsyslog-mysql</span></span><br><span class="line"><span class="comment">### Changes are preserved</span></span><br><span class="line"></span><br><span class="line">module (load=<span class="string">&quot;ommysql&quot;</span>)</span><br><span class="line">*.* action(<span class="built_in">type</span>=<span class="string">&quot;ommysql&quot;</span> server=<span class="string">&quot;localhost&quot;</span> db=<span class="string">&quot;Syslog&quot;</span> uid=<span class="string">&quot;rsyslog&quot;</span> <span class="built_in">pwd</span>=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看包文件</span></span><br><span class="line">[root@rsyslog ~]#rpm -ql rsyslog-mysql </span><br><span class="line">/usr/lib/.build-id</span><br><span class="line">/usr/lib/.build-id/7e</span><br><span class="line">/usr/lib/.build-id/7e/30458f368f71ec11b45c0445303b98fbc47a9c</span><br><span class="line">/usr/lib64/rsyslog/ommysql.so								<span class="comment">#库文件</span></span><br><span class="line">/usr/share/doc/rsyslog/mysql-createDB.sql					<span class="comment">#mysql 数据表脚本文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#补充Ubuntu</span></span><br><span class="line">[root@ubuntu2004 ~]# dpkg -L rsyslog-mysql</span><br><span class="line">......</span><br><span class="line">/usr/lib/x86_64-linux-gnu/rsyslog/ommysql.so 				<span class="comment">#库文件</span></span><br><span class="line">/usr/share/dbconfig-common/data/rsyslog-mysql/install/mysql <span class="comment">#mysql 数据表脚本文件</span></span><br><span class="line">/usr/share/rsyslog-mysql/rsyslog-mysql.conf.template 		<span class="comment">#rsyslog 配置文件模板</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看sql脚本文件内容</span></span><br><span class="line">[root@rsyslog ~]#<span class="built_in">cat</span> /usr/share/doc/rsyslog/mysql-createDB.sql</span><br><span class="line">CREATE DATABASE Syslog;</span><br><span class="line">USE Syslog;</span><br><span class="line">CREATE TABLE SystemEvents</span><br><span class="line">(</span><br><span class="line">        ID int unsigned not null auto_increment primary key,</span><br><span class="line">        CustomerID bigint,</span><br><span class="line">        ReceivedAt datetime NULL,</span><br><span class="line">        DeviceReportedTime datetime NULL,</span><br><span class="line">        Facility smallint NULL,</span><br><span class="line">        Priority smallint NULL,</span><br><span class="line">        FromHost varchar(60) NULL,</span><br><span class="line">        Message text,</span><br><span class="line">        NTSeverity int NULL,</span><br><span class="line">        Importance int NULL,</span><br><span class="line">        EventSource varchar(60),</span><br><span class="line">        EventUser varchar(60) NULL,</span><br><span class="line">        EventCategory int NULL,</span><br><span class="line">        EventID int NULL,</span><br><span class="line">        EventBinaryData text NULL,</span><br><span class="line">        MaxAvailable int NULL,</span><br><span class="line">        CurrUsage int NULL,</span><br><span class="line">        MinUsage int NULL,</span><br><span class="line">        MaxUsage int NULL,</span><br><span class="line">        InfoUnitID int NULL ,</span><br><span class="line">        SysLogTag varchar(60),</span><br><span class="line">        EventLogType varchar(60),</span><br><span class="line">        GenericFileName VarChar(60),</span><br><span class="line">        SystemID int NULL</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE TABLE SystemEventsProperties</span><br><span class="line">(</span><br><span class="line">        ID int unsigned not null auto_increment primary key,</span><br><span class="line">        SystemEventID int NULL ,</span><br><span class="line">        ParamName varchar(255) NULL ,</span><br><span class="line">        ParamValue text NULL</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">#补充Ubuntu</span></span><br><span class="line">[root@centos8 ~]#<span class="built_in">cat</span> /usr/share/dbconfig-common/data/rsyslog-mysql/install/mysql</span><br><span class="line">CREATE DATABASE Syslog;  <span class="comment">#Ubuntu22.04和20.04没有这两行，需要手动创建数据库</span></span><br><span class="line">USE Syslog;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-2-准备-MySQL"><a href="#2-3-2-准备-MySQL" class="headerlink" title="2.3.2 准备 MySQL"></a>2.3.2 准备 MySQL</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Ubuntu默认开启mysql服务</span></span><br><span class="line">[root@mysql ~]#apt update &amp;&amp; apt install -y mysql-server</span><br><span class="line"></span><br><span class="line"><span class="comment">#但是只监听本机，无法远程连接</span></span><br><span class="line">[root@ubuntu2004 ~]#ss -ntl</span><br><span class="line">State      Recv-Q     Send-Q          Local Address:Port            Peer Address:Port     Process     </span><br><span class="line">LISTEN     0          151                 127.0.0.1:3306                 0.0.0.0:*      </span><br><span class="line"></span><br><span class="line"><span class="comment">#修改文件，将两行注释</span></span><br><span class="line">[root@mysql ~]#vim /etc/mysql/mysql.conf.d/mysqld.cnf </span><br><span class="line"><span class="comment">#bind-address           = 127.0.0.1</span></span><br><span class="line"><span class="comment">#mysqlx-bind-address    = 127.0.0.1</span></span><br><span class="line"></span><br><span class="line">[root@mysql ~]#systemctl restart mysql</span><br><span class="line"></span><br><span class="line">[root@mysql ~]#ss -ntl               </span><br><span class="line">State      Recv-Q     Send-Q          Local Address:Port            Peer Address:Port     Process     </span><br><span class="line">LISTEN     0          151                         *:3306                       *:*          </span><br><span class="line"></span><br><span class="line"><span class="comment">#因为Ubuntu的数据库脚本中没有创建数据库的命令，需要手动创建</span></span><br><span class="line">mysql&gt; create database Syslog;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| Syslog             |</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#根据模块文件的要求创建账号和授权</span></span><br><span class="line">mysql&gt; create user rsyslog@<span class="string">&#x27;10.0.0.%&#x27;</span> identified by <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all on Syslog.* to rsyslog@<span class="string">&#x27;10.0.0.%&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试能否在rsyslog服务器上远程连接mysql服务器</span></span><br><span class="line">[root@rsyslog ~]#mysql -ursyslog -p123456 -h10.0.0.179</span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| performance_schema |</span><br><span class="line">+--------------------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#方法1：在rsyslog服务器上导入数据库</span></span><br><span class="line">mysql&gt; <span class="built_in">source</span> /usr/share/doc/rsyslog/mysql-createDB.sql;</span><br><span class="line">[root@rsyslog ~]#mysql -ursyslog -p123456 -h10.0.0.179 &lt; /usr/share/doc/rsyslog/mysql-createDB.sql</span><br><span class="line">[root@rsyslog ~]#mysql -ursyslog -p123456 -h10.0.0.179 -e <span class="string">&quot;source /usr/share/doc/rsyslog/mysql-createDB.sql&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#补充Ubuntu</span></span><br><span class="line">[root@ubuntu2204 ~]#mysql -ursyslog -p123456 -h10.0.0.179 Syslog &lt; /usr/share/dbconfig-common/data/rsyslog-ysql/install/mysql</span><br><span class="line">[root@ubuntu2204 ~]#mysql -ursyslog -p123456 -h10.0.0.179 Syslog -e <span class="string">&quot;source /usr/share/dbconfig-common/data/rsyslog-ysql/install/mysql&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#方法2：在mysql服务器上导入数据库</span></span><br><span class="line"><span class="comment">#将sql脚本复制到数据库服库上</span></span><br><span class="line">[root@rsyslog ~]#scp /usr/share/doc/rsyslog/mysql-createDB.sql 10.0.0.179:</span><br><span class="line"></span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">+------------------------+</span><br><span class="line">| Tables_in_Syslog       |</span><br><span class="line">+------------------------+</span><br><span class="line">| SystemEvents           |</span><br><span class="line">| SystemEventsProperties |</span><br><span class="line">+------------------------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#两张表都为空</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> count(*) from SystemEvents;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|        0 |</span><br><span class="line">+----------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> count(*) from SystemEventsProperties;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|        0 |</span><br><span class="line">+----------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br></pre></td></tr></table></figure>

<h3 id="2-3-3-配置日志服务器将日志发送至指定数据库"><a href="#2-3-3-配置日志服务器将日志发送至指定数据库" class="headerlink" title="2.3.3 配置日志服务器将日志发送至指定数据库"></a>2.3.3 配置日志服务器将日志发送至指定数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置rsyslog将日志保存到mysql中</span></span><br><span class="line">[root@rsyslog ~]#vim /etc/rsyslog.conf</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">####MODULES####</span></span><br><span class="line"><span class="comment">#在 MODULES 语言下面，如果是 Ubuntu22.04,20.04和CentOS8 加下面行</span></span><br><span class="line">module(load=<span class="string">&quot;ommysql&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#在 MODULES 语言下面，如果是 CentOS 7，6 加下面行</span></span><br><span class="line"><span class="variable">$ModLoad</span> ommysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#在RULES语句块加下面行的格式</span></span><br><span class="line"><span class="comment">#facility.priority  :ommysql:DBHOST,DBNAME,DBUSER, PASSWORD</span></span><br><span class="line">*.info :ommysql:10.0.0.179,Syslog,rsyslog,123456</span><br><span class="line"></span><br><span class="line">[root@rsyslog ~]#systemctl restart rsyslog.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#Ubuntu 自动生成以下配置文件，只需要按环境修改</span></span><br><span class="line"><span class="comment">#由于原模块文件中没有设置密码，要加上去，把级别改了，把server改了，指向mysql服务器</span></span><br><span class="line">[root@ubuntu2004 ~]#vim /etc/rsyslog.d/mysql.conf</span><br><span class="line">module (load=<span class="string">&quot;ommysql&quot;</span>)</span><br><span class="line">*.info action(<span class="built_in">type</span>=<span class="string">&quot;ommysql&quot;</span> server=<span class="string">&quot;10.0.0.179&quot;</span> db=<span class="string">&quot;Syslog&quot;</span> uid=<span class="string">&quot;rsyslog&quot;</span> <span class="built_in">pwd</span>=<span class="string">&quot;123456&quot;</span>)</span><br><span class="line"></span><br><span class="line">[root@ubuntu2004 ~]#systemctl restart rsyslog</span><br></pre></td></tr></table></figure>

<h3 id="2-3-4-测试"><a href="#2-3-4-测试" class="headerlink" title="2.3.4 测试"></a>2.3.4 测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#测试将client1，client2的日志发送数据库</span></span><br><span class="line">[root@client-1 ~]#logger <span class="string">&quot;this msg from client-1&quot;</span></span><br><span class="line">[root@client-2 ~]#logger <span class="string">&quot;this msg from client-2&quot;</span></span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> FromHost,Message from SystemEvents order by <span class="built_in">id</span> desc <span class="built_in">limit</span> 3;</span><br><span class="line">+------------+---------------------------+</span><br><span class="line">| FromHost   | Message          		 |</span><br><span class="line">+------------+---------------------------+</span><br><span class="line">| client-2   | this msg from client-2   |</span><br><span class="line">| client-1   | this msg from client-1   |</span><br><span class="line">+------------+---------------------------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>在此基础上，我们可以再实现一个 Web 服务，将 Mysql 中的日志数据在页面上显示出来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#推荐的开源程序</span></span><br><span class="line">https://loganalyzer.adiscon.com/</span><br></pre></td></tr></table></figure>

<h1 id="3-Logrotate日志转储"><a href="#3-Logrotate日志转储" class="headerlink" title="3 Logrotate日志转储"></a>3 Logrotate日志转储</h1><h2 id="3-1-Logrotate介绍"><a href="#3-1-Logrotate介绍" class="headerlink" title="3.1 Logrotate介绍"></a>3.1 Logrotate介绍</h2><p>日志是重要的系统文件，记录和保存了系统中所有的重要事件。但是日志文件也需要进行定期的维护，因为日志文件是不断增长的，如果完全不进行日志维护，而任由其随意递增，那么用不了多久，我们的硬盘就会被写满。如果服务器数量较多，日志文件大小增长较快，也会很容易触发告警。日志维护的最主要的工作就是把旧的日志文件删除，从而腾出空间保存新的日志文件。这项工作如果靠管理员手工来完成，那其实是非常烦琐的，而且也容易忘记。那么 Linux 系统是否可以自动完成日志的轮替工作呢？</p>
<p>为了解决这种情况，我们可以使用日志转储服务。logrotate就是用来进行日志轮替（也叫日志转储）的，把旧的日志文件删除，并创建新的日志文件，节省磁盘空间。可以根据日志文件的大小，也可以根据其天数来转储，这个过程一般通过 cron 程序来执行</p>
<p>工作原理：系统计划任务每天执行一次脚本文件，在脚本中再执行 <code>/usr/sbin/logrotate/etc/logrotate.conf</code> ，即调用 logrotate 程序再配合定义好的转储规则对日志文件进行转储</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@log-server ~]# ll /var/log/dmesg*</span><br><span class="line">-rw-r----- 1 root adm 132571 Jul  4 08:49 /var/log/dmesg</span><br><span class="line">-rw-r----- 1 root adm 132565 Jul  3 20:12 /var/log/dmesg.0</span><br><span class="line">-rw-r----- 1 root adm  26381 Jun 30 08:18 /var/log/dmesg.1.gz</span><br><span class="line">-rw-r----- 1 root adm  26443 Jun 28 22:01 /var/log/dmesg.2.gz</span><br><span class="line"></span><br><span class="line">[root@log-server ~]# ll /var/log/alternatives.log*</span><br><span class="line">-rw-r--r-- 1 root root  416 Jul  4 08:49 /var/log/alternatives.log</span><br><span class="line">-rw-r--r-- 1 root root 9415 Jun 30 08:31 /var/log/alternatives.log.1</span><br><span class="line">-rw-r--r-- 1 root root 3160 May  9 11:58 /var/log/alternatives.log.2.gz</span><br></pre></td></tr></table></figure>

<h2 id="3-2-日志文件的命名规则"><a href="#3-2-日志文件的命名规则" class="headerlink" title="3.2 日志文件的命名规则"></a>3.2 日志文件的命名规则</h2><p>日志轮替最主要的作用就是把旧的日志文件移动并改名，同时建立新的空日志文件，当旧日志文件超出保存的范围时就删除。那么，旧的日志文件改名之后，如何命名呢？主要依靠 &#x2F;etc&#x2F;logrotate.conf 配置文件中的“dateext”参数。</p>
<p>如果配置文件中有“dateext”参数，那么日志会用日期来作为日志文件的后缀，如“secure-20130605”。这样日志文件名不会重叠，也就不需要对日志文件进行改名，只需要保存指定的日志个数，删除多余的日志文件即可。</p>
<p>如果配置文件中没有“dateext”参数，那么日志文件就需要进行改名了。当第一次进行日志轮替时，当前的“secure”日志会自动改名为“secure.1”，然后新建“secure”日志，用来保存新的日志；当第二次进行日志轮替时，“secure.1”会自动改名为“secure.2”，当前的“secure”日志会自动改名为“secure.1”，然后也会新建“secure”日志，用来保存新的日志，以此类推。</p>
<h2 id="3-3-Logrotate配置"><a href="#3-3-Logrotate配置" class="headerlink" title="3.3 Logrotate配置"></a>3.3 Logrotate配置</h2><p>软件包：logrotate</p>
<p>相关文件</p>
<ul>
<li><p>计划任务：&#x2F;etc&#x2F;cron.daily&#x2F;logrotate，&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;logrotate.service，&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;logrotate.timer</p>
</li>
<li><p>程序文件：&#x2F;usr&#x2F;sbin&#x2F;logrotate</p>
</li>
<li><p>配置文件： &#x2F;etc&#x2F;logrotate.conf</p>
</li>
<li><p>日志文件：&#x2F;var&#x2F;lib&#x2F;logrotate&#x2F;logrotate.status</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/etc/cron.daily/logrotate 	<span class="comment">#定时任务脚本，放在 cron.daily 目录中，默认系统会每天执行一次</span></span><br><span class="line">/etc/logrotate.conf 				<span class="comment">#主配置文件，定义日志转储策略</span></span><br><span class="line">/etc/logrotate.d/ 					<span class="comment">#配置文件目录，定义日志转储策略</span></span><br><span class="line">/usr/sbin/logrotate 				<span class="comment">#主程序</span></span><br><span class="line">/var/lib/logrotate/status 	<span class="comment">#logrotate服务的日志文件</span></span><br></pre></td></tr></table></figure>

<p>在配置文件中定义转储规则，配置文件中的主要配置项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@log-server ~]# <span class="built_in">cat</span> /etc/logrotate.conf</span><br><span class="line"><span class="comment"># see &quot;man logrotate&quot; for details</span></span><br><span class="line"><span class="comment"># global options do not affect preceding include directives</span></span><br><span class="line"><span class="comment"># rotate log files weekly</span></span><br><span class="line">weekly 			<span class="comment">#默认每周一次转储</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># use the adm group by default, since this is the owning group</span></span><br><span class="line"><span class="comment"># of /var/log/syslog.</span></span><br><span class="line">su root adm 	<span class="comment">#默认使用adm组</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># keep 4 weeks worth of backlogs</span></span><br><span class="line">rotate 4 		<span class="comment">#默认保留最近4周的文件(4个文件)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># create new (empty) log files after rotating old ones</span></span><br><span class="line">create 			<span class="comment">#转储完成后生成新的空文件存储新的日志</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># use date as a suffix of the rotated file</span></span><br><span class="line"><span class="comment">#dateext 		#默认不使用日志后缀</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># uncomment this if you want your log files compressed</span></span><br><span class="line"><span class="comment">#compress 		#默认不启用文件压缩</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># packages drop log rotation information into this directory</span></span><br><span class="line">include /etc/logrotate.d 	<span class="comment">#包含的子目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># system-specific logs may also be configured here.</span></span><br></pre></td></tr></table></figure>

<p>配置文件主要参数如下：</p>
<table>
<thead>
<tr>
<th><strong>配置参数</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>compress</td>
<td>通过gzip压缩转储以后的日志</td>
</tr>
<tr>
<td>nocompress</td>
<td>不压缩</td>
</tr>
<tr>
<td>copytruncate</td>
<td>用于还在打开中的日志文件，把当前日志备份并截断</td>
</tr>
<tr>
<td>nocopytruncate</td>
<td>备份日志文件但是不截断</td>
</tr>
<tr>
<td>create mode owner group</td>
<td>转储文件，使用指定的权限，所有者，所属组创建新的日志文件</td>
</tr>
<tr>
<td>nocreate</td>
<td>不建立新的日志文件</td>
</tr>
<tr>
<td>delaycompress</td>
<td>和 compress 一起使用时，转储的日志文件到下一次转储时才压缩</td>
</tr>
<tr>
<td>nodelaycompress</td>
<td>覆盖 delaycompress 选项，转储同时压缩</td>
</tr>
<tr>
<td>errors address</td>
<td>专储时的错误信息发送到指定的Email 地址</td>
</tr>
<tr>
<td>ifempty</td>
<td>即使是空文件也转储，此为默认选项</td>
</tr>
<tr>
<td>notifempty</td>
<td>如果是空文件的话，不转储</td>
</tr>
<tr>
<td>mail address</td>
<td>把转储的日志文件发送到指定的E-mail 地址</td>
</tr>
<tr>
<td>nomail</td>
<td>转储时不发送日志文件</td>
</tr>
<tr>
<td>olddir directory</td>
<td>转储后的日志文件放入指定目录，必须和当前日志文件在同一个文件系统</td>
</tr>
<tr>
<td>noolddir</td>
<td>转储后的日志文件和当前日志文件放在同一个目录下</td>
</tr>
<tr>
<td>prerotate&#x2F;endscript</td>
<td>在转储以前需要执行的命令，这两个关键字必须单独成行</td>
</tr>
<tr>
<td>postrotate&#x2F;endscript</td>
<td>在转储以后需要执行的命令，这两个关键字必须单独成行</td>
</tr>
<tr>
<td>daily</td>
<td>指定转储周期为每天</td>
</tr>
<tr>
<td>weekly</td>
<td>指定转储周期为每周</td>
</tr>
<tr>
<td>monthly</td>
<td>指定转储周期为每月</td>
</tr>
<tr>
<td>rotate count</td>
<td>指定日志文件删除之前转储的次数，0 指没有备份，5 指保留5 个备份</td>
</tr>
<tr>
<td>tabooext [+] list</td>
<td>让logrotate不转储指定扩展名的文件，缺省的扩展名是：.rpm-orig，.rpmsave，v，和 ~</td>
</tr>
<tr>
<td>size size</td>
<td>当日志文件到达指定的大小时才转储，bytes(缺省)及KB或MB</td>
</tr>
<tr>
<td>sharedscripts</td>
<td>默认，对每个转储日志运行prerotate和postrotate脚本，日志文件的绝对路径作为第一个参数传递给脚本。 这意味着单个脚本可以针对与多个文件匹配的日志文件条目多次运行（例如&#x2F;var&#x2F;log&#x2F;example&#x2F;*.log）。 如果指定此项sharedscripts，则无论有多少个日志与通配符模式匹配，脚本都只会运行一次</td>
</tr>
<tr>
<td>nosharedscripts</td>
<td>针对每一个转储的日志文件，都执行一次prerotate 和 postrotate脚本，此为默认值</td>
</tr>
<tr>
<td>missingok</td>
<td>如果日志不存在，不提示错误，继续处理下一个</td>
</tr>
<tr>
<td>nomissingok</td>
<td>如果日志不存在，提示错误，此为默认值</td>
</tr>
</tbody></table>
<p>每个服务单独的配置文件，如果在单独配置文件中没有定义的配置项，则使用主配置文件中的配置项或默认配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">root@log-server ~]# <span class="built_in">ls</span> /etc/logrotate.d/</span><br><span class="line">alternatives apport apt bootlog btmp dbconfig-common dpkg nginx php8.1-fpm rsyslog ubuntu-advantage-tools ufw unattended-upgrades wtmp</span><br><span class="line"></span><br><span class="line">[root@log-server ~]# <span class="built_in">cat</span> /etc/logrotate.d/rsyslog</span><br><span class="line">/var/log/syslog</span><br><span class="line">/var/log/mail.info</span><br><span class="line">/var/log/mail.warn</span><br><span class="line">/var/log/mail.err</span><br><span class="line">/var/log/mail.log</span><br><span class="line">/var/log/daemon.log</span><br><span class="line">/var/log/kern.log</span><br><span class="line">/var/log/auth.log</span><br><span class="line">/var/log/user.log</span><br><span class="line">/var/log/lpr.log</span><br><span class="line">/var/log/cron.log</span><br><span class="line">/var/log/debug</span><br><span class="line">/var/log/messages</span><br><span class="line">&#123; 									<span class="comment">#上述所有日志文件都适用于此转储规则</span></span><br><span class="line">    rotate 4 				<span class="comment">#保留最近4个文件，加上当前使用的，一个5个</span></span><br><span class="line">    weekly 					<span class="comment">#每周转储</span></span><br><span class="line">    missingok 			<span class="comment">#如果要转储的日志文件不存在，不提示错误，继续下一个</span></span><br><span class="line">    notifempty 			<span class="comment">#如果是空文件，不转储</span></span><br><span class="line">    compress 				<span class="comment">#启用gzip压缩转储后的日志文件</span></span><br><span class="line">    delaycompress 	<span class="comment">#和 compress 一起使用时，转储的日志文件到下一次转储时才压缩</span></span><br><span class="line">    sharedscripts 	<span class="comment">#运行脚本，分别是转储前和转储后脚本</span></span><br><span class="line">    postrotate 	  	<span class="comment">#转储后脚本</span></span><br><span class="line">        /usr/lib/rsyslog/rsyslog-rotate</span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@log-server ~]# <span class="built_in">cat</span> /etc/logrotate.d/nginx</span><br><span class="line">/var/log/nginx/*.<span class="built_in">log</span> &#123;</span><br><span class="line">    daily</span><br><span class="line">    missingok</span><br><span class="line">    rotate 14</span><br><span class="line">    compress</span><br><span class="line">    delaycompress</span><br><span class="line">    notifempty</span><br><span class="line">    create 0640 www-data adm</span><br><span class="line">    sharedscripts</span><br><span class="line">    prerotate</span><br><span class="line">        <span class="keyword">if</span> [ -d /etc/logrotate.d/httpd-prerotate ]; <span class="keyword">then</span> \</span><br><span class="line">            run-parts /etc/logrotate.d/httpd-prerotate; \</span><br><span class="line">        <span class="keyword">fi</span> \</span><br><span class="line">    endscript</span><br><span class="line">    postrotate</span><br><span class="line">        invoke-rc.d nginx rotate &gt;/dev/null 2&gt;&amp;1 <span class="comment">#让nginx重新锚定新生成的日志文件</span></span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-4-Logrotate自定义规则实现"><a href="#3-4-Logrotate自定义规则实现" class="headerlink" title="3.4 Logrotate自定义规则实现"></a>3.4 Logrotate自定义规则实现</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">logrotate [OPTION...] &lt;configfile&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用选项</span></span><br><span class="line">-?|--<span class="built_in">help</span> 						<span class="comment">#显示帮助信息</span></span><br><span class="line">-d|--debug 						<span class="comment">#不执行任何操作，仅显示错误信息，类似于测试</span></span><br><span class="line">-f|--force     				<span class="comment">#强制执行</span></span><br><span class="line">-m|--mail=<span class="built_in">command</span> 		<span class="comment">#指定执行邮件发送的命令，默认 /usr/bin/mail</span></span><br><span class="line">-s|--state=statefile 	<span class="comment">#指定服务日志文件，默认 /var/lib/logrotate/status</span></span><br><span class="line">-v|--verbose 					<span class="comment">#显示详细信息</span></span><br><span class="line">-l|--<span class="built_in">log</span>=logfile 			<span class="comment">#指定详细信息日志，加上此选项，会将详细信息写到指定文件</span></span><br><span class="line">--version 						<span class="comment">#显示版本信息</span></span><br><span class="line">--skip-state-lock 		<span class="comment">#不给 statefile 文件加锁</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建测试日志文件</span></span><br><span class="line">[root@log-server ~]# <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/var/log/test1.<span class="built_in">log</span> bs=2M count=1</span><br><span class="line">[root@log-server ~]# <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/var/log/test2.<span class="built_in">log</span> bs=2M count=1</span><br><span class="line"></span><br><span class="line">[root@log-server ~]# ll -h /var/log/test*</span><br><span class="line">-rw-r--r-- 1 root root 2.0M Jul  4 17:51 /var/log/test1.<span class="built_in">log</span></span><br><span class="line">-rw-r--r-- 1 root root 2.0M Jul  4 17:52 /var/log/test2.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义转储规则</span></span><br><span class="line">[root@log-server ~]# <span class="built_in">cat</span> /etc/logrotate.d/test&#123;1,2&#125;</span><br><span class="line">/var/log/test1.<span class="built_in">log</span> &#123;</span><br><span class="line">    daily</span><br><span class="line">    rotate 5</span><br><span class="line"> 	su root root</span><br><span class="line">    compress</span><br><span class="line">    delaycompress</span><br><span class="line">    missingok</span><br><span class="line">    size 1M</span><br><span class="line">    notifempty</span><br><span class="line">    create 0640 syslog adm</span><br><span class="line">    postrotate</span><br><span class="line">        <span class="built_in">echo</span> `<span class="built_in">date</span> +%F_%T` &gt;&gt; /tmp/test1.<span class="built_in">log</span></span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/var/log/test2.<span class="built_in">log</span> &#123;</span><br><span class="line">    daily</span><br><span class="line">    rotate 5</span><br><span class="line"> 	su root root</span><br><span class="line">    dateext</span><br><span class="line">    compress</span><br><span class="line">    delaycompress</span><br><span class="line">    missingok</span><br><span class="line">    size 1M</span><br><span class="line">    notifempty</span><br><span class="line">    create 644 root root</span><br><span class="line">    postrotate</span><br><span class="line">  		<span class="built_in">echo</span> `<span class="built_in">date</span> +%F_%T` &gt;&gt; /tmp/test2.<span class="built_in">log</span></span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#手动执行转储</span></span><br><span class="line">[root@log-server ~]# logrotate /etc/logrotate.d/test1</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看日志，生成新的空文件，权限，属主属组都符合预设</span></span><br><span class="line">[root@log-server ~]# <span class="built_in">ls</span> -lh /var/log/test1*</span><br><span class="line">-rw-r----- 1 syslog adm   0 Jul  5 22:58 /var/log/test1.<span class="built_in">log</span></span><br><span class="line">-rw-r--r-- 1 root  root 2.0M Jul  5 21:05 /var/log/test1.log.1</span><br><span class="line"></span><br><span class="line"><span class="comment">#再次转储，先保证日志达到转储条件</span></span><br><span class="line">[root@log-server ~]# <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/var/log/test1.<span class="built_in">log</span> bs=3M count=1</span><br><span class="line">[root@log-server ~]# logrotate /etc/logrotate.d/test1</span><br><span class="line"></span><br><span class="line">[root@log-server ~]# <span class="built_in">ls</span> -lh /var/log/test1*</span><br><span class="line">-rw-r----- 1 syslog adm   0 Jul  5 23:16 /var/log/test1.<span class="built_in">log</span></span><br><span class="line">-rw-r----- 1 syslog adm  3.0M Jul  5 23:03 /var/log/test1.log.1 <span class="comment">#最新的转储</span></span><br><span class="line">-rw-r--r-- 1 root  root 2.1K Jul  5 21:05 /var/log/test1.log.2.gz <span class="comment">#前一个被转储的日志被压缩</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看日志文件，转储成功后命令被执行</span></span><br><span class="line">[root@log-server ~]# <span class="built_in">cat</span> /tmp/test1.<span class="built_in">log</span></span><br><span class="line">2023-07-05_22:58:11</span><br><span class="line">2023-07-05_23:16:12</span><br><span class="line"></span><br><span class="line"><span class="comment">#调用主配置文件进行转储，主配置文件中包含了 test1 test2 配置，所以都会被转储</span></span><br><span class="line">[root@log-server ~]# logrotate /etc/logrotate.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#test1 没有达到转储条件</span></span><br><span class="line">[root@log-server ~]# <span class="built_in">ls</span> -lh /var/log/test1*</span><br><span class="line">-rw-r----- 1 syslog adm   0 Jul  5 23:16 /var/log/test1.<span class="built_in">log</span></span><br><span class="line">-rw-r----- 1 syslog adm  3.0M Jul  5 23:03 /var/log/test1.log.1</span><br><span class="line">-rw-r--r-- 1 root  root 2.1K Jul  5 21:05 /var/log/test1.log.2.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#test2 达到条件，且有日期后缀</span></span><br><span class="line">[root@log-server ~]# <span class="built_in">ls</span> -lh /var/log/test2*</span><br><span class="line">-rw-r--r-- 1 root root   0 Jul  5 23:26 /var/log/test2.<span class="built_in">log</span></span><br><span class="line">-rw-r--r-- 1 root root 2.0M Jul  4 17:52 /var/log/test2.log-20230705</span><br></pre></td></tr></table></figure>

<h2 id="3-4-Logrotate配置范例"><a href="#3-4-Logrotate配置范例" class="headerlink" title="3.4 Logrotate配置范例"></a>3.4 Logrotate配置范例</h2><p>Ubuntu22.04 包文件内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu2204 ~]#dpkg -L logrotate</span><br><span class="line">/lib/systemd/system/logrotate.service</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[root@ubuntu2204 ~]#<span class="built_in">cat</span> /lib/systemd/system/logrotate.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Rotate <span class="built_in">log</span> files</span><br><span class="line">Documentation=man:logrotate(8) man:logrotate.conf(5)</span><br><span class="line">RequiresMountsFor=/var/log</span><br><span class="line">ConditionACPower=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=oneshot</span><br><span class="line">ExecStart=/usr/sbin/logrotate /etc/logrotate.conf</span><br><span class="line"><span class="comment"># performance options</span></span><br><span class="line">Nice=19</span><br><span class="line">IOSchedulingClass=best-effort</span><br><span class="line">IOSchedulingPriority=7</span><br><span class="line"><span class="comment"># hardening options</span></span><br><span class="line"><span class="comment"># details: https://www.freedesktop.org/software/systemd/man/systemd.exec.html</span></span><br><span class="line"><span class="comment"># no ProtectHome for userdir logs</span></span><br><span class="line"><span class="comment"># no PrivateNetwork for mail deliviery</span></span><br><span class="line"><span class="comment"># no NoNewPrivileges for third party rotate scripts</span></span><br><span class="line"><span class="comment"># no RestrictSUIDSGID for creating setgid directories</span></span><br><span class="line">LockPersonality=<span class="literal">true</span></span><br><span class="line">MemoryDenyWriteExecute=<span class="literal">true</span></span><br><span class="line">PrivateDevices=<span class="literal">true</span></span><br><span class="line">PrivateTmp=<span class="literal">true</span></span><br><span class="line">ProtectClock=<span class="literal">true</span></span><br><span class="line">ProtectControlGroups=<span class="literal">true</span></span><br><span class="line">ProtectHostname=<span class="literal">true</span></span><br><span class="line">ProtectKernelLogs=<span class="literal">true</span></span><br><span class="line">ProtectKernelModules=<span class="literal">true</span></span><br><span class="line">ProtectKernelTunables=<span class="literal">true</span></span><br><span class="line">ProtectSystem=full</span><br><span class="line">RestrictNamespaces=<span class="literal">true</span></span><br><span class="line">RestrictRealtime=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>Rocky8包文件内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]#rpm -ql logrotate</span><br><span class="line">/etc/cron.daily/logrotate</span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]#<span class="built_in">cat</span> /etc/cron.daily/logrotate</span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line">/usr/sbin/logrotate /etc/logrotate.conf</span><br><span class="line">EXITVALUE=$?</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$EXITVALUE</span> != 0 ]; <span class="keyword">then</span></span><br><span class="line"> 	/usr/bin/logger -t logrotate <span class="string">&quot;ALERT exited abnormally with [<span class="variable">$EXITVALUE</span>]&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">exit</span> <span class="variable">$EXITVALUE</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-1-定制设置nginx的日志转储"><a href="#3-4-1-定制设置nginx的日志转储" class="headerlink" title="3.4.1 定制设置nginx的日志转储"></a>3.4.1 定制设置nginx的日志转储</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/logrotate.d/nginx</span><br><span class="line">/var/log/nginx/*.<span class="built_in">log</span> &#123;</span><br><span class="line">     daily</span><br><span class="line"> 	rotate 100</span><br><span class="line"> 	missingok</span><br><span class="line"> 	compress</span><br><span class="line"> 	delaycompress</span><br><span class="line"> 	notifempty</span><br><span class="line"> 	create 644 ngnix nginx</span><br><span class="line"> 	postrotate</span><br><span class="line">   		<span class="keyword">if</span> [ -f /app/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">     		<span class="built_in">kill</span> -USR1 `<span class="built_in">cat</span> /app/nginx/logs/nginx.pid`</span><br><span class="line">   		<span class="keyword">fi</span></span><br><span class="line"> 	endscript</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#说明</span></span><br><span class="line"><span class="comment">#终端1</span></span><br><span class="line">[root@rocky8 ~]#<span class="built_in">touch</span> a.log</span><br><span class="line">[root@rocky8 ~]#<span class="built_in">tail</span> -f a.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#终端2</span></span><br><span class="line"><span class="comment">#查看进程和fd描述符</span></span><br><span class="line">[root@rocky8 ~]#lsof a.log</span><br><span class="line">COMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF     NODE NAME</span><br><span class="line"><span class="built_in">tail</span>    6337 root    3r   REG  253,0        0 33575489 a.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#/root/a.log的fd为3</span></span><br><span class="line">[root@rocky8 ~]#ll /proc/6337/fd</span><br><span class="line">total 0</span><br><span class="line">lrwx------ 1 root root 64 Dec  9 14:38 0 -&gt; /dev/pts/1</span><br><span class="line">lrwx------ 1 root root 64 Dec  9 14:38 1 -&gt; /dev/pts/1</span><br><span class="line">lrwx------ 1 root root 64 Dec  9 14:38 2 -&gt; /dev/pts/1</span><br><span class="line">lr-x------ 1 root root 64 Dec  9 14:38 3 -&gt; /root/a.log</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]#<span class="built_in">mv</span> a.log b.log</span><br><span class="line">[root@rocky8 ~]#ll /proc/6337/fd</span><br><span class="line">total 0</span><br><span class="line">....</span><br><span class="line">lr-x------ 1 root root 64 Dec  9 14:38 3 -&gt; /root/b.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#终端1，虽然改名了，但是没有报错</span></span><br><span class="line">[root@rocky8 ~]#<span class="built_in">tail</span> -f a.log</span><br><span class="line"></span><br><span class="line">所以这说明了<span class="built_in">tail</span> -f 跟踪的不是文件名，而是文件描述符，所以USR1信号的作用就是重新加载日志文件，把新的日志文件写到新生成的文件中，在转储中，nginx旧的日志转储到了access.2023-12-09，随后生成新的文件access去存储新的日志文件，但是转储完后并没有去跟踪fd，还是原来的，即access.2023-12-09，那么新的日志就会写到这里面去，不会写到新的文件access，所以需要USR1信号，去指向新的fd，把新的日志文件写到新生成的文件中</span><br></pre></td></tr></table></figure>

<h3 id="3-4-2-nginx安装内置转储规则"><a href="#3-4-2-nginx安装内置转储规则" class="headerlink" title="3.4.2 nginx安装内置转储规则"></a>3.4.2 nginx安装内置转储规则</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu2204 ~]#<span class="built_in">cat</span> /etc/logrotate.d/nginx</span><br><span class="line">/var/log/nginx/*.<span class="built_in">log</span> &#123;</span><br><span class="line">    daily</span><br><span class="line">    missingok</span><br><span class="line">    rotate 14</span><br><span class="line">    compress</span><br><span class="line">    delaycompress</span><br><span class="line">    notifempty</span><br><span class="line">    create 0640 www-data adm</span><br><span class="line">    sharedscripts</span><br><span class="line">    prerotate</span><br><span class="line">        <span class="keyword">if</span> [ -d /etc/logrotate.d/httpd-prerotate ]; <span class="keyword">then</span> \</span><br><span class="line">            run-parts /etc/logrotate.d/httpd-prerotate; \</span><br><span class="line">        <span class="keyword">fi</span> \</span><br><span class="line">    endscript</span><br><span class="line">    postrotate</span><br><span class="line">    invoke-rc.d nginx rotate &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]#<span class="built_in">cat</span> /etc/logrotate.d/nginx</span><br><span class="line">/var/log/nginx/*<span class="built_in">log</span> &#123;</span><br><span class="line"> 	create 0664 nginx root</span><br><span class="line"> 	daily</span><br><span class="line"> 	rotate 10</span><br><span class="line">     missingok</span><br><span class="line"> 	notifempty</span><br><span class="line"> 	compress</span><br><span class="line"> 	sharedscripts</span><br><span class="line"> 	postrotate</span><br><span class="line">   		/bin/kill -USR1 `<span class="built_in">cat</span> /run/nginx.pid 2&gt;/dev/null` 2&gt;/dev/null || <span class="literal">true</span></span><br><span class="line"> 	endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-3-Ubuntu22-04日志转储"><a href="#3-4-3-Ubuntu22-04日志转储" class="headerlink" title="3.4.3 Ubuntu22.04日志转储"></a>3.4.3 Ubuntu22.04日志转储</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu2204 ~]#<span class="built_in">mkdir</span> -p /var/log/test /data</span><br><span class="line">[root@ubuntu2204 ~]#<span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/var/log/test/test1.<span class="built_in">log</span> bs=1M count=2</span><br><span class="line">[root@ubuntu2204 ~]#ll /var/log/test/*</span><br><span class="line">-rw-r--r-- 1 root root 2097152 11月 18 12:21 /var/log/test/test1.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line">[root@ubuntu2204 ~]#<span class="built_in">cat</span> /etc/logrotate.d/test1</span><br><span class="line">/var/log/test/test1.<span class="built_in">log</span> &#123;	<span class="comment">#daily和size 1M要同时满足才会转储</span></span><br><span class="line"> 	daily</span><br><span class="line"> 	rotate 5</span><br><span class="line"> 	compress</span><br><span class="line"> 	delaycompress</span><br><span class="line"> 	missingok</span><br><span class="line"> 	size 1M</span><br><span class="line"> 	notifempty</span><br><span class="line"> 	create 0640 bin daemon</span><br><span class="line"> 	sharedscripts</span><br><span class="line"> 	postrotate</span><br><span class="line">        <span class="built_in">echo</span> `<span class="built_in">date</span> +%F_%T` &gt;&gt; /data/test1.<span class="built_in">log</span></span><br><span class="line"> 	endscript</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#手动转储，不等它满足条件才转储</span></span><br><span class="line">[root@ubuntu2204 ~]#logrotate /etc/logrotate.d/test1</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看结果</span></span><br><span class="line">[root@ubuntu2204 ~]#ll /var/log/test/</span><br><span class="line">总用量 2056</span><br><span class="line">drwxr-xr-x  2  600 root    4096  11月 18 12:22 ./</span><br><span class="line">drwxrwxr-x 12 root syslog  4096  11月 18 12:14 ../</span><br><span class="line">-rw-r-----  1 bin daemon   0     11月 18 12:22 test1.log		<span class="comment">#新生成文件准备转储新的日志</span></span><br><span class="line">-rw-r--r--  1 root root  2097152 11月 18 12:21 test1.log.1	<span class="comment">#旧的日志内容在这</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#添加日志</span></span><br><span class="line">[root@ubuntu2204 ~]#<span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/var/log/test/test1.<span class="built_in">log</span> bs=1M count=2</span><br><span class="line"></span><br><span class="line"><span class="comment">#手动转储</span></span><br><span class="line">[root@ubuntu2204 ~]#logrotate /etc/logrotate.d/test1</span><br><span class="line"></span><br><span class="line"><span class="comment">#观察结果，发现延迟压缩</span></span><br><span class="line">[root@ubuntu2204 ~]#ll /var/log/test/</span><br><span class="line">总用量 2060</span><br><span class="line">drwxr-xr-x  2  600 root    4096  11月 18 12:23 ./</span><br><span class="line">drwxrwxr-x 12 root syslog  4096  11月 18 12:14 ../</span><br><span class="line">-rw-r-----  1 bin daemon   0     11月 18 12:23 test1.log</span><br><span class="line">-rw-r-----  1 bin daemon 2097152 11月 18 12:23 test1.log.1	</span><br><span class="line">-rw-r--r--  1 root root    2067  11月 18 12:21 test1.log.2.gz <span class="comment">#之前旧的test1.log.1压缩</span></span><br><span class="line"></span><br><span class="line">[root@ubuntu2204 ~]#<span class="built_in">cat</span> /data/test1.<span class="built_in">log</span></span><br><span class="line">2022-11-18_12:22:40</span><br><span class="line">2022-11-18_12:23:07</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改全局配置</span></span><br><span class="line">[root@ubuntu2204 ~]#vim /etc/logrotate.conf</span><br><span class="line"><span class="comment">#取消注释</span></span><br><span class="line">dateext</span><br><span class="line"></span><br><span class="line"><span class="comment">#生成新日志</span></span><br><span class="line">[root@ubuntu2204 ~]#<span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/var/log/test/test1.<span class="built_in">log</span> bs=1k count=1025</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用全局配置</span></span><br><span class="line">[root@ubuntu2204 ~]#logrotate /etc/logrotate.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看生成日志文件格式为时间后缀</span></span><br><span class="line">[root@ubuntu2204 ~]#ll /var/log/test/</span><br><span class="line">总计 2084</span><br><span class="line">drwxr-xr-x  2 root root    4096  5月  8 17:13 ./</span><br><span class="line">drwxrwxr-x 11 root syslog   4096  5月  8 17:00 ../</span><br><span class="line">-rw-r-----  1 bin daemon 1049600  5月  8 17:13 test1.log</span><br><span class="line">-rw-r-----  1 bin daemon 1049600  5月  8 17:10 test1.log.1</span><br><span class="line">-rw-r-----  1 bin daemon   1052  5月  8 17:12 test1.log-20230508.gz</span><br></pre></td></tr></table></figure>

<h3 id="3-4-4-对指定日志手动执行日志转储"><a href="#3-4-4-对指定日志手动执行日志转储" class="headerlink" title="3.4.4 对指定日志手动执行日志转储"></a>3.4.4 对指定日志手动执行日志转储</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#生成测试日志</span></span><br><span class="line">[root@centos8 ~]#<span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/var/log/test1.<span class="built_in">log</span> bs=2M count=1</span><br><span class="line">1+0 records <span class="keyword">in</span></span><br><span class="line">1+0 records out</span><br><span class="line">2097152 bytes (2.1 MB, 2.0 MiB) copied, 0.00291879 s, 719 MB/s</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#<span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/var/log/test2.<span class="built_in">log</span> bs=2M count=1</span><br><span class="line">1+0 records <span class="keyword">in</span></span><br><span class="line">1+0 records out</span><br><span class="line">2097152 bytes (2.1 MB, 2.0 MiB) copied, 0.00200561 s, 1.0 GB/s</span><br><span class="line"></span><br><span class="line"><span class="comment">#针对不同的日志创建转储配置文件</span></span><br><span class="line"><span class="comment">#Ubuntu需加下面两行</span></span><br><span class="line">su bin syslog</span><br><span class="line">sharedscripts</span><br><span class="line"> </span><br><span class="line">[root@centos8 ~]#<span class="built_in">cat</span> /etc/logrotate.d/test1</span><br><span class="line">/var/log/test1.<span class="built_in">log</span> &#123;</span><br><span class="line"> 	daily</span><br><span class="line"> 	rotate 5</span><br><span class="line"> 	compress</span><br><span class="line"> 	delaycompress</span><br><span class="line">     missingok</span><br><span class="line"> 	size 1M</span><br><span class="line"> 	notifempty</span><br><span class="line"> 	create 640 bin daemon</span><br><span class="line"> 	postrotate</span><br><span class="line">        <span class="built_in">echo</span> `<span class="built_in">date</span> +%F_%T` &gt;&gt; /data/test1.<span class="built_in">log</span></span><br><span class="line"> 	endscript</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#<span class="built_in">cat</span> /etc/logrotate.d/test2</span><br><span class="line">/var/log/test2.<span class="built_in">log</span> &#123;</span><br><span class="line"> 	daily</span><br><span class="line"> 	rotate 5</span><br><span class="line"> 	compress</span><br><span class="line"> 	delaycompress</span><br><span class="line"> 	missingok</span><br><span class="line"> 	size 1M</span><br><span class="line"> 	notifempty</span><br><span class="line"> 	create 644 root root</span><br><span class="line"> 	postrotate</span><br><span class="line">        <span class="built_in">echo</span> `<span class="built_in">date</span> +%F_%T` &gt;&gt; /data/test2.<span class="built_in">log</span></span><br><span class="line"> 	endscript</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">#针对一个测试日志，手动执行日志转储</span></span><br><span class="line">[root@centos8 ~]#logrotate  /etc/logrotate.d/test1  </span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#ll /var/log/test*</span><br><span class="line">-rw-r----- 1 bin daemon   0 Dec 14 16:38 /var/log/test1.<span class="built_in">log</span></span><br><span class="line">-rw-r--r-- 1 root root 2097152 Dec 14 16:35 /var/log/test1.log.1</span><br><span class="line">-rw-r--r-- 1 root root 2097152 Dec 14 16:36 /var/log/test2.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#<span class="built_in">ls</span> /data</span><br><span class="line">test1.log</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#<span class="built_in">cat</span> /data/test1.<span class="built_in">log</span></span><br><span class="line">2019-11-12_14:00:14</span><br><span class="line"></span><br><span class="line"><span class="comment">#对所有日志进行手动转储</span></span><br><span class="line">[root@centos8 ~]#logrotate  /etc/logrotate.conf</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#ll /var/log/test*</span><br><span class="line">-rw-r--r-- 1 bin daemon   0 Nov 12 14:00 /var/log/test1.<span class="built_in">log</span></span><br><span class="line">-rw-r--r-- 1 root root 2097152 Nov 12 13:59 /var/log/test1.log.1</span><br><span class="line">-rw-r--r-- 1 root root    0 Nov 12 14:01 /var/log/test2.<span class="built_in">log</span></span><br><span class="line">-rw-r--r-- 1 root root 2097152 Nov 12 13:59 /var/log/test2.log-20191112</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#<span class="built_in">ls</span> /data</span><br><span class="line">test1.log test2.log</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#<span class="built_in">cat</span> /data/test1.<span class="built_in">log</span></span><br><span class="line">2019-11-12_14:01:51</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://AquaPluto.github.io">Aquarius</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://aquapluto.github.io/Linux/service-manage/log/">https://aquapluto.github.io/Linux/service-manage/log/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://AquaPluto.github.io" target="_blank">代码推演录</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/">服务管理</a></div><div class="post-share"><div class="social-share" data-image="/img/paper3.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://unpkg.com/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://unpkg.com/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/Storage/conspect/" title="存储概论"><img class="cover" src="/img/paper5.png" onerror="onerror=null;src='/img/error-page.png'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">存储概论</div></div><div class="info-2"><div class="info-item-1">1 存储类型IT 基础设施有三个主...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/plan-tasks/" title="计划任务"><img class="cover" src="/img/paper6.png" onerror="onerror=null;src='/img/error-page.png'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">计划任务</div></div><div class="info-2"><div class="info-item-1">1 一次性任务at 工具  由包 ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/Linux/service-manage/data-synchronization/" title="数据的实时同步"><img class="cover" src="/img/paper4.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">数据的实时同步</div></div><div class="info-2"><div class="info-item-1">1 数据的实时同步方式在生产环境，...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/DNS/" title="域名DNS解析服务"><img class="cover" src="/img/paper2.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">域名DNS解析服务</div></div><div class="info-2"><div class="info-item-1">一、DNS服务相关技术linux上...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/mail/" title="邮件服务"><img class="cover" src="/img/paper5.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">邮件服务</div></div><div class="info-2"><div class="info-item-1">1 邮件协议邮件服务的运作基于多个...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/ssh/" title="ssh远程连接服务"><img class="cover" src="/img/paper3.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-21</div><div class="info-item-2">ssh远程连接服务</div></div><div class="info-2"><div class="info-item-1">1 ssh服务介绍ssh: sec...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/plan-tasks/" title="计划任务"><img class="cover" src="/img/paper6.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">计划任务</div></div><div class="info-2"><div class="info-item-1">1 一次性任务at 工具  由包 ...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/time-synchronization/" title="时间同步服务"><img class="cover" src="/img/paper3.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">时间同步服务</div></div><div class="info-2"><div class="info-item-1">1 前言加密和安全当前都离不开时间...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avator.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Aquarius</div><div class="author-info-description">分享运维开发相关技术</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">138</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" href="https://github.com/AquaPluto"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/AquaPluto" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://blog.csdn.net/m0_75233142" target="_blank" title="CSDN"><i class="fa-solid fa-code" style="color: #8a2be2;"></i></a><a class="social-icon" href="mailto:wujunlinq@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content"><p>持续更新文章中，有问题请添加wx</p>
<div>
  <img src="/img/wx.jpg" alt="wx" style="width: 100px">
</div>
</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86"><span class="toc-text">1 系统日志管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97%E4%BB%8B%E7%BB%8D"><span class="toc-text">1.1 系统日志介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-1-sysklogd%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1"><span class="toc-text">1.1.1 sysklogd系统日志服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-2-rsyslog%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1"><span class="toc-text">1.1.2 rsyslog系统日志服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-Rsyslog%E7%AE%A1%E7%90%86"><span class="toc-text">1.2 Rsyslog管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97%E6%9C%AF%E8%AF%AD"><span class="toc-text">1.2.1 系统日志术语</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2-rsyslog%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6"><span class="toc-text">1.2.2 rsyslog相关文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3-rsyslog%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">1.2.3 rsyslog配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-4-%E5%9C%A8%E6%9C%AC%E6%9C%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9C%8D%E5%8A%A1%E6%97%A5%E5%BF%97"><span class="toc-text">1.2.4 在本机自定义服务日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-5-rsyslog%E6%97%A5%E5%BF%97%E5%86%85%E5%AE%B9%E5%92%8C%E6%A8%A1%E6%9D%BF"><span class="toc-text">1.2.5 rsyslog日志内容和模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-6-%E5%90%AF%E7%94%A8%E7%BD%91%E7%BB%9C%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1"><span class="toc-text">1.2.6 启用网络日志服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-7-%E5%B8%B8%E8%A7%81%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="toc-text">1.2.7 常见日志文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E6%97%A5%E5%BF%97%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7"><span class="toc-text">1.3 日志相关工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-1-dmesg%E5%91%BD%E4%BB%A4"><span class="toc-text">1.3.1 dmesg命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-2-logger%E5%91%BD%E4%BB%A4"><span class="toc-text">1.3.2 logger命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-3-journalctl"><span class="toc-text">1.3.3 journalctl</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%88%A9%E7%94%A8MySQL%E5%AD%98%E5%82%A8%E6%97%A5%E5%BF%97%E4%BF%A1%E6%81%AF"><span class="toc-text">2 利用MySQL存储日志信息</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E7%9B%AE%E6%A0%87"><span class="toc-text">2.1 目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-text">2.2 环境准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">2.3 实现步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-%E5%9C%A8rsyslog%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E5%AE%89%E8%A3%85%E8%BF%9E%E6%8E%A5mysql%E6%A8%A1%E5%9D%97%E7%9B%B8%E5%85%B3%E7%9A%84%E7%A8%8B%E5%BA%8F%E5%8C%85"><span class="toc-text">2.3.1 在rsyslog服务器上安装连接mysql模块相关的程序包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E5%87%86%E5%A4%87-MySQL"><span class="toc-text">2.3.2 准备 MySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-%E9%85%8D%E7%BD%AE%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B0%86%E6%97%A5%E5%BF%97%E5%8F%91%E9%80%81%E8%87%B3%E6%8C%87%E5%AE%9A%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">2.3.3 配置日志服务器将日志发送至指定数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-4-%E6%B5%8B%E8%AF%95"><span class="toc-text">2.3.4 测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Logrotate%E6%97%A5%E5%BF%97%E8%BD%AC%E5%82%A8"><span class="toc-text">3 Logrotate日志转储</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-Logrotate%E4%BB%8B%E7%BB%8D"><span class="toc-text">3.1 Logrotate介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E7%9A%84%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99"><span class="toc-text">3.2 日志文件的命名规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-Logrotate%E9%85%8D%E7%BD%AE"><span class="toc-text">3.3 Logrotate配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-Logrotate%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A7%84%E5%88%99%E5%AE%9E%E7%8E%B0"><span class="toc-text">3.4 Logrotate自定义规则实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-Logrotate%E9%85%8D%E7%BD%AE%E8%8C%83%E4%BE%8B"><span class="toc-text">3.4 Logrotate配置范例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-1-%E5%AE%9A%E5%88%B6%E8%AE%BE%E7%BD%AEnginx%E7%9A%84%E6%97%A5%E5%BF%97%E8%BD%AC%E5%82%A8"><span class="toc-text">3.4.1 定制设置nginx的日志转储</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-2-nginx%E5%AE%89%E8%A3%85%E5%86%85%E7%BD%AE%E8%BD%AC%E5%82%A8%E8%A7%84%E5%88%99"><span class="toc-text">3.4.2 nginx安装内置转储规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-3-Ubuntu22-04%E6%97%A5%E5%BF%97%E8%BD%AC%E5%82%A8"><span class="toc-text">3.4.3 Ubuntu22.04日志转储</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-4-%E5%AF%B9%E6%8C%87%E5%AE%9A%E6%97%A5%E5%BF%97%E6%89%8B%E5%8A%A8%E6%89%A7%E8%A1%8C%E6%97%A5%E5%BF%97%E8%BD%AC%E5%82%A8"><span class="toc-text">3.4.4 对指定日志手动执行日志转储</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Kubernetes/deploy/cluster/" title="集群管理指南"><img src="/img/paper1.jpg" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="集群管理指南"/></a><div class="content"><a class="title" href="/Kubernetes/deploy/cluster/" title="集群管理指南">集群管理指南</a><time datetime="2025-09-21T02:38:40.000Z" title="发表于 2025-09-21 10:38">2025-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/role/" title="Role角色"><img src="/img/paper4.png" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="Role角色"/></a><div class="content"><a class="title" href="/CICD/ansible/role/" title="Role角色">Role角色</a><time datetime="2025-09-13T10:07:53.000Z" title="发表于 2025-09-13 18:07">2025-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/playbook/" title="PlayBook"><img src="/img/paper5.png" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="PlayBook"/></a><div class="content"><a class="title" href="/CICD/ansible/playbook/" title="PlayBook">PlayBook</a><time datetime="2025-09-13T10:07:48.000Z" title="发表于 2025-09-13 18:07">2025-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/module/" title="常用模块"><img src="/img/paper6.png" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="常用模块"/></a><div class="content"><a class="title" href="/CICD/ansible/module/" title="常用模块">常用模块</a><time datetime="2025-09-13T10:07:42.000Z" title="发表于 2025-09-13 18:07">2025-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/command/" title="相关命令"><img src="/img/paper3.png" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="相关命令"/></a><div class="content"><a class="title" href="/CICD/ansible/command/" title="相关命令">相关命令</a><time datetime="2025-09-13T10:07:38.000Z" title="发表于 2025-09-13 18:07">2025-09-13</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Aquarius</span></div><div class="footer_custom_text"><style>
div#runtime {
  font-size: 13px;
  font-weight: bold;
}

div#ghbdages_list {
  height: 1.5rem;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 10px
}

.github-badge {
  display: flex;
  align-items: center;
  margin-inline: 6px;
}
</style>
<div id="runtime"></div>
<div id="ghbdages"></div>
<script>
  function createtime() {
    const now = new Date();
    const grt = new Date("08/01/2025 00:00:00"); // 网站诞生时间

    // 计算天、小时、分钟和秒
    const days = Math.floor((now - grt) / (1000 * 60 * 60 * 24));
    const hours = Math.floor(((now - grt) / (1000 * 60 * 60)) % 24)
      .toString()
      .padStart(2, "0");
    const minutes = Math.floor(((now - grt) / (1000 * 60)) % 60)
      .toString()
      .padStart(2, "0");
    const seconds = Math.floor(((now - grt) / 1000) % 60)
      .toString()
      .padStart(2, "0");

    // HTML 输出
    const currentTimeHtml = `
          <div>
              本站已运行 ${days} 天 ${hours} 小时 ${minutes} 分 ${seconds} 秒 
          </div>`;

    const runtime = document.getElementById("runtime");
    if (runtime) runtime.innerHTML = currentTimeHtml;
  }

  // 设置每秒调用函数
  setInterval(createtime, 1000);

  function renderBadge() {
    const currentTimeHtml = `
      <div id="ghbdages_list">
          <a class="github-badge" target="_blank" href="https://hexo.io/" title="hexo:7.3.0">
              <img src="https://img.shields.io/badge/Frame-Hexo-blue?logo=hexo" alt="Static Badge">
          </a>
          <a class="github-badge" target="_blank" href="https://github.com/" title="github">
              <img src="https://img.shields.io/badge/Code-GitHub-181717?logo=GitHub&color=%23FF7102" alt="Static Badge">
          </a>
          <a class="github-badge" target="_blank" href="https://vercel.com/" title="vercel">
              <img src="https://img.shields.io/badge/Host-Vercel-%23F0D722?logo=Vercel" alt="Static Badge">
          </a>
          <a class="github-badge" target="_blank" href="https://analytics.sysio.ai/" title="umami">
              <img src="https://img.shields.io/badge/Analytics-Umami-%237FB100?logo=umami&logoColor=%237FB100" alt="Static Badge">
          </a>
      </div>`;

    const ghbdages = document.getElementById("ghbdages");
    if (ghbdages) {
      ghbdages.innerHTML = currentTimeHtml;
    }
  }

  window.onload = renderBadge;
</script>
</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://unpkg.com/@fancyapps/ui/dist/fancybox/fancybox.umd.js"></script><script src="https://unpkg.com/instant.page/instantpage.js" type="module"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = 'https://unpkg.com/mathjax/es5/tex-mml-chtml.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'forest'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://unpkg.com/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script src="https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fishes.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://unpkg.com/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章..." type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>