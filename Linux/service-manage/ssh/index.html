<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ssh远程连接服务 | 代码推演录</title><meta name="author" content="Aquarius"><meta name="copyright" content="Aquarius"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="1 ssh服务介绍ssh: secure shell protocol, 22&#x2F;tcp, 安全的远程登录，实现加密通信，代替传统的 telnet 协议，生产中要改端口号 具体的软件实现：  OpenSSH：ssh协议的开源实现，CentOS 默认安装  dropbear：另一个ssh协议的开源项目的实现   ssh和 telnet 的区别  telnet不支持root用户登录，只允许普通">
<meta property="og:type" content="article">
<meta property="og:title" content="ssh远程连接服务">
<meta property="og:url" content="https://aquapluto.github.io/Linux/service-manage/ssh/">
<meta property="og:site_name" content="代码推演录">
<meta property="og:description" content="1 ssh服务介绍ssh: secure shell protocol, 22&#x2F;tcp, 安全的远程登录，实现加密通信，代替传统的 telnet 协议，生产中要改端口号 具体的软件实现：  OpenSSH：ssh协议的开源实现，CentOS 默认安装  dropbear：另一个ssh协议的开源项目的实现   ssh和 telnet 的区别  telnet不支持root用户登录，只允许普通">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://aquapluto.github.io/img/paper6.png">
<meta property="article:published_time" content="2025-08-21T03:01:35.000Z">
<meta property="article:modified_time" content="2025-09-09T05:38:44.859Z">
<meta property="article:author" content="Aquarius">
<meta property="article:tag" content="服务管理">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://aquapluto.github.io/img/paper6.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ssh远程连接服务",
  "url": "https://aquapluto.github.io/Linux/service-manage/ssh/",
  "image": "https://aquapluto.github.io/img/paper6.png",
  "datePublished": "2025-08-21T03:01:35.000Z",
  "dateModified": "2025-09-09T05:38:44.859Z",
  "author": [
    {
      "@type": "Person",
      "name": "Aquarius",
      "url": "https://AquaPluto.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://aquapluto.github.io/Linux/service-manage/ssh/"><link rel="preconnect" href="//unpkg.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://unpkg.com/@fancyapps/ui/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":true,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://unpkg.com/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ssh远程连接服务',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/wave.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(/img/background.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avator.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">138</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="menus_items"><!-- 一级菜单项（非目录）--><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>计算机基础</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>计算机组成原理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/hardware-composition/"><span>计算机硬件组成</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/CPU/"><span>CPU</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/memory/"><span>内存</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/hard-disk/"><span>硬盘</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>操作系统</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/concept/"><span>操作系统的概念</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/processes-threads/"><span>进程与线程</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/IO-model/"><span>IO模型</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Linux</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>linux基础</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/introduce/"><span>linux介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/file-structure-and-IO-redirects/"><span>文件结构与IO重定向</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/file-command/"><span>文件管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/text-command/"><span>文本管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/GSA/"><span>文本处理三剑客</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/user-permission/"><span>用户和权限管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/regular-expression/"><span>正则表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/software-manage/"><span>软件包管理</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>进程管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/command/"><span>进程相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/signal/"><span>信号发送</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/job-parallel/"><span>作业管理与并行运行</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/OOM/"><span>OOM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>磁盘管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/disk-partition/"><span>磁盘分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/file-system/"><span>文件系统</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/swap/"><span>Swap分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/LVM/"><span>逻辑卷管理器LVM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>网络管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/configuration/"><span>网络配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/test-diagnostic/"><span>网络测试诊断工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/bridge/"><span>网桥配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/troubleshoot/"><span>网络问题排查</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/DNS/"><span>域名DNS解析服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/time-synchronization/"><span>时间同步服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/plan-tasks/"><span>计划任务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/log/"><span>日志服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/data-synchronization/"><span>数据的实时同步</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/ssh/"><span>ssh远程连接服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/mail/"><span>邮件服务</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/kernel-manage/"><span>内核和启动管理</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>防火墙</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/introduce/"><span>安全技术和防火墙</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/iptables/"><span>iptables</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/firewalld/"><span>firewalld</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/nft/"><span>nft</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>加密和安全</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/security-mechanisms/"><span>安全机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/OpenSSL/"><span>OpenSSL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/sudo/"><span>sudo实现授权</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/PAM/"><span>PAM认证机制</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>shell编程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/introduce/"><span>shell脚本介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/variable/"><span>变量</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/operations-conditional/"><span>运算和条件测试</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-control/"><span>流程控制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/function/"><span>函数</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/array/"><span>数组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/string/"><span>字符串</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/script-tools/"><span>脚本相关工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-lock/"><span>进程锁</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/queue/"><span>队列实现线程并发控制</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/system-optimization/"><span>系统优化</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>数据库</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>MySQL</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/DataBase/MySQL/SQL/"><span>SQL语句</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Redis</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/DataBase/Redis/deploy/"><span>部署安装</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>中间件</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Nginx</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Nginx/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>HAProxy</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/HAProxy/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Keepalived</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Keepalived/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kafka</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Kafka/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Tomcat</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Tomcat/111/"><span>111</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>日志</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>存储</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Storage/conspect/"><span>存储概论</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Storage/nfs/"><span>NFS</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>容器</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/basics/"><span>容器基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Docker</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/conspect/"><span>Docker概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/image/"><span>镜像管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/container/"><span>容器管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/volume/"><span>数据卷</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/network/"><span>网络管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/compose/"><span>Docker-Compose</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>镜像</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/conspect/"><span>镜像概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/dockerfile/"><span>dockerfile</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/build/"><span>构建镜像</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/harbor/"><span>镜像仓库</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>容器进程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/management/"><span>容器里的进程管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/cpu-cgroup/"><span>cpu cgroup使用</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/cpu-usage/"><span>监控容器真实的cpu使用率</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/memory/"><span>容器内存</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/storage/"><span>容器存储</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/network/"><span>容器网络</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/safe/"><span>容器安全</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/containerd/"><span>Containerd</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>K8s</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kubernetes概论</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/architecture/"><span>Kubernetes架构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/cri/"><span>容器运行时接口CRI</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/list-watch/"><span>List-Watch机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/object/"><span>Kubernetes对象</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/namespace/"><span>Namespace</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/kubectl/"><span>kubectl命令</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>部署安装</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/explanation/"><span>部署说明</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/docker/"><span>基于docker部署k8s-v1.30</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/containerd/"><span>基于containerd部署k8s-v1.30</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/cluster/"><span>集群管理指南</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Pod</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/conspect/"><span>Pod概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/configuration/"><span>Pod的配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/schedule/"><span>Pod的调度</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/eviction/"><span>Pod的驱逐</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>控制器</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/introduce/"><span>控制器介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/deployment/"><span>Deployment</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/statefulset/"><span>StatefulSet</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/daemonset/"><span>DaemonSet</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/job-cronjob/"><span>Job和CronJob</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/HPA/"><span>HPA</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/operator/"><span>Operator</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务发现与负载均衡</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/service/"><span>Service</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/ingress/"><span>Ingress</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/coredns/"><span>CoreDNS</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/localdns/"><span>LocalDNS</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>数据存储持久化</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/csi/"><span>存储接口CSI</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/pv-pvc/"><span>PV和PVC</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/storageclass/"><span>StorageClass</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/configmap-secret/"><span>ConfigMap和Secret</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>认证与鉴权体系</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/conspect/"><span>体系概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/kubeconfig/"><span>kubeconfig</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/user-account/"><span>User Account</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/service-account/"><span>Service Account</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>监控</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/conspect/"><span>监控概论</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Prometheus</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/introduce/"><span>prometheus概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/exporter/"><span>Exporter</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/promql/"><span>PromQL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/query-persist/"><span>查询结果持久化</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/service-discovery/"><span>服务发现</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/indicators-remarked/"><span>指标重新打标</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/pushmanager/"><span>Pushmanager</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/cluster-ha/"><span>集群与高可用</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Alertmanager</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/introduce/"><span>告警功能概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/alarm/"><span>实现告警功能</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/ha/"><span>高可用架构</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/grafana/"><span>Grafana</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/streaming/"><span>基于流处理的可观测性架构</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>CICD</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Ansible</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/introduce/"><span>架构概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/command/"><span>相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/module/"><span>常用模块</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/playbook/"><span>PlayBook</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>SRE</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/SRE/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Python</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>python基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>线性表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>列表</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>元组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字符串</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>哈希表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>封装与解构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>集合</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字典</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>解析式与生成器表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>函数</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>IO操作</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>面向对象编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>并发编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>网络编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>数据库编程</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Django</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/paper6.png);"><nav id="nav"><!-- 左侧博客信息区域--><span id="blog-info"><a class="nav-site-title" href="/"></a><a class="nav-page-title" href="/"><span class="site-name">ssh远程连接服务</span></a></span><!-- 新增的导航菜单容器（居中布局关键）--><div id="nav-menus-container"><!-- 菜单主体部分--><div id="menus"><!-- 菜单项--><div class="menus_items"><!-- 一级菜单项（非目录）--><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>计算机基础</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>计算机组成原理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/hardware-composition/"><span>计算机硬件组成</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/CPU/"><span>CPU</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/memory/"><span>内存</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/hard-disk/"><span>硬盘</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>操作系统</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/concept/"><span>操作系统的概念</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/processes-threads/"><span>进程与线程</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/IO-model/"><span>IO模型</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Linux</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>linux基础</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/introduce/"><span>linux介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/file-structure-and-IO-redirects/"><span>文件结构与IO重定向</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/file-command/"><span>文件管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/text-command/"><span>文本管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/GSA/"><span>文本处理三剑客</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/user-permission/"><span>用户和权限管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/regular-expression/"><span>正则表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/software-manage/"><span>软件包管理</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>进程管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/command/"><span>进程相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/signal/"><span>信号发送</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/job-parallel/"><span>作业管理与并行运行</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/OOM/"><span>OOM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>磁盘管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/disk-partition/"><span>磁盘分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/file-system/"><span>文件系统</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/swap/"><span>Swap分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/LVM/"><span>逻辑卷管理器LVM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>网络管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/configuration/"><span>网络配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/test-diagnostic/"><span>网络测试诊断工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/bridge/"><span>网桥配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/troubleshoot/"><span>网络问题排查</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/DNS/"><span>域名DNS解析服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/time-synchronization/"><span>时间同步服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/plan-tasks/"><span>计划任务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/log/"><span>日志服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/data-synchronization/"><span>数据的实时同步</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/ssh/"><span>ssh远程连接服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/mail/"><span>邮件服务</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/kernel-manage/"><span>内核和启动管理</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>防火墙</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/introduce/"><span>安全技术和防火墙</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/iptables/"><span>iptables</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/firewalld/"><span>firewalld</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/nft/"><span>nft</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>加密和安全</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/security-mechanisms/"><span>安全机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/OpenSSL/"><span>OpenSSL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/sudo/"><span>sudo实现授权</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/PAM/"><span>PAM认证机制</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>shell编程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/introduce/"><span>shell脚本介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/variable/"><span>变量</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/operations-conditional/"><span>运算和条件测试</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-control/"><span>流程控制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/function/"><span>函数</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/array/"><span>数组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/string/"><span>字符串</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/script-tools/"><span>脚本相关工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-lock/"><span>进程锁</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/queue/"><span>队列实现线程并发控制</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/system-optimization/"><span>系统优化</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>数据库</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>MySQL</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/DataBase/MySQL/SQL/"><span>SQL语句</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Redis</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/DataBase/Redis/deploy/"><span>部署安装</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>中间件</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Nginx</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Nginx/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>HAProxy</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/HAProxy/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Keepalived</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Keepalived/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kafka</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Kafka/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Tomcat</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Tomcat/111/"><span>111</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>日志</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>存储</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Storage/conspect/"><span>存储概论</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Storage/nfs/"><span>NFS</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>容器</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/basics/"><span>容器基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Docker</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/conspect/"><span>Docker概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/image/"><span>镜像管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/container/"><span>容器管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/volume/"><span>数据卷</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/network/"><span>网络管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/compose/"><span>Docker-Compose</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>镜像</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/conspect/"><span>镜像概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/dockerfile/"><span>dockerfile</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/build/"><span>构建镜像</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/harbor/"><span>镜像仓库</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>容器进程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/management/"><span>容器里的进程管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/cpu-cgroup/"><span>cpu cgroup使用</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/cpu-usage/"><span>监控容器真实的cpu使用率</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/memory/"><span>容器内存</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/storage/"><span>容器存储</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/network/"><span>容器网络</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/safe/"><span>容器安全</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/containerd/"><span>Containerd</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>K8s</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kubernetes概论</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/architecture/"><span>Kubernetes架构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/cri/"><span>容器运行时接口CRI</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/list-watch/"><span>List-Watch机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/object/"><span>Kubernetes对象</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/namespace/"><span>Namespace</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/kubectl/"><span>kubectl命令</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>部署安装</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/explanation/"><span>部署说明</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/docker/"><span>基于docker部署k8s-v1.30</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/containerd/"><span>基于containerd部署k8s-v1.30</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/cluster/"><span>集群管理指南</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Pod</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/conspect/"><span>Pod概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/configuration/"><span>Pod的配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/schedule/"><span>Pod的调度</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/eviction/"><span>Pod的驱逐</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>控制器</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/introduce/"><span>控制器介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/deployment/"><span>Deployment</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/statefulset/"><span>StatefulSet</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/daemonset/"><span>DaemonSet</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/job-cronjob/"><span>Job和CronJob</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/HPA/"><span>HPA</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/operator/"><span>Operator</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务发现与负载均衡</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/service/"><span>Service</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/ingress/"><span>Ingress</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/coredns/"><span>CoreDNS</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/localdns/"><span>LocalDNS</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>数据存储持久化</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/csi/"><span>存储接口CSI</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/pv-pvc/"><span>PV和PVC</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/storageclass/"><span>StorageClass</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/configmap-secret/"><span>ConfigMap和Secret</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>认证与鉴权体系</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/conspect/"><span>体系概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/kubeconfig/"><span>kubeconfig</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/user-account/"><span>User Account</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/service-account/"><span>Service Account</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>监控</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/conspect/"><span>监控概论</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Prometheus</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/introduce/"><span>prometheus概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/exporter/"><span>Exporter</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/promql/"><span>PromQL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/query-persist/"><span>查询结果持久化</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/service-discovery/"><span>服务发现</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/indicators-remarked/"><span>指标重新打标</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/pushmanager/"><span>Pushmanager</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/cluster-ha/"><span>集群与高可用</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Alertmanager</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/introduce/"><span>告警功能概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/alarm/"><span>实现告警功能</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/ha/"><span>高可用架构</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/grafana/"><span>Grafana</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/streaming/"><span>基于流处理的可观测性架构</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>CICD</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Ansible</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/introduce/"><span>架构概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/command/"><span>相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/module/"><span>常用模块</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/playbook/"><span>PlayBook</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>SRE</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/SRE/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Python</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>python基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>线性表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>列表</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>元组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字符串</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>哈希表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>封装与解构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>集合</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字典</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>解析式与生成器表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>函数</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>IO操作</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>面向对象编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>并发编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>网络编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>数据库编程</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Django</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div></div></div></div><!-- 右侧功能区域（新增容器）--><div id="nav-right-container"><!-- 搜索按钮（移动到右侧）--><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i></span></div><!-- 移动端汉堡菜单按钮--><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">ssh远程连接服务</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-08-21T03:01:35.000Z" title="发表于 2025-08-21 11:01">2025-08-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-09T05:38:44.859Z" title="更新于 2025-09-09 13:38">2025-09-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/">Linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">7.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>32分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="1-ssh服务介绍"><a href="#1-ssh服务介绍" class="headerlink" title="1 ssh服务介绍"></a>1 ssh服务介绍</h1><p>ssh: secure shell protocol, 22&#x2F;tcp, 安全的远程登录，实现加密通信，代替传统的 telnet 协议，<strong>生产中要改端口号</strong></p>
<p>具体的软件实现：</p>
<ul>
<li><p>OpenSSH：ssh协议的开源实现，CentOS 默认安装</p>
</li>
<li><p>dropbear：另一个ssh协议的开源项目的实现</p>
</li>
</ul>
<p>ssh和 telnet 的区别</p>
<ul>
<li>telnet不支持root用户登录，只允许普通用户登录；ssh支持root用户登录</li>
<li>telnet数据传输过程中明文的；ssh数据传输过程中时加密码</li>
</ul>
<h2 id="1-1-公钥交换原理"><a href="#1-1-公钥交换原理" class="headerlink" title="1.1 公钥交换原理"></a>1.1 公钥交换原理</h2><p><img src="/Linux/service-manage/ssh/image-20250821124953441.png" alt="image-20250821124953441"></p>
<ol>
<li><p>客户端发起链接请求</p>
</li>
<li><p>服务端返回自己的公钥，以及一个会话ID（这一步客户端得到服务端公钥）客户端生成密钥对</p>
</li>
<li><p>客户端用自己的公钥异或会话ID，计算出一个值Res，并用服务端的公钥加密</p>
</li>
<li><p>客户端发送加密后的值到服务端，服务端用私钥解密，得到Res</p>
</li>
<li><p>服务端用解密后的值Res异或会话ID，计算出客户端的公钥（这一步服务端得到客户端公钥）</p>
</li>
<li><p>最终：双方各自持有三个秘钥，分别为自己的一对公、私钥，以及对方的公钥，之后的所有通讯都会被加密</p>
</li>
</ol>
<h2 id="1-2-ssh加密通讯原理"><a href="#1-2-ssh加密通讯原理" class="headerlink" title="1.2 ssh加密通讯原理"></a>1.2 ssh加密通讯原理</h2><p><img src="/Linux/service-manage/ssh/image-20250821125004648.png" alt="image-20250821125004648"></p>
<h1 id="2-openssh软件"><a href="#2-openssh软件" class="headerlink" title="2 openssh软件"></a>2 openssh软件</h1><p>Openssh软件相关包：</p>
<ul>
<li><p>openssh</p>
</li>
<li><p>openssh-clients</p>
</li>
<li><p>openssh-server</p>
</li>
</ul>
<p>服务器端程序：&#x2F;usr&#x2F;sbin&#x2F;sshd</p>
<p>Unit 文件：&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;sshd.service</p>
<h2 id="2-1-ssh命令"><a href="#2-1-ssh命令" class="headerlink" title="2.1 ssh命令"></a>2.1 ssh命令</h2><p>ssh命令是ssh客户端，允许实现对远程系统经验证地加密安全访问</p>
<p>当用户远程连接ssh服务器时，会复制ssh服务器 <code>/etc/ssh/ssh_host*key.pub</code> 文件中的公钥到客户机的<code>~/.ssh/know_hosts</code> 中。下次连接时，会自动匹配相对应的私钥，不能匹配，将拒绝连接</p>
<p>ssh客户端配置文件： <code>/etc/ssh/ssh_config</code>，主要配置如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#StrictHostKeyChecking ask</span></span><br><span class="line"><span class="comment">#首次登录不显示检查提示</span></span><br><span class="line">StrictHostKeyChecking no</span><br><span class="line"><span class="comment">#  IdentityFile ~/.ssh/id_rsa</span></span><br><span class="line"><span class="comment">#  IdentityFile ~/.ssh/id_dsa</span></span><br><span class="line"><span class="comment">#  IdentityFile ~/.ssh/id_ecdsa</span></span><br><span class="line"><span class="comment">#  IdentityFile ~/.ssh/id_ed25519</span></span><br><span class="line"><span class="comment">#  Port 22</span></span><br></pre></td></tr></table></figure>

<p>命令格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ssh [user@]host [COMMAND]</span><br><span class="line">ssh [-l user] host [COMMAND]</span><br><span class="line"></span><br><span class="line">-p port <span class="comment">#远程服务器监听的端口</span></span><br><span class="line">-b <span class="comment">#指定连接的源IP</span></span><br><span class="line">-v <span class="comment">#调试模式</span></span><br><span class="line">-C <span class="comment">#压缩方式</span></span><br><span class="line">-X <span class="comment">#支持x11转发</span></span><br><span class="line">-t <span class="comment">#强制伪tty分配，如：ssh -t remoteserver1 ssh -t remoteserver2  ssh remoteserver3</span></span><br><span class="line">-o option  <span class="comment">#如：-o StrictHostKeyChecking=no</span></span><br><span class="line">-i &lt;file&gt;  <span class="comment">#指定私钥文件路径，实现基于key验证，默认使用文件： ~/.ssh/id_dsa,~/.ssh/id_ecdsa, ~/.ssh/id_ed25519，~/.ssh/id_rsa等</span></span><br></pre></td></tr></table></figure>

<p>首次连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#首次连接，会显示目标主机的指纹信息（唯一标识），并提示是否继续</span></span><br><span class="line"><span class="comment">#敲yes后会将目标主机的公钥保存在当前用户的~/.ssh/know_hosts 文件中</span></span><br><span class="line">root@ubuntu2204:~# ssh root@10.0.0.206</span><br><span class="line">The authenticity of host <span class="string">&#x27;10.0.0.206 (10.0.0.206)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ED25519 key fingerprint is SHA256:+CC49Sra7GzLnNYn4QqcT0QyDEwS+osEpcbQ5e1zCc8.</span></span><br><span class="line"><span class="string">This key is not known by any other names		</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>10.0.0.206<span class="string">&#x27; (ED25519) to the list of known hosts.</span></span><br><span class="line"><span class="string">root@10.0.0.206&#x27;</span>s password:</span><br><span class="line">    </span><br><span class="line"><span class="comment">#在客户端机器上可以看到远端主机的公钥</span></span><br><span class="line">root@ubuntu2204:~# <span class="built_in">ls</span> -l .ssh/</span><br><span class="line">total 8</span><br><span class="line">-rw------- 1 root root 978 May 23 02:08 known_hosts</span><br><span class="line">-rw-r--r-- 1 root root 142 May 23 02:08 known_hosts.old</span><br><span class="line"></span><br><span class="line"><span class="comment">#该文件中保存的内容，在远程主机上都能找到对应的</span></span><br><span class="line">root@ubuntu2204:~# <span class="built_in">cat</span> .ssh/known_hosts</span><br><span class="line"></span><br><span class="line"><span class="comment">#在10.0.0.206上查看</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> -l /etc/ssh/*pub</span><br><span class="line">-rw-r--r-- 1 root root 605 May  4 17:02 /etc/ssh/ssh_host_dsa_key.pub</span><br><span class="line">-rw-r--r-- 1 root root 177 May  4 17:02 /etc/ssh/ssh_host_ecdsa_key.pub	<span class="comment">#公钥</span></span><br><span class="line">-rw-r--r-- 1 root root  97 May  4 17:02 /etc/ssh/ssh_host_ed25519_key.pub</span><br><span class="line">-rw-r--r-- 1 root root 569 May  4 17:02 /etc/ssh/ssh_host_rsa_key.pub</span><br><span class="line"></span><br><span class="line"><span class="comment">#首次连接时并不能确定远端主机公钥的真伪,为了确定真伪，可以进行以下操作</span></span><br><span class="line"><span class="comment">#在连接前，在准备要连接的机器上自己连自己，查看一下指纹，比对一下指纹</span></span><br><span class="line">[root@ubuntu ~]# ssh 127.1</span><br><span class="line">The authenticity of host <span class="string">&#x27;127.0.0.1 (127.0.0.1)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ED25519 key fingerprint is SHA256:+CC49Sra7GzLnNYn4QqcT0QyDEwS+osEpcbQ5e1zCc8.</span></span><br><span class="line"><span class="string">This key is not known by any other names</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no/[fingerprint])?</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">#首次连接之后，保存了远程主机的公钥，后续如果有冒充这个IP地址的主机，连接到这个假冒的主机，发现公钥不一样，则会提示</span></span><br><span class="line"><span class="string">#如果远程主机确实发生了改变，则可以删除本地~.ssh/know_host中的对应的公钥</span></span><br><span class="line"><span class="string">root@ubuntu2204:~# ssh root@10.0.0.206</span></span><br><span class="line"><span class="string">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span></span><br><span class="line"><span class="string">@  WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!   @</span></span><br><span class="line"><span class="string">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span></span><br><span class="line"><span class="string">IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!</span></span><br><span class="line"><span class="string">Someone could be eavesdropping on you right now (man-in-the-middle attack)!</span></span><br><span class="line"><span class="string">It is also possible that a host key has just been changed.</span></span><br><span class="line"><span class="string">The fingerprint for the ED25519 key sent by the remote host is</span></span><br><span class="line"><span class="string">SHA256:1eOK9Aygq1kbA+smlYjwRwRsx+ZdSRkDnNy5AFp3aPE.</span></span><br><span class="line"><span class="string">Please contact your system administrator.</span></span><br><span class="line"><span class="string">Add correct host key in /root/.ssh/known_hosts to get rid of this message.</span></span><br><span class="line"><span class="string">Offending ECDSA key in /root/.ssh/known_hosts:3</span></span><br><span class="line"><span class="string">remove with:</span></span><br><span class="line"><span class="string">ssh-keygen -f &quot;/root/.ssh/known_hosts&quot; -R &quot;10.0.0.206&quot;</span></span><br><span class="line"><span class="string">Host key for 10.0.0.206 has changed and you have requested strict checking.</span></span><br><span class="line"><span class="string">Host key verification failed.</span></span><br></pre></td></tr></table></figure>

<p>范例：修改客户端配置，首次连接自动回答为yes</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]#sed -i.bak <span class="string">&#x27;/StrictHostKeyChecking/s/.*/StrictHostKeyChecking no/&#x27;</span> /etc/ssh/ssh_config</span><br></pre></td></tr></table></figure>

<p>范例：通过多个跳板登录远程主机10.0.0.6</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]#ssh -t 10.0.0.8 ssh -t 10.0.0.7 ssh 10.0.0.6</span><br><span class="line">root@10.0.0.8<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">root@10.0.0.7&#x27;</span>s password:</span><br><span class="line">root@10.0.0.6<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">Last login: Fri May 22 09:10:28 2020 from 10.0.0.7</span></span><br><span class="line"><span class="string">[root@centos6 ~]#</span></span><br></pre></td></tr></table></figure>

<p>范例：远程执行命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@centos6 ~]#ssh 10.0.0.8 <span class="string">&quot;sed -i.bak</span></span><br><span class="line"><span class="string">&#x27;/StrictHostKeyChecking/s/.*/StrictHostKeyChecking no/&#x27; /etc/ssh/ssh_config&quot;</span></span><br><span class="line">root@10.0.0.8<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">[root@centos6 ~]#</span></span><br></pre></td></tr></table></figure>

<p>范例：在远程主机运行本地shell脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]#hostname -I</span><br><span class="line">10.0.0.8</span><br><span class="line">[root@centos8 ~]#<span class="built_in">cat</span> test.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">hostname -I</span><br><span class="line">[root@centos8 ~]#ssh 10.0.0.18 /bin/bash &lt; test.sh</span><br><span class="line">root@10.0.0.18<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">10.0.0.18</span></span><br></pre></td></tr></table></figure>

<p>范例：加选项，首次连接时自动回答yes</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# ssh -o StrictHostKeyChecking=no 10.0.0.210</span><br><span class="line">Warning: Permanently added <span class="string">&#x27;10.0.0.210&#x27;</span> (ED25519) to the list of known hosts.</span><br><span class="line">root@10.0.0.210<span class="string">&#x27;s password:</span></span><br></pre></td></tr></table></figure>

<h2 id="2-2-scp命令"><a href="#2-2-scp命令" class="headerlink" title="2.2 scp命令"></a>2.2 scp命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">scp [options] [user@]host:/sourcefile /destpath</span><br><span class="line">scp [options] /sourcefile [user@]host:/destpath</span><br><span class="line">scp [options] [user@]host1:/sourcetpath [user@]host2:/destpath</span><br><span class="line"></span><br><span class="line">-C <span class="comment">#压缩数据流</span></span><br><span class="line">-r <span class="comment">#递归复制</span></span><br><span class="line">-p <span class="comment">#保持原文件的属性信息</span></span><br><span class="line">-q <span class="comment">#静默模式</span></span><br><span class="line">-P PORT <span class="comment">#指定远程服务器的端口,默认22</span></span><br></pre></td></tr></table></figure>

<p>范例：将本地文件复制到远程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将当前主机/root/test.sh 复制到远程主机 mage 的家目录下</span></span><br><span class="line">[root@ubuntu ~]# scp /root/test.sh mage@10.0.0.210:</span><br><span class="line">mage@10.0.0.210<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">test.sh 100%  25   2.6KB/s  00:00</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#远程主机上查看</span></span><br><span class="line"><span class="string">root@ubuntu2204:~# ls -l /home/mage/</span></span><br><span class="line"><span class="string">total 4</span></span><br><span class="line"><span class="string">-rwxr-xr-x 1 mage mage 25 May 23 07:17 test.sh</span></span><br></pre></td></tr></table></figure>

<p>范例：将远程主机文件复制到本地</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]# scp root@10.0.0.157:/home/jose/test.sh .</span><br><span class="line">root@10.0.0.157<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">test.sh                         100%  25   10.0KB/s </span></span><br><span class="line"><span class="string">00:00</span></span><br></pre></td></tr></table></figure>

<p>范例：源和目标都不是本机</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky86 ~]# scp jose@10.0.0.157:test.sh root@10.0.0.154:</span><br><span class="line">jose@10.0.0.157<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">root@10.0.0.154&#x27;</span>s password:</span><br><span class="line">test.sh                         100%  25   12.9KB/s </span><br><span class="line">00:00  </span><br><span class="line">Connection to 10.0.0.157 closed.</span><br></pre></td></tr></table></figure>

<p>范例：复制目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# scp -r /var/log/ root@10.0.0.161:/tmp/</span><br><span class="line">root@10.0.0.161<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">syslog 100% 1575KB  15.4MB/s  00:00  </span></span><br><span class="line"><span class="string">sysinfo.log 100%   0   0.0KB/s  00:00  </span></span><br><span class="line"><span class="string">kern.log.2.gz 100% 281KB  45.9MB/s  00:00 </span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">scp -r dir dest/ #复制整个目录</span></span><br><span class="line"><span class="string">scp -r dir/ dest/ #复制整个目录</span></span><br><span class="line"><span class="string">scp -r dir/* dest/ #复制目录下所有文件</span></span><br></pre></td></tr></table></figure>

<h2 id="2-3-rsync命令"><a href="#2-3-rsync命令" class="headerlink" title="2.3 rsync命令"></a>2.3 rsync命令</h2><p>rsync工具可以基于ssh和rsync协议实现高效率的远程系统之间复制文件，使用安全的shell连接做为传输方式，比scp更快，基于增量数据同步，即只复制两方不同的文件，此工具来自于rsync包</p>
<p>注意：通信两端主机都需要安装 rsync 软件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rsync  -av /etc  server1:/tmp/ <span class="comment">#复制目录和目录下文件</span></span><br><span class="line">rsync  -av /etc/ server1:/tmp/ <span class="comment">#只复制目录下文件</span></span><br></pre></td></tr></table></figure>

<p>常用选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-n 模拟复制过程</span><br><span class="line">-v 显示详细过程</span><br><span class="line">-r 递归复制目录树</span><br><span class="line">-p 保留权限</span><br><span class="line">-t 保留修改时间戳</span><br><span class="line">-g 保留组信息</span><br><span class="line">-o 保留所有者信息</span><br><span class="line">-l 将软链接文件本身进行复制（默认）</span><br><span class="line">-L 将软链接文件指向的文件复制</span><br><span class="line">-u 如果接收者的文件比发送者的文件较新，将忽略同步</span><br><span class="line">-z 压缩，节约网络带宽</span><br><span class="line">-a 保留属性，相当于-rlptgoD，但不保留ACL（-A）和SELinux属性（-X）</span><br><span class="line">--delete 源数据删除，目标数据也自动同步删除</span><br><span class="line">--progress 显示进度</span><br><span class="line">--bwlimit=5120 <span class="comment">#限速以KB为单位,5120表示5MB</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]#rsync -auv --delete /data/test 10.0.0.7:/data</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#rsync -auv --progress --bwlimit=5120 --delete /data/test 10.0.0.7:/data</span><br><span class="line">sending incremental file list</span><br><span class="line"><span class="built_in">test</span>/</span><br><span class="line"><span class="built_in">test</span>/a.img</span><br><span class="line">  104,857,600 100%   5.01MB/s   0:00:19 (xfr#1, to-chk=0/2)</span><br><span class="line">sent 104,883,319 bytes received 39 bytes  4,463,121.62 bytes/sec</span><br><span class="line">total size is 104,857,600 speedup is 1.00</span><br><span class="line">[root@rocky8 ~]#</span><br></pre></td></tr></table></figure>

<p>范例：增量复制</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# <span class="built_in">cp</span> /var/log/syslog ./0525</span><br><span class="line">[root@ubuntu ~]# <span class="built_in">ls</span> -l ./0525</span><br><span class="line">total 1584</span><br><span class="line">-rw-r--r-- 1  123  456   657 May 25 15:46 fstab</span><br><span class="line">-rw-r--r-- 1  123  456    24 May 25 15:46 issue</span><br><span class="line">-rw-r----- 1 root root 1612718 May 25 15:55 syslog</span><br><span class="line"></span><br><span class="line"><span class="comment">#这次只复制了新增的syslog 文件</span></span><br><span class="line">[root@ubuntu ~]# rsync -av /root/0525 root@10.0.0.161:/tmp/</span><br><span class="line">root@10.0.0.161<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">sending incremental file list</span></span><br><span class="line"><span class="string">0525/</span></span><br><span class="line"><span class="string">0525/syslog</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">sent 1,613,291 bytes received 39 bytes  460,951.43 bytes/sec</span></span><br><span class="line"><span class="string">total size is 1,613,399 speedup is 1.00</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#查看目标机，0918这个目录属性更新了</span></span><br><span class="line"><span class="string">root@ubuntu:~# ls -l /tmp/0525/</span></span><br><span class="line"><span class="string">total 1584</span></span><br><span class="line"><span class="string">-rw-r--r-- 1  123  456   657 May 25 15:46 fstab</span></span><br><span class="line"><span class="string">-rw-r--r-- 1  123  456    24 May 25 15:46 issue</span></span><br><span class="line"><span class="string">-rw-r----- 1 root root 1612718 May 25 15:55 syslog</span></span><br></pre></td></tr></table></figure>

<h2 id="2-4-sftp命令"><a href="#2-4-sftp命令" class="headerlink" title="2.4 sftp命令"></a>2.4 sftp命令</h2><p>交互式文件传输工具，用法和传统的ftp工具相似，利用ssh服务实现安全的文件上传和下载</p>
<p>使用 <code>ls cd mkdir rmdir pwd get put</code> 等指令，可用 <code>？</code>或 help 获取帮助信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sftp [user@]host</span><br><span class="line">sftp&gt; <span class="built_in">help</span></span><br></pre></td></tr></table></figure>

<h2 id="2-5-自动登录ssh工具sshpass"><a href="#2-5-自动登录ssh工具sshpass" class="headerlink" title="2.5 自动登录ssh工具sshpass"></a>2.5 自动登录ssh工具sshpass</h2><p>由EPEL源提供，ssh登陆不能在命令行中指定密码。sshpass的出现，解决了这一问题。sshpass用于非交互SSH的密码验证，一般用在sh脚本中，无须再次输入密码（本机known_hosts文件中有的主机才能生效）。它允许你用 -p 参数指定明文密码，然后直接登录远程服务器，它支持密码从命令行、文件、环境变量中读取。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sshpass [option] <span class="built_in">command</span> parameters</span><br><span class="line"></span><br><span class="line">-p password <span class="comment">#后跟密码它允许你用 -p 参数指定明文密码，然后直接登录远程服务器</span></span><br><span class="line">-f filename <span class="comment">#后跟保存密码的文件名，密码是文件内容的第一行</span></span><br><span class="line">-e 			<span class="comment">#将环境变量SSHPASS作为密码</span></span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]#sshpass -p zjwjl2004 ssh -o StrictHostKeyChecking=no 10.0.0.129 hostname -I</span><br><span class="line">10.0.0.129 </span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# sshpass -p 123456 ssh 10.0.0.161 hostname -I</span><br><span class="line">10.0.0.161</span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> pwd.txt</span><br><span class="line">123456</span><br><span class="line">[root@ubuntu ~]# sshpass -f pwd.txt ssh 10.0.0.161 hostname -I</span><br><span class="line">10.0.0.161</span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# <span class="built_in">export</span> SSHPASS=123456</span><br><span class="line">[root@ubuntu ~]# sshpass -e ssh 10.0.0.161 hostname -I</span><br><span class="line">10.0.0.161</span><br></pre></td></tr></table></figure>

<p>范例：批量修改主机密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> pwd.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">IPLIST=<span class="string">&quot;</span></span><br><span class="line"><span class="string">10.0.0.161</span></span><br><span class="line"><span class="string">10.0.0.210</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"></span><br><span class="line">PASS=123456</span><br><span class="line">. /etc/os-release</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">pre_os</span></span> () &#123;</span><br><span class="line">    <span class="keyword">if</span> [[ <span class="variable">$ID</span> =~ ubuntu ]];<span class="keyword">then</span></span><br><span class="line"> 		dpkg -l sshpass &amp;&gt; /dev/null || &#123; apt update; apt -y install sshpass; &#125;</span><br><span class="line">    <span class="keyword">elif</span> [[ <span class="variable">$ID</span> =~ rocky|centos|rhel ]];<span class="keyword">then</span></span><br><span class="line"> 		rpm -q sshpass &amp;&gt;/dev/null || yum -y install sshpass</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">  		<span class="built_in">echo</span> <span class="string">&quot;不支持当前操作系统&quot;</span></span><br><span class="line">  		<span class="built_in">exit</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">change_root_pass</span></span> () &#123;</span><br><span class="line">    [ -f ip_pass.txt ] &amp;&amp; <span class="built_in">mv</span> ip_pass.txt ip_pass.txt.bak</span><br><span class="line">    <span class="keyword">for</span> ip <span class="keyword">in</span> <span class="variable">$IPLIST</span>;<span class="keyword">do</span></span><br><span class="line">  		pass=`openssl rand -<span class="built_in">base64</span> 9`</span><br><span class="line"> 		sshpass -p <span class="variable">$PASS</span>  ssh -o StrictHostKeyChecking=no  <span class="variable">$ip</span> <span class="string">&quot;echo root:<span class="variable">$pass</span> | chpasswd&quot;</span></span><br><span class="line">  		<span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">   		 	<span class="built_in">echo</span>  <span class="string">&quot;<span class="variable">$ip</span>:root:<span class="variable">$pass</span>&quot;</span> &gt;&gt; ip_pass.txt</span><br><span class="line">    		<span class="built_in">echo</span> <span class="string">&quot;change root password is successfull on <span class="variable">$ip</span>&quot;</span></span><br><span class="line">  		<span class="keyword">else</span></span><br><span class="line">    		<span class="built_in">echo</span> <span class="string">&quot;change root password is failed on <span class="variable">$ip</span>&quot;</span></span><br><span class="line">  		<span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line">pre_os</span><br><span class="line">change_root_pass</span><br><span class="line"></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">chmod</span> a+x pwd.sh</span><br><span class="line">[root@ubuntu ~]# ./pwd.sh</span><br><span class="line">[root@ubuntu ~]# ./pwd.sh</span><br><span class="line">change root password is successfull on 10.0.0.161</span><br><span class="line">change root password is successfull on 10.0.0.210</span><br><span class="line"></span><br><span class="line"><span class="comment">#记录执行结果</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">cat</span> ip_pass.txt</span><br><span class="line">10.0.0.161:root:uOihK+VaW54C</span><br><span class="line">10.0.0.210:root:aSQdPL57FHaX</span><br></pre></td></tr></table></figure>

<h2 id="2-6-lastb命令"><a href="#2-6-lastb命令" class="headerlink" title="2.6 lastb命令"></a>2.6 lastb命令</h2><p>lastb 命令用于列出登入系统失败的用户相关信息。</p>
<p>单独执行 lastb 指令，它会读取位于 <code>/var/log</code> 目录下，名称为 btmp 的文件，并把该文件记录登入失败的用户名，全部显示出来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">lastb [-adRx][-f &lt;记录文件&gt;][-n &lt;显示行数&gt;][帐号名称...][终端机编号...]</span><br><span class="line"></span><br><span class="line">参数说明：</span><br><span class="line">-R  					 <span class="comment">#省略主机名 hostname 的列</span></span><br><span class="line">-a 　					<span class="comment">#把从何处登入系统的主机名称或IP地址显示在最后一行。</span></span><br><span class="line">-d 　					<span class="comment">#将IP地址转换成主机名称。</span></span><br><span class="line">-f&lt;记录文件&gt; 　			 <span class="comment">#指定记录文件。</span></span><br><span class="line">-n&lt;显示行数&gt;或-&lt;显示行数&gt; 　<span class="comment">#显示名单的行数。</span></span><br><span class="line">-R 　					<span class="comment">#不显示登入系统的主机名称或IP地址。</span></span><br><span class="line">-x 　					<span class="comment">#显示系统关机，重新开机，以及执行等级的改变等信息。</span></span><br></pre></td></tr></table></figure>

<p>范例：统计ssh登录失败次数最多的前十个远程IP</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]#lastb -f btmp-test | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>|<span class="built_in">sort</span> |<span class="built_in">uniq</span> -c|<span class="built_in">sort</span> -nr|<span class="built_in">head</span></span><br><span class="line"> 86294 58.218.92.37</span><br><span class="line"> 43148 58.218.92.26</span><br><span class="line"> 18036 112.85.42.201</span><br><span class="line"> 10501 111.26.195.101</span><br><span class="line"> 10501 111.231.235.49</span><br><span class="line"> 10501 111.204.186.207</span><br><span class="line"> 10501 111.11.29.199</span><br><span class="line"> 10499 118.26.23.225</span><br><span class="line"> 6288 42.7.26.142</span><br><span class="line"> 4236 58.218.92.30</span><br><span class="line"> </span><br><span class="line">[root@centos8 ~]#lastb -f btmp-test | awk <span class="string">&#x27;&#123;ip[$3]++&#125;END&#123;for(i in ip)&#123;print ip[i],i&#125;&#125;&#x27;</span>|<span class="built_in">sort</span> -nr|<span class="built_in">head</span></span><br><span class="line">86294 58.218.92.37</span><br><span class="line">43148 58.218.92.26</span><br><span class="line">18036 112.85.42.201</span><br><span class="line">10501 111.26.195.101</span><br><span class="line">10501 111.231.235.49</span><br><span class="line">10501 111.204.186.207</span><br><span class="line">10501 111.11.29.199</span><br><span class="line">10499 118.26.23.225</span><br><span class="line">6288 42.7.26.142</span><br><span class="line">4236 58.218.92.30</span><br></pre></td></tr></table></figure>

<h1 id="3-ssh登录验证方式介绍"><a href="#3-ssh登录验证方式介绍" class="headerlink" title="3 ssh登录验证方式介绍"></a>3 ssh登录验证方式介绍</h1><p><strong>基于用户和口令登录验证</strong></p>
<ol>
<li><p>客户端发起ssh请求，服务器会把自己的公钥发送给用户</p>
</li>
<li><p>用户会根据服务器发来的公钥对密码进行加密</p>
</li>
<li><p>加密后的信息回传给服务器，服务器用自己的私钥解密，如果密码正确，则用户登录成功</p>
</li>
</ol>
<p><strong>基于密钥的登录方式</strong></p>
<ol>
<li><p>首先在客户端生成一对密钥（ssh-keygen）</p>
</li>
<li><p>并将客户端的公钥ssh-copy-id 拷贝到服务端</p>
</li>
<li><p>当客户端再次发送一个连接请求，包括ip、用户名</p>
</li>
<li><p>服务端得到客户端的请求后，会到authorized_keys中查找，如果有响应的IP和用户，就会随机生成一个字符串，例如：magedu</p>
</li>
<li><p>服务端将使用客户端拷贝过来的公钥进行加密，然后发送给客户端</p>
</li>
<li><p>得到服务端发来的消息后，客户端会使用私钥进行解密，然后将解密后的字符串发送给服务端</p>
</li>
<li><p>服务端接受到客户端发来的字符串后，跟之前的字符串进行对比，如果一致，就允许免密码登录</p>
</li>
</ol>
<h2 id="3-1-实现基于密钥的登录方式"><a href="#3-1-实现基于密钥的登录方式" class="headerlink" title="3.1 实现基于密钥的登录方式"></a>3.1 实现基于密钥的登录方式</h2><p>在客户端生成密钥对</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa [-P <span class="string">&#x27;password&#x27;</span>] [-f “~/.ssh/id_rsa<span class="string">&quot;] [-C &quot;</span>your_email@example.com<span class="string">&quot;]</span></span><br></pre></td></tr></table></figure>

<p>命令释义说明：</p>
<ul>
<li><p>使用 ssh-keygen 用于生成 RSA 密钥和公钥，<code>-t</code> 指定密钥类型，就是生成 RSA 加密的钥匙，<code>-p</code> 指定密码，<code>-C</code> 添加注释，一般用邮箱地址，<code>-f</code> 指定密钥对存放路径</p>
</li>
<li><p>RSA 也是默认的加密类型，所以可以只输入 ssh-keygen，默认的 RSA 长度是 2048 位，如果你非常注重安全，那么可以指定 4096 位的长度，指令如下：</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -b 4096 -t rsa</span><br></pre></td></tr></table></figure>

<ul>
<li><p>生成密钥对后，你可以选择将其存储在默认位置（<code>~/.ssh/</code> 目录下）或选择其他位置。</p>
</li>
<li><p>生成的密钥对包括两个文件：私钥文件（<code>id_rsa</code>）和公钥文件（<code>id_rsa.pub</code>）。私钥文件存储在本地，而公钥文件则需要被复制到远程服务器上。</p>
</li>
</ul>
<p>把公钥文件传输至要免密登录的远程服务器对应用户的家目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id [-i [identity_file]] [user@]host</span><br><span class="line"></span><br><span class="line">选项</span><br><span class="line">-p：指定ssh端口号</span><br><span class="line">-i &lt;identity_file&gt;：指定复制到远程主机的公钥认证文件路径</span><br><span class="line">-o &lt;ssh_option&gt;：指定其他ssh参数</span><br></pre></td></tr></table></figure>

<p>重设私钥口令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -p</span><br></pre></td></tr></table></figure>

<p>范例：10.0.0.183（centos7）远程免密登陆10.0.0.176（rocky8）和10.0.0.129（Ubuntu2004）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]#ssh-keygen</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa): 	<span class="comment">#回车，接受默认值</span></span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): 				<span class="comment">#回车，接受默认值，空密码</span></span><br><span class="line">Enter same passphrase again: 								<span class="comment">#回车，接受默认值</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa): 	<span class="comment">#生成私钥存放路径，默认/root/.ssh/id_rsa</span></span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): 	 			<span class="comment">#私钥文件要不要加密</span></span><br><span class="line">Enter same passphrase again: </span><br><span class="line"></span><br><span class="line">root@centos7 ~]#<span class="built_in">ls</span> .ssh</span><br><span class="line">id_rsa  id_rsa.pub</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]#ssh-copy-id 10.0.0.129	<span class="comment">#默认是root用户，如果要指定，wu@10.0.0.129</span></span><br><span class="line"></span><br><span class="line">[root@ubuntu2023 ~]#<span class="built_in">cat</span> .ssh/authorized_keys</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCwUJnGIjiRoZkFN+RLZdS0/td6mYu9ANZJlNrTp/AbN73JXuMx9CAjhNPfS1NzeD8U0HCDyMBDZPjgiTtwB8rqHIL2TiKdf6gnXjiLbQ15v5fk7ZW2Na7Nh4x3sUY3ZpuZt/w2SEG37yHxwAKRCBBccafEbbo/GW8GOhTdbHEUlONSv5jDLVzQyxNzjAgpBX7Y/LYbtrY3QG6UJOw61gknI8rPWlBN+VuPo11NXqQ5F/mVCy/QgzZIkD5N/MBCBO2jMcLkXD0+kgrOZxx1DY7lC2jyGt27zu9OS/OLPR7ZNmLKKnCMJp+Yp+DHcelVrDEMD8SoAXh1gMAb7Jux04i/ root@centos7</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]#<span class="built_in">cat</span> .ssh/id_rsa.pub </span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCwUJnGIjiRoZkFN+RLZdS0/td6mYu9ANZJlNrTp/AbN73JXuMx9CAjhNPfS1NzeD8U0HCDyMBDZPjgiTtwB8rqHIL2TiKdf6gnXjiLbQ15v5fk7ZW2Na7Nh4x3sUY3ZpuZt/w2SEG37yHxwAKRCBBccafEbbo/GW8GOhTdbHEUlONSv5jDLVzQyxNzjAgpBX7Y/LYbtrY3QG6UJOw61gknI8rPWlBN+VuPo11NXqQ5F/mVCy/QgzZIkD5N/MBCBO2jMcLkXD0+kgrOZxx1DY7lC2jyGt27zu9OS/OLPR7ZNmLKKnCMJp+Yp+DHcelVrDEMD8SoAXh1gMAb7Jux04i/ root@centos7</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]#ssh 10.0.0.129	<span class="comment">#免密登陆</span></span><br><span class="line">[root@ubuntu2023 ~]#</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]#ssh 10.0.0.129 hostname	<span class="comment">#也可远程执行命令</span></span><br><span class="line">ubuntu2023</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]#ssh-copy-id 10.0.0.176</span><br><span class="line"></span><br><span class="line">[root@Rocky8 ~]#<span class="built_in">ls</span> .ssh</span><br><span class="line">authorized_keys</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]#ssh 10.0.0.176</span><br><span class="line">[root@Rocky8 ~]#</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果不想敲yesno</span></span><br><span class="line">[root@centos7 ~]#ssh -o StrictHostKeyChecking=no 10.0.0.176</span><br></pre></td></tr></table></figure>

<p>范例：10.0.0.183（centos7，以该机为主要机器）10.0.0.176（rocky8）和10.0.0.129（Ubuntu2004）互相免密远程登陆</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]#ssh-keygen </span><br><span class="line">[root@centos7 ~]#ssh-copy-id 10.0.0.183</span><br><span class="line">[root@centos7 ~]#<span class="built_in">ls</span> .ssh</span><br><span class="line">authorized_keys  id_rsa  id_rsa.pub  known_hosts</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]#scp -r .ssh 10.0.0.176:/root/</span><br><span class="line">[root@Rocky8 ~]#<span class="built_in">ls</span> .ssh</span><br><span class="line">authorized_keys  id_rsa  id_rsa.pub  known_hosts</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]#scp -r .ssh 10.0.0.129:/root/</span><br><span class="line">[root@ubuntu2023 ~]#<span class="built_in">ls</span> .ssh</span><br><span class="line">authorized_keys  id_rsa  id_rsa.pub  known_hosts</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th><code>authorized_keys</code></th>
<th><code>known_hosts</code></th>
</tr>
</thead>
<tbody><tr>
<td><strong>位置</strong></td>
<td>存在于服务器端（目标主机）。</td>
<td>存在于客户端（发起连接的主机）。</td>
</tr>
<tr>
<td><strong>作用</strong></td>
<td>存储允许登录的客户端公钥，用于身份验证。</td>
<td>存储远程主机的公钥，用于验证主机身份。</td>
</tr>
<tr>
<td><strong>文件内容</strong></td>
<td>每行一个公钥，对应一个允许登录的用户。</td>
<td>每行一个条目，包含主机名&#x2F;IP 和公钥。</td>
</tr>
<tr>
<td><strong>权限要求</strong></td>
<td>必须限制为仅用户可读写（<code>600</code>）。</td>
<td>必须限制为仅用户可读写（<code>600</code>）。</td>
</tr>
<tr>
<td><strong>首次连接行为</strong></td>
<td>不涉及。</td>
<td>客户端会提示确认主机公钥，并记录到 <code>known_hosts</code>。</td>
</tr>
</tbody></table>
<p>范例：实现基于 key 验证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]#ssh-keygen</span><br><span class="line">[root@centos8 ~]#ll .ssh/</span><br><span class="line">total 8</span><br><span class="line">-rw------- 1 root root 2622 May 22 09:51 id_rsa</span><br><span class="line">-rw-r--r-- 1 root root  583 May 22 09:51 id_rsa.pub</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#ssh-copy-id root@10.0.0.7</span><br><span class="line">[root@centos7 ~]#ll .ssh</span><br><span class="line">total 4</span><br><span class="line">-rw------- 1 root root 583 May 22 09:52 authorized_keys</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#ssh 10.0.0.7</span><br><span class="line">Last login: Fri May 22 08:43:50 2020 from 10.0.0.1</span><br><span class="line">[root@centos7 ~]#<span class="built_in">exit</span></span><br><span class="line"><span class="built_in">logout</span></span><br><span class="line">Connection to 10.0.0.7 closed.</span><br><span class="line">[root@centos8 ~]#scp /etc/fstab 10.0.0.7:/data</span><br><span class="line">fstab</span><br><span class="line"></span><br><span class="line"><span class="comment">#对私钥加密</span></span><br><span class="line">[root@centos8 ~]#ssh-keygen -p</span><br><span class="line">[root@centos8 ~]#ssh 10.0.0.7</span><br><span class="line">Enter passphrase <span class="keyword">for</span> key <span class="string">&#x27;/root/.ssh/id_rsa&#x27;</span>: <span class="comment">#输入私钥的密码</span></span><br><span class="line">Last login: Fri May 22 08:47:50 2020 from 10.0.0.8</span><br><span class="line">[root@centos7 ~]#<span class="built_in">exit</span></span><br><span class="line"><span class="built_in">logout</span></span><br><span class="line">Connection to 10.0.0.7 closed.</span><br><span class="line"></span><br><span class="line"><span class="comment">#启用ssh代理</span></span><br><span class="line">[root@centos8 ~]#ssh-agent bash</span><br><span class="line">[root@centos8 ~]#ps aux|grep agent</span><br><span class="line">root    1972  0.0  0.0  29440  548 ?    Ss  10:18  0:00 ssh-agent bash</span><br><span class="line">root    1992  0.0  0.1  12108  964 pts/0  S+  10:18  0:00 grep --color=auto agent</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#ssh-add</span><br><span class="line">Enter passphrase <span class="keyword">for</span> /root/.ssh/id_rsa:</span><br><span class="line">Identity added: /root/.ssh/id_rsa (root@centos8.wangxiaochun.com)</span><br><span class="line">[root@centos8 ~]#ssh 10.0.0.7</span><br><span class="line">Last login: Fri May 22 08:48:55 2020 from 10.0.0.8</span><br></pre></td></tr></table></figure>

<p>脚本：向目标主机批量分发 SSH 公钥，实现免密码登录</p>
<p>第一种：使用<code>expect</code>工具处理交互，目标 IP 写在<code>IPLIST</code>变量中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">COLOR=<span class="string">&quot;echo -e \E[1;32m&quot;</span></span><br><span class="line">END=<span class="string">&quot;\E[0m&quot;</span></span><br><span class="line">PASSWORD=123456</span><br><span class="line">IPLIST=<span class="string">&quot;</span></span><br><span class="line"><span class="string">10.0.0.7</span></span><br><span class="line"><span class="string">10.0.0.17</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"></span><br><span class="line">[ ! -f ~/.ssh/id_rsa ] &amp;&amp; ssh-keygen -P <span class="string">&quot;&quot;</span> -f ~/.ssh/id_rsa &amp;&gt;/dev/null</span><br><span class="line">rpm -q expect &amp;&gt; /dev/null || yum -y -q install expect &amp;&gt;/dev/null</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> <span class="variable">$IPLIST</span> ;<span class="keyword">do</span></span><br><span class="line">&#123;  </span><br><span class="line">    expect &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">    set timeout 60</span></span><br><span class="line"><span class="string">    spawn ssh-copy-id $ip</span></span><br><span class="line"><span class="string">    expect &#123;</span></span><br><span class="line"><span class="string">    	&quot;yes/no&quot; &#123; send &quot;yes\r&quot;;exp_continue &#125;</span></span><br><span class="line"><span class="string">    	&quot;password:&quot; &#123; send &quot;$PASSWORD\r&quot; &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    expect eof</span></span><br><span class="line"><span class="string">    EOF</span></span><br><span class="line">    <span class="variable">$COLOR</span><span class="string">&quot;<span class="variable">$ip</span> is ready&quot;</span><span class="variable">$END</span></span><br><span class="line">&#125;&amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"><span class="variable">$COLOR</span><span class="string">&quot;Push ssh key is finished!&quot;</span><span class="variable">$END</span></span><br></pre></td></tr></table></figure>

<p>第二种：使用<code>expect</code>工具处理交互，目标 IP 通过<code>hosts.txt</code>文件传入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]#<span class="built_in">cat</span> push_ssh_key.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">PASS=123456</span><br><span class="line"></span><br><span class="line">rpm -q expect &amp;&gt; /dev/null || yum -y install expect &amp;&gt; /dev/null</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -e /root/.ssh/id_rsa ];<span class="keyword">then</span></span><br><span class="line"> 	ssh-keygen  -t rsa -P <span class="string">&quot;&quot;</span> -f /root/.ssh/id_rsa &amp;&gt; /dev/null</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ssh key is created&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> IP ;<span class="keyword">do</span></span><br><span class="line">    expect &amp;&gt; /dev/null &lt;&lt;<span class="string">EOF  #或者expect &lt;&lt;EOF</span>  &amp;&gt; /dev/null</span><br><span class="line">    <span class="built_in">set</span> <span class="built_in">timeout</span> 20</span><br><span class="line">    spawn ssh-copy-id -i /root/.ssh/id_rsa.pub root@<span class="variable">$IP</span></span><br><span class="line">    expect &#123;</span><br><span class="line">        <span class="string">&quot;yes/no&quot;</span> &#123; send <span class="string">&quot;yes\n&quot;</span>;exp_continue &#125;</span><br><span class="line">        <span class="string">&quot;password&quot;</span> &#123; send <span class="string">&quot;<span class="variable">$PASS</span>\n&quot;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    expect eof</span><br><span class="line">    EOF</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$IP</span> is ready</span><br><span class="line"><span class="keyword">done</span> &lt; hosts.txt</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#<span class="built_in">cat</span> hosts.txt</span><br><span class="line">10.0.0.7</span><br><span class="line">10.0.0.6</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#bash push_ssh_key.sh</span><br><span class="line">ssh key is created</span><br><span class="line">10.0.0.7 is ready</span><br><span class="line">10.0.0.6 is ready</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#ssh 10.0.0.7</span><br><span class="line">Last login: Fri May 22 10:19:35 2020 from 10.0.0.8</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]#<span class="built_in">exit</span></span><br><span class="line"><span class="built_in">logout</span></span><br><span class="line">Connection to 10.0.0.7 closed.</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#ssh 10.0.0.6</span><br><span class="line">Last login: Fri May 22 10:19:39 2020 from 10.0.0.8</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#<span class="built_in">exit</span></span><br><span class="line"><span class="built_in">logout</span></span><br><span class="line">Connection to 10.0.0.6 closed.</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]#<span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">cat</span> hosts.txt`;<span class="keyword">do</span> ssh <span class="variable">$i</span> hostname -I ;<span class="keyword">done</span></span><br><span class="line">10.0.0.7</span><br><span class="line">10.0.0.6</span><br></pre></td></tr></table></figure>

<p>第三种：使用<code>sshpass</code>工具自动输入密码（替代<code>expect</code>），目标 IP 是连续网段（通过循环<code>&#123;1..100&#125;</code>生成）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">NET=10.0.0</span><br><span class="line">PASS=123456</span><br><span class="line"></span><br><span class="line">ssh-keygen  -P <span class="string">&quot;&quot;</span>  -f /root/.ssh/id_rsa &amp;&gt; /dev/null</span><br><span class="line">rpm -q sshpass &amp;&gt; /dev/null || yum -y install sshpass &amp;&gt; /dev/null</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..100&#125;;<span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">    sshpass  -p <span class="variable">$PASS</span> ssh-copy-id -o  StrictHostKeyChecking=no -i</span><br><span class="line">    /root/.ssh/id_rsa.pub <span class="variable">$NET</span>.<span class="variable">$i</span> &amp;&gt; /dev/null</span><br><span class="line">&#125;&amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br></pre></td></tr></table></figure>

<p>第四种：使用<code>sshpass</code>工具自动输入密码（替代<code>expect</code>），目标 IP 写在<code>HOSTS</code>变量中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">HOSTS=<span class="string">&quot;</span></span><br><span class="line"><span class="string">10.0.0.6</span></span><br><span class="line"><span class="string">10.0.0.7</span></span><br><span class="line"><span class="string">10.0.0.18</span></span><br><span class="line"><span class="string">10.0.0.28</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line">PASS=magedu</span><br><span class="line"></span><br><span class="line">ssh-keygen  -P <span class="string">&quot;&quot;</span>  -f /root/.ssh/id_rsa &amp;&gt; /dev/null</span><br><span class="line">rpm -q sshpass &amp;&gt; /dev/null || yum -y install sshpass &amp;&gt; /dev/null</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$HOSTS</span>;<span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">    sshpass  -p <span class="variable">$PASS</span> ssh-copy-id -o  StrictHostKeyChecking=no -i</span><br><span class="line">    /root/.ssh/id_rsa.pub <span class="variable">$i</span> &amp;&gt; /dev/null</span><br><span class="line">&#125;&amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br></pre></td></tr></table></figure>

<h2 id="3-2-SSH密钥代理"><a href="#3-2-SSH密钥代理" class="headerlink" title="3.2 SSH密钥代理"></a>3.2 SSH密钥代理</h2><p>验证代理（authentication agent）保密解密后的密钥，口令就只需要输入一次，在GNOME中，代理被自动提供给root用户</p>
<p>SSH密钥代理是一个可以管理 SSH 私钥的程序，可以在一次登录后将私钥的解密密码缓存起来，以便后续的 SSH 操作无需再次输入密码</p>
<p>这样你就不需要每次 SSH 登录都输入私钥密码了，提高了使用的便利性和安全性。在实际使用中，你可能会有多个密钥对，用于不同的服务器或用途。为了更好地管理这些密钥对，可以使用 SSH 配置文件或密钥文件的别名。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#启用代理</span></span><br><span class="line">ssh-agent bash</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加私钥到代理</span></span><br><span class="line">ssh-add ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure>

<p>在SecureCRT或Xshell实现基于key验证</p>
<p>在SecureCRT工具 —&gt; 创建公钥 —&gt; 生成 <code>Identity.pub</code> 文件</p>
<p>转化为openssh兼容格式（适合SecureCRT，Xshell不需要转化格式），并复制到需登录主机上相应文件authorized_keys中，注意权限必须为600，在需登录的ssh主机上执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -i -f Identity.pub &gt;&gt; .ssh/authorized_keys</span><br></pre></td></tr></table></figure>

<h1 id="4-ssh服务器配置"><a href="#4-ssh服务器配置" class="headerlink" title="4 ssh服务器配置"></a>4 ssh服务器配置</h1><p>服务器端：sshd</p>
<p>服务器端的配置文件: &#x2F;etc&#x2F;ssh&#x2F;sshd_config</p>
<p>服务器端的配置文件帮助：man 5 sshd_config</p>
<p>常用参数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Port  22   					<span class="comment">#生产建议修改，不然容易被黑客攻击</span></span><br><span class="line">ListenAddress ip		<span class="comment">#监听的ip地址</span></span><br><span class="line"></span><br><span class="line">LoginGraceTime 2m</span><br><span class="line">PermitRootLogin <span class="built_in">yes</span> 	<span class="comment">#默认ubuntu不允许root远程ssh登录</span></span><br><span class="line">StrictModes <span class="built_in">yes</span>   		<span class="comment">#检查.ssh/文件的所有者，权限等</span></span><br><span class="line">MaxAuthTries  6   		<span class="comment">#一次连接，最多可以输错6次密码</span></span><br><span class="line">MaxSessions  10     	<span class="comment">#同一个连接最大会话</span></span><br><span class="line"></span><br><span class="line">PubkeyAuthentication <span class="built_in">yes</span>   			<span class="comment">#基于key验证</span></span><br><span class="line">PermitEmptyPasswords no    			<span class="comment">#空密码连接</span></span><br><span class="line">PasswordAuthentication <span class="built_in">yes</span> 			<span class="comment">#基于用户名和密码连接</span></span><br><span class="line">PrintMotd no 										<span class="comment">#是否输出motd信息，改成yes 则motd 会输出两次</span></span><br><span class="line">ChallengeResponseAuthentication <span class="built_in">yes</span>	 <span class="comment">#改成no，提高登陆速度</span></span><br><span class="line">PrintLastLog <span class="built_in">yes</span> 								<span class="comment">#是否输出上次登录信息</span></span><br><span class="line">UseDNS <span class="built_in">yes</span> 											<span class="comment">#是否需要解析主机名，no可加快连接速度</span></span><br><span class="line">GSSAPIAuthentication <span class="built_in">yes</span> 				<span class="comment">#是否开启客户端对IP反解析，提高速度可改为no</span></span><br><span class="line">Banner /path/file 							<span class="comment">#远程连接时的登录前提示</span></span><br><span class="line"></span><br><span class="line">GatewayPorts no</span><br><span class="line">ClientAliveInterval 10 		<span class="comment">#单位:秒</span></span><br><span class="line">ClientAliveCountMax 3 		<span class="comment">#默认3</span></span><br><span class="line">MaxStartups   						<span class="comment">#未认证连接最大值，默认值10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#以下可以限制可登录用户的办法：</span></span><br><span class="line">AllowUsers user1 user2 user3 	<span class="comment">#用户名白名单</span></span><br><span class="line">DenyUsers user1 user2 user3 	<span class="comment">#用户名黑名单</span></span><br><span class="line">AllowGroups g1 g2 						<span class="comment">#用户组白名单</span></span><br><span class="line">DenyGroups g1 g2 							<span class="comment">#用户组黑名单</span></span><br></pre></td></tr></table></figure>

<p>范例：设置ssh服务超时断开连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#10s如果没有互动，则断开链接，永久生效可以写配置文件,例如可以写在 /etc/profile 里面</span></span><br><span class="line">[root@ubuntu ~]# <span class="built_in">export</span> TMOUT=10</span><br></pre></td></tr></table></figure>

<p>范例：设置ssh空闲60s自动注销</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Vim /etc/ssh/sshd_config</span><br><span class="line">ClientAliveInterval  60</span><br><span class="line">ClientAliveCountMax  0</span><br><span class="line"></span><br><span class="line">Service sshd restart</span><br><span class="line"><span class="comment">#注意：新开一个连接才有效</span></span><br></pre></td></tr></table></figure>

<p>范例：解决ssh登录缓慢的问题</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line">UseDNS no					<span class="comment">#关闭dns解析选项</span></span><br><span class="line">GSSAPIAuthentication no</span><br><span class="line"></span><br><span class="line">systemctl restart sshd</span><br></pre></td></tr></table></figure>

<p>范例：在 ubuntu 上启用 root 远程ssh登录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改sshd服务配置文件</span></span><br><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line"><span class="comment">#PermitRootLogin prohibit-password 注释掉此行，修改为下面形式</span></span><br><span class="line">PermitRootLogin <span class="built_in">yes</span> </span><br><span class="line"></span><br><span class="line">systemctl restart sshd</span><br></pre></td></tr></table></figure>

<h2 id="4-1-优化ssh服务"><a href="#4-1-优化ssh服务" class="headerlink" title="4.1 优化ssh服务"></a>4.1 优化ssh服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UseDNS                  no      <span class="comment"># 禁止ssh进行dns反向解析，影响ssh连接效率参数</span></span><br><span class="line">GSSAPIAuthentication    no      <span class="comment"># 禁止GSS认证，减少连接时产生的延迟</span></span><br></pre></td></tr></table></figure>

<h2 id="4-2-ssh服务的最佳实践"><a href="#4-2-ssh服务的最佳实践" class="headerlink" title="4.2 ssh服务的最佳实践"></a>4.2 ssh服务的最佳实践</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">建议使用非默认端口</span><br><span class="line">禁止使用protocol version 1</span><br><span class="line">限制可登录用户</span><br><span class="line">设定空闲会话超时时长</span><br><span class="line">利用防火墙设置ssh访问策略</span><br><span class="line">仅监听特定的IP地址</span><br><span class="line">基于口令认证时，使用强密码策略，比如：<span class="built_in">tr</span> -dc A-Za-z0-9_ &lt; /dev/urandom | <span class="built_in">head</span> -c 12| xargs</span><br><span class="line">使用基于密钥的认证</span><br><span class="line">禁止使用空密码</span><br><span class="line">禁止root用户直接登录</span><br><span class="line">限制ssh的访问频度和并发在线数</span><br><span class="line">经常分析日志</span><br></pre></td></tr></table></figure>

<h1 id="5-ssh服务加固安全"><a href="#5-ssh服务加固安全" class="headerlink" title="5 ssh服务加固安全"></a>5 ssh服务加固安全</h1><h2 id="5-1-限制和加固-SSH-访问"><a href="#5-1-限制和加固-SSH-访问" class="headerlink" title="5.1 限制和加固 SSH 访问"></a>5.1 限制和加固 SSH 访问</h2><p>禁用密码身份验证是提高 SSH 安全性的重要步骤之一。这样，用户只能通过密钥身份验证进行访问，而不再依赖弱密码。</p>
<p>在 <code>sshd_config</code> 中禁用密码身份验证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> vim /etc/ssh/sshd_config</span><br><span class="line"><span class="comment"># 找到并修改以下行：</span></span><br><span class="line">PasswordAuthentication no</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">sudo</span> service ssh restart</span><br></pre></td></tr></table></figure>

<p>在 <code>sshd_config</code> 中禁用root身份验证</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">PermitRootLogin</span> <span class="literal">no</span></span><br></pre></td></tr></table></figure>

<h2 id="5-2-使用-sshd-config-文件设置访问限制"><a href="#5-2-使用-sshd-config-文件设置访问限制" class="headerlink" title="5.2 使用 sshd_config 文件设置访问限制"></a>5.2 使用 sshd_config 文件设置访问限制</h2><p><code>sshd_config</code> 文件包含了 SSH 服务器的配置选项。通过修改这个文件，你可以设置一些限制，例如限制用户和 IP 地址的访问。</p>
<p>一些常用的 <code>sshd_config</code> 选项：</p>
<ul>
<li><code>AllowUsers</code>：指定允许登录的用户列表。</li>
<li><code>DenyUsers</code>：指定禁止登录的用户列表。</li>
<li><code>AllowGroups</code>：指定允许登录的用户组列表。</li>
<li><code>DenyGroups</code>：指定禁止登录的用户组列表。</li>
<li><code>PermitRootLogin</code>：禁用或限制 root 用户的远程登录。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> vim /etc/ssh/sshd_config</span><br><span class="line"><span class="comment"># 找到并修改以下行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#限制用户访问，将username替换为允许访问的用户名。你还可以使用逗号分隔的列表允许多个用户。</span></span><br><span class="line">AllowUsers username</span><br><span class="line"></span><br><span class="line"><span class="comment"># 限制IP地址访问，将username替换为允许访问的用户名，your_ip替换为允许访问的IP地址。</span></span><br><span class="line">AllowUsers username@your_ip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许特定IP地址段，下列设置表示将允许来自192.168.1网段的所有IP地址的用户名为username的访问。</span></span><br><span class="line">AllowUsers username@192.168.1.*</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">sudo</span> service ssh restart</span><br></pre></td></tr></table></figure>

<p>配置范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">AllowUsers alice bob</span><br><span class="line">DenyUsers mallory</span><br><span class="line">AllowGroups sshusers</span><br><span class="line">DenyGroups badusers</span><br><span class="line">PermitRootLogin no</span><br></pre></td></tr></table></figure>

<p>以上配置将只允许用户 alice 和 bob 以及属于 sshusers 组的用户登录，同时拒绝用户 mallory 和属于 badusers 组的用户登录。此外，禁止 root 用户通过 SSH 远程登录。</p>
<h2 id="5-3-使用-TCP-Wrappers-进行进一步访问控制"><a href="#5-3-使用-TCP-Wrappers-进行进一步访问控制" class="headerlink" title="5.3 使用 TCP Wrappers 进行进一步访问控制"></a>5.3 使用 TCP Wrappers 进行进一步访问控制</h2><p>在 <code>/etc/hosts.allow</code> 和 <code>/etc/hosts.deny</code> 文件中，你可以使用 TCP Wrappers 设置更复杂的主机访问控制规则。例如，在 <code>/etc/hosts.allow</code> 中添加以下行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshd: 192.168.1.0/255.255.255.0</span><br></pre></td></tr></table></figure>

<p>这样将允许来自 <code>192.168.1</code> 网段的所有主机访问 SSH 服务。</p>
<h2 id="5-4-修改-SSH-端口"><a href="#5-4-修改-SSH-端口" class="headerlink" title="5.4 修改 SSH 端口"></a>5.4 修改 SSH 端口</h2><p>默认情况下，SSH 服务使用 22 端口。为了提高安全性，可以修改为其他非常用端口，比如 2222：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Port 2222</span><br></pre></td></tr></table></figure>

<p>确保保存修改并重新启动 SSH 服务。</p>
<h2 id="5-5-使用-SSH-Agent-Forwarding"><a href="#5-5-使用-SSH-Agent-Forwarding" class="headerlink" title="5.5 使用 SSH Agent Forwarding"></a>5.5 使用 SSH Agent Forwarding</h2><p>SSH Agent Forwarding 是一种机制，允许你在本地系统上解锁私钥，然后通过安全地转发到远程主机，以在远程主机上进行身份验证。这意味着，如果你已经通过密钥身份验证登录到本地机器，你可以使用相同的身份验证在远程主机上执行操作，而无需再次输入密码或私钥。</p>
<p>在本地机器上启动 SSH Agent</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span> <span class="string">&quot;<span class="subst">$(ssh-agent -s)</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>添加私钥到代理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-add ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure>

<p>在连接到远程主机时启用 Agent Forwarding</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -A username@your_server_ip</span><br></pre></td></tr></table></figure>

<p>确保替换 <code>username</code> 为你的用户名，<code>your_server_ip</code> 为目标服务器的 IP 地址。</p>
<p>现在，你可以在远程主机上执行需要私钥身份验证的操作，而无需再次输入密码或私钥。</p>
<p>尽管 SSH Agent Forwarding 提供了便利，但也需要注意一些安全性问题。确保遵循以下最佳实践：</p>
<ul>
<li><p>只允许受信任的主机使用 Agent Forwarding：如果你连接到了不受信任的主机，可以通过使用 <code>-A</code> 参数禁用 Agent Forwarding。</p>
</li>
<li><p>定期检查代理并清除不再需要的密钥：使用 <code>ssh-add -L</code> 命令查看当前加载的密钥列表，并使用 <code>ssh-add -D</code> 清除不再需要的密钥。</p>
</li>
<li><p>在不需要 Agent Forwarding 的情况下禁用它：只有在确实需要在远程主机上执行私钥身份验证的操作时才启用 Agent Forwarding。</p>
</li>
</ul>
<p>通过理解和正确配置 SSH Agent Forwarding，你可以在保持安全性的同时提高 SSH 的便利性。</p>
<h2 id="5-6-定期更新密钥对"><a href="#5-6-定期更新密钥对" class="headerlink" title="5.6 定期更新密钥对"></a>5.6 定期更新密钥对</h2><p>为了增加安全性，定期更新 SSH 密钥对是一个好的实践。可以使用以下步骤生成新的密钥对并替换旧的密钥：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成新的密钥对</span></span><br><span class="line">ssh-keygen -t rsa -b 4096 -f ~/.ssh/new_key -C <span class="string">&quot;your_email@example.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制新的公钥到目标服务器</span></span><br><span class="line">ssh-copy-id username@your_server_ip -i ~/.ssh/new_key.pub</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试新密钥是否可以成功登录</span></span><br><span class="line">ssh -i ~/.ssh/new_key username@your_server_ip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果一切正常，可以删除旧密钥</span></span><br><span class="line"><span class="built_in">rm</span> ~/.ssh/id_rsa*</span><br></pre></td></tr></table></figure>

<h2 id="5-7-监控和审计-SSH-访问"><a href="#5-7-监控和审计-SSH-访问" class="headerlink" title="5.7 监控和审计 SSH 访问"></a>5.7 监控和审计 SSH 访问</h2><p>启用 SSH 访问的监控和审计功能可以及时发现潜在的安全问题。可以使用工具如 <code>fail2ban</code> 来监控日志文件，自动封禁恶意的 SSH 连接尝试。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 fail2ban</span></span><br><span class="line"><span class="built_in">sudo</span> apt install fail2ban   <span class="comment"># 对于 Debian/Ubuntu</span></span><br><span class="line"><span class="built_in">sudo</span> yum install fail2ban   <span class="comment"># 对于 Red Hat/CentOS</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用 SSH 防护</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> fail2ban</span><br><span class="line"><span class="built_in">sudo</span> systemctl start fail2ban</span><br></pre></td></tr></table></figure>

<p>通过审查系统日志文件，特别是 <code>/var/log/auth.log</code>（对于 Debian&#x2F;Ubuntu）或 <code>/var/log/secure</code>（对于 Red Hat&#x2F;CentOS），可以查看 SSH 访问的详细信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">tail</span> -f /var/log/auth.log   <span class="comment"># 对于 Debian/Ubuntu</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">tail</span> -f /var/log/secure     <span class="comment"># 对于 Red Hat/CentOS</span></span><br></pre></td></tr></table></figure>

<p>通过监控和审计 SSH 访问，你可以及时发现异常情况，并采取相应的措施来保护系统安全。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://AquaPluto.github.io">Aquarius</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://aquapluto.github.io/Linux/service-manage/ssh/">https://aquapluto.github.io/Linux/service-manage/ssh/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://AquaPluto.github.io" target="_blank">代码推演录</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/">服务管理</a></div><div class="post-share"><div class="social-share" data-image="/img/paper6.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://unpkg.com/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://unpkg.com/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/Linux/firewall/introduce/" title="安全技术和防火墙"><img class="cover" src="/img/paper3.png" onerror="onerror=null;src='/img/error-page.png'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">安全技术和防火墙</div></div><div class="info-2"><div class="info-item-1">1 安全技术和防火墙1.1 安全技...</div></div></div></a><a class="pagination-related" href="/Linux/network-manage/troubleshoot/" title="网络问题排查"><img class="cover" src="/img/paper1.jpg" onerror="onerror=null;src='/img/error-page.png'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">网络问题排查</div></div><div class="info-2"><div class="info-item-1">一、网卡丢包问题1.1 linux...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/Linux/service-manage/mail/" title="邮件服务"><img class="cover" src="/img/paper1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">邮件服务</div></div><div class="info-2"><div class="info-item-1">1 邮件协议邮件服务的运作基于多个...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/plan-tasks/" title="计划任务"><img class="cover" src="/img/paper6.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">计划任务</div></div><div class="info-2"><div class="info-item-1">1 一次性任务at 工具  由包 ...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/DNS/" title="域名DNS解析服务"><img class="cover" src="/img/paper2.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">域名DNS解析服务</div></div><div class="info-2"><div class="info-item-1">一、DNS服务相关技术linux上...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/data-synchronization/" title="数据的实时同步"><img class="cover" src="/img/paper5.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">数据的实时同步</div></div><div class="info-2"><div class="info-item-1">1 数据的实时同步方式在生产环境，...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/time-synchronization/" title="时间同步服务"><img class="cover" src="/img/paper5.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">时间同步服务</div></div><div class="info-2"><div class="info-item-1">1 前言加密和安全当前都离不开时间...</div></div></div></a><a class="pagination-related" href="/Linux/service-manage/log/" title="日志服务"><img class="cover" src="/img/paper1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">日志服务</div></div><div class="info-2"><div class="info-item-1">1 系统日志管理1.1 系统日志介...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avator.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Aquarius</div><div class="author-info-description">分享运维开发相关技术</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">138</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/AquaPluto"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/AquaPluto" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://blog.csdn.net/m0_75233142" target="_blank" title="CSDN"><i class="fa-solid fa-code" style="color: #8a2be2;"></i></a><a class="social-icon" href="mailto:wujunlinq@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content"><p>持续更新文章中，有问题请添加wx</p>
<div>
  <img src="/img/wx.jpg" alt="wx" style="width: 100px">
</div>
</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-ssh%E6%9C%8D%E5%8A%A1%E4%BB%8B%E7%BB%8D"><span class="toc-text">1 ssh服务介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%85%AC%E9%92%A5%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86"><span class="toc-text">1.1 公钥交换原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-ssh%E5%8A%A0%E5%AF%86%E9%80%9A%E8%AE%AF%E5%8E%9F%E7%90%86"><span class="toc-text">1.2 ssh加密通讯原理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-openssh%E8%BD%AF%E4%BB%B6"><span class="toc-text">2 openssh软件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-ssh%E5%91%BD%E4%BB%A4"><span class="toc-text">2.1 ssh命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-scp%E5%91%BD%E4%BB%A4"><span class="toc-text">2.2 scp命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-rsync%E5%91%BD%E4%BB%A4"><span class="toc-text">2.3 rsync命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-sftp%E5%91%BD%E4%BB%A4"><span class="toc-text">2.4 sftp命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E8%87%AA%E5%8A%A8%E7%99%BB%E5%BD%95ssh%E5%B7%A5%E5%85%B7sshpass"><span class="toc-text">2.5 自动登录ssh工具sshpass</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-lastb%E5%91%BD%E4%BB%A4"><span class="toc-text">2.6 lastb命令</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-ssh%E7%99%BB%E5%BD%95%E9%AA%8C%E8%AF%81%E6%96%B9%E5%BC%8F%E4%BB%8B%E7%BB%8D"><span class="toc-text">3 ssh登录验证方式介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%AE%9E%E7%8E%B0%E5%9F%BA%E4%BA%8E%E5%AF%86%E9%92%A5%E7%9A%84%E7%99%BB%E5%BD%95%E6%96%B9%E5%BC%8F"><span class="toc-text">3.1 实现基于密钥的登录方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-SSH%E5%AF%86%E9%92%A5%E4%BB%A3%E7%90%86"><span class="toc-text">3.2 SSH密钥代理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-ssh%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">4 ssh服务器配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E4%BC%98%E5%8C%96ssh%E6%9C%8D%E5%8A%A1"><span class="toc-text">4.1 优化ssh服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-ssh%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-text">4.2 ssh服务的最佳实践</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-ssh%E6%9C%8D%E5%8A%A1%E5%8A%A0%E5%9B%BA%E5%AE%89%E5%85%A8"><span class="toc-text">5 ssh服务加固安全</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E9%99%90%E5%88%B6%E5%92%8C%E5%8A%A0%E5%9B%BA-SSH-%E8%AE%BF%E9%97%AE"><span class="toc-text">5.1 限制和加固 SSH 访问</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E4%BD%BF%E7%94%A8-sshd-config-%E6%96%87%E4%BB%B6%E8%AE%BE%E7%BD%AE%E8%AE%BF%E9%97%AE%E9%99%90%E5%88%B6"><span class="toc-text">5.2 使用 sshd_config 文件设置访问限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-%E4%BD%BF%E7%94%A8-TCP-Wrappers-%E8%BF%9B%E8%A1%8C%E8%BF%9B%E4%B8%80%E6%AD%A5%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-text">5.3 使用 TCP Wrappers 进行进一步访问控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-%E4%BF%AE%E6%94%B9-SSH-%E7%AB%AF%E5%8F%A3"><span class="toc-text">5.4 修改 SSH 端口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-5-%E4%BD%BF%E7%94%A8-SSH-Agent-Forwarding"><span class="toc-text">5.5 使用 SSH Agent Forwarding</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-6-%E5%AE%9A%E6%9C%9F%E6%9B%B4%E6%96%B0%E5%AF%86%E9%92%A5%E5%AF%B9"><span class="toc-text">5.6 定期更新密钥对</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-7-%E7%9B%91%E6%8E%A7%E5%92%8C%E5%AE%A1%E8%AE%A1-SSH-%E8%AE%BF%E9%97%AE"><span class="toc-text">5.7 监控和审计 SSH 访问</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Kubernetes/controller/introduce/" title="控制器介绍"><img src="/img/paper1.jpg" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="控制器介绍"/></a><div class="content"><a class="title" href="/Kubernetes/controller/introduce/" title="控制器介绍">控制器介绍</a><time datetime="2025-09-21T02:38:40.000Z" title="发表于 2025-09-21 10:38">2025-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Kubernetes/deploy/containerd/" title="基于containerd部署k8s-v1.30"><img src="/img/paper6.png" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="基于containerd部署k8s-v1.30"/></a><div class="content"><a class="title" href="/Kubernetes/deploy/containerd/" title="基于containerd部署k8s-v1.30">基于containerd部署k8s-v1.30</a><time datetime="2025-09-21T02:38:40.000Z" title="发表于 2025-09-21 10:38">2025-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Kubernetes/deploy/cluster/" title="集群管理指南"><img src="/img/paper3.png" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="集群管理指南"/></a><div class="content"><a class="title" href="/Kubernetes/deploy/cluster/" title="集群管理指南">集群管理指南</a><time datetime="2025-09-21T02:38:40.000Z" title="发表于 2025-09-21 10:38">2025-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Kubernetes/deploy/docker/" title="基于docker部署k8s-v1.30"><img src="/img/paper5.png" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="基于docker部署k8s-v1.30"/></a><div class="content"><a class="title" href="/Kubernetes/deploy/docker/" title="基于docker部署k8s-v1.30">基于docker部署k8s-v1.30</a><time datetime="2025-09-21T02:38:40.000Z" title="发表于 2025-09-21 10:38">2025-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Kubernetes/deploy/explanation/" title="概论"><img src="/img/paper2.jpg" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="概论"/></a><div class="content"><a class="title" href="/Kubernetes/deploy/explanation/" title="概论">概论</a><time datetime="2025-09-21T02:38:40.000Z" title="发表于 2025-09-21 10:38">2025-09-21</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Aquarius</span></div><div class="footer_custom_text"><style>
div#runtime {
  font-size: 13px;
  font-weight: bold;
}

div#ghbdages_list {
  height: 1.5rem;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 10px
}

.github-badge {
  display: flex;
  align-items: center;
  margin-inline: 6px;
}
</style>
<div id="runtime"></div>
<div id="ghbdages"></div>
<script>
  function createtime() {
    const now = new Date();
    const grt = new Date("08/01/2025 00:00:00"); // 网站诞生时间

    // 计算天、小时、分钟和秒
    const days = Math.floor((now - grt) / (1000 * 60 * 60 * 24));
    const hours = Math.floor(((now - grt) / (1000 * 60 * 60)) % 24)
      .toString()
      .padStart(2, "0");
    const minutes = Math.floor(((now - grt) / (1000 * 60)) % 60)
      .toString()
      .padStart(2, "0");
    const seconds = Math.floor(((now - grt) / 1000) % 60)
      .toString()
      .padStart(2, "0");

    // HTML 输出
    const currentTimeHtml = `
          <div>
              本站已运行 ${days} 天 ${hours} 小时 ${minutes} 分 ${seconds} 秒 
          </div>`;

    const runtime = document.getElementById("runtime");
    if (runtime) runtime.innerHTML = currentTimeHtml;
  }

  // 设置每秒调用函数
  setInterval(createtime, 1000);

  function renderBadge() {
    const currentTimeHtml = `
      <div id="ghbdages_list">
          <a class="github-badge" target="_blank" href="https://hexo.io/" title="hexo:7.3.0">
              <img src="https://img.shields.io/badge/Frame-Hexo-blue?logo=hexo" alt="Static Badge">
          </a>
          <a class="github-badge" target="_blank" href="https://github.com/" title="github">
              <img src="https://img.shields.io/badge/Code-GitHub-181717?logo=GitHub&color=%23FF7102" alt="Static Badge">
          </a>
          <a class="github-badge" target="_blank" href="https://vercel.com/" title="vercel">
              <img src="https://img.shields.io/badge/Host-Vercel-%23F0D722?logo=Vercel" alt="Static Badge">
          </a>
          <a class="github-badge" target="_blank" href="https://analytics.sysio.ai/" title="umami">
              <img src="https://img.shields.io/badge/Analytics-Umami-%237FB100?logo=umami&logoColor=%237FB100" alt="Static Badge">
          </a>
      </div>`;

    const ghbdages = document.getElementById("ghbdages");
    if (ghbdages) {
      ghbdages.innerHTML = currentTimeHtml;
    }
  }

  window.onload = renderBadge;
</script>
</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://unpkg.com/@fancyapps/ui/dist/fancybox/fancybox.umd.js"></script><script src="https://unpkg.com/instant.page/instantpage.js" type="module"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = 'https://unpkg.com/mathjax/es5/tex-mml-chtml.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script></div><script src="https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fishes.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://unpkg.com/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章..." type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>