<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Exporter | 代码推演录</title><meta name="author" content="Aquarius"><meta name="copyright" content="Aquarius"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="1 Exporter基础Exporter是Prometheus的指标数据收集组件。它负责从目标Jobs收集数据，并把收集到的数据转换为Prometheus支持的时序数据格式。 和传统的指标数据收集组件不同的是，他只负责收集，并不向Server端发送数据，而是等待Prometheus Server 主动抓取(pull) 对于那些未内建Instrumentation，且也不便于自行添加该类组件以暴露指">
<meta property="og:type" content="article">
<meta property="og:title" content="Exporter">
<meta property="og:url" content="https://aquapluto.github.io/Monitor/prometheus/exporter/">
<meta property="og:site_name" content="代码推演录">
<meta property="og:description" content="1 Exporter基础Exporter是Prometheus的指标数据收集组件。它负责从目标Jobs收集数据，并把收集到的数据转换为Prometheus支持的时序数据格式。 和传统的指标数据收集组件不同的是，他只负责收集，并不向Server端发送数据，而是等待Prometheus Server 主动抓取(pull) 对于那些未内建Instrumentation，且也不便于自行添加该类组件以暴露指">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://aquapluto.github.io/img/paper4.png">
<meta property="article:published_time" content="2025-08-27T10:16:32.000Z">
<meta property="article:modified_time" content="2025-09-12T09:16:45.147Z">
<meta property="article:author" content="Aquarius">
<meta property="article:tag" content="Prometheus">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://aquapluto.github.io/img/paper4.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Exporter",
  "url": "https://aquapluto.github.io/Monitor/prometheus/exporter/",
  "image": "https://aquapluto.github.io/img/paper4.png",
  "datePublished": "2025-08-27T10:16:32.000Z",
  "dateModified": "2025-09-12T09:16:45.147Z",
  "author": [
    {
      "@type": "Person",
      "name": "Aquarius",
      "url": "https://AquaPluto.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://aquapluto.github.io/Monitor/prometheus/exporter/"><link rel="preconnect" href="//unpkg.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://unpkg.com/@fancyapps/ui/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":true,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://unpkg.com/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Exporter',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/wave.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(/img/background.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avator.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">138</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="menus_items"><!-- 一级菜单项（非目录）--><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>计算机基础</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>计算机组成原理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/hardware-composition/"><span>计算机硬件组成</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/CPU/"><span>CPU</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/memory/"><span>内存</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/hard-disk/"><span>硬盘</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>操作系统</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/concept/"><span>操作系统的概念</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/processes-threads/"><span>进程与线程</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/IO-model/"><span>IO模型</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Linux</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>linux基础</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/introduce/"><span>linux介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/file-structure-and-IO-redirects/"><span>文件结构与IO重定向</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/file-command/"><span>文件管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/text-command/"><span>文本管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/GSA/"><span>文本处理三剑客</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/user-permission/"><span>用户和权限管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/regular-expression/"><span>正则表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/software-manage/"><span>软件包管理</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>进程管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/command/"><span>进程相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/signal/"><span>信号发送</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/job-parallel/"><span>作业管理与并行运行</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/OOM/"><span>OOM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>磁盘管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/disk-partition/"><span>磁盘分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/file-system/"><span>文件系统</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/swap/"><span>Swap分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/LVM/"><span>逻辑卷管理器LVM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>网络管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/configuration/"><span>网络配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/test-diagnostic/"><span>网络测试诊断工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/bridge/"><span>网桥配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/troubleshoot/"><span>网络问题排查</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/DNS/"><span>域名DNS解析服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/time-synchronization/"><span>时间同步服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/plan-tasks/"><span>计划任务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/log/"><span>日志服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/data-synchronization/"><span>数据的实时同步</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/ssh/"><span>ssh远程连接服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/mail/"><span>邮件服务</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/kernel-manage/"><span>内核和启动管理</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>防火墙</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/introduce/"><span>安全技术和防火墙</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/iptables/"><span>iptables</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/firewalld/"><span>firewalld</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/nft/"><span>nft</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>加密和安全</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/security-mechanisms/"><span>安全机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/OpenSSL/"><span>OpenSSL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/sudo/"><span>sudo实现授权</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/PAM/"><span>PAM认证机制</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>shell编程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/introduce/"><span>shell脚本介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/variable/"><span>变量</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/operations-conditional/"><span>运算和条件测试</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-control/"><span>流程控制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/function/"><span>函数</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/array/"><span>数组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/string/"><span>字符串</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/script-tools/"><span>脚本相关工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-lock/"><span>进程锁</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/queue/"><span>队列实现线程并发控制</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/system-optimization/"><span>系统优化</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>数据库</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>MySQL</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/DataBase/MySQL/SQL/"><span>SQL语句</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Redis</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/DataBase/Redis/deploy/"><span>部署安装</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>中间件</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Nginx</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Nginx/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>HAProxy</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/HAProxy/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Keepalived</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Keepalived/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kafka</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Kafka/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Tomcat</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Tomcat/111/"><span>111</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>日志</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>存储</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Storage/conspect/"><span>存储概论</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Storage/nfs/"><span>NFS</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>容器</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/basics/"><span>容器基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Docker</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/conspect/"><span>Docker概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/image/"><span>镜像管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/container/"><span>容器管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/volume/"><span>数据卷</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/network/"><span>网络管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/compose/"><span>Docker-Compose</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>镜像</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/conspect/"><span>镜像概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/dockerfile/"><span>dockerfile</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/build/"><span>构建镜像</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/harbor/"><span>镜像仓库</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>容器进程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/management/"><span>容器里的进程管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/cpu-cgroup/"><span>cpu cgroup使用</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/cpu-usage/"><span>监控容器真实的cpu使用率</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/memory/"><span>容器内存</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/storage/"><span>容器存储</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/network/"><span>容器网络</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/safe/"><span>容器安全</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/containerd/"><span>Containerd</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>K8s</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kubernetes概论</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/architecture/"><span>Kubernetes架构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/cri/"><span>容器运行时接口CRI</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/list-watch/"><span>List-Watch机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/object/"><span>Kubernetes对象</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/namespace/"><span>Namespace</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/kubectl/"><span>kubectl命令</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>部署安装</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/explanation/"><span>部署说明</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/docker/"><span>基于docker部署k8s-v1.30</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/containerd/"><span>基于containerd部署k8s-v1.30</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/cluster/"><span>集群管理指南</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Pod</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/conspect/"><span>Pod概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/configuration/"><span>Pod的配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/schedule/"><span>Pod的调度</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/eviction/"><span>Pod的驱逐</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>控制器</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/introduce/"><span>控制器介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/deployment/"><span>Deployment</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/statefulset/"><span>StatefulSet</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/daemonset/"><span>DaemonSet</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/job-cronjob/"><span>Job和CronJob</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/HPA/"><span>HPA</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/operator/"><span>Operator</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务发现与负载均衡</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/service/"><span>Service</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/ingress/"><span>Ingress</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/coredns/"><span>CoreDNS</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/localdns/"><span>LocalDNS</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>数据存储持久化</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/csi/"><span>存储接口CSI</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/pv-pvc/"><span>PV和PVC</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/storageclass/"><span>StorageClass</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/configmap-secret/"><span>ConfigMap和Secret</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>认证与鉴权体系</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/conspect/"><span>体系概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/kubeconfig/"><span>kubeconfig</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/user-account/"><span>User Account</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/service-account/"><span>Service Account</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>监控</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/conspect/"><span>监控概论</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Prometheus</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/introduce/"><span>prometheus概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/exporter/"><span>Exporter</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/promql/"><span>PromQL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/query-persist/"><span>查询结果持久化</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/service-discovery/"><span>服务发现</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/indicators-remarked/"><span>指标重新打标</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/pushmanager/"><span>Pushmanager</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/cluster-ha/"><span>集群与高可用</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Alertmanager</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/introduce/"><span>告警功能概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/alarm/"><span>实现告警功能</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/ha/"><span>高可用架构</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/grafana/"><span>Grafana</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/streaming/"><span>基于流处理的可观测性架构</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>CICD</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Ansible</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/introduce/"><span>架构概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/command/"><span>相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/module/"><span>常用模块</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/playbook/"><span>PlayBook</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>SRE</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/SRE/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Python</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>python基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>线性表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>列表</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>元组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字符串</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>哈希表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>封装与解构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>集合</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字典</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>解析式与生成器表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>函数</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>IO操作</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>面向对象编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>并发编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>网络编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>数据库编程</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Django</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/paper4.png);"><nav id="nav"><!-- 左侧博客信息区域--><span id="blog-info"><a class="nav-site-title" href="/"></a><a class="nav-page-title" href="/"><span class="site-name">Exporter</span></a></span><!-- 新增的导航菜单容器（居中布局关键）--><div id="nav-menus-container"><!-- 菜单主体部分--><div id="menus"><!-- 菜单项--><div class="menus_items"><!-- 一级菜单项（非目录）--><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>计算机基础</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>计算机组成原理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/hardware-composition/"><span>计算机硬件组成</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/CPU/"><span>CPU</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/memory/"><span>内存</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/computer-composition/hard-disk/"><span>硬盘</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>操作系统</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/concept/"><span>操作系统的概念</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/processes-threads/"><span>进程与线程</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/ComputerBasic/operating-system/IO-model/"><span>IO模型</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Linux</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>linux基础</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/introduce/"><span>linux介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/file-structure-and-IO-redirects/"><span>文件结构与IO重定向</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/file-command/"><span>文件管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/text-command/"><span>文本管理工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/GSA/"><span>文本处理三剑客</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/user-permission/"><span>用户和权限管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/basics/regular-expression/"><span>正则表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/software-manage/"><span>软件包管理</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>进程管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/command/"><span>进程相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/signal/"><span>信号发送</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/job-parallel/"><span>作业管理与并行运行</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/process-manage/OOM/"><span>OOM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>磁盘管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/disk-partition/"><span>磁盘分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/file-system/"><span>文件系统</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/swap/"><span>Swap分区</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/disk-manage/LVM/"><span>逻辑卷管理器LVM</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>网络管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/configuration/"><span>网络配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/test-diagnostic/"><span>网络测试诊断工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/bridge/"><span>网桥配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/network-manage/troubleshoot/"><span>网络问题排查</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务管理</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/DNS/"><span>域名DNS解析服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/time-synchronization/"><span>时间同步服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/plan-tasks/"><span>计划任务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/log/"><span>日志服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/data-synchronization/"><span>数据的实时同步</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/ssh/"><span>ssh远程连接服务</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/service-manage/mail/"><span>邮件服务</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/kernel-manage/"><span>内核和启动管理</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>防火墙</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/introduce/"><span>安全技术和防火墙</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/iptables/"><span>iptables</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/firewalld/"><span>firewalld</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/firewall/nft/"><span>nft</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>加密和安全</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/security-mechanisms/"><span>安全机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/OpenSSL/"><span>OpenSSL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/sudo/"><span>sudo实现授权</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/encryption-security/PAM/"><span>PAM认证机制</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>shell编程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/introduce/"><span>shell脚本介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/variable/"><span>变量</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/operations-conditional/"><span>运算和条件测试</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-control/"><span>流程控制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/function/"><span>函数</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/array/"><span>数组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/string/"><span>字符串</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/script-tools/"><span>脚本相关工具</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/process-lock/"><span>进程锁</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Linux/shell/queue/"><span>队列实现线程并发控制</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Linux/system-optimization/"><span>系统优化</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>数据库</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>MySQL</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/DataBase/MySQL/SQL/"><span>SQL语句</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Redis</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/DataBase/Redis/deploy/"><span>部署安装</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>中间件</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Nginx</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Nginx/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>HAProxy</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/HAProxy/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Keepalived</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Keepalived/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kafka</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Kafka/111/"><span>111</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Tomcat</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Middleware/Tomcat/111/"><span>111</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>日志</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>存储</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Storage/conspect/"><span>存储概论</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Storage/nfs/"><span>NFS</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>容器</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/basics/"><span>容器基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Docker</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/conspect/"><span>Docker概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/image/"><span>镜像管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/container/"><span>容器管理命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/volume/"><span>数据卷</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/network/"><span>网络管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/docker/compose/"><span>Docker-Compose</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>镜像</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/conspect/"><span>镜像概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/dockerfile/"><span>dockerfile</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/build/"><span>构建镜像</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/mirror/harbor/"><span>镜像仓库</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>容器进程</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/management/"><span>容器里的进程管理</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/cpu-cgroup/"><span>cpu cgroup使用</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Container/process/cpu-usage/"><span>监控容器真实的cpu使用率</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/memory/"><span>容器内存</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/storage/"><span>容器存储</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/network/"><span>容器网络</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/safe/"><span>容器安全</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Container/containerd/"><span>Containerd</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>K8s</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Kubernetes概论</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/architecture/"><span>Kubernetes架构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/cri/"><span>容器运行时接口CRI</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/list-watch/"><span>List-Watch机制</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/object/"><span>Kubernetes对象</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/namespace/"><span>Namespace</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/conspect/kubectl/"><span>kubectl命令</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>部署安装</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/explanation/"><span>部署说明</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/docker/"><span>基于docker部署k8s-v1.30</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/containerd/"><span>基于containerd部署k8s-v1.30</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/deploy/cluster/"><span>集群管理指南</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Pod</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/conspect/"><span>Pod概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/configuration/"><span>Pod的配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/schedule/"><span>Pod的调度</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/pod/eviction/"><span>Pod的驱逐</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>控制器</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/introduce/"><span>控制器介绍</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/deployment/"><span>Deployment</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/statefulset/"><span>StatefulSet</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/daemonset/"><span>DaemonSet</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/job-cronjob/"><span>Job和CronJob</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/HPA/"><span>HPA</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/controller/operator/"><span>Operator</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>服务发现与负载均衡</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/service/"><span>Service</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/ingress/"><span>Ingress</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/coredns/"><span>CoreDNS</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/service-loadbalancer/localdns/"><span>LocalDNS</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>数据存储持久化</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/csi/"><span>存储接口CSI</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/pv-pvc/"><span>PV和PVC</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/storageclass/"><span>StorageClass</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/data-storage/configmap-secret/"><span>ConfigMap和Secret</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>认证与鉴权体系</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/conspect/"><span>体系概论</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/kubeconfig/"><span>kubeconfig</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/user-account/"><span>User Account</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Kubernetes/certification-authentication/service-account/"><span>Service Account</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>监控</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/conspect/"><span>监控概论</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Prometheus</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/introduce/"><span>prometheus概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/exporter/"><span>Exporter</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/promql/"><span>PromQL</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/query-persist/"><span>查询结果持久化</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/service-discovery/"><span>服务发现</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/indicators-remarked/"><span>指标重新打标</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/pushmanager/"><span>Pushmanager</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/prometheus/cluster-ha/"><span>集群与高可用</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Alertmanager</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/introduce/"><span>告警功能概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/alarm/"><span>实现告警功能</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/Monitor/alertmanager/ha/"><span>高可用架构</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/grafana/"><span>Grafana</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/Monitor/streaming/"><span>基于流处理的可观测性架构</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>CICD</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>Ansible</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/introduce/"><span>架构概述</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/deploy/"><span>部署与配置</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/command/"><span>相关命令</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/module/"><span>常用模块</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/CICD/ansible/playbook/"><span>PlayBook</span></a></li></ul></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>SRE</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/SRE/111/"><span>111</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Python</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>python基础</span></a></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>线性表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>列表</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>元组</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字符串</span></a></li></ul></li><!-- 二级目录（包含三级菜单）--><li class="menus_item_second"><span class="site-page group second"><span>哈希表</span><i class="fas fa-chevron-right"></i></span><ul class="menus_item_child_second"><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>封装与解构</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>集合</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>字典</span></a></li><!-- 三级菜单项--><li><a class="site-page third" href="/python/111/"><span>解析式与生成器表达式</span></a></li></ul></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>函数</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>IO操作</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>面向对象编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>并发编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>网络编程</span></a></li><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/python/111/"><span>数据库编程</span></a></li></ul></div><!-- 一级目录（包含二级菜单）--><div class="menus_item"><span class="site-page group"><span>Django</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><!-- 二级菜单项（非目录）--><li><a class="site-page child" href="/ELK/111/"><span>111</span></a></li></ul></div></div></div></div><!-- 右侧功能区域（新增容器）--><div id="nav-right-container"><!-- 搜索按钮（移动到右侧）--><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i></span></div><!-- 移动端汉堡菜单按钮--><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Exporter</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-08-27T10:16:32.000Z" title="发表于 2025-08-27 18:16">2025-08-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-12T09:16:45.147Z" title="更新于 2025-09-12 17:16">2025-09-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/monitor/">监控</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">7.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>33分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="1-Exporter基础"><a href="#1-Exporter基础" class="headerlink" title="1 Exporter基础"></a>1 Exporter基础</h1><p>Exporter是Prometheus的指标数据收集组件。它负责从目标Jobs收集数据，并把收集到的数据转换为Prometheus支持的时序数据格式。 和传统的指标数据收集组件不同的是，他只负责收集，并不向Server端发送数据，而是等待Prometheus Server 主动抓取(pull)</p>
<p>对于那些未内建Instrumentation，且也不便于自行添加该类组件以暴露指标数据的应用程序来说，常用的办法是于待监控的目标应用程序外部运行一个独立指标暴露程序，该类型的程序即统称为Exporter；换句话说，Exporter负责从目标应用程序上采集和聚合原始格式的数据，并转换或聚合为Prometheus格式的指标向外暴露；</p>
<p>对于那些非由用户可直接控制的应用代码来说，为其添加客户端库以进行直接测量很难实现</p>
<ul>
<li>操作系统内核就是一个典型的示例，它显然不大可能易于实现添加自定义代码通过HTTP协议输出Prometheus格式的指标</li>
<li>但这一类的程序一般都会通常某种接口输出其内在的指标，只不过这些指标可能有着特殊的格式，例如Linux内核的特有指标格式，或者SNMP指标格式等</li>
<li>这些指标需要对它进行适当的解析和处理以转换为合用的目标格式，Exporter（指标暴露器）是完成此类转换功能的应用程序</li>
</ul>
<p>Exporter独立运行于要获取其测量指标的应用程序之外，负责接收来自于Prometheus Server的指标获取请求，它通过目标应用程序（真正的目标）内置的指标接口获取指标数据，并将这些指标数据转换为合用的目标格式后响应给Prometheus</p>
<ul>
<li>Exporter更像是“一对一”的代理，它作为Prometheus Server的target存在，工作于应用程序的指标接口和Prometheus的文本指标格式之间转换数据格式</li>
<li>但Exporter不存储也不缓存任何数据</li>
</ul>
<h1 id="2-Node-Export"><a href="#2-Node-Export" class="headerlink" title="2 Node Export"></a>2 Node Export</h1><h2 id="2-1-二进制部署"><a href="#2-1-二进制部署" class="headerlink" title="2.1 二进制部署"></a>2.1 二进制部署</h2><p>每个被监控的主机节点上均应该部署node-exporter，用于监控系统级指标</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2004:~# wget https://github.com/prometheus/node_exporter/releases/download/v1.8.2/node_exporter-1.8.2.linux-amd64.tar.gz</span><br><span class="line">root@ubuntu2004:~# tar xf node_exporter-1.8.2.linux-amd64.tar.gz -C /usr/local/</span><br><span class="line">root@ubuntu2004:~# <span class="built_in">ln</span> -sv /usr/local/node_exporter-1.8.2.linux-amd64/ /usr/local/node_exporter</span><br><span class="line"><span class="string">&#x27;/usr/local/node_exporter&#x27;</span> -&gt; <span class="string">&#x27;/usr/local/node_exporter-1.8.2.linux-amd64/&#x27;</span></span><br><span class="line"></span><br><span class="line">root@ubuntu2004:~# <span class="built_in">ls</span> /usr/local/node_exporter</span><br><span class="line">LICENSE  node_exporter  NOTICE</span><br><span class="line"></span><br><span class="line">root@ubuntu2004:~# vim /usr/lib/systemd/system/node_exporter.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=node_exporter</span><br><span class="line">Documentation=https://prometheus.io/docs/introduction/overview/</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">User=prometheus</span><br><span class="line">ExecStart=/usr/local/node_exporter/node_exporter \</span><br><span class="line">  --collector.ntp \</span><br><span class="line">  --collector.mountstats \</span><br><span class="line">  --collector.systemd \</span><br><span class="line">  --collector.ethtool \</span><br><span class="line">  --collector.tcpstat</span><br><span class="line">ExecReload=/bin/kill -HUP <span class="variable">$MAINPID</span></span><br><span class="line">TimeoutStopSec=20s</span><br><span class="line">Restart=always</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">root@ubuntu2004:~# systemctl daemon-reload</span><br><span class="line">root@ubuntu2004:~# systemctl start node_exporter.service</span><br><span class="line">root@ubuntu2004:~# systemctl <span class="built_in">enable</span> node_exporter.service</span><br><span class="line"></span><br><span class="line">root@ubuntu2004:~# ss -tnlp | grep <span class="string">&#x27;9100&#x27;</span></span><br><span class="line">LISTEN    0         4096                     *:9100                   *:*        <span class="built_in">users</span>:((&quot;node_exporter&quot;,pid=<span class="number">6011</span>,fd=<span class="number">7</span>))    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看指标数据，HELP解释当前指标的含义，TYPE说明当前指标的数据类型</span></span><br><span class="line">root@ubuntu2004:~#curl localhost:9100/metrics | less</span><br><span class="line"><span class="comment"># HELP node_cpu Seconds the cpus spent in each mode.</span></span><br><span class="line"><span class="comment"># TYPE node_cpu counter</span></span><br><span class="line">node_cpu&#123;cpu=<span class="string">&quot;cpu0&quot;</span>,mode=<span class="string">&quot;idle&quot;</span>&#125; 362812.7890625</span><br><span class="line"><span class="comment"># HELP node_load1 1m load average.</span></span><br><span class="line"><span class="comment"># TYPE node_load1 gauge</span></span><br><span class="line">node_load1 3.0703125</span><br></pre></td></tr></table></figure>

<p>选项 <code>--collector.&lt;name&gt;</code> 用于指定启用的collector</p>
<p>默认即启用的collector，可使用选项 <code>--no-collector.&lt;name&gt;</code> 禁用</p>
<p>编辑Prometheus配置文件，去采集Node Exporter暴露出来的指标数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2004:~# vim /usr/local/prometheus/prometheus.yml</span><br><span class="line">scrape_configs:</span><br><span class="line">  - job_name: <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [<span class="string">&quot;localhost:9090&quot;</span>]</span><br><span class="line">      </span><br><span class="line">  <span class="comment"># 添加以下三项</span></span><br><span class="line">  - job_name: <span class="string">&quot;linux&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [<span class="string">&quot;localhost:9100&quot;</span>]</span><br><span class="line"></span><br><span class="line">root@ubuntu2004:~# /usr/local/prometheus/promtool check config /usr/local/prometheus/prometheus.yml</span><br><span class="line">root@ubuntu2004:~# systemctl reload prometheus.service</span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line">curl -XPOST localhost:9090/-/reload</span><br><span class="line"></span><br><span class="line">访问http://localhost:9090/config</span><br></pre></td></tr></table></figure>

<h2 id="2-2-容器部署"><a href="#2-2-容器部署" class="headerlink" title="2.2 容器部署"></a>2.2 容器部署</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3.6&#x27;</span></span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  monitoring:</span><br><span class="line">    driver: bridge</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  node-exporter:</span><br><span class="line">    image: bitnami/node-exporter:1.8.2</span><br><span class="line">    container_name: node-exporter</span><br><span class="line">    volumes:</span><br><span class="line">      - /proc:/host/proc:ro</span><br><span class="line">      - /sys:/host/sys:ro</span><br><span class="line">      - /:/rootfs:ro</span><br><span class="line">    <span class="built_in">command</span>:</span><br><span class="line">      - <span class="string">&#x27;--path.procfs=/host/proc&#x27;</span></span><br><span class="line">      - <span class="string">&#x27;--path.sysfs=/host/sys&#x27;</span></span><br><span class="line">      - <span class="string">&#x27;--collector.filesystem.mount-points-exclude=^/(sys|proc|dev|host|etc)($$|/)&#x27;</span></span><br><span class="line">      <span class="comment">#- &#x27;--collector.filesystem.ignored-mount-points=^/(sys|proc|dev|host|etc|rootfs/var/lib/docker)($$|/)&#x27;</span></span><br><span class="line">      - <span class="string">&#x27;--path.rootfs=/rootfs&#x27;</span></span><br><span class="line">    ports:</span><br><span class="line">      - 9100:9100</span><br><span class="line">    networks:</span><br><span class="line">      - monitoring</span><br><span class="line">    restart: always</span><br></pre></td></tr></table></figure>

<ul>
<li><code>--path.procfs=/host/proc</code>: 指定 <code>/proc</code> 文件系统的路径。</li>
<li><code>--path.sysfs=/host/sys</code>: 指定 <code>/sys</code> 文件系统的路径。</li>
<li><code>--collector.filesystem.mount-points-exclude</code> 和 <code>--collector.filesystem.ignored-mount-points</code>: 排除某些特定的挂载点，避免不必要的文件系统指标被收集。</li>
<li><code>--path.rootfs=/rootfs</code>: 指定根文件系统的路径。</li>
</ul>
<h2 id="2-3-Node-Exporter的指标"><a href="#2-3-Node-Exporter的指标" class="headerlink" title="2.3 Node Exporter的指标"></a>2.3 Node Exporter的指标</h2><p>启用或禁用Node Exporter内生支持的指标</p>
<ul>
<li>通过提供 <code>--collector.&lt;name&gt;</code> 标志来启用收集器。</li>
<li>可以通过提供 <code>--no-collector.&lt;name&gt;</code> 标志来禁用默认启用的收集器。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">node_boot_time	<span class="comment">#系统启动时间</span></span><br><span class="line">node_cpu		<span class="comment">#系统CPU使用量</span></span><br><span class="line">nodedisk*		<span class="comment">#磁盘IO</span></span><br><span class="line">nodefilesystem*	<span class="comment">#文件系统用量</span></span><br><span class="line">node_load1		<span class="comment">#系统负载</span></span><br><span class="line">nodememeory*	<span class="comment">#内存使用量</span></span><br><span class="line">nodenetwork*	<span class="comment">#网络带宽</span></span><br><span class="line">node_time		<span class="comment">#当前系统时间</span></span><br><span class="line">go_*			<span class="comment">#node exporter中go相关指标</span></span><br><span class="line">process_*		<span class="comment">#node exporter自身进程相关运行指标</span></span><br></pre></td></tr></table></figure>

<p>常用指标</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">node_cpu_seconds_total</span><br><span class="line">node_memory_MemTotal_bytes</span><br><span class="line">node_filesystem_size_bytes&#123;mount_point=PATH&#125;</span><br><span class="line">node_system_unit_state&#123;name=&#125;</span><br><span class="line">node_vmstat_pswpin					<span class="comment">#系统每秒从磁盘读到内存的字节数；</span></span><br><span class="line">node_vmstat_pswpout					<span class="comment">#系统每秒钟从内存写到磁盘的字节数；</span></span><br></pre></td></tr></table></figure>

<p>相关文档</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/prometheus/node_exporter</span><br></pre></td></tr></table></figure>

<h3 id="2-3-1-CPU监控"><a href="#2-3-1-CPU监控" class="headerlink" title="2.3.1 CPU监控"></a>2.3.1 CPU监控</h3><p>CPU的监控项名称是：node_cpu_seconds_total，使用总量</p>
<p>直接执行node_cpu_seconds_total查询后会出现很多监控指标，显然不是想要的</p>
<p>node_cpu_seconds_total执行后会出现很多监控指标，其中各种类型的比如系统态、用户态都会由mode标签来区分</p>
<p>我们想要查询CPU的使用率的思路是：查出当前空闲的CPU百分比，最后用100减去，mode标签值idle就表示当前空闲的CPU值</p>
<p><img src="/Monitor/prometheus/exporter/1753692757446-ee91efbe-0794-4205-a44b-1be40bcf1995.png" alt="img"></p>
<p>cpu&#x3D;”0”代表第1核cpu，cpu&#x3D;”1”代表第2核cpu</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取空闲cpu监控数据，mode标签值为idle的为空闲（user代表mode为用户，system代表mode为系统...）</span></span><br><span class="line">node_cpu_seconds_total&#123;mode=<span class="string">&#x27;idle&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取某台监控机器的cpu数据，instance标签值为centos2服务器的cpu数据</span></span><br><span class="line">node_cpu_seconds_total&#123;instance=<span class="string">&#x27;centos2服务器&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取1分钟/5分钟/15分钟的cpu负载</span></span><br><span class="line">node_load1</span><br><span class="line">node_load5</span><br><span class="line">node_load15</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取5分钟内的监控数据</span></span><br><span class="line">node_cpu_seconds_total&#123;mode=<span class="string">&#x27;idle&#x27;</span>&#125;[5m]</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取5分钟内的cpu平均空闲状况</span></span><br><span class="line">avg(irate(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;idle&#x27;</span>&#125;[5m])) by (instance)</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取cpu5分钟内的使用率</span></span><br><span class="line">100 - (avg(irate(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;idle&#x27;</span>&#125;[5m])) by (instance) *100)</span><br></pre></td></tr></table></figure>

<h3 id="2-3-2-内存监控"><a href="#2-3-2-内存监控" class="headerlink" title="2.3.2 内存监控"></a>2.3.2 内存监控</h3><p>由于内存的监控项没有像CPU一样区分了很多标签，因此内存监控相较于CPU则需要结合很多个监控项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">node_memory_MemFree_bytes 	<span class="comment">#空闲内存</span></span><br><span class="line">node_memory_MemTotal_bytes 	<span class="comment">#总内存</span></span><br><span class="line">node_memory_Cached_bytes 	<span class="comment">#缓存</span></span><br><span class="line">node_memory_Buffers_bytes 	<span class="comment">#缓冲区内存</span></span><br></pre></td></tr></table></figure>

<p>监控内存使用的思路：</p>
<ol>
<li>空闲内存+缓存+缓冲区内存得出空闲总内存</li>
<li>得出的空闲总内存再除总内存大小再乘100，得出空闲率</li>
<li>再用100 - 空闲率就得出使用率</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取空闲内存</span></span><br><span class="line">(node_memory_MemFree_bytes+node_memory_Cached_bytes+node_memory_Buffers_bytes)</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取空闲内存率</span></span><br><span class="line">(node_memory_MemFree_bytes+node_memory_Cached_bytes+node_memory_Buffers_bytes) / node_memory_MemTotal_bytes * 100</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取内存使用率</span></span><br><span class="line">100 - ((node_memory_MemFree_bytes+node_memory_Cached_bytes+node_memory_Buffers_bytes) / node_memory_MemTotal_bytes * <span class="number">100</span>)</span><br></pre></td></tr></table></figure>

<h3 id="2-3-3-磁盘使用率"><a href="#2-3-3-磁盘使用率" class="headerlink" title="2.3.3 磁盘使用率"></a>2.3.3 磁盘使用率</h3><p>关于磁盘使用率，这里我们用到的主要有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node_filesystem_free_bytes <span class="comment">#剩余磁盘空间</span></span><br><span class="line">node_filesystem_size_bytes <span class="comment">#磁盘空间总大小</span></span><br><span class="line">node_disk相关</span><br></pre></td></tr></table></figure>

<p>这两个监控项中都有相同的标签可以关联，我们这里用到的标签有fstype，fstype标签值是关于磁盘的文件系统类型，对于磁盘监控，我们主要对xfs、ext4等文件系统的磁盘进行监控，像tmpfs这种的不必要监控，另一个主要的标签是mountpoint，这个标签值主要用来储存磁盘的挂载点，我们可以通过标签来选择要对那个挂载点的磁盘进行监控</p>
<p>磁盘使用率实现思路：</p>
<p> 1.由磁盘空闲容量除磁盘总容量乘100即可得到磁盘空闲率</p>
<p> 2.用100减磁盘空闲率即可得到磁盘使用率</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取磁盘空闲率</span></span><br><span class="line">node_filesystem_free_bytes&#123;fstype=~<span class="string">&quot;ext4|xfs&quot;</span>,mountpoint=<span class="string">&quot;/&quot;</span>&#125; / node_filesystem_size_bytes&#123;fstype=~<span class="string">&quot;ext4|xfs&quot;</span>,mountpoint=<span class="string">&quot;/&quot;</span>&#125; *100</span><br><span class="line"><span class="built_in">df</span> -hT  <span class="comment">#linux中获取磁盘空闲率命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#获取磁盘使用率</span></span><br><span class="line">100 - (node_filesystem_free_bytes&#123;fstype=~<span class="string">&quot;ext4|xfs&quot;</span>,mountpoint=<span class="string">&quot;/&quot;</span>&#125; / node_filesystem_size_bytes&#123;fstype=~<span class="string">&quot;ext4|xfs&quot;</span>,mountpoint=<span class="string">&quot;/&quot;</span>&#125; *100)</span><br></pre></td></tr></table></figure>

<h3 id="2-3-4-网络采集"><a href="#2-3-4-网络采集" class="headerlink" title="2.3.4 网络采集"></a>2.3.4 网络采集</h3><p>node_network_ 相关都属于网络采集数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#网络流出流量</span></span><br><span class="line">node_network_transmit_bytes_total</span><br><span class="line"><span class="comment">#网络流入流量  </span></span><br><span class="line">node_network_receive_bytes_total</span><br></pre></td></tr></table></figure>

<h3 id="2-3-5-系统服务状态"><a href="#2-3-5-系统服务状态" class="headerlink" title="2.3.5 系统服务状态"></a>2.3.5 系统服务状态</h3><p>监控服务的状态，例如nginx、docker这种服务器的启动状态</p>
<p>node_exporter是根据systemd去监控的，因此只有能用systemctl启动的服务器才能被监控到</p>
<p>配置非常简单，只需要在启动时开启system监控，并指定监控什么服务即可</p>
<p>配置system监控的参数：</p>
<ul>
<li><code>--collector.systemd</code></li>
<li><code>--collector.systemd.unit-whitelist=&quot;.+&quot;</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/lib/systemd/system/node_exporter.service </span><br><span class="line">ExecStart=/data/node_exporter/node_exporter --collector.systemd --collector.systemd.unit-whitelist=(docker|sshd|node_exporter).service</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload </span><br><span class="line">systemctl restart node_exporter.service </span><br></pre></td></tr></table></figure>

<p>以docker为例，我们查询docker存活状态</p>
<p>node_systemd_unit_state 使用这个监控项查看，里面也有很多标签，<code>name=“docker.service”</code>，标签name表示服务的名称， <code>state=“active”</code>，state表示服务的状态，active表示活动的，对应的监控值也是1，如果为1则表示正常，不为1表示异常</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node_systemd_unit_state&#123;name=<span class="string">&quot;docker.service&quot;</span>, state=<span class="string">&quot;active&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-4-适用于主机监控的USE方法"><a href="#2-4-适用于主机监控的USE方法" class="headerlink" title="2.4 适用于主机监控的USE方法"></a>2.4 适用于主机监控的USE方法</h2><p>对CPU来说，USE通常意味着如下概念</p>
<ul>
<li>CPU使用率随时间的百分比；</li>
<li>CPU饱和度，等待CPU的进程数；</li>
<li>错误，通常对CPU不太有影响；</li>
</ul>
<p>对内存来说，USE的意义相似</p>
<ul>
<li>内存使用率随时间的百分比；</li>
<li>内存饱和度，可通过监控swap进行测量；</li>
<li>错误，通常不太关键；</li>
</ul>
<h3 id="2-4-1-CPU使用率"><a href="#2-4-1-CPU使用率" class="headerlink" title="2.4.1 CPU使用率"></a>2.4.1 CPU使用率</h3><p>每台主机CPU在5分钟内的平均使用率</p>
<p><img src="/Monitor/prometheus/exporter/1753692772124-de9b0caa-2972-4e8b-a4b3-cd49d65803ae.png" alt="img"></p>
<h3 id="2-4-2-CPU的饱和度"><a href="#2-4-2-CPU的饱和度" class="headerlink" title="2.4.2 CPU的饱和度"></a>2.4.2 CPU的饱和度</h3><p>跟踪CPU的平均负载就能获取到相关主机的CPU饱和度，实际上，它是将主机上的CPU数量考虑在内的一段时间内的平均运行队列长度</p>
<p>平均负载少于CPU的数量是正常状况，而长时间内超过CPU数量则表示CPU已然饱和；</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查询1分钟平均负载超过主机CPU数量两倍的时间序列</span></span><br><span class="line">node_load1 &gt; on (instance)  2 * count (node_cpu_seconds_total&#123;mode=<span class="string">&quot;idle&quot;</span>&#125;) by (instance)</span><br></pre></td></tr></table></figure>

<p><img src="/Monitor/prometheus/exporter/1753692785555-570913fd-f9d1-4310-99bf-86fb6c01642e.png" alt="img"></p>
<h3 id="2-4-3-内存使用率"><a href="#2-4-3-内存使用率" class="headerlink" title="2.4.3 内存使用率"></a>2.4.3 内存使用率</h3><p>node_exporter暴露了多个以node_memory为前缀的指标，我们重点关注如下几个</p>
<ul>
<li>node_memory_MemTotal_bytes</li>
<li>node_memory_MemFree_bytes</li>
<li>node_memory_Buffers_bytes</li>
<li>node_memory_Cached_bytes</li>
</ul>
<p>计算使用率</p>
<ul>
<li>可用空间：上面后三个指标之和；</li>
<li>已用空间：总空间减去可用空间；</li>
<li>使用率：已用空间除以总空间</li>
</ul>
<p><img src="/Monitor/prometheus/exporter/1753692794136-de0448d8-3636-4939-8daf-827d6528b375.png" alt="img"></p>
<h1 id="3-MySQL-Exporter"><a href="#3-MySQL-Exporter" class="headerlink" title="3 MySQL Exporter"></a>3 MySQL Exporter</h1><h2 id="3-1-容器部署"><a href="#3-1-容器部署" class="headerlink" title="3.1 容器部署"></a>3.1 容器部署</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2004:~# <span class="built_in">cd</span> learning-prometheus/08-prometheus-components-compose/mysqld-and-exporter/</span><br><span class="line">root@ubuntu2004:mysqld-and-exporter# vim docker-compose.yml </span><br><span class="line">version: <span class="string">&#x27;3.6&#x27;</span></span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">    mysqld_data: &#123;&#125;</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  monitoring:</span><br><span class="line">    driver: bridge</span><br><span class="line">    ipam:</span><br><span class="line">      config:</span><br><span class="line">        - subnet: 192.168.0.0/24</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  mysqld:</span><br><span class="line">    image: mysql:8.0</span><br><span class="line">    volumes:</span><br><span class="line">      - ./mysql:/etc/mysql/conf.d</span><br><span class="line">      - mysqld_data:/var/lib/mysql</span><br><span class="line">    environment:</span><br><span class="line">      - MYSQL_ALLOW_EMPTY_PASSWORD=<span class="literal">true</span></span><br><span class="line">    networks:</span><br><span class="line">      - monitoring</span><br><span class="line">    ports:</span><br><span class="line">      - 3306:3306</span><br><span class="line"></span><br><span class="line">  <span class="comment"># CREATE USER &#x27;exporter&#x27;@&#x27;192.168.%.%&#x27; IDENTIFIED BY &#x27;exporter&#x27;;</span></span><br><span class="line">  <span class="comment"># GRANT PROCESS, REPLICATION CLIENT ON *.* TO &#x27;exporter&#x27;@&#x27;192.168.%.%&#x27;;</span></span><br><span class="line">  <span class="comment"># GRANT SELECT ON performance_schema.* TO &#x27;exporter&#x27;@&#x27;192.168.%.%&#x27;;</span></span><br><span class="line">  mysqld-exporter:</span><br><span class="line">    image: prom/mysqld-exporter:v0.16.0</span><br><span class="line">    <span class="built_in">command</span>:</span><br><span class="line">     - --mysqld.username=exporter:exporter</span><br><span class="line">     - --mysqld.address=10.0.0.204:3306</span><br><span class="line">     - --collect.info_schema.innodb_metrics</span><br><span class="line">     - --collect.info_schema.innodb_tablespaces</span><br><span class="line">     - --collect.perf_schema.eventsstatementssum</span><br><span class="line">     - --collect.perf_schema.memory_events</span><br><span class="line">     - --collect.global_status</span><br><span class="line">     - --collect.engine_innodb_status</span><br><span class="line">     - --collect.binlog_size</span><br><span class="line">    environment:</span><br><span class="line">      - DATA_SOURCE_NAME=exporter:exporter@(mysqld:3306)/</span><br><span class="line">    ports:</span><br><span class="line">      - 9104:9104</span><br><span class="line">    networks:</span><br><span class="line">      - monitoring</span><br><span class="line">    depends_on:</span><br><span class="line">      - mysqld</span><br><span class="line">      </span><br><span class="line">root@ubuntu2004:~# docker-compose pull</span><br><span class="line">root@ubuntu2004:~# docker-compose up</span><br><span class="line">root@ubuntu2004:~# docker-compose ps</span><br><span class="line">NAME                     IMAGE                          COMMAND                  SERVICE           CREATED          STATUS          PORTS</span><br><span class="line">root-mysqld-1            mysql:8.0                      <span class="string">&quot;docker-entrypoint.s…&quot;</span>   mysqld            11 hours ago     Up 11 seconds   0.0.0.0:3306-&gt;3306/tcp, :::3306-&gt;3306/tcp, 33060/tcp</span><br><span class="line">root-mysqld-exporter-1   prom/mysqld-exporter:v0.16.0   <span class="string">&quot;/bin/mysqld_exporte…&quot;</span>   mysqld-exporter   11 seconds ago   Up 10 seconds   0.0.0.0:9104-&gt;9104/tcp, :::9104-&gt;9104/tcp</span><br><span class="line"></span><br><span class="line">root@ubuntu2004:~# ss -ntl | grep -E <span class="string">&#x27;(3306|9104)&#x27;</span></span><br><span class="line">LISTEN   0        4096             0.0.0.0:3306          0.0.0.0:*              </span><br><span class="line">LISTEN   0        4096             0.0.0.0:9104          0.0.0.0:*              </span><br><span class="line">LISTEN   0        4096                [::]:3306             [::]:*              </span><br><span class="line">LISTEN   0        4096                [::]:9104             [::]:*              </span><br><span class="line"></span><br><span class="line">root@ubuntu2004:~# docker-compose <span class="built_in">exec</span> mysqld /bin/sh</span><br><span class="line">sh-5.1# mysql</span><br><span class="line">mysql&gt; CREATE USER <span class="string">&#x27;exporter&#x27;</span>@<span class="string">&#x27;192.168.%.%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;exporter&#x27;</span>;</span><br><span class="line">mysql&gt; GRANT PROCESS, REPLICATION CLIENT ON *.* TO <span class="string">&#x27;exporter&#x27;</span>@<span class="string">&#x27;192.168.%.%&#x27;</span>;</span><br><span class="line">mysql&gt; GRANT SELECT ON performance_schema.* TO <span class="string">&#x27;exporter&#x27;</span>@<span class="string">&#x27;192.168.%.%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看指标</span></span><br><span class="line">root@ubuntu2004:~# curl localhost:9104/metrics</span><br></pre></td></tr></table></figure>

<p>编辑Prometheus配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2004:~# vim /usr/local/prometheus/prometheus.yml </span><br><span class="line">scrape_configs:</span><br><span class="line">  <span class="comment"># 添加下列</span></span><br><span class="line">  - job_name: <span class="string">&quot;mysql&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [<span class="string">&quot;10.0.0.204:9104&quot;</span>]</span><br><span class="line">      </span><br><span class="line">root@ubuntu2004:~# systemctl reload prometheus.service </span><br></pre></td></tr></table></figure>

<h2 id="3-2-二进制部署"><a href="#3-2-二进制部署" class="headerlink" title="3.2 二进制部署"></a>3.2 二进制部署</h2><p>MySQL</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装略</span></span><br><span class="line"><span class="comment"># 创建用户并授权</span></span><br><span class="line">mysql&gt; CREATE USER <span class="string">&#x27;exporter&#x27;</span>@<span class="string">&#x27;192.168.%.%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;exporter&#x27;</span>;</span><br><span class="line">mysql&gt; GRANT PROCESS, REPLICATION CLIENT ON *.* TO <span class="string">&#x27;exporter&#x27;</span>@<span class="string">&#x27;192.168.%.%&#x27;</span>;</span><br><span class="line">mysql&gt; GRANT SELECT ON performance_schema.* TO <span class="string">&#x27;exporter&#x27;</span>@<span class="string">&#x27;192.168.%.%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>MySQL Exporter</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky8 ~]# wget https://github.com/prometheus/mysqld_exporter/releases/download/v0.16.0/mysqld_exporter-0.16.0.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">[root@rocky8 ~]#<span class="built_in">cd</span> /usr/local/</span><br><span class="line">[root@rocky8 <span class="built_in">local</span>]#<span class="built_in">ln</span> -sv mysqld_exporter-0.16.0.linux-amd64 mysqld_exporter</span><br><span class="line"></span><br><span class="line">[root@rocky8 <span class="built_in">local</span>]#<span class="built_in">cd</span> mysqld_exporter</span><br><span class="line">[root@rocky8 mysqld_exporter]#<span class="built_in">ls</span></span><br><span class="line">LICENSE  mysqld_exporter  NOTICE</span><br><span class="line"></span><br><span class="line">[root@rocky8 mysqld_exporter]# vim .my.cnf</span><br><span class="line">[client]</span><br><span class="line">user=exporter</span><br><span class="line">password=exporter</span><br><span class="line"></span><br><span class="line">[root@rocky8 mysqld_exporter]#vim /usr/lib/systemd/system/mysqld_exporter.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=consul_exporter</span><br><span class="line">Documentation=https://prometheus.io/docs/introduction/overview/</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">User=mysql</span><br><span class="line">EnvironmentFile=-/etc/default/mysqld_exporter</span><br><span class="line"><span class="comment"># 具体使用时，若mysql_exporter与mysql server不在同一主机时，mysql server要指向实际的地址；</span></span><br><span class="line"><span class="comment"># mysql_exporter连接mysql server使用的用户名和密码均为exporter，该用户要获得正确的授权；</span></span><br><span class="line">Environment=<span class="string">&#x27;DATA_SOURCE_NAME=exporter:exporter@(localhost:3306)&#x27;</span></span><br><span class="line">ExecStart=/usr/local/mysqld_exporter/mysqld_exporter \</span><br><span class="line">            --config.my-cnf=/usr/local/mysqld_exporter/.my.cnf \</span><br><span class="line">            --web.listen-address=<span class="string">&quot;:9104&quot;</span> \</span><br><span class="line">            --web.telemetry-path=<span class="string">&quot;/metrics&quot;</span> \</span><br><span class="line">            --collect.info_schema.innodb_tablespaces \</span><br><span class="line">            --collect.info_schema.innodb_metrics \</span><br><span class="line">            --collect.global_status \</span><br><span class="line">            --collect.global_variables \</span><br><span class="line">            --collect.slave_status \</span><br><span class="line">            --collect.engine_innodb_status \</span><br><span class="line">            <span class="variable">$ARGS</span></span><br><span class="line">ExecReload=/bin/kill -HUP <span class="variable">$MAINPID</span></span><br><span class="line">TimeoutStopSec=20s</span><br><span class="line">Restart=always</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">[root@rocky8 mysqld_exporter]# systemctl daemon-reload</span><br><span class="line">[root@rocky8 mysqld_exporter]# systemctl start mysqld_exporter.service</span><br><span class="line">[root@rocky8 mysqld_exporter]# systemctl <span class="built_in">enable</span> mysqld_exporter.service</span><br></pre></td></tr></table></figure>

<h2 id="3-3-mysql服务器指标查询"><a href="#3-3-mysql服务器指标查询" class="headerlink" title="3.3 mysql服务器指标查询"></a>3.3 mysql服务器指标查询</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">mysql_up                                              <span class="comment"># 服务器是否在线</span></span><br><span class="line">mysql_global_status_uptime                            <span class="comment"># 运行时长，单位 s</span></span><br><span class="line">delta(mysql_global_status_bytes_received[1m])         <span class="comment"># 网络接收的 bytes</span></span><br><span class="line">delta(mysql_global_status_bytes_sent[1m])             <span class="comment"># 网络发送的 bytes</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql_global_status_threads_connected                 <span class="comment"># 当前的客户端连接数</span></span><br><span class="line">mysql_global_variables_max_connections                <span class="comment"># 允许的最大连接数</span></span><br><span class="line">mysql_global_status_threads_running                   <span class="comment"># 正在执行命令的客户端连接数，即非 sleep 状态</span></span><br><span class="line">delta(mysql_global_status_aborted_connects[1m])       <span class="comment"># 客户端建立连接失败的连接数，比如登录失败</span></span><br><span class="line">delta(mysql_global_status_aborted_clients[1m])        <span class="comment"># 客户端连接之后，未正常关闭的连接数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">delta(mysql_global_status_commands_total&#123;<span class="built_in">command</span>=<span class="string">&quot;xx&quot;</span>&#125;[1m]) &gt; 0     <span class="comment"># 每分钟各种命令的次数</span></span><br><span class="line">delta(mysql_global_status_handlers_total&#123;handler=<span class="string">&quot;xx&quot;</span>&#125;[1m]) &gt; 0     <span class="comment"># 每分钟各种操作的次数</span></span><br><span class="line">delta(mysql_global_status_handlers_total&#123;handler=<span class="string">&quot;commit&quot;</span>&#125;[1m]) &gt; 0 <span class="comment"># 每分钟 commit 的次数</span></span><br><span class="line">delta(mysql_global_status_table_locks_immediate[1m])  <span class="comment"># 请求获取锁，且立即获得的请求数</span></span><br><span class="line">delta(mysql_global_status_table_locks_waited[1m])     <span class="comment"># 请求获取锁，但需要等待的请求数。该值越少越好</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">delta(mysql_global_status_queries[1m])                <span class="comment"># 每分钟的查询数</span></span><br><span class="line">delta(mysql_global_status_slow_queries[1m])           <span class="comment"># 慢查询数。如果未启用慢查询日志，则为 0</span></span><br><span class="line">mysql_global_status_innodb_page_size                  <span class="comment"># innodb 数据页的大小，单位 bytes</span></span><br><span class="line">mysql_global_variables_innodb_buffer_pool_size        <span class="comment"># innodb_buffer_pool 的限制体积</span></span><br><span class="line">mysql_global_status_buffer_pool_pages&#123;state=<span class="string">&quot;data&quot;</span>&#125;   <span class="comment"># 包含数据的数据页数，包括洁页、脏页</span></span><br><span class="line">mysql_global_status_buffer_pool_dirty_pages           <span class="comment"># 脏页数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql_global_status_innodb_row_lock_current_waits     <span class="comment">#当前正在等待的 InnoDB 行锁数量。</span></span><br><span class="line">mysql_global_status_innodb_row_lock_time              <span class="comment">#从服务器启动以来的总 InnoDB 行锁等待时间（以毫秒为单位）。</span></span><br><span class="line">mysql_global_status_innodb_row_lock_time_avg          <span class="comment">#每次等待 InnoDB 行锁的平均时间（以毫秒为单位）</span></span><br><span class="line">mysql_global_status_innodb_row_lock_time_max          <span class="comment">#单次等待 InnoDB 行锁的最长时间（以毫秒为单位）。</span></span><br><span class="line">mysql_global_status_innodb_row_lock_waits             <span class="comment">#从服务器启动以来的总 InnoDB 行锁等待次数。</span></span><br></pre></td></tr></table></figure>

<h1 id="4-Mongodb-Exporter"><a href="#4-Mongodb-Exporter" class="headerlink" title="4 Mongodb Exporter"></a>4 Mongodb Exporter</h1><h2 id="4-1-容器部署"><a href="#4-1-容器部署" class="headerlink" title="4.1 容器部署"></a>4.1 容器部署</h2><p>docker-compose.yaml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  mongo:</span><br><span class="line">    image: mongo:4.2.5</span><br><span class="line">    container_name: mongo</span><br><span class="line">    restart: always</span><br><span class="line">    volumes:</span><br><span class="line">      - /data/mongo/db:/data/db</span><br><span class="line">    <span class="built_in">command</span>: [--auth]</span><br><span class="line">    ports:</span><br><span class="line">      - 27017:27017</span><br><span class="line">    environment:</span><br><span class="line">      MONGO_INITDB_ROOT_USERNAME: root</span><br><span class="line">      MONGO_INITDB_ROOT_PASSWORD: 123456</span><br><span class="line">      </span><br><span class="line">  mongodb_exporter:</span><br><span class="line">    image: ccr.ccs.tencentyun.com/rig-agent/mongodb-exporter:0.10.0</span><br><span class="line">    container_name: mongodb_exporter</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      MONGODB_URI: <span class="string">&quot;mongodb://exporter:password@192.168.28.110:27017/admin?ssl=false&quot;</span></span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;9216:9216&quot;</span></span><br></pre></td></tr></table></figure>

<p>创建监控用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it mongo mongo admin</span><br><span class="line">&gt; db.auth(<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>)</span><br><span class="line">&gt;db.createUser(&#123; user: <span class="string">&#x27;exporter&#x27;</span>,<span class="built_in">pwd</span> : <span class="string">&#x27;password&#x27;</span>,roles:[&#123;role: <span class="string">&#x27;readAnyDatabase&#x27;</span>,db : <span class="string">&#x27;admin&#x27;</span>&#125;,&#123;role: <span class="string">&#x27;clusterMonitor&#x27;</span>,db : <span class="string">&#x27;admin&#x27;</span>&#125;]&#125;);</span><br><span class="line"><span class="comment">#测试 使用上面创建的用户信息进行连接</span></span><br><span class="line">&gt; db.auth(<span class="string">&#x27;exporter&#x27;</span>,<span class="string">&#x27;password&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="4-2-mongodb服务器指标查询"><a href="#4-2-mongodb服务器指标查询" class="headerlink" title="4.2 mongodb服务器指标查询"></a>4.2 mongodb服务器指标查询</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mongodb_connections&#123;state=<span class="string">&quot;available&quot;</span>&#125; <span class="comment">#可用的连接数</span></span><br><span class="line">mongodb_connections&#123;state=<span class="string">&quot;current&quot;</span>&#125;   <span class="comment">#当前连接数 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#关于server status</span></span><br><span class="line">mongodb_up                       <span class="comment">#服务器是否在线</span></span><br><span class="line">mongodb_instance_uptime_seconds  <span class="comment">#服务器的运行时长,单位为秒</span></span><br></pre></td></tr></table></figure>

<h1 id="5-Nginx-Exporter"><a href="#5-Nginx-Exporter" class="headerlink" title="5 Nginx Exporter"></a>5 Nginx Exporter</h1><h2 id="5-1-容器部署"><a href="#5-1-容器部署" class="headerlink" title="5.1 容器部署"></a>5.1 容器部署</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/nginx/nginx-prometheus-exporter</span><br><span class="line">root@ubuntu2004:~/learning-prometheus/08-prometheus-components-compose/nginx-and-exporter# vim docker-compose.yml </span><br><span class="line">version: <span class="string">&#x27;3.6&#x27;</span></span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  monitoring:</span><br><span class="line">    driver: bridge</span><br><span class="line">    ipam:</span><br><span class="line">      config:</span><br><span class="line">        - subnet: 192.168.100.0/24</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  nginx:</span><br><span class="line">    image: nginx:1.26.2</span><br><span class="line">    volumes:</span><br><span class="line">      - ./nginx/stub_status-server.conf:/etc/nginx/conf.d/stub_status-server.conf:ro</span><br><span class="line">    networks:</span><br><span class="line">      - monitoring</span><br><span class="line">    expose:</span><br><span class="line">      - 8080</span><br><span class="line">      - 80</span><br><span class="line">    ports:</span><br><span class="line">      - 80:80</span><br><span class="line"></span><br><span class="line">  nginx-exporter:</span><br><span class="line">    image: nginx/nginx-prometheus-exporter:1.4.0</span><br><span class="line">    <span class="built_in">command</span>:</span><br><span class="line">      - <span class="string">&#x27;-nginx.scrape-uri=http://nginx:8080/stub_status&#x27;</span></span><br><span class="line">    networks:</span><br><span class="line">      - monitoring</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&#x27;9113:9113&#x27;</span></span><br><span class="line">    depends_on:</span><br><span class="line">      - nginx</span><br><span class="line"></span><br><span class="line">root@ubuntu2004:~/learning-prometheus/08-prometheus-components-compose/nginx-and-exporter# <span class="built_in">cat</span> nginx/stub_status-server.conf </span><br><span class="line">server &#123;</span><br><span class="line">    listen 8080;</span><br><span class="line">    server_name localhost;</span><br><span class="line"></span><br><span class="line">    location /stub_status &#123;</span><br><span class="line">        stub_status;</span><br><span class="line"></span><br><span class="line">        access_log off;</span><br><span class="line">        <span class="comment">#allow 172.31.0.0/16;</span></span><br><span class="line">        <span class="comment">#deny all;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">root@ubuntu2004:~/nginx# docker-compose pull</span><br><span class="line">root@ubuntu2004:~/nginx# docker-compose ps</span><br><span class="line">NAME                     IMAGE                                   COMMAND                  SERVICE          CREATED          STATUS         PORTS</span><br><span class="line">nginx-nginx-1            nginx:1.26.2                            <span class="string">&quot;/docker-entrypoint.…&quot;</span>   nginx            7 seconds ago    Up 7 seconds   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp, 8080/tcp</span><br><span class="line">nginx-nginx-exporter-1   nginx/nginx-prometheus-exporter:1.4.0   <span class="string">&quot;/usr/bin/nginx-prom…&quot;</span>   nginx-exporter   24 minutes ago   Up 6 seconds   0.0.0.0:9113-&gt;9113/tcp, :::9113-&gt;9113/tcp</span><br></pre></td></tr></table></figure>

<p>编辑Prometheus配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2004:~# vim /usr/local/prometheus/prometheus.yml </span><br><span class="line">scrape_configs:</span><br><span class="line">  <span class="comment"># 添加下列</span></span><br><span class="line">  - job_name: <span class="string">&quot;nginx&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [<span class="string">&quot;10.0.0.204:9113&quot;</span>]</span><br><span class="line">      </span><br><span class="line">root@ubuntu2004:~# systemctl reload prometheus.service </span><br></pre></td></tr></table></figure>

<h2 id="5-2-nginx监控指标"><a href="#5-2-nginx监控指标" class="headerlink" title="5.2 nginx监控指标"></a>5.2 nginx监控指标</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nginx_connections_accepted  <span class="comment">#接收请求数</span></span><br><span class="line">nginx_connections_active    <span class="comment">#活动连接数</span></span><br><span class="line">nginx_connections_handled   <span class="comment">#成功处理请求数</span></span><br><span class="line">nginx_connections_reading   <span class="comment">#正在进行读操作的请求数</span></span><br><span class="line">nginx_connections_waiting   <span class="comment">#正在等待的请求数</span></span><br><span class="line">nginx_connections_writing   <span class="comment">#正在进行写操作的请求数</span></span><br><span class="line">nginx_connections_requests  <span class="comment">#总请求数</span></span><br></pre></td></tr></table></figure>

<h1 id="6-Consul-Exporter"><a href="#6-Consul-Exporter" class="headerlink" title="6 Consul Exporter"></a>6 Consul Exporter</h1><h2 id="6-1-部署Consul"><a href="#6-1-部署Consul" class="headerlink" title="6.1 部署Consul"></a>6.1 部署Consul</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/hashicorp/consul</span><br></pre></td></tr></table></figure>

<p>下载Consul并展开，创建用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/hashicorp/consul/archive/refs/tags/v1.20.2.tar.gz</span><br><span class="line"><span class="built_in">mkdir</span> -p /usr/local/consul/config/data</span><br><span class="line">tar xf consul_1.20.2_linux_amd64.tar.gz -C /usr/local/consul</span><br><span class="line">useradd -r consul</span><br><span class="line"><span class="built_in">chown</span> consul.consul /usr/local/consul/&#123;data,config&#125;</span><br></pre></td></tr></table></figure>

<p>创建Systemd Unitfile，保存于 &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;consul.service 文件中:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=<span class="string">&quot;HashiCorp Consul - A service mesh solution&quot;</span></span><br><span class="line">Documentation=https://www.consul.io/</span><br><span class="line">Requires=network-online.target</span><br><span class="line">After=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=-/etc/consul.d/consul.env</span><br><span class="line">User=consul</span><br><span class="line">Group=consul</span><br><span class="line">ExecStart=/usr/bin/consul agent -dev -bootstrap \</span><br><span class="line">            -config-dir /usr/local/consul/config \</span><br><span class="line">            -data-dir /usr/local/consul/data \</span><br><span class="line">            -ui \</span><br><span class="line">            -log-level INFO \</span><br><span class="line">            -<span class="built_in">bind</span> 127.0.0.1 \</span><br><span class="line">            -client 0.0.0.0</span><br><span class="line">ExecReload=/bin/kill --signal HUP <span class="variable">$MAINPID</span></span><br><span class="line">KillMode=process</span><br><span class="line">KillSignal=SIGTERM</span><br><span class="line">Restart=on-failure</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>配置参数说明</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-server  <span class="comment">#提供此标志指定您希望代理以服务器模式启动。</span></span><br><span class="line">-dev		 <span class="comment">#启动开发者模式</span></span><br><span class="line">-ui			 <span class="comment">#打开内置的web界面</span></span><br><span class="line"></span><br><span class="line">-bootstrap-expect 	<span class="comment">#这告诉Consul服务器数据中心应该总共有多少服务器。所有服务器将等待此数量的服务器加入后再引导复制日志，这保持所有服务器上的数据一致性。因为您正在设置一个单服务器数据中心，您将其值设置为1。</span></span><br><span class="line"></span><br><span class="line">-node 	<span class="comment">#数据中心中的每个节点必须有一个唯一的名称。默认情况下，Consul使用机器的主机名，但您将手动覆盖它，并将其设置为agent-one。</span></span><br><span class="line">        </span><br><span class="line">-<span class="built_in">bind</span> 	<span class="comment">#这是此代理将在其上监听来自其他Consul成员通信的地址。它必须可以被数据中心中的所有其他节点访问。如果您不设置绑定地址，Consul将尝试监听所有IPv4接口，如果找到多个私有IP，将无法启动。由于生产服务器通常具有多个接口，您应始终提供一个绑定地址。在这种情况下，它是172.20.20.10，这是您在Vagrantfile中指定的第一个虚拟机的地址。</span></span><br><span class="line"></span><br><span class="line">-data-dir 	  <span class="comment">#此标志告诉Consul代理它们应该在哪里存储其状态，其中可能包含ACL令牌等敏感数据，用于服务器和客户端。在生产部署中，您应该注意此目录的权限。</span></span><br><span class="line"></span><br><span class="line">-config-dir 	<span class="comment">#此标志告诉Consul在哪里查找其配置。您将其设置为标准位置：/etc/consul.d。</span></span><br></pre></td></tr></table></figure>

<p>启动服务并验证监听的端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start consul.service</span><br><span class="line">systemctl <span class="built_in">enable</span> consul.service</span><br></pre></td></tr></table></figure>

<p>随后即可访问Consul的Web UI，其使用的URL如下: http:&#x2F;&#x2F;:8500&#x2F;</p>
<h2 id="6-2-部署Consul-Exporter"><a href="#6-2-部署Consul-Exporter" class="headerlink" title="6.2 部署Consul Exporter"></a>6.2 部署Consul Exporter</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/prometheus/consul_exporter</span><br></pre></td></tr></table></figure>

<p>提示：仅需要为每个Consul实例部署consul-exporter，它负责将Consul的状态信息转为Prometheus兼容的指标格式并予以暴露。</p>
<p>下载Consul Exporter并展开，创建用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/prometheus/consul_exporter/releases/download/v0.13.0/consul_exporter-0.13.0.linux-amd64.tar.gz</span><br><span class="line">tar xf consul_exporter-0.13.0.linux-amd64.tar.gz -C /usr/local/</span><br><span class="line"><span class="built_in">ln</span> -sv /usr/local/consul_exporter-0.13.0.linux-amd64 /usr/local/consul_exporter</span><br><span class="line">useradd -r consul</span><br></pre></td></tr></table></figure>

<p>创建Systemd Unitfile，保存于&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;consul_exporter.service文件中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=consul_exporter</span><br><span class="line">Documentation=https://prometheus.io/docs/introduction/overview/</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">User=consul</span><br><span class="line">EnvironmentFile=-/etc/default/consul_exporter</span><br><span class="line"><span class="comment"># 具体使用时，若consul_exporter与consul server不在同一主机时，consul server要指向实际的地址；</span></span><br><span class="line">ExecStart=/usr/local/consul_exporter/consul_exporter \</span><br><span class="line">            --consul.server=<span class="string">&quot;http://localhost:8500&quot;</span> \</span><br><span class="line">            --web.listen-address=<span class="string">&quot;:9107&quot;</span> \</span><br><span class="line">            --web.telemetry-path=<span class="string">&quot;/metrics&quot;</span> \</span><br><span class="line">            --log.level=info \</span><br><span class="line">            <span class="variable">$ARGS</span></span><br><span class="line">ExecReload=/bin/kill -HUP <span class="variable">$MAINPID</span></span><br><span class="line">TimeoutStopSec=20s</span><br><span class="line">Restart=always</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>启动服务并验证监听的端口，测试访问其暴露的指标</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ss -tnlp | grep <span class="string">&#x27;9107&#x27;</span></span><br><span class="line">curl localhost:9107/metrics</span><br></pre></td></tr></table></figure>

<p>编辑Prometheus配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2004:~# vim /usr/local/prometheus/prometheus.yml </span><br><span class="line">scrape_configs:</span><br><span class="line">  <span class="comment"># 添加下列</span></span><br><span class="line">  - job_name: <span class="string">&quot;consul&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [<span class="string">&quot;10.0.0.204:9107&quot;</span>]</span><br><span class="line">      </span><br><span class="line">root@ubuntu2004:~# systemctl reload prometheus.service </span><br></pre></td></tr></table></figure>

<h2 id="6-3-容器化运行"><a href="#6-3-容器化运行" class="headerlink" title="6.3 容器化运行"></a>6.3 容器化运行</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2004:~/learning-prometheus/08-prometheus-components-compose/consul-and-exporter# <span class="built_in">cat</span> docker-compose.yml </span><br><span class="line">version: <span class="string">&#x27;3.6&#x27;</span></span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  consul_data: &#123;&#125;</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  monitoring:</span><br><span class="line">    driver: bridge</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  consul:</span><br><span class="line">    image: hashicorp/consul:1.20</span><br><span class="line">    volumes:</span><br><span class="line">      - ./consul_configs:/consul/config</span><br><span class="line">      - consul_data:/consul/data/</span><br><span class="line">    networks:</span><br><span class="line">      - monitoring</span><br><span class="line">    ports:</span><br><span class="line">      - 8500:8500</span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">&quot;consul&quot;</span>,<span class="string">&quot;agent&quot;</span>,<span class="string">&quot;-dev&quot;</span>,<span class="string">&quot;-bootstrap&quot;</span>,<span class="string">&quot;-config-dir&quot;</span>,<span class="string">&quot;/consul/config&quot;</span>,<span class="string">&quot;-data-dir&quot;</span>,<span class="string">&quot;/consul/data&quot;</span>,<span class="string">&quot;-ui&quot;</span>,<span class="string">&quot;-log-level&quot;</span>,<span class="string">&quot;INFO&quot;</span>,<span class="string">&quot;-bind&quot;</span>,<span class="string">&quot;127.0.0.1&quot;</span>,<span class="string">&quot;-client&quot;</span>,<span class="string">&quot;0.0.0.0&quot;</span>]</span><br><span class="line"></span><br><span class="line">  consul-exporter:</span><br><span class="line">    image: prom/consul-exporter:v0.13.0</span><br><span class="line">    networks:</span><br><span class="line">      - monitoring</span><br><span class="line">    ports:</span><br><span class="line">      - 9107:9107</span><br><span class="line">    <span class="built_in">command</span>:</span><br><span class="line">      - <span class="string">&quot;--consul.server=consul:8500&quot;</span></span><br><span class="line">    depends_on:</span><br><span class="line">      - consul</span><br></pre></td></tr></table></figure>

<h1 id="7-Redis-Exporter"><a href="#7-Redis-Exporter" class="headerlink" title="7 Redis Exporter"></a>7 Redis Exporter</h1><h2 id="7-1-容器部署"><a href="#7-1-容器部署" class="headerlink" title="7.1 容器部署"></a>7.1 容器部署</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:6</span><br><span class="line">    container_name: redis</span><br><span class="line">    restart: always</span><br><span class="line">    volumes:</span><br><span class="line">      - /data/redis/data:/data</span><br><span class="line">    <span class="built_in">command</span>: redis-server --maxmemory 512mb</span><br><span class="line">    ports:</span><br><span class="line">      - 6379:6379</span><br><span class="line">      </span><br><span class="line">  redis_exporter:</span><br><span class="line">    image: oliver006/redis_exporter</span><br><span class="line">    container_name: redis_exporter</span><br><span class="line">    restart: always</span><br><span class="line">    environment: </span><br><span class="line">      REDIS_ADDR: <span class="string">&quot;192.168.28.110:6379&quot;</span></span><br><span class="line">      REDIS_PASSWORD: </span><br><span class="line">    ports:</span><br><span class="line">      - 9121:9121</span><br></pre></td></tr></table></figure>

<h2 id="7-2-k8s部署"><a href="#7-2-k8s部署" class="headerlink" title="7.2 k8s部署"></a>7.2 k8s部署</h2><p>如果 redis-server 跑在k8s中，那我们通常不会裸部署一个redis_exporter，而是会以 sidecar 的形式将 redis_exporter 和主应用 redis_server 部署在同一个 Pod 中</p>
<p>redis 这个 Pod 中包含了两个容器，一个就是 redis 本身的主应用，另外一个容器就是 redis_exporter。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: redis</span><br><span class="line">  namespace: prom</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: redis</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      annotations:</span><br><span class="line">        prometheus.io/scrape: <span class="string">&quot;true&quot;</span></span><br><span class="line">        prometheus.io/port: <span class="string">&quot;9121&quot;</span></span><br><span class="line">      labels:</span><br><span class="line">        app: redis</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: redis</span><br><span class="line">        image: redis:4</span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 100m</span><br><span class="line">            memory: 100Mi</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 6379</span><br><span class="line">      - name: redis-exporter</span><br><span class="line">        image: oliver006/redis_exporter:latest</span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 100m</span><br><span class="line">            memory: 100Mi</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 9121</span><br><span class="line">---</span><br><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: redis</span><br><span class="line">  namespace: prom</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: redis</span><br><span class="line">  ports:</span><br><span class="line">  - name: redis</span><br><span class="line">    port: 6379</span><br><span class="line">    targetPort: 6379</span><br><span class="line">  - name: prom</span><br><span class="line">    port: 9121</span><br><span class="line">    targetPort: 9121</span><br><span class="line">    </span><br><span class="line">[root@master prom]# kubectl apply -f prome-redis.yaml</span><br><span class="line">deployment.apps/redis created</span><br><span class="line">service/redis created</span><br><span class="line"></span><br><span class="line">[root@master prom]# kubectl get pods -n prom</span><br><span class="line">NAME                        READY   STATUS    RESTARTS       AGE</span><br><span class="line">prometheus-cfc6c98f-dshdt   1/1     Running   1 (152m ago)   20h</span><br><span class="line">redis-65c96d4bb4-fz55l      2/2     Running   0              39s</span><br><span class="line"></span><br><span class="line">[root@master prom]# kubectl get svc -n prom </span><br><span class="line">NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)             AGE</span><br><span class="line">prometheus   NodePort    10.98.38.77     &lt;none&gt;        9090:32197/TCP      20h</span><br><span class="line">redis        ClusterIP   10.111.11.242   &lt;none&gt;        6379/TCP,9121/TCP   41s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 9121 端口来校验是否能够采集到数据</span></span><br><span class="line">[root@master prom]# curl 10.111.11.242:9121/metrics</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新 Prometheus 的配置文件</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: prometheus-config</span><br><span class="line">  namespace: prom</span><br><span class="line">data:</span><br><span class="line">  prometheus.yml: |</span><br><span class="line">    global:</span><br><span class="line">      scrape_interval: 15s</span><br><span class="line">      scrape_timeout: 15s</span><br><span class="line"></span><br><span class="line">    scrape_configs:</span><br><span class="line">    - job_name: <span class="string">&#x27;prometheus&#x27;</span></span><br><span class="line">      static_configs:</span><br><span class="line">        - targets: [<span class="string">&#x27;localhost:9090&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    - job_name: <span class="string">&#x27;redis&#x27;</span></span><br><span class="line">      static_configs:</span><br><span class="line">        - targets: [<span class="string">&#x27;redis:9121&#x27;</span>]</span><br><span class="line"></span><br><span class="line">[root@master prom]# kubectl apply -f prometheus-cm.yaml</span><br><span class="line">configmap/prometheus-config configured</span><br><span class="line"></span><br><span class="line">[root@master prom]# curl -X POST <span class="string">&quot;http://10.98.38.77:9090/-/reload&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="Redis服务器指标查询"><a href="#Redis服务器指标查询" class="headerlink" title="Redis服务器指标查询"></a>Redis服务器指标查询</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">redis_up                     <span class="comment">#服务器是否在线</span></span><br><span class="line">redis_uptime_in_seconds      <span class="comment">#运行时长,单位s</span></span><br><span class="line">rate(redis_cpu_sys_seconds_total[1m])+rate(redis_cpu_user_seconds_total[1m]) <span class="comment">#占用CPU核数</span></span><br><span class="line">redis_memory_used_bytes                  <span class="comment">#占用内存量</span></span><br><span class="line">redis_memory_max_bytes                   <span class="comment">#限制的最大内存,如果没限制则为0</span></span><br><span class="line">delta(redis_net_input_bytes_total[1m])   <span class="comment">#网络接受的bytes</span></span><br><span class="line">delta(redis_net_output_bytes_total[1m])  <span class="comment">#网络发送的bytes</span></span><br><span class="line">redis_connected_clients                              <span class="comment">#客户端连接数</span></span><br><span class="line">redis_connected_clients / redis_config_maxclients    <span class="comment">#连接数使用率</span></span><br><span class="line">redis_rejected_connections_total                     <span class="comment">#拒绝的客户端连接数</span></span><br><span class="line">redis_connected_slaves                               <span class="comment">#slave连接数</span></span><br></pre></td></tr></table></figure>

<h1 id="8-黑盒监控Blackbox-Exporter"><a href="#8-黑盒监控Blackbox-Exporter" class="headerlink" title="8 黑盒监控Blackbox Exporter"></a>8 黑盒监控Blackbox Exporter</h1><p>“白盒监控”是需要把对应的Exporter程序安装到被监控的目标主机上，从而实现对主机各种资源及其状态的数据采集工作。</p>
<p>但是由于某些情况下操作技术或其他原因，不是所有的Exporter都能部署到被监控的主机环境中，最典型的例子是监控全国网络质量的稳定性，通常的方法是使用ping操作，对选取的节点进行ICMP测试，此时不可能在他人应用环境中部署相关的Exporter程序。针对这样的应用的场景，Prometheus社区提供了黑盒解决方案，Blackbox Exporter无须安装在被监控的目标环境中，用户只需要将其安装在与Prometheus和被监控目标互通的环境中，通过HTTP、HTTPS、DNS、TCP、ICMP等方式（探针）进行探测监控，还可以探测SSL证书过期时间，Blackbox Exporter去获取被监控目标的暴露出来的数据，返回给Prometheus</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/prometheus/blackbox_exporter</span><br></pre></td></tr></table></figure>

<h2 id="8-1-二进制部署"><a href="#8-1-二进制部署" class="headerlink" title="8.1 二进制部署"></a>8.1 二进制部署</h2><p>提示：仅需要部署的Blackbox Exporter实例数据，取决于黑盒监控的任务量及节点的可用资源。</p>
<p>blackbox_exporter组件，需要一个config.yml，用于指示当前黑盒监控可以具备哪些监控能力</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget https://github.com/prometheus/blackbox_exporter/releases/download/v0.25.0/blackbox_exporter-0.25.0.linux-amd64.tar.gz</span></span><br><span class="line"><span class="comment"># tar xf blackbox_exporter-0.25.0.linux-amd64.tar.gz -C /usr/local/</span></span><br><span class="line"><span class="comment"># ln -sv /usr/local/blackbox_exporter-0.25.0.linux-amd64 /usr/local/blackbox_exporter</span></span><br><span class="line"><span class="comment"># useradd -r prometheus</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># /usr/lib/systemd/system/blackbox_exporter.service</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=blackbox_exporter</span><br><span class="line">Documentation=https://prometheus.io/docs/introduction/overview/</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">User=prometheus</span><br><span class="line">EnvironmentFile=-/etc/default/blackbox_exporter</span><br><span class="line">ExecStart=/usr/local/blackbox_exporter/blackbox_exporter \</span><br><span class="line">            --web.listen-address=<span class="string">&quot;:9115&quot;</span> \</span><br><span class="line">            --config.file=<span class="string">&quot;/usr/local/blackbox_exporter/blackbox.yml&quot;</span> \</span><br><span class="line">            --config.check \            </span><br><span class="line">            <span class="variable">$ARGS</span></span><br><span class="line">ExecReload=/bin/kill -HUP <span class="variable">$MAINPID</span></span><br><span class="line">TimeoutStopSec=20s</span><br><span class="line">Restart=always</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start blackbox_exporter.service</span><br><span class="line">systemctl <span class="built_in">enable</span> blackbox_exporter.service</span><br><span class="line"></span><br><span class="line">ss -tnlp | grep <span class="string">&#x27;9115&#x27;</span></span><br><span class="line">curl localhost:9115/metrics</span><br></pre></td></tr></table></figure>

<p>随后即可访问Blackbox Exporter的Web UI，其使用的URL如下: <code>http://localhost:9115/</code></p>
<p>配置Prometheus使用黑盒监控，编辑prometheus的主配置文件prometheus.yml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#http配置</span></span><br><span class="line">- job_name: <span class="string">&#x27;blackbox_http&#x27;</span></span><br><span class="line">  metrics_path: /probe</span><br><span class="line">  params:</span><br><span class="line">    module: [http_2xx]  <span class="comment"># Look for a HTTP 200 response.</span></span><br><span class="line">  static_configs:</span><br><span class="line">  - targets:</span><br><span class="line">    - <span class="string">&quot;www.magedu.com&quot;</span></span><br><span class="line">    - <span class="string">&quot;www.google.com&quot;</span></span><br><span class="line">  relabel_configs:</span><br><span class="line">    - source_labels: [__address__]</span><br><span class="line">      target_label: __param_target</span><br><span class="line">    - source_labels: [__param_target]</span><br><span class="line">      target_label: instance</span><br><span class="line">    - target_label: __address__</span><br><span class="line">      replacement: <span class="string">&quot;prometheus.magedu.com:9115&quot;</span>  <span class="comment"># 指向实际的Blackbox exporter.</span></span><br><span class="line">    - target_label: region</span><br><span class="line">      replacement: <span class="string">&quot;local&quot;</span></span><br><span class="line">      </span><br><span class="line"><span class="comment">#tcp配置</span></span><br><span class="line">- job_name: <span class="string">&quot;blackbox_tcp&quot;</span></span><br><span class="line">  metrics_path: /probe</span><br><span class="line">  params:</span><br><span class="line">    module: [tcp_connect]</span><br><span class="line">  static_configs:</span><br><span class="line">    - targets: </span><br><span class="line">      - 192.168.28.100:9090</span><br><span class="line">      - 192.168.28.110:9100</span><br><span class="line">  relabel_configs:</span><br><span class="line">    - source_labels: [__address__]</span><br><span class="line">      target_label: __param_target</span><br><span class="line">    - source_labels: [__param_target]</span><br><span class="line">      target_label: instance</span><br><span class="line">    - target_label: __address__</span><br><span class="line">      replacement: blackbox_exporter:9115</span><br><span class="line"></span><br><span class="line"><span class="comment">#icmp配置 ping</span></span><br><span class="line">- job_name: <span class="string">&quot;blackbox_icmp&quot;</span></span><br><span class="line">  metrics_path: /probe</span><br><span class="line">  params:</span><br><span class="line">    module: [icmp]</span><br><span class="line">  static_configs:</span><br><span class="line">    - targets: </span><br><span class="line">      - 192.168.28.100</span><br><span class="line">      - 192.168.28.110</span><br><span class="line">  relabel_configs:</span><br><span class="line">    - source_labels: [__address__]</span><br><span class="line">      target_label: __param_target</span><br><span class="line">    - source_labels: [__param_target]</span><br><span class="line">      target_label: instance</span><br><span class="line">    - target_label: __address__</span><br><span class="line">      replacement: blackbox_exporter:9115</span><br></pre></td></tr></table></figure>

<h2 id="8-2-容器化部署"><a href="#8-2-容器化部署" class="headerlink" title="8.2 容器化部署"></a>8.2 容器化部署</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu2004:~/learning-prometheus/08-prometheus-components-compose/blackbox-exporter# <span class="built_in">cat</span> docker-compose.yml</span><br><span class="line">version: <span class="string">&#x27;3.6&#x27;</span></span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  monitoring:</span><br><span class="line">    driver: bridge</span><br><span class="line">    ipam:</span><br><span class="line">      config:</span><br><span class="line">        - subnet: 192.168.200.0/24</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  blackbox_exporter:</span><br><span class="line">    image: prom/blackbox-exporter:v0.25.0</span><br><span class="line">    volumes:</span><br><span class="line">      - ./configs/:/etc/blackboxexporter/</span><br><span class="line">    <span class="built_in">command</span>:</span><br><span class="line">      - <span class="string">&#x27;--config.file=/etc/blackboxexporter/blackbox.yml&#x27;</span></span><br><span class="line">    networks:</span><br><span class="line">      - monitoring</span><br><span class="line">    ports:</span><br><span class="line">      - 9115:9115</span><br></pre></td></tr></table></figure>

<h2 id="8-3-blackbox的监控项"><a href="#8-3-blackbox的监控项" class="headerlink" title="8.3 blackbox的监控项"></a>8.3 blackbox的监控项</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">probe_success                   <span class="comment"># 是否探测成功（取值 1、0 分别表示成功、失败）</span></span><br><span class="line">probe_duration_seconds          <span class="comment"># 探测的耗时</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关于 DNS</span></span><br><span class="line">probe_dns_lookup_time_seconds   <span class="comment"># DNS 解析的耗时</span></span><br><span class="line">probe_ip_protocol               <span class="comment"># IP 协议，取值为 4、6</span></span><br><span class="line">probe_ip_addr_hash              <span class="comment"># IP 地址的哈希值，用于判断 IP 是否变化</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关于 HTTP</span></span><br><span class="line">probe_http_status_code          <span class="comment"># HTTP 响应的状态码。如果发生重定向，则取决于最后一次响应</span></span><br><span class="line">probe_http_content_length       <span class="comment"># HTTP 响应的 body 长度，单位 bytes</span></span><br><span class="line">probe_http_version              <span class="comment"># HTTP 响应的协议版本，比如 1.1</span></span><br><span class="line">probe_http_ssl                  <span class="comment"># HTTP 响应是否采用 SSL ，取值为 1、0</span></span><br><span class="line">probe_ssl_earliest_cert_expiry  <span class="comment"># SSL 证书的过期时间，为 Unix 时间戳</span></span><br></pre></td></tr></table></figure>

<p>修复检测总耗时图形，可检测各个target的耗时情况。探测不通的target往往耗时很久</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">options选项，&#123;&#123;<span class="built_in">env</span>&#125;&#125;_&#123;&#123;name&#125;&#125;</span><br><span class="line">修改为：&#123;&#123;instance&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ICMP&#x2F;HTTPS检测类 阶段耗时</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">options选项，&#123;&#123;<span class="built_in">env</span>&#125;&#125;_&#123;&#123;name&#125;&#125; &#123;&#123;phase&#125;&#125;</span><br><span class="line">修改为：&#123;&#123;instance&#125;&#125; &#123;&#123;phase&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>网站HTTP状态检查</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">options选项，&#123;&#123;<span class="built_in">env</span>&#125;&#125;_&#123;&#123;name&#125;&#125;</span><br><span class="line">修改为：&#123;&#123;instance&#125;&#125;</span><br></pre></td></tr></table></figure>

<h1 id="9-监控springboot"><a href="#9-监控springboot" class="headerlink" title="9 监控springboot"></a>9 监控springboot</h1><p>prometheus中配置springboot的监控节点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- job_name: <span class="string">&#x27;SpringBoot&#x27;</span></span><br><span class="line">  scrape_interval: 5s</span><br><span class="line">  metrics_path: <span class="string">&#x27;/actuator/prometheus&#x27;</span>  <span class="comment"># springboot暴露出的指标api</span></span><br><span class="line">  static_configs:</span><br><span class="line">  - targets: [<span class="string">&#x27;192.168.28.110:8081&#x27;</span>]  <span class="comment"># springboot所在主机</span></span><br><span class="line">    labels:</span><br><span class="line">      instance: springboot服务器</span><br></pre></td></tr></table></figure>

<p>springboot监控指标查询</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#http请求</span></span><br><span class="line">http_server_requests_seconds_count：请求此时</span><br><span class="line">http_server_requests_seconds_max ：http请求数峰值</span><br><span class="line">http_server_requests_seconds_sum： 请求n次花费的时间</span><br><span class="line"></span><br><span class="line"><span class="comment">#jvm缓冲区</span></span><br><span class="line">jvm_buffer_count_buffers：计数缓冲</span><br><span class="line">jvm_buffer_memory_used_bytes：缓冲内存使用大小</span><br><span class="line">jvm_buffer_total_capacity_bytes：缓冲容量大小</span><br><span class="line"></span><br><span class="line"><span class="comment">#类信息</span></span><br><span class="line">jvm_classes_loaded_classes：已加载类个数</span><br><span class="line">jvm_classes_unloaded_classes_total：已卸载类总数</span><br><span class="line"></span><br><span class="line"><span class="comment">#内存信息</span></span><br><span class="line">jvm_memory_committed_bytes：已提交内存</span><br><span class="line">jvm_memory_max_bytes： 最大内存</span><br><span class="line">jvm_memory_used_bytes：已使用内存</span><br><span class="line"></span><br><span class="line"><span class="comment">#gc信息</span></span><br><span class="line">jvm_gc_live_data_size_bytes：gc存活数据大小</span><br><span class="line">jvm_gc_max_data_size_bytes：gc最大数据大小</span><br><span class="line">jvm_gc_memory_allocated_bytes_total：gc分配的内存大小</span><br><span class="line">jvm_gc_memory_promoted_bytes_total：gc晋升到下一代的内存大小</span><br><span class="line">jvm_gc_pause_seconds：gc等待的时间</span><br><span class="line">jvm_gc_pause_seconds_max：gc等待的最大时间</span><br><span class="line"></span><br><span class="line"><span class="comment">#线程信息</span></span><br><span class="line">jvm_threads_daemon_threads：守护线程</span><br><span class="line">jvm_threads_live_threads：存活线程</span><br><span class="line">jvm_threads_peak_threads：线程峰值</span><br><span class="line">jvm_threads_states_thread：不同状态的线程</span><br><span class="line">tomcat_threads_busy_threads：繁忙的线程数</span><br><span class="line">tomcat_threads_config_max_threads：配置的最大线程数</span><br><span class="line">tomcat_threads_current_threads：当前线程数</span><br><span class="line"></span><br><span class="line"><span class="comment">#进程信息</span></span><br><span class="line">process_cpu_usage：cpu使用率</span><br><span class="line">process_files_max_files：最大文件数</span><br><span class="line">process_files_open_files：打开文件数</span><br><span class="line">process_start_time_seconds：进程启动时刻</span><br><span class="line">process_uptime_seconds：进程运行时间</span><br><span class="line"></span><br><span class="line"><span class="comment">#系统信息</span></span><br><span class="line">system_cpu_count：cpu个数</span><br><span class="line">system_cpu_usage：cpu使用情况</span><br><span class="line">system_load_average_1m：系统平均负载</span><br><span class="line"></span><br><span class="line"><span class="comment">#tomcat信息</span></span><br><span class="line">tomcat_global_error_total：总体报错数</span><br><span class="line">tomcat_global_received_bytes_total：接收的字节总数</span><br><span class="line">tomcat_global_sent_bytes_total：发出的字节总数</span><br><span class="line">tomcat_global_request_max_seconds：每秒最大请求数</span><br><span class="line">tomcat_global_request_seconds：每秒请求数</span><br><span class="line">tomcat_sessions_active_current_sessions：目前活跃会话数</span><br><span class="line">tomcat_sessions_active_max_sessions：活跃最大会话数</span><br><span class="line">tomcat_sessions_alive_max_seconds：会话活跃的最长时间</span><br><span class="line">tomcat_sessions_created_sessions_total：累计创建的会话数</span><br><span class="line">tomcat_sessions_expired_sessions_total：累计失效的会话数</span><br><span class="line">tomcat_sessions_rejected_sessions_total：累计拒绝的会话数</span><br></pre></td></tr></table></figure>

<h1 id="10-自定义监控"><a href="#10-自定义监控" class="headerlink" title="10 自定义监控"></a>10 自定义监控</h1><p>我们已经实现了对于操作系统、硬件、系统、应用程序(比如springboot程序)中间件等的监控。但如果想对一些业务指标做监控（比如想要知道一个订单系统的实时订单数、订单金额、一个用户系统的在线人数，应该怎么做呢？——需要进行自定义监控</p>
<h2 id="10-1-业务监控-自定义监控指标"><a href="#10-1-业务监控-自定义监控指标" class="headerlink" title="10.1 业务监控&#x2F;自定义监控指标"></a>10.1 业务监控&#x2F;自定义监控指标</h2><p>已有的exporter默认采集到的数据不能满足产品、数据需要，需要额外采集其他数据，就需要后端自行写代码。常用的业务指标有：</p>
<p>用户数据指标</p>
<ol>
<li>新增用户 日新增用户数</li>
<li>活跃用户 活跃率</li>
<li>留存用户 留存率</li>
</ol>
<p>活跃用户数：日活、周活、月活</p>
<ol>
<li>活跃率&#x3D;活跃用户数&#x2F;总用户数</li>
<li>留存率&#x3D;（第一天新增用户中在第N天使用过产品的用户数）&#x2F;第一天新增用户数<ul>
<li>通常需要计算：次日、7日、30日留存率）</li>
</ul>
</li>
</ol>
<p>行为数据指标</p>
<ol>
<li>PV&#x3D;page view 访问次数</li>
<li>UV&#x3D;unique visitor 访问人数</li>
<li>转发率&#x3D;转发某功能用户数&#x2F;看到该功能的用户数</li>
<li>转化率：与具体业务相关</li>
<li>K因子（衡量推荐的效果）&#x3D;平均每个用户向多少人发邀请X接收到邀请的人转化为新用户的转化率</li>
</ol>
<p>产品数据指标</p>
<ol>
<li>总量：成交总额（GMV）、成交数量、访问时长</li>
<li>人均付费&#x3D;总收入&#x2F;总用户数（ARPV&#x2F;客单价）</li>
<li>付费用户人均付费&#x3D;总收入&#x2F;付费人数</li>
<li>人均访问时长&#x3D;总时长&#x2F;总用户数</li>
<li>付费率&#x3D;付费人数&#x2F;总用户数</li>
<li>复购率&#x3D;消费两次以上人数&#x2F;付费人数</li>
<li>产品：热销产品数、好评产品数、差评产品数</li>
</ol>
<p>需要注意的是，每家公司都会根据的自身实际情况设立业务指标，因此不同公司的业务指标可能会有所不同。</p>
<p>同一家公司，在不同的阶段可能会侧重于不同的业务指标（比如，初创公司暂不关心收费、付费，优先关注访问人数；等稳定发展了再追求高付费率、高ARPU值）。</p>
<h2 id="10-2-收集业务指标-自定义指标的步骤"><a href="#10-2-收集业务指标-自定义指标的步骤" class="headerlink" title="10.2 收集业务指标&#x2F;自定义指标的步骤"></a>10.2 收集业务指标&#x2F;自定义指标的步骤</h2><ul>
<li>应用程序抛出一些数据指标 -&gt; 给prometheus</li>
<li>Prometheus的服务器加工采集这些数据指标 -&gt; 给Grafana</li>
<li>Grafana用于展现自定义监控指标</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://AquaPluto.github.io">Aquarius</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://aquapluto.github.io/Monitor/prometheus/exporter/">https://aquapluto.github.io/Monitor/prometheus/exporter/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://AquaPluto.github.io" target="_blank">代码推演录</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Prometheus/">Prometheus</a></div><div class="post-share"><div class="social-share" data-image="/img/paper4.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://unpkg.com/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://unpkg.com/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/Monitor/prometheus/promql/" title="PromQL"><img class="cover" src="/img/paper3.png" onerror="onerror=null;src='/img/error-page.png'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">PromQL</div></div><div class="info-2"><div class="info-item-1">1 时间序列数据时间序列数据是在一...</div></div></div></a><a class="pagination-related" href="/Monitor/prometheus/deploy/" title="部署与配置"><img class="cover" src="/img/paper6.png" onerror="onerror=null;src='/img/error-page.png'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">部署与配置</div></div><div class="info-2"><div class="info-item-1">1 使用包管理器Rocky&#x2...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/Monitor/prometheus/cluster-ha/" title="集群与高可用"><img class="cover" src="/img/paper6.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-13</div><div class="info-item-2">集群与高可用</div></div><div class="info-2"><div class="info-item-1">1 Prometheus的本地存储...</div></div></div></a><a class="pagination-related" href="/Monitor/prometheus/indicators-remarked/" title="指标重新打标"><img class="cover" src="/img/paper5.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-27</div><div class="info-item-2">指标重新打标</div></div><div class="info-2"><div class="info-item-1">1 指标抓取的生命周期发现 -&g...</div></div></div></a><a class="pagination-related" href="/Monitor/prometheus/deploy/" title="部署与配置"><img class="cover" src="/img/paper6.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-27</div><div class="info-item-2">部署与配置</div></div><div class="info-2"><div class="info-item-1">1 使用包管理器Rocky&#x2...</div></div></div></a><a class="pagination-related" href="/Monitor/prometheus/introduce/" title="prometheus概述"><img class="cover" src="/img/paper2.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-27</div><div class="info-item-2">prometheus概述</div></div><div class="info-2"><div class="info-item-1">1 Prometheus概述Pro...</div></div></div></a><a class="pagination-related" href="/Monitor/prometheus/pushmanager/" title="使用Pushmanager实现跨机房采集"><img class="cover" src="/img/paper5.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-12</div><div class="info-item-2">使用Pushmanager实现跨机房采集</div></div><div class="info-2"><div class="info-item-1">1 场景介绍跨机房监控服务器时，网...</div></div></div></a><a class="pagination-related" href="/Monitor/prometheus/query-persist/" title="查询结果持久化"><img class="cover" src="/img/paper2.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-27</div><div class="info-item-2">查询结果持久化</div></div><div class="info-2"><div class="info-item-1">1 为什么需要查询结果持久化在Pr...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avator.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Aquarius</div><div class="author-info-description">分享运维开发相关技术</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">138</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/AquaPluto"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/AquaPluto" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://blog.csdn.net/m0_75233142" target="_blank" title="CSDN"><i class="fa-solid fa-code" style="color: #8a2be2;"></i></a><a class="social-icon" href="mailto:wujunlinq@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content"><p>持续更新文章中，有问题请添加wx</p>
<div>
  <img src="/img/wx.jpg" alt="wx" style="width: 100px">
</div>
</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Exporter%E5%9F%BA%E7%A1%80"><span class="toc-text">1 Exporter基础</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Node-Export"><span class="toc-text">2 Node Export</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2"><span class="toc-text">2.1 二进制部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E5%AE%B9%E5%99%A8%E9%83%A8%E7%BD%B2"><span class="toc-text">2.2 容器部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-Node-Exporter%E7%9A%84%E6%8C%87%E6%A0%87"><span class="toc-text">2.3 Node Exporter的指标</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-CPU%E7%9B%91%E6%8E%A7"><span class="toc-text">2.3.1 CPU监控</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E5%86%85%E5%AD%98%E7%9B%91%E6%8E%A7"><span class="toc-text">2.3.2 内存监控</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-%E7%A3%81%E7%9B%98%E4%BD%BF%E7%94%A8%E7%8E%87"><span class="toc-text">2.3.3 磁盘使用率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-4-%E7%BD%91%E7%BB%9C%E9%87%87%E9%9B%86"><span class="toc-text">2.3.4 网络采集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-5-%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1%E7%8A%B6%E6%80%81"><span class="toc-text">2.3.5 系统服务状态</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E9%80%82%E7%94%A8%E4%BA%8E%E4%B8%BB%E6%9C%BA%E7%9B%91%E6%8E%A7%E7%9A%84USE%E6%96%B9%E6%B3%95"><span class="toc-text">2.4 适用于主机监控的USE方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1-CPU%E4%BD%BF%E7%94%A8%E7%8E%87"><span class="toc-text">2.4.1 CPU使用率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-2-CPU%E7%9A%84%E9%A5%B1%E5%92%8C%E5%BA%A6"><span class="toc-text">2.4.2 CPU的饱和度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-3-%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E7%8E%87"><span class="toc-text">2.4.3 内存使用率</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-MySQL-Exporter"><span class="toc-text">3 MySQL Exporter</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%AE%B9%E5%99%A8%E9%83%A8%E7%BD%B2"><span class="toc-text">3.1 容器部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2"><span class="toc-text">3.2 二进制部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-mysql%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8C%87%E6%A0%87%E6%9F%A5%E8%AF%A2"><span class="toc-text">3.3 mysql服务器指标查询</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-Mongodb-Exporter"><span class="toc-text">4 Mongodb Exporter</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%AE%B9%E5%99%A8%E9%83%A8%E7%BD%B2"><span class="toc-text">4.1 容器部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-mongodb%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8C%87%E6%A0%87%E6%9F%A5%E8%AF%A2"><span class="toc-text">4.2 mongodb服务器指标查询</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Nginx-Exporter"><span class="toc-text">5 Nginx Exporter</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E5%AE%B9%E5%99%A8%E9%83%A8%E7%BD%B2"><span class="toc-text">5.1 容器部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-nginx%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87"><span class="toc-text">5.2 nginx监控指标</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-Consul-Exporter"><span class="toc-text">6 Consul Exporter</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E9%83%A8%E7%BD%B2Consul"><span class="toc-text">6.1 部署Consul</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E9%83%A8%E7%BD%B2Consul-Exporter"><span class="toc-text">6.2 部署Consul Exporter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E5%AE%B9%E5%99%A8%E5%8C%96%E8%BF%90%E8%A1%8C"><span class="toc-text">6.3 容器化运行</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-Redis-Exporter"><span class="toc-text">7 Redis Exporter</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-%E5%AE%B9%E5%99%A8%E9%83%A8%E7%BD%B2"><span class="toc-text">7.1 容器部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-k8s%E9%83%A8%E7%BD%B2"><span class="toc-text">7.2 k8s部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8C%87%E6%A0%87%E6%9F%A5%E8%AF%A2"><span class="toc-text">Redis服务器指标查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E9%BB%91%E7%9B%92%E7%9B%91%E6%8E%A7Blackbox-Exporter"><span class="toc-text">8 黑盒监控Blackbox Exporter</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2"><span class="toc-text">8.1 二进制部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E5%AE%B9%E5%99%A8%E5%8C%96%E9%83%A8%E7%BD%B2"><span class="toc-text">8.2 容器化部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-blackbox%E7%9A%84%E7%9B%91%E6%8E%A7%E9%A1%B9"><span class="toc-text">8.3 blackbox的监控项</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E7%9B%91%E6%8E%A7springboot"><span class="toc-text">9 监控springboot</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%91%E6%8E%A7"><span class="toc-text">10 自定义监控</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-%E4%B8%9A%E5%8A%A1%E7%9B%91%E6%8E%A7-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87"><span class="toc-text">10.1 业务监控&#x2F;自定义监控指标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-%E6%94%B6%E9%9B%86%E4%B8%9A%E5%8A%A1%E6%8C%87%E6%A0%87-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E6%A0%87%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-text">10.2 收集业务指标&#x2F;自定义指标的步骤</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Kubernetes/deploy/cluster/" title="集群管理指南"><img src="/img/paper5.png" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="集群管理指南"/></a><div class="content"><a class="title" href="/Kubernetes/deploy/cluster/" title="集群管理指南">集群管理指南</a><time datetime="2025-09-21T02:38:40.000Z" title="发表于 2025-09-21 10:38">2025-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/role/" title="Role角色"><img src="/img/paper1.jpg" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="Role角色"/></a><div class="content"><a class="title" href="/CICD/ansible/role/" title="Role角色">Role角色</a><time datetime="2025-09-13T10:07:53.000Z" title="发表于 2025-09-13 18:07">2025-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/playbook/" title="PlayBook"><img src="/img/paper2.jpg" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="PlayBook"/></a><div class="content"><a class="title" href="/CICD/ansible/playbook/" title="PlayBook">PlayBook</a><time datetime="2025-09-13T10:07:48.000Z" title="发表于 2025-09-13 18:07">2025-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/module/" title="常用模块"><img src="/img/paper6.png" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="常用模块"/></a><div class="content"><a class="title" href="/CICD/ansible/module/" title="常用模块">常用模块</a><time datetime="2025-09-13T10:07:42.000Z" title="发表于 2025-09-13 18:07">2025-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CICD/ansible/command/" title="相关命令"><img src="/img/paper5.png" onerror="this.onerror=null;this.src='/img/error-page.png'" alt="相关命令"/></a><div class="content"><a class="title" href="/CICD/ansible/command/" title="相关命令">相关命令</a><time datetime="2025-09-13T10:07:38.000Z" title="发表于 2025-09-13 18:07">2025-09-13</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Aquarius</span></div><div class="footer_custom_text"><style>
div#runtime {
  font-size: 13px;
  font-weight: bold;
}

div#ghbdages_list {
  height: 1.5rem;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 10px
}

.github-badge {
  display: flex;
  align-items: center;
  margin-inline: 6px;
}
</style>
<div id="runtime"></div>
<div id="ghbdages"></div>
<script>
  function createtime() {
    const now = new Date();
    const grt = new Date("08/01/2025 00:00:00"); // 网站诞生时间

    // 计算天、小时、分钟和秒
    const days = Math.floor((now - grt) / (1000 * 60 * 60 * 24));
    const hours = Math.floor(((now - grt) / (1000 * 60 * 60)) % 24)
      .toString()
      .padStart(2, "0");
    const minutes = Math.floor(((now - grt) / (1000 * 60)) % 60)
      .toString()
      .padStart(2, "0");
    const seconds = Math.floor(((now - grt) / 1000) % 60)
      .toString()
      .padStart(2, "0");

    // HTML 输出
    const currentTimeHtml = `
          <div>
              本站已运行 ${days} 天 ${hours} 小时 ${minutes} 分 ${seconds} 秒 
          </div>`;

    const runtime = document.getElementById("runtime");
    if (runtime) runtime.innerHTML = currentTimeHtml;
  }

  // 设置每秒调用函数
  setInterval(createtime, 1000);

  function renderBadge() {
    const currentTimeHtml = `
      <div id="ghbdages_list">
          <a class="github-badge" target="_blank" href="https://hexo.io/" title="hexo:7.3.0">
              <img src="https://img.shields.io/badge/Frame-Hexo-blue?logo=hexo" alt="Static Badge">
          </a>
          <a class="github-badge" target="_blank" href="https://github.com/" title="github">
              <img src="https://img.shields.io/badge/Code-GitHub-181717?logo=GitHub&color=%23FF7102" alt="Static Badge">
          </a>
          <a class="github-badge" target="_blank" href="https://vercel.com/" title="vercel">
              <img src="https://img.shields.io/badge/Host-Vercel-%23F0D722?logo=Vercel" alt="Static Badge">
          </a>
          <a class="github-badge" target="_blank" href="https://analytics.sysio.ai/" title="umami">
              <img src="https://img.shields.io/badge/Analytics-Umami-%237FB100?logo=umami&logoColor=%237FB100" alt="Static Badge">
          </a>
      </div>`;

    const ghbdages = document.getElementById("ghbdages");
    if (ghbdages) {
      ghbdages.innerHTML = currentTimeHtml;
    }
  }

  window.onload = renderBadge;
</script>
</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://unpkg.com/@fancyapps/ui/dist/fancybox/fancybox.umd.js"></script><script src="https://unpkg.com/instant.page/instantpage.js" type="module"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = 'https://unpkg.com/mathjax/es5/tex-mml-chtml.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'forest'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://unpkg.com/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script src="https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fishes.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://unpkg.com/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章..." type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>